!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("\0commonjsHelpers.js"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@webresto/ng-core"),require("\0commonjs-proxy-@angular/core"),require("\0commonjs-proxy-rxjs"),require("\0commonjs-proxy-rxjs/operators"),require("\0commonjs-proxy-@webresto/ng-core"),require("\0commonjs-proxy-../services/ng-restocart.service"),require("\0commonjs-proxy-../../services/ng-restocart.service"),require("@angular/common"),require("\0commonjs-proxy-@angular/common"),require("\0commonjs-proxy-./directives/add-dish-to-cart.directive"),require("\0commonjs-proxy-./directives/amount-cart.directive"),require("\0commonjs-proxy-./directives/delete-from-cart.directive"),require("\0commonjs-proxy-./directives/order-cart-user.directive"),require("\0commonjs-proxy-./directives/set-amount.directive"),require("\0commonjs-proxy-./directives/dish-calc.directive"),require("\0commonjs-proxy-./directives/checkout.directive"),require("\0commonjs-proxy-./directives/set-dish-comment.directive"),require("\0commonjs-proxy-./components/dish-calc/dish-calc.component"),require("\0commonjs-proxy-./lib/services/ng-restocart.service"),require("\0commonjs-proxy-./lib/ng-cart.module"),require("\0commonjs-proxy-./public_api"),require("\0commonjs-proxy-./lib/components/dish-calc/dish-calc.component"),require("\0commonjs-proxy-./lib/directives/add-dish-to-cart.directive"),require("\0commonjs-proxy-./lib/directives/amount-cart.directive"),require("\0commonjs-proxy-./lib/directives/checkout.directive"),require("\0commonjs-proxy-./lib/directives/delete-from-cart.directive"),require("\0commonjs-proxy-./lib/directives/dish-calc.directive"),require("\0commonjs-proxy-./lib/directives/order-cart-user.directive"),require("\0commonjs-proxy-./lib/directives/set-amount.directive"),require("\0commonjs-proxy-./lib/directives/set-dish-comment.directive")):"function"==typeof define&&define.amd?define("@webresto/ng-cart",["exports","\0commonjsHelpers.js","@angular/core","rxjs","rxjs/operators","@webresto/ng-core","\0commonjs-proxy-@angular/core","\0commonjs-proxy-rxjs","\0commonjs-proxy-rxjs/operators","\0commonjs-proxy-@webresto/ng-core","\0commonjs-proxy-../services/ng-restocart.service","\0commonjs-proxy-../../services/ng-restocart.service","@angular/common","\0commonjs-proxy-@angular/common","\0commonjs-proxy-./directives/add-dish-to-cart.directive","\0commonjs-proxy-./directives/amount-cart.directive","\0commonjs-proxy-./directives/delete-from-cart.directive","\0commonjs-proxy-./directives/order-cart-user.directive","\0commonjs-proxy-./directives/set-amount.directive","\0commonjs-proxy-./directives/dish-calc.directive","\0commonjs-proxy-./directives/checkout.directive","\0commonjs-proxy-./directives/set-dish-comment.directive","\0commonjs-proxy-./components/dish-calc/dish-calc.component","\0commonjs-proxy-./lib/services/ng-restocart.service","\0commonjs-proxy-./lib/ng-cart.module","\0commonjs-proxy-./public_api","\0commonjs-proxy-./lib/components/dish-calc/dish-calc.component","\0commonjs-proxy-./lib/directives/add-dish-to-cart.directive","\0commonjs-proxy-./lib/directives/amount-cart.directive","\0commonjs-proxy-./lib/directives/checkout.directive","\0commonjs-proxy-./lib/directives/delete-from-cart.directive","\0commonjs-proxy-./lib/directives/dish-calc.directive","\0commonjs-proxy-./lib/directives/order-cart-user.directive","\0commonjs-proxy-./lib/directives/set-amount.directive","\0commonjs-proxy-./lib/directives/set-dish-comment.directive"],t):t((e.webresto=e.webresto||{},e.webresto["ng-cart"]={}),null,e.ng.core,e.rxjs,e.rxjs.operators,null,null,null,null,null,null,null,e.ng.common,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null)}(this,function(e,t,r,i,n,o,s,a,d,v,c,u,h,l,m,p,f,g,y,x,b,I,C,M,w,D,k,T,j,P,A,S,E,O,_){"use strict";s=s&&s.hasOwnProperty("default")?s["default"]:s,a=a&&a.hasOwnProperty("default")?a["default"]:a,d=d&&d.hasOwnProperty("default")?d["default"]:d,v=v&&v.hasOwnProperty("default")?v["default"]:v,c=c&&c.hasOwnProperty("default")?c["default"]:c,u=u&&u.hasOwnProperty("default")?u["default"]:u,l=l&&l.hasOwnProperty("default")?l["default"]:l,m=m&&m.hasOwnProperty("default")?m["default"]:m,p=p&&p.hasOwnProperty("default")?p["default"]:p,f=f&&f.hasOwnProperty("default")?f["default"]:f,g=g&&g.hasOwnProperty("default")?g["default"]:g,y=y&&y.hasOwnProperty("default")?y["default"]:y,x=x&&x.hasOwnProperty("default")?x["default"]:x,b=b&&b.hasOwnProperty("default")?b["default"]:b,I=I&&I.hasOwnProperty("default")?I["default"]:I,C=C&&C.hasOwnProperty("default")?C["default"]:C,M=M&&M.hasOwnProperty("default")?M["default"]:M,w=w&&w.hasOwnProperty("default")?w["default"]:w,D=D&&D.hasOwnProperty("default")?D["default"]:D,k=k&&k.hasOwnProperty("default")?k["default"]:k,T=T&&T.hasOwnProperty("default")?T["default"]:T,j=j&&j.hasOwnProperty("default")?j["default"]:j,P=P&&P.hasOwnProperty("default")?P["default"]:P,A=A&&A.hasOwnProperty("default")?A["default"]:A,S=S&&S.hasOwnProperty("default")?S["default"]:S,E=E&&E.hasOwnProperty("default")?E["default"]:E,O=O&&O.hasOwnProperty("default")?O["default"]:O,_=_&&_.hasOwnProperty("default")?_["default"]:_;var q=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=s,i=v,n=function(){function e(e,t){var r=this;this.net=e,this.eventer=t,this.OrderFormChange=new a.BehaviorSubject(null),this.cart=new a.BehaviorSubject({}),this.modifires=new a.BehaviorSubject([]),this.modifiresMessage=new a.BehaviorSubject([]),this.initialStorage(),this.modifiresMessage.subscribe(function(e){return r.messages=e})}return e.prototype.initialStorage=function(){var t=this;this.cartID=this.getCartId(),this.cartID&&this.net.get("/cart?cartId="+this.cartID).pipe(d.tap(function(e){"ORDER"==e.state&&a.throwError(new Error("Cart in order state"))})).subscribe(function(e){return t.cart.next(e.cart)},function(e){return t.removeCartId()})},e.prototype.getCartId=function(){return localStorage.getItem("cartID")},e.prototype.addDishToCart=function(e){var t=this;this.messages.length?this.messages.forEach(function(e){t.eventer.emitMessageEvent(e)}):this.net.put("/cart/add",e).subscribe(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId},function(e){})},e.prototype.addDishToCart$=function(e){var t=this;return this.messages.length?(this.messages.forEach(function(e){t.eventer.emitMessageEvent(e)}),a.of(null)):this.net.put("/cart/add",e).pipe(d.tap(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId}))},e.prototype.setDishCountToCart=function(e,t){var r=this;this.net.post("/cart/set",{dishId:e,cartId:this.cartID,amount:t}).subscribe(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){})},e.prototype.setDishComment=function(e,t){var r=this;return this.net.post("/cart/setcomment",{dishId:e,cartId:this.cartID,comment:t}).pipe(d.tap(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){r.eventer.emitMessageEvent(new v.EventMessage("error","Ошибка","Не удалось изменить коментарий"))}))},e.prototype.removeDishFromCart$=function(e,t){var r=this;return this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).pipe(d.tap(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId}))},e.prototype.removeDishFromCart=function(e,t){var r=this;this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).subscribe(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){})},e.prototype.checkoutCart=function(e){var t={cartId:this.cartID,address:{streetId:e.street.id,home:e.house,housing:e.housing,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:e.phone,name:e.name,mail:e.email||undefined}};return this.orderCart(t)},e.prototype.orderCart=function(e){var t=this;return this.net.post("/order",e).pipe(d.tap(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId},function(e){console.log("Ошибка оформления!",e),e.error&&e.error.cart&&(t.setCartId(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId)}))},e.prototype.checkStreetV2=function(e){var t=this;return this.net.post("/check",e).pipe(d.tap(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId},function(e){console.error(e)}))},e.prototype.checkStreet=function(e){var t=this;this.net.post("/check",e).subscribe(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,e.message&&t.eventer.emitMessageEvent(new v.EventMessage(e.message.type,e.message.title,e.message.body))},function(e){e.error&&e.error.cart&&(t.setCartId(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId)})},e.prototype.setCartId=function(e){localStorage.setItem("cartID",e)},e.prototype.removeCartId=function(){localStorage.removeItem("cartID")},e.prototype.userCart=function(){return this.cart},e.prototype.setModifires=function(e,t){this.modifires.next(e),t&&this.modifiresMessage.next(t)},e.prototype.getModifires=function(){return this.modifires},e.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:v.NetService},{type:v.EventerService}]},e.ngInjectableDef=r.defineInjectable({factory:function(){return new e(r.inject(i.NetService),r.inject(i.EventerService))},token:e,providedIn:"root"}),e}();t.NgRestoCartService=n});t.unwrapExports(q);q.NgRestoCartService;var L=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.cartService=e,this.loading=new s.EventEmitter,this.success=new s.EventEmitter,this.error=new s.EventEmitter,this.cartService.userCart().subscribe(function(e){return t.cart=e}),this.cartService.getModifires().subscribe(function(e){return t.modifires=e})}return e.prototype.onClick=function(){this.addDishToCart(this.dish.id,this.amountDish)},e.prototype.addDishToCart=function(e,t){var r=this,i={dishId:e,amount:t,cartId:undefined,modifiers:this.modifires,comment:this.comment};this.cart.cartId&&(i.cartId=this.cart.cartId),this.loading.emit(!0),this.cartService.addDishToCart$(i).subscribe(function(e){return r.success.emit(!0)},function(e){return r.error.emit(e)},function(){r.loading.emit(!1)})},e.decorators=[{type:s.Directive,args:[{selector:"[addToCart]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService}]},e.propDecorators={dish:[{type:s.Input}],amountDish:[{type:s.Input}],comment:[{type:s.Input}],loading:[{type:s.Output}],success:[{type:s.Output}],error:[{type:s.Output}],onClick:[{type:s.HostListener,args:["click"]}]},e}();t.AddDishToCartDirective=r});t.unwrapExports(L);L.AddDishToCartDirective;var H=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){var i=this;this.cartService=e,this.renderer=t,this.el=r,this.amount="0",this.renderer.setProperty(this.el.nativeElement,"innerHTML",this.amount),this.cartService.userCart().subscribe(function(e){i.cart=e,i.amount=e.dishesCount||0,i.renderer.setProperty(i.el.nativeElement,"innerHTML",i.amount)})}return e.decorators=[{type:s.Directive,args:[{selector:"[amountCart]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService},{type:s.Renderer2},{type:s.ElementRef}]},e}();t.AmountCartDirective=r});t.unwrapExports(H);H.AmountCartDirective;var R=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e})}return e.prototype.onClick=function(){this.cartService.removeDishFromCart(this.dish.id,this.amountDish)},e.decorators=[{type:s.Directive,args:[{selector:"[deleteFromCart]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService}]},e.propDecorators={dish:[{type:s.Input}],amountDish:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}();t.DeleteFromCartDirective=r});t.unwrapExports(R);R.DeleteFromCartDirective;var F=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.cartService=e,this.requiredFields=["name","phone","street","house"],this.checkerFields=new a.BehaviorSubject(undefined)}return e.prototype.onClick=function(){this.order(this.orderCart.value),console.log(this.orderCart.value)},e.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){t.cartService.userCart().subscribe(function(e){t.cart&&t.orderCart.valid&&t.cart.cartTotal!=e.cartTotal&&0<e.cartTotal&&t.checkStreet(t.orderCart.value),t.cart=e})},100),setTimeout(function(){t.checkerFields.next(t.checkForFields(t.orderCart._directives,t.requiredFields))},100),this.checkerFields.subscribe(function(e){e&&(t.orderCart.controls.street.valueChanges.subscribe(function(e){"object"==typeof e&&setTimeout(function(){t.orderCart.controls.house.valid&&(t.orderCart.value.name=t.orderCart.value.name||"Неуказано",t.orderCart.value.phone=t.orderCart.value.phone||"78888888888",t.checkStreet(t.orderCart.value))},100)}),t.orderCart.controls.house.valueChanges.subscribe(function(e){setTimeout(function(){t.orderCart.controls.street.valid&&(t.orderCart.value.name=t.orderCart.value.name||"Неуказано",t.orderCart.value.phone=t.orderCart.value.phone||"78888888888",t.checkStreet(t.orderCart.value))},100)}))})},e.prototype.checkForFields=function(e,t){var r={},i=[];return e.forEach(function(e){r[e.name]=!0}),t.forEach(function(e){r.hasOwnProperty(e)||i.push(e)}),i.length<=0||(console.error("У формы отсутсвуют следующие обязательные для корректной работы модуля поля:",i),!1)},e.prototype.order=function(e){if(this.checkForFields(this.orderCart._directives,this.requiredFields)){var t=void 0,r=e.comment||"Не указан";t=e.cash?"Наличными курьеру":e.bankcard?"Банковской картой курьеру":"Не указан",console.log(e);var i={cartId:this.cart.cartId,comment:"\n Тип оплаты:"+t+"\nКоментарий:"+r,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.orderCart(i).subscribe()}},e.prototype.checkStreet=function(e){if(console.log(">>>>",e),this.checkForFields(this.orderCart._directives,this.requiredFields)){var t={cartId:this.cart.cartId,comment:e.comment,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.checkStreet(t)}},e.prototype.stringToNumber=function(e){return console.log(typeof e),"string"==typeof e?+e:"number"==typeof e?e:void console.error("Параметр home должен быть или string или number")},e.decorators=[{type:s.Directive,args:[{selector:"[orderCart]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService}]},e.propDecorators={orderCart:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}();t.OrderCartUserDirective=r});t.unwrapExports(F);F.OrderCartUserDirective;var N=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e})}return e.prototype.onClick=function(){this.changeAmount(this.action)},e.prototype.changeAmount=function(e){switch(e){case"+":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount+1);break;case"-":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount-1);break;default:console.log("Директива SetDishAmount получила ложное значение action")}},e.decorators=[{type:s.Directive,args:[{selector:"[setDishAmount]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService}]},e.propDecorators={action:[{type:s.Input}],dish:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}();t.SetAmountDirective=r});t.unwrapExports(N);N.SetAmountDirective;var z=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this.renderer=e,this.el=t,this.cartService=r,this.validate=new s.EventEmitter,this.amountDishToAdd=new s.EventEmitter,this.amountModifires={},this.stateModifiers={}}return e.prototype.ngOnInit=function(){var e=this;this.renderer.addClass(this.el.nativeElement,"dish-calculator"),this.amountDish=this.amount,this.amountDishToAdd.emit(this.amountDish),this.price=this.renderer.createElement("div"),this.renderer.addClass(this.price,"dish-price"),setTimeout(function(){e.renderDish(e.dish),e.render(e.dish.modifiers)},100)},e.prototype.renderDish=function(e){var t=this,r=this.renderer.createElement("div");this.renderer.addClass(r,"dish-wraper"),this.renderer.appendChild(this.el.nativeElement,r);var i=this.renderer.createElement("div");this.renderer.addClass(i,"name"),this.renderer.appendChild(r,i);var n=this.renderer.createElement("div");this.renderer.addClass(n,"title"),this.renderer.setProperty(n,"innerHTML",this.dish.name),this.renderer.appendChild(i,n);var o=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"dish"),this.renderer.appendChild(r,o);var s=this.renderer.createElement("div");this.renderer.addClass(s,"value"),this.renderer.setProperty(s,"innerHTML",(1e3*this.dish.weight).toFixed(0)+" г."),0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(s,"zero"),this.renderer.appendChild(o,s),this.renderer.setProperty(this.price,"innerHTML",this.dish.price);var a=this.renderer.createElement("div");this.renderer.addClass(a,"price"),this.renderer.addClass(a,"total"),this.renderer.appendChild(a,this.price),this.renderer.appendChild(r,a);var d=this.renderer.createElement("div");this.renderer.addClass(d,"quantity"),this.renderer.appendChild(r,d);var c=this.renderer.createElement("a");this.renderer.addClass(c,"quantity__button"),this.renderer.addClass(c,"minus"),this.renderer.setProperty(c,"innerHTML","&#8722;"),this.renderer.listen(c,"click",function(e){t.changeAmountdish(-1),t.renderer.setProperty(u,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(m)}),this.renderer.appendChild(d,c);var u=this.renderer.createElement("span");this.renderer.addClass(u,"quantity__counter"),this.renderer.setProperty(u,"innerHTML",this.amountDish),this.renderer.appendChild(d,u);var h=this.renderer.createElement("a");this.renderer.addClass(h,"quantity__button"),this.renderer.addClass(c,"plus"),this.renderer.setProperty(h,"innerHTML","&#x2b;"),this.renderer.listen(h,"click",function(e){t.changeAmountdish(1),t.renderer.setProperty(u,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(m)}),this.renderer.appendChild(d,h);var l=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"total"),this.renderer.appendChild(r,l);var m=this.renderer.createElement("div");0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(m,"zero"),this.renderer.addClass(m,"value"),this.innerTotalWeight(m),this.renderer.appendChild(l,m),this.weightTotal=m,this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(e.price));var p=this.renderer.createElement("div");this.renderer.addClass(p,"price"),this.renderer.addClass(p,"total"),this.renderer.appendChild(p,this.price),this.renderer.appendChild(r,p)},e.prototype.generatePrice=function(e,t,r){var i=this,n=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(r){i.dish.modifiers.forEach(function(e){var t=e.childModifiers.filter(function(e){return e.modifierId===r.id});0<t.length&&(t[0].groupId=e.group.id,n.push(t[0]))})});var o=0;return n.forEach(function(e){o+=e.dish.price*i.amountModifires[e.groupId][e.modifierId]}),o*=this.amountDish,e*this.amountDish+o+'<div class="currency">&nbsp;&#x20bd;</div>'},e.prototype.generateTotalWeight=function(){var t=this,i=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(r){t.dish.modifiers.forEach(function(e){var t=e.childModifiers.filter(function(e){return e.modifierId===r.id});0<t.length&&(t[0].groupId=e.group.id,i.push(t[0]))})});var r=0;return i.forEach(function(e){r+=e.dish.weight*t.amountModifires[e.groupId][e.modifierId]*1e3}),r=parseFloat((r*this.amountDish).toFixed(2)),console.log(r,1e3*this.dish.weight*this.amountDish),console.log(this.dish.weight,this.amountDish),(1e3*this.dish.weight*this.amountDish+r).toFixed(0)+" г. <div class='separator'></div>"},e.prototype.innerTotalWeight=function(e){this.renderer.setProperty(e,"innerHTML",this.generateTotalWeight())},e.prototype.changeAmountdish=function(e){this.amountDish=this.amountDish+e,this.amountDish<=0&&(this.amountDish=1),199<=this.amountDish&&(this.amountDish=199),this.amountDishToAdd.emit(this.amountDish)},e.prototype.render=function(e){var n=this;if(this.setModifires(),0<e.length){var t=this.renderer.createElement("h5");this.renderer.setProperty(t,"innerHTML","К этому блюду можно добавить:")}if(e.forEach(function(r){if(n.stateModifiers[r.modifierId]={},n.amountModifires[r.modifierId]={},r.dish){var e=n.groupDiv("Одночные модификаторы не поддерживаются");n.renderer.appendChild(n.el.nativeElement,e),console.log("elementGroup",r)}else if(r.childModifiers){var i=n.groupDiv(r.group?r.group.name:"Ошибка");n.renderer.appendChild(n.el.nativeElement,i),r.childModifiers.forEach(function(e){var t=n.modifireDiv(e,r.modifierId);n.renderer.appendChild(i,t),e.defaultAmount<1?n.stateModifiers[r.modifierId][e.modifierId]=!1:n.stateModifiers[r.modifierId][e.modifierId]=!0})}}),0<e.length){t=this.renderer.createElement("div");this.renderer.setProperty(t,"innerHTML","<p>* — Количество добавленых опций блюда применяется для каждой порции</p>"),this.renderer.appendChild(this.el.nativeElement,t)}},e.prototype.groupDiv=function(e){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"group-modifires-wraper"),this.renderer.appendChild(t,this.renderer.createText(""+e)),t},e.prototype.modifireDiv=function(e,t){var r=this.renderer.createElement("div");return this.renderer.addClass(r,"additional-item"),this.renderOneModifire(e,r,t),r},e.prototype.renderOneModifire=function(e,t,r){console.info("renderOneModifire",e),console.info("renderOneModifire selectedModifiers",this.selectedModifiers);var i=this.renderer.createElement("div");this.renderer.addClass(i,"item-name");var n=this.renderer.createElement("label");this.renderer.setAttribute(n,"for",e.modifierId),this.renderer.appendChild(i,n),this.renderer.setProperty(n,"innerHTML",e.dish.name),this.renderer.appendChild(t,i);var o=this.renderer.createElement("div");this.renderer.addClass(o,"left-weight-modifire-wraper");var s=this.renderer.createElement("div");this.renderer.addClass(s,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(s,"zero"),this.renderer.setProperty(s,"innerHTML",(1e3*e.dish.weight).toFixed(0)+" г."),this.renderer.appendChild(o,s),this.renderer.appendChild(t,o);var a=this.renderer.createElement("div"),d=e.minAmount,c=e.maxAmount,u=e.defaultAmount;switch(console.info("min max def",d,c,u),!0){case 0===d&&0===c&&0===u:case 0===d&&1===c&&0===u:this.renderCheckbox(e,!1,a,t,r);break;case 0===d&&1===c&&1===u:this.renderCheckbox(e,!0,a,t,r);break;case 1===d&&1===c&&1===u:console.error(e.dish.name,"Значение не поддается настройке:",d,c,u);break;case d<=c&&d<=u&&u<=c&&1<c:this.renderInputButton(e,r,a,t);break;default:console.error(e.dish.name,"Ошибка рендера модификатора, для значений:",d,c,u)}0<e.maxAmount&&e.minAmount;var h=this.renderer.createElement("div");this.renderer.addClass(h,"right-weight-modifire-wraper");var l=this.renderer.createElement("div");this.renderer.addClass(l,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(l,"zero"),this.renderer.setProperty(l,"innerHTML",(1e3*e.dish.weight).toFixed(0)+' г.<div class="separator"></div>'),this.renderer.appendChild(h,l),this.renderer.appendChild(t,h);var m,p=this.renderer.createElement("div");this.renderer.addClass(p,"item-price"),0<e.dish.price?(m=e.dish.price+"<div class = 'currency'>&nbsp;&#x20bd;</div>",this.renderer.setProperty(p,"innerHTML",m),this.renderer.appendChild(t,p)):this.renderer.addClass(p,"zero-price"),this.setModifires(),this.innerTotalWeight(this.weightTotal),this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(this.dish.price))},e.prototype.renderCheckbox=function(e,t,r,i,n){var o=this,s=this.renderer.createElement("input");this.renderer.setAttribute(s,"type","checkbox"),this.renderer.setAttribute(s,"id",e.modifierId),t?(this.renderer.setProperty(s,"checked",!0),e.checked=!0,this.stateModifiers[n][e.modifierId]=!0,this.amountModifires[n][e.modifierId]=1):(e.checked=!1,this.stateModifiers[n][e.modifierId]=!1,this.amountModifires[n][e.modifierId]=0),this.renderer.addClass(s,"modal-checkbox"),this.renderer.appendChild(r,s),this.renderer.listen(s,"change",function(t){if(o.idRadioBox(n)){for(var e in o.stateModifiers[n])o.stateModifiers[n].hasOwnProperty(e)&&(o.stateModifiers[n][e]=!1);t.target.parentElement.parentElement.parentElement.querySelectorAll("input").forEach(function(e){e.id!=t.target.id&&(e.checked=!1)})}o.stateModifiers[n][t.target.id]=t.target.checked,t.target.checked&&(o.amountModifires[n][t.target.id]=1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))}),this.renderer.appendChild(i,r)},e.prototype.renderInputButton=function(r,i,e,t){var n,o=this;0<(n=0<r.defaultAmount?r.defaultAmount:r.minAmount)&&(this.stateModifiers[i][r.modifierId]=!0);var s=this.renderer.createElement("a");this.renderer.addClass(s,"quantity__button"),this.renderer.setProperty(s,"innerHTML","&#8722;"),this.renderer.appendChild(e,s),this.renderer.listen(s,"click",function(e){var t=+o.amountModifires[i][r.modifierId];o.amountModifires[i][r.modifierId]=t-1,o.amountModifires[i][r.modifierId]<r.minAmount&&(o.amountModifires[i][r.modifierId]=r.minAmount),o.renderer.setProperty(a,"innerHTML",o.amountModifires[i][r.modifierId]),0===o.amountModifires[i][r.modifierId]&&(o.stateModifiers[i][r.modifierId]=!1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))});var a=this.renderer.createElement("span");this.renderer.addClass(a,"item-quantity__counter"),this.amountModifires[i][r.modifierId]=n,this.renderer.setProperty(a,"innerHTML",this.amountModifires[i][r.modifierId]),this.renderer.appendChild(e,a);var d=this.renderer.createElement("a");this.renderer.addClass(d,"quantity__button"),this.renderer.setProperty(d,"innerHTML","&#x2b;"),this.renderer.appendChild(e,d),this.renderer.appendChild(t,e),this.renderer.listen(d,"click",function(e){var t=+o.amountModifires[i][r.modifierId];o.amountModifires[i][r.modifierId]=t+1,o.amountModifires[i][r.modifierId]>r.maxAmount&&0!=r.maxAmount&&(o.amountModifires[i][r.modifierId]=r.maxAmount),o.renderer.setProperty(a,"innerHTML",o.amountModifires[i][r.modifierId]),0<o.amountModifires[i][r.modifierId]&&(o.stateModifiers[i][r.modifierId]=!0),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))})},e.prototype.setModifires=function(){var n=this,e=[],o=[];for(var r in console.info("setModifires modifiersToSelect",e),console.info("setModifires stateModifiers before",this.stateModifiers),console.info("setModifires selectedModifiers before",this.selectedModifiers),this.stateModifiers){var t=function(t){(i.stateModifiers[r][t]||e.find(function(e){return e.modifierId==t}))&&o.push({id:t,amount:i.amountModifires[r][t],groupId:r})},i=this;for(var s in this.stateModifiers[r])t(s)}if(this.selectedModifiers=o,0<this.dish.modifiers.length){var a=[];this.dish.modifiers.forEach(function(e){if(e.required)if(n.stateModifiers[e.modifierId]){var t=[],r=n.stateModifiers[e.modifierId];for(var i in r)r.hasOwnProperty(i)&&r[i]&&t.push(r[i]);t.length<e.minAmount?(a.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),n.validate.emit(!1),n.cartService.setModifires(o,a)):(n.validate.emit(!0),n.cartService.setModifires(o,[]))}else a.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),n.validate.emit(!1),n.cartService.setModifires(o,a);else n.validate.emit(!0),n.cartService.setModifires(o)})}else this.validate.emit(!0),this.cartService.setModifires(o,[]);console.info("setModifires stateModifiers after",this.stateModifiers),console.info("setModifires selectedModifiers after",this.selectedModifiers)},e.prototype.idRadioBox=function(t){var e=this.dish.modifiers.find(function(e){return e.modifierId===t});return 1===e.minAmount&&1===e.maxAmount},e.prototype.checkMinAmountModifires=function(e,t){},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e.decorators=[{type:s.Directive,args:[{selector:"[dishCalc]"}]}],e.ctorParameters=function(){return[{type:s.Renderer2},{type:s.ElementRef},{type:c.NgRestoCartService}]},e.propDecorators={dish:[{type:s.Input}],amount:[{type:s.Input}],selectedModifiers:[{type:s.Input}],validate:[{type:s.Output}],amountDishToAdd:[{type:s.Output}]},e}();t.DishCalcDirective=r});t.unwrapExports(z);z.DishCalcDirective;var V=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.cartService=e,this.success=new s.EventEmitter,this.error=new s.EventEmitter,this.isChecking=new s.EventEmitter,this.cartService.userCart().subscribe(function(e){return t.cart=e}),this.cartService.OrderFormChange.pipe(d.filter(function(){if(t.locationId||(t.streetId||t.street)&&t.home||t.delivery)return!0}),d.debounceTime(1e3)).subscribe(function(){return t.checkStreet()})}return e.prototype.onClick=function(){var t=this;if(this.locationId||(this.streetId||this.street)&&this.home||this.delivery){var e=this.comment||"Не указан",r=(this.paymentMethod,{cartId:this.cart.cartId,comment:e,customer:{phone:this.preparePhone(this.phone),mail:this.email,name:this.name},personsCount:+this.personsCount});this.paymentMethodId&&(r.paymentMethodId=this.paymentMethodId),this.orderDate&&(r.orderDate=this.orderDate),this.notifyMethodId&&(r.notifyMethodId=this.notifyMethodId),r.selfDelivery=this.delivery,this.bonuses&&(r.bonuses=this.bonuses.map(function(e){return{name:e.name,amount:e.amount}})),this.locationId?r.locationId=this.locationId:r.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""};var i=this.cart.id;this.cartService.orderCart(r).subscribe(function(e){e.action&&e.action.paymentRedirect?window.location.href=e.action.paymentRedirect:t.success.emit(i)},function(e){return t.error.emit(e)})}else this.error.emit("Нужно указать адрес")},e.prototype.ngOnChanges=function(e){this.cartService.OrderFormChange.next(e)},e.prototype.checkStreet=function(){var t=this,e=this.comment||"Не указан",r=(this.paymentMethod,{cartId:this.cart.cartId,comment:e,customer:{phone:this.phone?this.preparePhone(this.phone):null,mail:this.email,name:this.name||null},personsCount:+this.personsCount});r.selfDelivery=this.delivery,this.paymentMethodId&&(r.paymentMethodId=this.paymentMethodId),this.orderDate&&(r.orderDate=this.orderDate),this.notifyMethodId&&(r.notifyMethodId=this.notifyMethodId),this.locationId?r.locationId=this.locationId:r.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},this.isChecking.emit(!0),this.cartService.checkStreetV2(r).subscribe(function(e){return t.isChecking.emit(!1)},function(e){return t.isChecking.emit(!1)})},e.prototype.preparePhone=function(e){return e?(e="+"+e.replace(/[^0-9]/gim,"")).replace("+8","+7"):""},e.decorators=[{type:s.Directive,args:[{selector:"[checkout]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService}]},e.propDecorators={cartTotal:[{type:s.Input}],bonuses:[{type:s.Input}],name:[{type:s.Input}],email:[{type:s.Input}],phone:[{type:s.Input}],delivery:[{type:s.Input}],locationId:[{type:s.Input}],street:[{type:s.Input}],streetId:[{type:s.Input}],home:[{type:s.Input}],housing:[{type:s.Input}],apartment:[{type:s.Input}],entrance:[{type:s.Input}],doorphone:[{type:s.Input}],floor:[{type:s.Input}],paymentMethod:[{type:s.Input}],paymentMethodId:[{type:s.Input}],personsCount:[{type:s.Input}],comment:[{type:s.Input}],orderDate:[{type:s.Input}],notifyMethodId:[{type:s.Input}],success:[{type:s.Output}],error:[{type:s.Output}],isChecking:[{type:s.Output}],onClick:[{type:s.HostListener,args:["click"]}]},e}();t.CheckoutDirective=r});t.unwrapExports(V);V.CheckoutDirective;var B=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.cartService=e,this.success=new s.EventEmitter,this.error=new s.EventEmitter}return e.prototype.onClick=function(){this.setComment()},e.prototype.setComment=function(){var t=this;this.cartService.setDishComment(this.dish.id,this.comment).subscribe(function(e){return t.success.emit(!0)},function(e){return t.error.emit(e)})},e.decorators=[{type:s.Directive,args:[{selector:"[setDishComment]"}]}],e.ctorParameters=function(){return[{type:c.NgRestoCartService}]},e.propDecorators={comment:[{type:s.Input}],dish:[{type:s.Input}],success:[{type:s.Output}],error:[{type:s.Output}],onClick:[{type:s.HostListener,args:["click"]}]},e}();t.SetDishCommentDirective=r});t.unwrapExports(B);B.SetDishCommentDirective;var W=function(e,t){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var G=function(){return(G=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function Z(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function U(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)s.push(i.value)}catch(a){n={error:a}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}return s}function $(e){return this instanceof $?(this.v=e,this):new $(e)}var J=Object.freeze({__extends:function ie(e,t){function r(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},get __assign(){return G},__rest:function ne(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r},__decorate:function oe(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(s=(o<3?n(s):3<o?n(t,r,s):n(t,r))||s);return 3<o&&s&&Object.defineProperty(t,r,s),s},__param:function se(r,i){return function(e,t){i(e,t,r)}},__metadata:function ae(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function de(t,s,a,d){return new(a||(a=Promise))(function(e,r){function i(e){try{o(d.next(e))}catch(t){r(t)}}function n(e){try{o(d["throw"](e))}catch(t){r(t)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(i,n)}o((d=d.apply(t,s||[])).next())})},__generator:function ce(i,n){var o,s,a,e,d={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function r(e){if(o)throw new TypeError("Generator is already executing.");for(;d;)try{if(o=1,s&&(a=2&e[0]?s["return"]:e[0]?s["throw"]||((a=s["return"])&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return d.label++,{value:e[1],done:!1};case 5:d.label++,s=e[1],e=[0];continue;case 7:e=d.ops.pop(),d.trys.pop();continue;default:if(!(a=0<(a=d.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){d=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){d.label=e[1];break}if(6===e[0]&&d.label<a[1]){d.label=a[1],a=e;break}if(a&&d.label<a[2]){d.label=a[2],d.ops.push(e);break}a[2]&&d.ops.pop(),d.trys.pop();continue}e=n.call(i,d)}catch(t){e=[6,t],s=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}},__exportStar:function ue(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])},__values:Z,__read:U,__spread:function he(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(U(arguments[t]));return e},__spreadArrays:function le(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i},__await:$,__asyncGenerator:function me(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),s=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(i){o[i]&&(n[i]=function(r){return new Promise(function(e,t){1<s.push([i,r,e,t])||a(i,r)})})}function a(e,t){try{!function r(e){e.value instanceof $?Promise.resolve(e.value.v).then(d,c):u(s[0][2],e)}(o[e](t))}catch(i){u(s[0][3],i)}}function d(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},__asyncDelegator:function pe(i){var e,n;return e={},t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,r){e[t]=i[t]?function(e){return(n=!n)?{value:$(i[t](e)),done:"return"===t}:r?r(e):e}:r}},__asyncValues:function fe(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=o[Symbol.asyncIterator];return t?t.call(o):(o=Z(o),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=o[i]&&function(r){return new Promise(function(e,t){!function n(t,e,r,i){Promise.resolve(i).then(function(e){t({value:e,done:r})},e)}(e,t,(r=o[i](r)).done,r.value)})}}},__makeTemplateObject:function ge(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function ve(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t},__importDefault:function ye(e){return e&&e.__esModule?e:{"default":e}}}),K=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this.cartService=e,this.eventer=t,this.validate=new s.EventEmitter,this.amountDishToAdd=new s.EventEmitter,this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.imageUrl=r}return e.prototype.ngOnInit=function(){this.checkValid()},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e.prototype.ngOnChanges=function(){var e,t,r,i;if(this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.dish&&this.dish.modifiers){try{for(var n=J.__values(this.dish.modifiers),o=n.next();!o.done;o=n.next()){var s=o.value,a=null;switch(this.modifiers.indexById[s.modifierId]=s,this.modifiers.custom.fixed||this.modifiers.baseList.length||!s.childModifiers||2!=s.childModifiers.length||s.maxAmount!=s.maxAmount||1!=s.maxAmount?s.group&&s.childModifiers&&s.childModifiers.length&&s.childModifiers.find(function(e){return e.dish})?(a="group",this.modifiers.baseList.push(s),console.info("Group modifier:",s)):s.dish?(a="single",this.modifiers.baseList.push(s),console.info("Single modifier:",s)):(a="broken",console.warn("Broken modifier:",s)):(a="custom",this.modifiers.custom.fixed=s,console.info("Custom Fixed modifier:",s)),a){case"group":case"custom":this.modifiersValueTree[s.modifierId]={};try{for(var d=J.__values(s.childModifiers),c=d.next();!c.done;c=d.next()){var u=c.value;this.modifiers.indexById[u.modifierId]=u,this.modifiersValueTree[s.modifierId][u.modifierId]=u.defaultAmount}}catch(h){r={error:h}}finally{try{c&&!c.done&&(i=d["return"])&&i.call(d)}finally{if(r)throw r.error}}this.calculateTotalAmountInGroup(s.modifierId);break;case"single":this.modifiersValueTree.single||(this.modifiersValueTree.single={}),this.modifiers.indexById[s.modifierId]=s,this.modifiersValueTree.single[s.modifierId]=s.defaultAmount}this.checkImagesInModifier(s.modifierId)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.calculateTotalPrice()}},e.prototype.calculateTotalAmountInGroup=function(e){if("single"!=e)return this.modifiers.indexById[e].totalAmount=Object.values(this.modifiersValueTree[e]).reduce(function(e,t){return e+t}),this.modifiers.indexById[e].totalAmount},e.prototype.checkImagesInModifier=function(e){var t=this.modifiers.indexById[e];this.modifiers.indexById[e].imagesIsset=t.dish&&t.dish.images&&t.dish.images.length,this.modifiers.indexById[e].childImagesIsset=!!Object.values(this.modifiersValueTree[e]).find(function(e){return e&&e.dish&&e.dish.images&&e.dish.images.length})},e.prototype.calculateTotalPrice=function(){var e=this.dish.price||0;for(var t in this.modifiersValueTree)for(var r in this.modifiersValueTree[t]){var i=this.modifiersValueTree[t][r];if(i){var n=this.modifiers.indexById[r];n&&n.dish&&n.dish.price&&(e+=n.dish.price*i)}}this.totalPrice=e,this.setModifiers()},e.prototype.getModifiersIds=function(e){return{groupId:e.dish&&e.dish.groupId?e.dish.groupId:undefined,modifierId:e.modifierId}},e.prototype.changeModifierAmount=function(e,t,r){if(!(t<0)){var i=this.getModifiersIds(e),n=i.groupId,o=void 0===n?"single":n,s=i.modifierId,a=e.minAmount,d=e.maxAmount,c=this.modifiers.indexById[o]||{},u=c.minAmount,h=void 0===u?0:u,l=c.maxAmount,m=void 0===l?0:l,p=this.modifiersValueTree[o][s];if("checkbox"==r&&"single"!==o){if(h<=1&&1==m){if(t<h)return;for(var f in this.modifiersValueTree[o])this.modifiersValueTree[o][f]=0;this.calculateTotalAmountInGroup(o)}if(0==t)return void this.calculateTotalPrice()}if(h||m){var g=this.modifiers.indexById[o].totalAmount-p+t;if(g<h)return console.warn("Limit: min "+h+". Current "+g),void this.eventer.emitMessageEvent(new v.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[o].group.name+'" - не менее '+h));if(m<g)return console.warn("Limit: max "+m+". Current "+g),void this.eventer.emitMessageEvent(new v.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[o].group.name+'" - не более '+m))}if(a||d){if(t<a)switch(r){case"plus":t=a;break;case"minus":t=0}d<t&&(t=d)}this.modifiersValueTree[o][s]=t,this.calculateTotalAmountInGroup(o),this.calculateTotalPrice()}},e.prototype.setModifiers=function(){var e=[];for(var t in this.modifiersValueTree)for(var r in this.modifiersValueTree[t]){var i=this.modifiersValueTree[t][r];i&&e.push({id:r,amount:i,groupId:"single"!==t?t:undefined})}e.length&&(this.checkValid(),this.cartService.setModifires(e,[]))},e.prototype.checkValid=function(){var e=!0;for(var t in this.modifiersValueTree){var r=this.modifiers.indexById[t];if(r.required){var i=this.calculateTotalAmountInGroup(t);i<r.minAmount&&(e=!1,console.warn("Modifier "+t+" min amount: "+r.minAmount)),i>r.maxAmount&&(e=!1,console.warn("Modifier "+t+" max amount: "+r.maxAmount))}}this.validate.emit(e)},e.decorators=[{type:s.Component,args:[{selector:"dish-calc",template:'<div class="ng-cart-dish-calc" *ngIf="dish">\n    <div class="dish">\n        <div class="dish-image-box">\n            <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\n        </div>\n        <div class="dish-description-box">\n            <div class="dish-name">{{ dish.name }}</div>\n            <div class="dish-ingredients">{{ dish.description }}</div>\n            <div class="dish-price-box">\n                <ng-container *ngIf="!modifiers.custom.fixed; else modifierFixedTemplate">\n                    <div class="price" [ngClass]="{\'zero-price\': !dish.price}">\n                        <span>{{ dish.price }}</span> ₽\n                    </div>\n                </ng-container>\n                <ng-template #modifierFixedTemplate>\n                    <ng-container *ngIf="modifiers.custom.fixed as modifier">\n                        <div class="modifier-fixed">\n                            <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                                <div class="item"\n                                     [ngClass]="{selected: !!modifiersValueTree[modifier.modifierId][childModifier.modifierId]}"\n                                     (click)="changeModifierAmount(childModifier, 1, \'checkbox\')">\n                                    {{ childModifier.dish?.name }}\n                                </div>\n                            </ng-container>\n                        </div>\n                        <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                            <ng-container *ngIf="!!modifiersValueTree[modifier.modifierId][childModifier.modifierId]">\n                                <div class="price" [ngClass]="{\'zero-price\': !childModifier.dish?.price}">\n                                    <span>{{ childModifier.dish?.price }}</span> ₽\n                                </div>\n                            </ng-container>\n                        </ng-container>\n                    </ng-container>\n                </ng-template>\n\n            </div>\n        </div>\n    </div>\n    <div class="modifiers" *ngIf="modifiers.baseList?.length">\n        <ng-container *ngFor="let modifier of modifiers.baseList">\n            <div class="modifier-group">\n                <div class="modifier-header" *ngIf="modifier.group as group">\n                    <div class="modifier-name" *ngIf="group.name">{{ group.name }}</div>\n                    <div class="modifier-description" *ngIf="group.description">{{ group.description }}</div>\n                </div>\n\n                <ng-container *ngIf="modifier.dish">\n                    <div class="modifier-box" [ngClass]="{\'without-images\': !modifier.childImagesIsset}">\n                        \x3c!-- Single modifier --\x3e\n                        <ng-container *ngTemplateOutlet="modifierTemplate; context: {\n                            modifier: modifier,\n                            groupId: \'single\',\n                            amount: modifiersValueTree[\'single\'][modifier.modifierId],\n                            groupAmount: modifiersValueTree[\'single\'][modifier.modifierId],\n                            groupMinAmount: modifier.minAmount || 0,\n                            groupMaxAmount: modifier.maxAmount || 100\n                        }"></ng-container>\n                    </div>\n                </ng-container>\n\n                <ng-container *ngIf="modifier.childModifiers?.length">\n                    <div class="modifier-children" [ngClass]="{\'without-images\': !modifier.imagesIsset}">\n                        <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                            \x3c!-- Group modifier --\x3e\n                            <ng-container *ngTemplateOutlet="modifierTemplate; context: {\n                            modifier: childModifier,\n                            groupId: modifier.modifierId,\n                            amount: modifiersValueTree[modifier.modifierId][childModifier.modifierId],\n                            groupAmount: modifiers.indexById[modifier.modifierId].totalAmount,\n                            groupMinAmount: modifier.minAmount || 0,\n                            groupMaxAmount: modifier.maxAmount || 100\n                        }"></ng-container>\n\n                        </ng-container>\n                    </div>\n                </ng-container>\n\n            </div>\n        </ng-container>\n    </div>\n    <div class="result">\n        <span class="text">ИТОГО:</span>\n        <span class="price">\n            <span>{{ totalPrice}}</span> ₽\n        </span>\n    </div>\n</div>\n\n\n\n\x3c!-- Template block #dishImageTemplate --\x3e\n\n<ng-template #dishImageTemplate let-dish="dish">\n    <ng-container *ngIf="dish?.images && dish.images[0]?.images?.small; else imgPlaceholder">\n        <div class="dish-image" [style.backgroundImage]="\'url(\' + imageUrl + dish.images[0].images.small + \')\'"></div>\n    </ng-container>\n    <ng-template #imgPlaceholder>\n        <div class="dish-image-placeholder"></div>\n    </ng-template>\n</ng-template>\n\n\x3c!-- Template block #modifierTemplate --\x3e\n\n<ng-template #modifierTemplate\n             let-modifier="modifier"\n             let-groupId="groupId"\n             let-amount="amount"\n             let-groupAmount="groupAmount"\n             let-groupMinAmount="groupMinAmount"\n             let-groupMaxAmount="groupMaxAmount">\n    <ng-container *ngIf="modifier.dish as dish">\n        <div class="modifier-dish">\n            <div class="modifier-dish-image-box">\n                <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\n            </div>\n            <div class="modifier-dish-description-box">\n                <div class="modifier-dish-name">{{ dish.name }}</div>\n                <div class="modifier-dish-weight">{{ dish.weight * 1000 }} гр</div>\n            </div>\n            <div class="modifier-dish-price-box">\n                <div [ngClass]="{\'zero-price\': !dish.price}">\n                    <span>{{ dish.price }}</span> ₽\n                </div>\n            </div>\n            <div class="modifier-dish-action-box">\n                <ng-container *ngIf="groupMinAmount <= 1 && groupMaxAmount == 1; else counterTemplate">\n                    <ng-container *ngTemplateOutlet="modifierCheckboxTemplate; context: {\n                        modifier: modifier,\n                        groupId: groupId,\n                        amount: amount\n                    }"></ng-container>\n                </ng-container>\n\n                <ng-template #counterTemplate>\n                    <ng-container *ngTemplateOutlet="modifierCounterTemplate; context: {\n                        modifier: modifier,\n                        groupId: groupId,\n                        amount: amount,\n                        groupAmount: groupAmount,\n                        groupMinAmount: groupMinAmount,\n                        groupMaxAmount: groupMaxAmount\n                    }"></ng-container>\n                </ng-template>\n\n            </div>\n        </div>\n    </ng-container>\n</ng-template>\n\n\x3c!-- Template block #modifierCounterTemplate --\x3e\n\n<ng-template #modifierCounterTemplate\n             let-modifier="modifier"\n             let-groupId="groupId"\n             let-amount="amount"\n             let-groupAmount="groupAmount"\n             let-groupMinAmount="groupMinAmount"\n             let-groupMaxAmount="groupMaxAmount">\n    <ng-container>\n        <div class="modifier-counter" [ngClass]="{disabled: !amount && groupAmount >= groupMaxAmount}">\n            <div\n                    class="minus"\n                    [ngClass]="{disabled: !amount || groupAmount <= groupMinAmount}"\n                    (click)="changeModifierAmount(modifier, amount - 1, \'minus\')"\n                    onselectstart="return false;">-</div>\n            <input [value]="amount" readonly #input>\n            <div\n                    class="plus"\n                    [ngClass]="{disabled: groupAmount >= groupMaxAmount}"\n                    (click)="changeModifierAmount(modifier, amount + 1, \'plus\')"\n                    onselectstart="return false;">+</div>\n        </div>\n    </ng-container>\n</ng-template>\n\n\x3c!-- Template block #modifierCheckboxTemplate --\x3e\n\n<ng-template #modifierCheckboxTemplate\n             let-modifier="modifier"\n             let-groupId="groupId"\n             let-amount="amount">\n    <ng-container>\n        <div\n                class="modifier-checkbox"\n                [ngClass]="{selected: amount}"\n                (click)="changeModifierAmount(modifier, amount ? 0 : 1, \'checkbox\')"></div>\n    </ng-container>\n</ng-template>\n',styles:['.dish{display:-webkit-box;display:flex;-webkit-box-align:start;align-items:flex-start;padding-bottom:34px;border-bottom:2px solid #969696}.dish .dish-image-box{position:relative;width:250px;height:170px;box-sizing:border-box;text-align:center;background-color:#eee;background-size:50%}.dish .dish-description-box{margin-left:34px;height:170px;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-align:stretch;align-items:stretch;padding:5px 0 0;box-sizing:border-box}.dish .dish-description-box .dish-name{font-weight:700;font-size:28px;line-height:32px;letter-spacing:2.4px;color:#0a0909}.dish .dish-description-box .dish-ingredients{font-size:15px;line-height:17px;color:#000;margin-top:15px;overflow:hidden;-webkit-box-flex:1;flex-grow:1}.dish .dish-description-box .dish-price-box{font-weight:700;font-size:20px;line-height:23px;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;height:45px;margin-right:49px}.dish-image{width:250px;height:100%;border-radius:0;background-size:cover;background-position:top;background-repeat:no-repeat}.result{margin-top:49px;font-weight:700;font-size:24px;line-height:28px;color:#0a0909;text-align:right}.result .price{margin-left:76px}.modifiers .modifier-group{margin-top:25px;padding-bottom:25px;border-bottom:2px solid #969696}.modifiers .modifier-header{margin-bottom:25px}.modifiers .modifier-header .modifier-name{font-weight:500;font-size:20px;line-height:23px;color:#0a0909}.modifiers .modifier-header .modifier-description{font-size:15px;line-height:17px;color:#0a0909}.modifiers .modifier-dish{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;margin-bottom:2px;height:100px;box-sizing:border-box}.modifiers .modifier-dish .modifier-dish-image-box{position:relative;width:100px;height:100px;box-sizing:border-box;text-align:center;background-color:#eee;background-size:50%;margin-right:28px}.modifiers .modifier-dish .modifier-dish-description-box{-webkit-box-flex:1;flex-grow:1;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center}.modifiers .modifier-dish .modifier-dish-description-box .modifier-dish-name{font-weight:500;font-size:20px;line-height:23px;color:#0a0909}.modifiers .modifier-dish .modifier-dish-description-box .modifier-dish-weight{font-size:20px;line-height:23px;color:#0a0909;margin-top:10px}.modifiers .modifier-dish .modifier-dish-price-box{font-weight:700;font-size:20px;line-height:23px;color:#0a0909;margin-right:105px}.modifiers .modifier-dish .modifier-dish-price-box .zero-price{display:none}.modifiers .modifier-dish .modifier-dish-action-box{width:151px;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center}.modifier-fixed{border:2px solid #767676;box-sizing:border-box;border-radius:15px;display:-webkit-box;display:flex;-webkit-box-align:stretch;align-items:stretch;height:45px}.modifier-fixed .item{font-weight:500;font-size:20px;line-height:23px;width:142px;height:45px;color:#767676;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;margin-top:-2px}.modifier-fixed .item:first-child{margin-left:-2px}.modifier-fixed .item:last-child{margin-right:-2px}.modifier-fixed .item.selected{background:#0a0909;border-radius:15px;color:#fff}.modifier-fixed .item:not(.selected){cursor:pointer}.modifier-checkbox{width:50px;height:50px;background:#e0e0e0;border-radius:15px;cursor:pointer;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.modifier-checkbox.selected:after{content:url("data:image/svg+xml; base64, PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMTMuNUwxMS4zMjMxIDI2TDI2IDIiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMy41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cg==")}.modifier-counter{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;position:relative;border:none;width:151px;height:50px;border-radius:15px;background:#e0e0e0}.modifier-counter.disabled{opacity:.3}.modifier-counter:not(.disabled) .minus.disabled,.modifier-counter:not(.disabled) .plus.disabled{opacity:.15;cursor:default}.modifier-counter input{border:none;background:0 0;width:100%;padding:0;height:50px;line-height:50px;text-align:center;font-weight:500;font-size:18px;color:#0a0909}.modifier-counter .minus,.modifier-counter .plus{display:block;position:absolute;top:0;height:50px;line-height:50px;text-align:center;font-style:normal;font-weight:700;font-size:18px;color:#0a0909;padding:0 30px;cursor:pointer}.modifier-counter .minus:hover,.modifier-counter .plus:hover{color:#000}.modifier-counter .minus:active,.modifier-counter .plus:active{color:#cc0009}.modifier-counter .minus.loading,.modifier-counter .plus.loading{opacity:.2}.modifier-counter .minus{left:0}.modifier-counter .plus{right:0}.without-images .modifier-dish-image-box{display:none}.without-images .modifier-dish{height:75px}']}]}],e.ctorParameters=function(){return[{type:u.NgRestoCartService},{type:v.EventerService},{type:String,decorators:[{type:s.Inject,args:["ImageUrl"]}]}]},e.propDecorators={dish:[{type:s.Input}],amount:[{type:s.Input}],selectedModifiers:[{type:s.Input}],validate:[{type:s.Output}],amountDishToAdd:[{type:s.Output}]},e}();t.DishCalcComponent=r});t.unwrapExports(K);K.DishCalcComponent;var Q=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=[m.AddDishToCartDirective,p.AmountCartDirective,f.DeleteFromCartDirective,g.OrderCartUserDirective,x.DishCalcDirective,I.SetDishCommentDirective,y.SetAmountDirective,b.CheckoutDirective],i=[C.DishCalcComponent],n=[l.CommonModule],o=function(){function e(){}return e.decorators=[{type:s.NgModule,args:[{imports:[n],providers:[],declarations:[r,i],exports:[r,i]}]}],e}();t.NgRestoCartModule=o});t.unwrapExports(Q);Q.NgRestoCartModule;var Y=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NgRestoCartService=M.NgRestoCartService,t.NgRestoCartModule=w.NgRestoCartModule});t.unwrapExports(Y);Y.NgRestoCartService,Y.NgRestoCartModule;var X=t.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NgRestoCartService=D.NgRestoCartService,t.NgRestoCartModule=D.NgRestoCartModule,t.ɵi=k.DishCalcComponent,t.ɵa=T.AddDishToCartDirective,t.ɵb=j.AmountCartDirective,t.ɵh=P.CheckoutDirective,t.ɵc=A.DeleteFromCartDirective,t.ɵe=S.DishCalcDirective,t.ɵd=E.OrderCartUserDirective,t.ɵg=O.SetAmountDirective,t.ɵf=_.SetDishCommentDirective}),ee=t.unwrapExports(X),te=X.NgRestoCartService,re=X.NgRestoCartModule;e["default"]=ee,e.NgRestoCartService=te,e.NgRestoCartModule=re,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=webresto-ng-cart.umd.min.js.map