import { Injectable } from '@angular/core';
import { BehaviorSubject, throwError, from, ReplaySubject } from 'rxjs';
import { catchError, filter, map, switchMap, tap } from 'rxjs/operators';
import { EventMessage } from '@webresto/ng-core';
import { formatDate } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@webresto/ng-core";
export class NgRestoCartService {
    constructor(net, eventer) {
        this.net = net;
        this.eventer = eventer;
        this.cartID = this.getCartId();
        this.cart = new BehaviorSubject(null);
        this.modifires = new BehaviorSubject([]);
        this.OrderFormChange = new BehaviorSubject(null);
        this.modifiresMessage = new BehaviorSubject([]);
        this.restrictions$ = new ReplaySubject(null);
        this.restrictionsLoader$ = this.net.get(`/restrictions`).pipe(map(restictions => formatDate(Date.now() + restictions.periodPossibleForOrder * 60000, 'yyyy-MM-dd', 'en'))).subscribe(this.restrictions$);
    }
    getCartId() {
        return localStorage.getItem('cartID');
    }
    getCart() {
        return this.net.get(`/cart${this.cartID ? '?cartId=' + this.cartID : ''}`).pipe(switchMap(data => {
            if (!this.cartID) {
                this.setCartId(data.cart.cartId);
            }
            ;
            if (data.cart.state == 'ORDER') {
                return throwError(new Error('Cart in order state'));
            }
            else {
                this.cart.next(data.cart);
            }
            ;
            return this.cart;
        }), catchError(err => {
            this.removeCartId();
            return throwError(err);
        }));
    }
    addDishToCart(data) {
        if (this.modifiresMessage.value.length) {
            this.modifiresMessage.value.forEach(message => {
                this.eventer.emitMessageEvent(message);
            });
            return;
        }
        this.net.put('/cart/add', data).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Блюдо добавлено в корзину')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось добавить блюдо')
             )*/
        });
    }
    addDishToCart$(data) {
        if (this.modifiresMessage.value.length) {
            this.modifiresMessage.value.forEach(message => {
                this.eventer.emitMessageEvent(message);
            });
            return from([null]);
        }
        return this.net.put('/cart/add', data)
            .pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }));
    }
    setDishCountToCart(dishId, amount) {
        this.net.post('/cart/set', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        }).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Изменено количество')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось изменить количество')
             )*/
        });
    }
    setDishComment(dishId, comment) {
        return this.net.post('/cart/setcomment', {
            dishId: dishId,
            cartId: this.cartID,
            comment: comment
        }).pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }, () => {
            this.eventer.emitMessageEvent(new EventMessage('error', 'Ошибка', 'Не удалось изменить коментарий'));
        }));
    }
    removeDishFromCart$(dishId, amount) {
        return this.net.put('/cart/remove', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        })
            .pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }));
    }
    removeDishFromCart(dishId, amount) {
        this.net.put('/cart/remove', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        }).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Блюдо успешно удалено')
             );*/
        }, error => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось удалить блюдо')
             )*/
        });
    }
    checkoutCart(data) {
        let order = {
            cartId: this.cartID,
            address: {
                streetId: data.street.id,
                home: data.house,
                housing: data.housing,
                // index: "1278",
                entrance: data.entrance,
                floor: data.floor,
                apartment: data.apartment
            },
            customer: {
                phone: data.phone,
                name: data.name,
                mail: data.email || undefined
            }
        };
        return this.orderCart(order);
    }
    orderCart(data) {
        return this.net.post('/order', data)
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Заказ упешно оформлен')
             );*/
        }, error => {
            console.log("Ошибка оформления!", error);
            if (error.error && error.error.cart) {
                this.setCartId(error.error.cart.cartId);
                this.cart.next(error.error.cart);
                this.cartID = error.error.cart.cartId;
            }
            /*if (error.message) {
              this.eventer.emitMessageEvent(
                new EventMessage(error.message.type, error.message.title, error.message.body)
              );
            } else {
              this.eventer.emitMessageEvent(
                new EventMessage('error', 'Ошибка', 'Не удалось оформить заказ')
              );
            }*/
        }));
    }
    checkStreetV2(data) {
        return this.net.post('/check', data)
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
            /*if (result.message) {
             this.eventer.emitMessageEvent(
             new EventMessage(
             result.message.type,
             result.message.title,
             result.message.body
             )
             );
             }*/
        }, error => {
            console.error(error);
            //this.eventer.emitMessageEvent(
            //new EventMessage('error', 'Ошибка', 'Не удалось оформить заказ')
            //)
        }));
    }
    checkStreet(data) {
        this.net.post('/check', data).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            if (res.message) {
                this.eventer.emitMessageEvent(new EventMessage(res.message.type, res.message.title, res.message.body));
            }
        }, error => {
            if (error.error) {
                if (error.error.cart) {
                    this.setCartId(error.error.cart.cartId);
                    this.cart.next(error.error.cart);
                    this.cartID = error.error.cart.cartId;
                }
                /*this.eventer.emitMessageEvent(
                 new EventMessage(error.error.message.type, error.error.message.title, error.error.message.body)
                 );*/
            }
        });
    }
    setCartId(cartID) {
        localStorage.setItem('cartID', cartID);
    }
    removeCartId() {
        localStorage.removeItem('cartID');
    }
    userCart() {
        return this.cart;
    }
    setModifires(modifires, messages) {
        this.modifires.next(modifires);
        if (messages) {
            this.modifiresMessage.next(messages);
        }
        ;
    }
    getModifires() {
        return this.modifires.pipe();
    }
    productInCart(product) {
        return this.cart.pipe(filter(cart => 'cartId' in cart), map(cart => {
            var _a;
            return !!(cart && ((_a = cart === null || cart === void 0 ? void 0 : cart.dishes) === null || _a === void 0 ? void 0 : _a.find(dishInCart => dishInCart.dish.id === product.id)));
        }));
    }
    getPickupPoints() {
        return this.net.get('/pickupaddreses?cartId=string');
    }
    getPaymentMethods() {
        return this.net.get('/paymentmethods');
    }
}
NgRestoCartService.ɵfac = function NgRestoCartService_Factory(t) { return new (t || NgRestoCartService)(i0.ɵɵinject(i1.NetService), i0.ɵɵinject(i1.EventerService)); };
NgRestoCartService.ɵprov = i0.ɵɵdefineInjectable({ token: NgRestoCartService, factory: NgRestoCartService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(NgRestoCartService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.NetService }, { type: i1.EventerService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctcmVzdG9jYXJ0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vc3JjLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL25nLXJlc3RvY2FydC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLGVBQWUsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFHTCxZQUFZLEVBQ2IsTUFBTSxtQkFBbUIsQ0FBQztBQUMzQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7OztBQU03QyxNQUFNLE9BQU8sa0JBQWtCO0lBUzdCLFlBQW9CLEdBQWUsRUFBVSxPQUF1QjtRQUFoRCxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUFScEUsV0FBTSxHQUFXLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNsQyxTQUFJLEdBQTBCLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXhELGNBQVMsR0FBeUIsSUFBSSxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUQsb0JBQWUsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QyxxQkFBZ0IsR0FBb0MsSUFBSSxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7UUFJNUUsa0JBQWEsR0FBRyxJQUFJLGFBQWEsQ0FBUyxJQUFJLENBQUMsQ0FBQztRQUVoRCx3QkFBbUIsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBb0IsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FDN0UsV0FB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LENBQUM7SUFDSixDQUFDO0lBRUQsZUFBZTtRQUNiLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQWdCLCtCQUErQixDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVELGlCQUFpQjtRQUNmLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQWtCLGlCQUFpQixDQUFDLENBQUM7SUFDMUQsQ0FBQzs7b0ZBNVRVLGtCQUFrQjswREFBbEIsa0JBQWtCLFdBQWxCLGtCQUFrQixtQkFGakIsTUFBTTtrREFFUCxrQkFBa0I7Y0FIOUIsVUFBVTtlQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QsIHRocm93RXJyb3IsIGZyb20sIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY2F0Y2hFcnJvciwgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQge1xyXG4gIE5ldFNlcnZpY2UsXHJcbiAgRXZlbnRlclNlcnZpY2UsXHJcbiAgRXZlbnRNZXNzYWdlXHJcbn0gZnJvbSAnQHdlYnJlc3RvL25nLWNvcmUnO1xyXG5pbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ1Jlc3RvQ2FydFNlcnZpY2Uge1xyXG4gIGNhcnRJRDogc3RyaW5nID0gdGhpcy5nZXRDYXJ0SWQoKTtcclxuICBjYXJ0OiBCZWhhdmlvclN1YmplY3Q8Q2FydD4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KG51bGwpO1xyXG5cclxuICBtb2RpZmlyZXM6IEJlaGF2aW9yU3ViamVjdDxhbnk+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChbXSk7XHJcbiAgT3JkZXJGb3JtQ2hhbmdlID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcclxuXHJcbiAgbW9kaWZpcmVzTWVzc2FnZTogQmVoYXZpb3JTdWJqZWN0PEV2ZW50TWVzc2FnZVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3QoW10pO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5ldDogTmV0U2VydmljZSwgcHJpdmF0ZSBldmVudGVyOiBFdmVudGVyU2VydmljZSkgeyB9XHJcblxyXG4gIHJlc3RyaWN0aW9ucyQgPSBuZXcgUmVwbGF5U3ViamVjdDxzdHJpbmc+KG51bGwpO1xyXG5cclxuICByZXN0cmljdGlvbnNMb2FkZXIkID0gdGhpcy5uZXQuZ2V0PFJlc3RyaWN0aW9uc09yZGVyPihgL3Jlc3RyaWN0aW9uc2ApLnBpcGUobWFwKFxyXG4gICAgcmVzdGljdGlvbnMgPT4gZm9ybWF0RGF0ZShEYXRlLm5vdygpICsgcmVzdGljdGlvbnMucGVyaW9kUG9zc2libGVGb3JPcmRlciAqIDYwMDAwLCAneXl5eS1NTS1kZCcsICdlbicpKVxyXG4gICkuc3Vic2NyaWJlKHRoaXMucmVzdHJpY3Rpb25zJCk7XHJcblxyXG4gIGdldENhcnRJZCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYXJ0SUQnKTtcclxuICB9XHJcblxyXG4gIGdldENhcnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQuZ2V0PHsgY2FydDogQ2FydCB9PihgL2NhcnQke3RoaXMuY2FydElEID8gJz9jYXJ0SWQ9JyArIHRoaXMuY2FydElEIDogJyd9YCkucGlwZShcclxuICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgIGRhdGEgPT4ge1xyXG4gICAgICAgICAgaWYgKCF0aGlzLmNhcnRJRCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldENhcnRJZChkYXRhLmNhcnQuY2FydElkKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBpZiAoZGF0YS5jYXJ0LnN0YXRlID09ICdPUkRFUicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IobmV3IEVycm9yKCdDYXJ0IGluIG9yZGVyIHN0YXRlJykpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0Lm5leHQoZGF0YS5jYXJ0KTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5jYXJ0O1xyXG4gICAgICAgIH0pLFxyXG4gICAgICBjYXRjaEVycm9yKGVyciA9PiB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVDYXJ0SWQoKTtcclxuICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGFkZERpc2hUb0NhcnQoZGF0YSkge1xyXG5cclxuICAgIGlmICh0aGlzLm1vZGlmaXJlc01lc3NhZ2UudmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMubW9kaWZpcmVzTWVzc2FnZS52YWx1ZS5mb3JFYWNoKG1lc3NhZ2UgPT4ge1xyXG4gICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubmV0LnB1dCgnL2NhcnQvYWRkJywgZGF0YSkuc3Vic2NyaWJlKFxyXG4gICAgICByZXMgPT4ge1xyXG5cclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXMuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuXHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnc3VjY2VzcycsICfQo9GB0L/QtdGFJywgJ9CR0LvRjtC00L4g0LTQvtCx0LDQstC70LXQvdC+INCyINC60L7RgNC30LjQvdGDJylcclxuICAgICAgICAgKTsqL1xyXG5cclxuICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINC00L7QsdCw0LLQuNGC0Ywg0LHQu9GO0LTQvicpXHJcbiAgICAgICAgICkqL1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZERpc2hUb0NhcnQkKGRhdGEpIHtcclxuICAgIGlmICh0aGlzLm1vZGlmaXJlc01lc3NhZ2UudmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMubW9kaWZpcmVzTWVzc2FnZS52YWx1ZS5mb3JFYWNoKG1lc3NhZ2UgPT4ge1xyXG4gICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGZyb20oW251bGxdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5uZXQucHV0KCcvY2FydC9hZGQnLCBkYXRhKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAocmVzID0+IHtcclxuICAgICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzaENvdW50VG9DYXJ0KGRpc2hJZCwgYW1vdW50KSB7XHJcbiAgICB0aGlzLm5ldC5wb3N0KCcvY2FydC9zZXQnLCB7XHJcbiAgICAgIGRpc2hJZDogZGlzaElkLFxyXG4gICAgICBjYXJ0SWQ6IHRoaXMuY2FydElELFxyXG4gICAgICBhbW91bnQ6IGFtb3VudFxyXG4gICAgfSkuc3Vic2NyaWJlKFxyXG4gICAgICByZXMgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzLmNhcnQpO1xyXG4gICAgICAgIHRoaXMuY2FydElEID0gcmVzLmNhcnQuY2FydElkO1xyXG5cclxuICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdzdWNjZXNzJywgJ9Cj0YHQv9C10YUnLCAn0JjQt9C80LXQvdC10L3QviDQutC+0LvQuNGH0LXRgdGC0LLQvicpXHJcbiAgICAgICAgICk7Ki9cclxuXHJcblxyXG4gICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnZXJyb3InLCAn0J7RiNC40LHQutCwJywgJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0LjQt9C80LXQvdC40YLRjCDQutC+0LvQuNGH0LXRgdGC0LLQvicpXHJcbiAgICAgICAgICkqL1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHNldERpc2hDb21tZW50KGRpc2hJZCwgY29tbWVudCkge1xyXG4gICAgcmV0dXJuIHRoaXMubmV0LnBvc3QoJy9jYXJ0L3NldGNvbW1lbnQnLCB7XHJcbiAgICAgIGRpc2hJZDogZGlzaElkLFxyXG4gICAgICBjYXJ0SWQ6IHRoaXMuY2FydElELFxyXG4gICAgICBjb21tZW50OiBjb21tZW50XHJcbiAgICB9KS5waXBlKHRhcChcclxuICAgICAgcmVzID0+IHtcclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXMuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuXHJcbiAgICAgIH0sICgpID0+IHtcclxuICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINC40LfQvNC10L3QuNGC0Ywg0LrQvtC80LXQvdGC0LDRgNC40LknKVxyXG4gICAgICAgIClcclxuICAgICAgfVxyXG4gICAgKSlcclxuXHJcbiAgfVxyXG5cclxuICByZW1vdmVEaXNoRnJvbUNhcnQkKGRpc2hJZCwgYW1vdW50KSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQucHV0KCcvY2FydC9yZW1vdmUnLCB7XHJcbiAgICAgIGRpc2hJZDogZGlzaElkLFxyXG4gICAgICBjYXJ0SWQ6IHRoaXMuY2FydElELFxyXG4gICAgICBhbW91bnQ6IGFtb3VudFxyXG4gICAgfSlcclxuICAgICAgLnBpcGUodGFwKHJlcyA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzLmNhcnQuY2FydElkKTtcclxuICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXMuY2FydC5jYXJ0SWQ7XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgfVxyXG5cclxuICByZW1vdmVEaXNoRnJvbUNhcnQoZGlzaElkLCBhbW91bnQpIHtcclxuICAgIHRoaXMubmV0LnB1dCgnL2NhcnQvcmVtb3ZlJywge1xyXG4gICAgICBkaXNoSWQ6IGRpc2hJZCxcclxuICAgICAgY2FydElkOiB0aGlzLmNhcnRJRCxcclxuICAgICAgYW1vdW50OiBhbW91bnRcclxuICAgIH0pLnN1YnNjcmliZShcclxuICAgICAgcmVzID0+IHtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzLmNhcnQuY2FydElkKTtcclxuICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXMuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnc3VjY2VzcycsICfQo9GB0L/QtdGFJywgJ9CR0LvRjtC00L4g0YPRgdC/0LXRiNC90L4g0YPQtNCw0LvQtdC90L4nKVxyXG4gICAgICAgICApOyovXHJcblxyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnZXJyb3InLCAn0J7RiNC40LHQutCwJywgJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0YPQtNCw0LvQuNGC0Ywg0LHQu9GO0LTQvicpXHJcbiAgICAgICAgICkqL1xyXG4gICAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBjaGVja291dENhcnQoZGF0YSkge1xyXG4gICAgbGV0IG9yZGVyID0ge1xyXG4gICAgICBjYXJ0SWQ6IHRoaXMuY2FydElELFxyXG4gICAgICBhZGRyZXNzOiB7XHJcbiAgICAgICAgc3RyZWV0SWQ6IGRhdGEuc3RyZWV0LmlkLFxyXG4gICAgICAgIGhvbWU6IGRhdGEuaG91c2UsXHJcbiAgICAgICAgaG91c2luZzogZGF0YS5ob3VzaW5nLFxyXG4gICAgICAgIC8vIGluZGV4OiBcIjEyNzhcIixcclxuICAgICAgICBlbnRyYW5jZTogZGF0YS5lbnRyYW5jZSxcclxuICAgICAgICBmbG9vcjogZGF0YS5mbG9vcixcclxuICAgICAgICBhcGFydG1lbnQ6IGRhdGEuYXBhcnRtZW50XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBjdXN0b21lcjoge1xyXG4gICAgICAgIHBob25lOiBkYXRhLnBob25lLFxyXG4gICAgICAgIG5hbWU6IGRhdGEubmFtZSxcclxuICAgICAgICBtYWlsOiBkYXRhLmVtYWlsIHx8IHVuZGVmaW5lZFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRoaXMub3JkZXJDYXJ0KG9yZGVyKTtcclxuXHJcbiAgfVxyXG5cclxuICBvcmRlckNhcnQoZGF0YSkge1xyXG4gICAgcmV0dXJuIHRoaXMubmV0LnBvc3QoJy9vcmRlcicsIGRhdGEpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcChcclxuICAgICAgICAgIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKHJlc3VsdC5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydC5uZXh0KHJlc3VsdC5jYXJ0KTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXN1bHQuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdzdWNjZXNzJywgJ9Cj0YHQv9C10YUnLCAn0JfQsNC60LDQtyDRg9C/0LXRiNC90L4g0L7RhNC+0YDQvNC70LXQvScpXHJcbiAgICAgICAgICAgICApOyovXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcItCe0YjQuNCx0LrQsCDQvtGE0L7RgNC80LvQtdC90LjRjyFcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IuZXJyb3IgJiYgZXJyb3IuZXJyb3IuY2FydCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKGVycm9yLmVycm9yLmNhcnQuY2FydElkKTtcclxuICAgICAgICAgICAgICB0aGlzLmNhcnQubmV4dChlcnJvci5lcnJvci5jYXJ0KTtcclxuICAgICAgICAgICAgICB0aGlzLmNhcnRJRCA9IGVycm9yLmVycm9yLmNhcnQuY2FydElkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qaWYgKGVycm9yLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoZXJyb3IubWVzc2FnZS50eXBlLCBlcnJvci5tZXNzYWdlLnRpdGxlLCBlcnJvci5tZXNzYWdlLmJvZHkpXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINC+0YTQvtGA0LzQuNGC0Ywg0LfQsNC60LDQtycpXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tTdHJlZXRWMihkYXRhKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5wb3N0KCcvY2hlY2snLCBkYXRhKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAoXHJcbiAgICAgICAgICByZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldENhcnRJZChyZXN1bHQuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgICAgICB0aGlzLmNhcnQubmV4dChyZXN1bHQuY2FydCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydElEID0gcmVzdWx0LmNhcnQuY2FydElkO1xyXG4gICAgICAgICAgICAvKmlmIChyZXN1bHQubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKFxyXG4gICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UudHlwZSxcclxuICAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlLnRpdGxlLFxyXG4gICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UuYm9keVxyXG4gICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIC8vdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgICAgIC8vbmV3IEV2ZW50TWVzc2FnZSgnZXJyb3InLCAn0J7RiNC40LHQutCwJywgJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0L7RhNC+0YDQvNC40YLRjCDQt9Cw0LrQsNC3JylcclxuICAgICAgICAgICAgLy8pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tTdHJlZXQoZGF0YSk6IHZvaWQge1xyXG5cclxuICAgIHRoaXMubmV0LnBvc3QoJy9jaGVjaycsIGRhdGEpLnN1YnNjcmliZShcclxuICAgICAgcmVzID0+IHtcclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXMuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuICAgICAgICBpZiAocmVzLm1lc3NhZ2UpIHtcclxuICAgICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKHJlcy5tZXNzYWdlLnR5cGUsIHJlcy5tZXNzYWdlLnRpdGxlLCByZXMubWVzc2FnZS5ib2R5KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IuZXJyb3IpIHtcclxuICAgICAgICAgIGlmIChlcnJvci5lcnJvci5jYXJ0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKGVycm9yLmVycm9yLmNhcnQuY2FydElkKTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0Lm5leHQoZXJyb3IuZXJyb3IuY2FydCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydElEID0gZXJyb3IuZXJyb3IuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoZXJyb3IuZXJyb3IubWVzc2FnZS50eXBlLCBlcnJvci5lcnJvci5tZXNzYWdlLnRpdGxlLCBlcnJvci5lcnJvci5tZXNzYWdlLmJvZHkpXHJcbiAgICAgICAgICAgKTsqL1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgc2V0Q2FydElkKGNhcnRJRCkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhcnRJRCcsIGNhcnRJRCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVDYXJ0SWQoKSB7XHJcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY2FydElEJyk7XHJcbiAgfVxyXG5cclxuICB1c2VyQ2FydCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY2FydDtcclxuICB9XHJcblxyXG4gIHNldE1vZGlmaXJlcyhtb2RpZmlyZXMsIG1lc3NhZ2VzPzogRXZlbnRNZXNzYWdlW10pOiB2b2lkIHtcclxuICAgIHRoaXMubW9kaWZpcmVzLm5leHQobW9kaWZpcmVzKTtcclxuICAgIGlmIChtZXNzYWdlcykge1xyXG4gICAgICB0aGlzLm1vZGlmaXJlc01lc3NhZ2UubmV4dChtZXNzYWdlcyk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0TW9kaWZpcmVzKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5tb2RpZmlyZXMucGlwZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJvZHVjdEluQ2FydChwcm9kdWN0OiBEaXNoTGlzdEl0ZW0pIHtcclxuICAgIHJldHVybiB0aGlzLmNhcnQucGlwZShcclxuICAgICAgZmlsdGVyKGNhcnQgPT4gJ2NhcnRJZCcgaW4gY2FydCksXHJcbiAgICAgIG1hcChjYXJ0ID0+IHtcclxuICAgICAgICByZXR1cm4gISEoY2FydCAmJiBjYXJ0Py5kaXNoZXM/LmZpbmQoZGlzaEluQ2FydCA9PiBkaXNoSW5DYXJ0LmRpc2guaWQgPT09IHByb2R1Y3QuaWQpKVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldFBpY2t1cFBvaW50cygpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5nZXQ8UGlja3VwUG9pbnRbXT4oJy9waWNrdXBhZGRyZXNlcz9jYXJ0SWQ9c3RyaW5nJyk7XHJcbiAgfVxyXG5cclxuICBnZXRQYXltZW50TWV0aG9kcygpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5nZXQ8UGF5bWVudE1ldGhvZFtdPignL3BheW1lbnRtZXRob2RzJyk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgUGlja3VwUG9pbnQge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdGl0bGU6IHN0cmluZztcclxuICBhZGRyZXNzOiBzdHJpbmc7XHJcbiAgb3JkZXI6IG51bWJlcjtcclxuICBlbmFibGU6IGJvb2xlYW47XHJcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XHJcbiAgdXBkYXRlZEF0OiBzdHJpbmc7XHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIFBheW1lbnRNZXRob2Qge1xyXG4gIGlpa29QYXltZW50TWV0aG9kOiBhbnksXHJcbiAgaWQ6IHN0cmluZyxcclxuICB0aXRsZTogc3RyaW5nLFxyXG4gIHR5cGU6IHN0cmluZyxcclxuICBhZGFwdGVyOiBzdHJpbmcsXHJcbiAgb3JkZXI6IG51bWJlcixcclxuICBkZXNjcmlwdGlvbjogc3RyaW5nLFxyXG4gIGVuYWJsZTogYm9vbGVhbixcclxuICBjcmVhdGVkQXQ6IHN0cmluZyxcclxuICB1cGRhdGVkQXQ6IHN0cmluZ1xyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBEaXNoSW5DYXJ0IHtcclxuICBhZGRlZEJ5OiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgY2FydDogc3RyaW5nO1xyXG4gIGNvbW1lbnQ6IHN0cmluZztcclxuICBjcmVhdGVkQXQ6IHN0cmluZztcclxuICBkaXNoOiBEaXNoTGlzdEl0ZW07XHJcbiAgaWQ6IG51bWJlcjtcclxuICBpdGVtVG90YWw6IG51bWJlcjtcclxuICBtb2RpZmllcnM6IGFueVtdO1xyXG4gIHBhcmVudDogYW55O1xyXG4gIHRvdGFsV2VpZ2h0OiBudW1iZXI7XHJcbiAgdW5pcXVlSXRlbXM6IG51bWJlcjtcclxuICB1cGRhdGVkQXQ6IHN0cmluZztcclxuICB3ZWlnaHQ6IG51bWJlcjtcclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgQ2FydCB7XHJcbiAgYWRkcmVzczogYW55XHJcbiAgY2FydElkOiBzdHJpbmdcclxuICBjYXJ0VG90YWw6IG51bWJlclxyXG4gIGNvbW1lbnQ6IHN0cmluZ1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgY3VzdG9tZXI6IHN0cmluZ1xyXG4gIGRlbGl2ZXJ5OiBhbnlcclxuICBkZWxpdmVyeURlc2NyaXB0aW9uOiBzdHJpbmdcclxuICBkZWxpdmVyeUl0ZW06IGFueVxyXG4gIGRlbGl2ZXJ5U3RhdHVzOiBhbnlcclxuICBkaXNoZXM6IERpc2hJbkNhcnRbXVxyXG4gIGRpc2hlc0NvdW50OiBudW1iZXJcclxuICBoaXN0b3J5OiBhbnlcclxuICBpZDogc3RyaW5nXHJcbiAgbWVzc2FnZTogYW55XHJcbiAgbW9kaWZpZXJzOiBhbnlcclxuICBuYW1lT2ZNb2RlbDogYW55XHJcbiAgcGVyc29uc0NvdW50OiBudW1iZXJcclxuICBwcm9ibGVtOiBib29sZWFuXHJcbiAgcm1zSWQ6IHN0cmluZ1xyXG4gIHNlbGZEZWxpdmVyeTogYm9vbGVhblxyXG4gIHNlbmRUb0lpa286IGJvb2xlYW5cclxuICBzdGF0ZTogc3RyaW5nXHJcbiAgdG90YWxXZWlnaHQ6IHN0cmluZ1xyXG4gIHVuaXF1ZURpc2hlczogc3RyaW5nXHJcbiAgdXBkYXRlZEF0OiBzdHJpbmdcclxuICB1c2VyOiBhbnlcclxuICBGcmVlRGVsaXZlcnlGcm9tTWVzc2FnZTogc3RyaW5nXHJcbiAgZGF0ZTogbnVsbFxyXG4gIGRlbGl2ZXJ5VGltZU1lc3NhZ2U6IHN0cmluZ1xyXG4gIGRlbGl2ZXJ5VG90YWw6IG51bWJlclxyXG4gIGRpc2NvdW50VG90YWw6IG51bWJlclxyXG4gIGlzUGF5bWVudFByb21pc2U6IGJvb2xlYW5cclxuICBvcmRlckRhdGU6IHN0cmluZ1xyXG4gIG9yZGVyRGF0ZUxpbWl0OiBzdHJpbmdcclxuICBvcmRlclRvdGFsOiBudW1iZXJcclxuICBwYWlkOiBib29sZWFuXHJcbiAgcGF5bWVudE1ldGhvZDogc3RyaW5nXHJcbiAgcGF5bWVudE1ldGhvZFRpdGxlOiBzdHJpbmdcclxuICByZWNvbW1lbmRzOiBEaXNoTGlzdEl0ZW1bXTtcclxuICBybXNEZWxpdmVyZWQ6IGJvb2xlYW5cclxuICBybXNEZWxpdmVyeURhdGU6IG51bGxcclxuICBybXNFcnJvckNvZGU6IG51bGxcclxuICBybXNFcnJvck1lc3NhZ2U6IG51bGxcclxuICBybXNPcmRlckRhdGE6IG51bGxcclxuICBybXNPcmRlck51bWJlcjogbnVsbFxyXG4gIHJtc1N0YXR1c0NvZGU6IG51bGxcclxuICBzZWxmU2VydmljZTogYm9vbGVhblxyXG4gIHNob3J0SWQ6IHN0cmluZ1xyXG4gIHRvdGFsOiBudW1iZXJcclxuICB1bnRpbEZyZWVEZWxpdmVyeU1lc3NhZ2U6IHN0cmluZ1xyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBEaXNoTGlzdEl0ZW0ge1xyXG4gIGFkZGl0aW9uYWxJbmZvOiBhbnlcclxuICBiYWxhbmNlOiBudW1iZXJcclxuICBjYXJib2h5ZHJhdGVBbW91bnQ6IG51bWJlclxyXG4gIGNhcmJvaHlkcmF0ZUZ1bGxBbW91bnQ6IG51bWJlclxyXG4gIGNvZGU6IHN0cmluZ1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xyXG4gIGRpZmZlcmVudFByaWNlc09uOiBhbnlbXVxyXG4gIGRvTm90UHJpbnRJbkNoZXF1ZTogYm9vbGVhblxyXG4gIGVuZXJneUFtb3VudDogbnVtYmVyXHJcbiAgZW5lcmd5RnVsbEFtb3VudDogbnVtYmVyXHJcbiAgZmF0QW1vdW50OiBudW1iZXJcclxuICBmYXRGdWxsQW1vdW50OiBudW1iZXJcclxuICBmaWJlckFtb3VudDogbnVtYmVyXHJcbiAgZmliZXJGdWxsQW1vdW50OiBudW1iZXJcclxuICBncm91cElkOiBhbnlcclxuICBncm91cE1vZGlmaWVyczogW11cclxuICBoYXNoOiBudW1iZXJcclxuICBpZDogc3RyaW5nXHJcbiAgaW1hZ2VzOiBEaXNoSW1hZ2VJdGVtW11cclxuICBpbWFnZXNMaXN0OiBEaXNoSW1hZ2VJdGVtW11cclxuICBpc0RlbGV0ZWQ6IGJvb2xlYW5cclxuICBpc0luY2x1ZGVkSW5NZW51OiBib29sZWFuXHJcbiAgbWVhc3VyZVVuaXQ6IHN0cmluZ1xyXG4gIG1vZGlmaWVyczogRGlzaE1vZGlmaWVyW11cclxuICBuYW1lOiBzdHJpbmdcclxuICBvcmRlcjogbnVtYmVyXHJcbiAgcGFyZW50R3JvdXA6IHN0cmluZ1xyXG4gIHByaWNlOiBudW1iZXJcclxuICBwcm9kdWN0Q2F0ZWdvcnlJZDogc3RyaW5nXHJcbiAgcHJvaGliaXRlZFRvU2FsZU9uOiBhbnlbXVxyXG4gIHJtc0lkOiBzdHJpbmdcclxuICBzZW9EZXNjcmlwdGlvbjogYW55XHJcbiAgc2VvS2V5d29yZHM6IGFueVxyXG4gIHNlb1RleHQ6IGFueVxyXG4gIHNlb1RpdGxlOiBhbnlcclxuICBzbHVnOiBzdHJpbmdcclxuICB0YWdzOiBhbnlbXVxyXG4gIHRhZ3NMaXN0OiBhbnlbXVxyXG4gIHR5cGU6IHN0cmluZ1xyXG4gIHVwZGF0ZWRBdDogc3RyaW5nXHJcbiAgdXNlQmFsYW5jZUZvclNlbGw6IGJvb2xlYW5cclxuICB3ZWlnaHQ6IG51bWJlclxyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBEaXNoSW1hZ2VVcmxzIHtcclxuICBsYXJnZTogc3RyaW5nXHJcbiAgb3JpZ2luOiBzdHJpbmdcclxuICBzbWFsbDogc3RyaW5nXHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIERpc2hJbWFnZUl0ZW0ge1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgZ3JvdXA6IGFueVxyXG4gIGlkOiBzdHJpbmdcclxuICBpbWFnZXM6IERpc2hJbWFnZVVybHNcclxuICB1cGRhdGVkQXQ6IHN0cmluZ1xyXG4gIHVwbG9hZERhdGU6IHN0cmluZ1xyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBEaXNoQmFzZU1vZGlmaWVyIHtcclxuICBtYXhBbW91bnQ6IG51bWJlclxyXG4gIG1pbkFtb3VudDogbnVtYmVyXHJcbiAgbW9kaWZpZXJJZDogc3RyaW5nXHJcbiAgcmVxdWlyZWQ6IGJvb2xlYW5cclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgRGlzaE1vZGlmaWVyIGV4dGVuZHMgRGlzaEJhc2VNb2RpZmllciB7XHJcbiAgY2hpbGRNb2RpZmllcnM6IERpc2hDaGlsZE1vZGlmaWVyW11cclxuICBjaGlsZE1vZGlmaWVyc0hhdmVNaW5NYXhSZXN0cmljdGlvbnM6IGJvb2xlYW5cclxuICBncm91cDogRGlzaExpc3RJdGVtXHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIERpc2hDaGlsZE1vZGlmaWVyIGV4dGVuZHMgRGlzaEJhc2VNb2RpZmllciB7XHJcbiAgZGVmYXVsdEFtb3VudDogbnVtYmVyXHJcbiAgaGlkZUlmRGVmYXVsdEFtb3VudDogYm9vbGVhblxyXG4gIGRpc2g6IERpc2hMaXN0SXRlbVxyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBXb3JrVGltZUJhc2Uge1xyXG4gIHN0YXJ0OiBzdHJpbmc7XHJcbiAgc3RvcDogc3RyaW5nO1xyXG4gIGJyZWFrOiBzdHJpbmc7XHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIFdvcmtUaW1lIGV4dGVuZHMgV29ya1RpbWVCYXNlIHtcclxuICBkYXlPZldlZWs6IHN0cmluZ1xyXG4gIHNlbGZTZXJ2aWNlOiBXb3JrVGltZUJhc2VcclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgUmVzdHJpY3Rpb25zT3JkZXIge1xyXG4gIG1pbkRlbGl2ZXJ5VGltZTogc3RyaW5nXHJcbiAgcGVyaW9kUG9zc2libGVGb3JPcmRlcjogbnVtYmVyXHJcbiAgdGltZXpvbmU6IHN0cmluZ1xyXG4gIHdvcmtUaW1lOiBXb3JrVGltZVtdXHJcbn1cclxuXHJcbiJdfQ==