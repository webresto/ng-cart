!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@webresto/ng-core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@webresto/ng-cart",["exports","@angular/core","rxjs","rxjs/operators","@webresto/ng-core","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).webresto=e.webresto||{},e.webresto["ng-cart"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.i1,e.ng.common)}(this,(function(e,t,i,r,n,o){"use strict";var s=function(){function e(e,t){this.net=e,this.eventer=t,this.cartID=this.getCartId(),this.cart=new i.BehaviorSubject(null),this.modifires=new i.BehaviorSubject([]),this.OrderFormChange=new i.BehaviorSubject(null),this.modifiresMessage=new i.BehaviorSubject([])}return e.prototype.getCartId=function(){return localStorage.getItem("cartID")},e.prototype.getCart=function(){var e=this;return this.cartID?this.net.get("/cart?cartId="+this.cartID).pipe(r.switchMap((function(t){return"ORDER"==t.state?i.throwError(new Error("Cart in order state")):(e.cart.next(t.cart),e.cart)})),r.catchError((function(t){return e.removeCartId(),i.throwError(t)}))):i.from([{}])},e.prototype.addDishToCart=function(e){var t=this;this.modifiresMessage.value.length?this.modifiresMessage.value.forEach((function(e){t.eventer.emitMessageEvent(e)})):this.net.put("/cart/add",e).subscribe((function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId}),(function(){}))},e.prototype.addDishToCart$=function(e){var t=this;return this.modifiresMessage.value.length?(this.modifiresMessage.value.forEach((function(e){t.eventer.emitMessageEvent(e)})),i.from([null])):this.net.put("/cart/add",e).pipe(r.tap((function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId})))},e.prototype.setDishCountToCart=function(e,t){var i=this;this.net.post("/cart/set",{dishId:e,cartId:this.cartID,amount:t}).subscribe((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId}),(function(){}))},e.prototype.setDishComment=function(e,t){var i=this;return this.net.post("/cart/setcomment",{dishId:e,cartId:this.cartID,comment:t}).pipe(r.tap((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId}),(function(){i.eventer.emitMessageEvent(new n.EventMessage("error","Ошибка","Не удалось изменить коментарий"))})))},e.prototype.removeDishFromCart$=function(e,t){var i=this;return this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).pipe(r.tap((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId})))},e.prototype.removeDishFromCart=function(e,t){var i=this;this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).subscribe((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId}),(function(e){}))},e.prototype.checkoutCart=function(e){var t={cartId:this.cartID,address:{streetId:e.street.id,home:e.house,housing:e.housing,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:e.phone,name:e.name,mail:e.email||void 0}};return this.orderCart(t)},e.prototype.orderCart=function(e){var t=this;return this.net.post("/order",e).pipe(r.tap((function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId}),(function(e){console.log("Ошибка оформления!",e),e.error&&e.error.cart&&(t.setCartId(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId)})))},e.prototype.checkStreetV2=function(e){var t=this;return this.net.post("/check",e).pipe(r.tap((function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId}),(function(e){console.error(e)})))},e.prototype.checkStreet=function(e){var t=this;this.net.post("/check",e).subscribe((function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,e.message&&t.eventer.emitMessageEvent(new n.EventMessage(e.message.type,e.message.title,e.message.body))}),(function(e){e.error&&e.error.cart&&(t.setCartId(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId)}))},e.prototype.setCartId=function(e){localStorage.setItem("cartID",e)},e.prototype.removeCartId=function(){localStorage.removeItem("cartID")},e.prototype.userCart=function(){return this.cart},e.prototype.setModifires=function(e,t){this.modifires.next(e),t&&this.modifiresMessage.next(t)},e.prototype.getModifires=function(){return this.modifires.pipe()},e.prototype.productInCart=function(e){return this.cart.pipe(r.filter((function(e){return"cartId"in e})),r.map((function(t){var i;return!(!t||!(null===(i=null==t?void 0:t.dishes)||void 0===i?void 0:i.find((function(t){return t.dish.id===e.id}))))})))},e.prototype.getPickupPoints=function(){return this.net.get("/pickupaddreses?cartId=string")},e.prototype.getPaymentMethods=function(){return this.net.get("/paymentmethods")},e}();s.ɵfac=function(e){return new(e||s)(t.ɵɵinject(n.NetService),t.ɵɵinject(n.EventerService))},s.ɵprov=t.ɵɵdefineInjectable({token:s,factory:s.ɵfac,providedIn:"root"});var d=function(){function e(e){var i=this;this.cartService=e,this.loading=new t.EventEmitter,this.success=new t.EventEmitter,this.error=new t.EventEmitter,this.cartService.userCart().subscribe((function(e){return i.cart=e})),this.cartService.getModifires().subscribe((function(e){return i.modifires=e}))}return e.prototype.onClick=function(){this.addDishToCart(this.dish.id,this.amountDish)},e.prototype.addDishToCart=function(e,t){var i=this,r={dishId:e,amount:t,cartId:void 0,modifiers:this.modifires,comment:this.comment};this.cart.cartId&&(r.cartId=this.cart.cartId),this.loading.emit(!0),this.cartService.addDishToCart$(r).subscribe((function(){return i.success.emit(!0)}),(function(e){return i.error.emit(e)}),(function(){return i.loading.emit(!1)}))},e}();d.ɵfac=function(e){return new(e||d)(t.ɵɵdirectiveInject(s))},d.ɵdir=t.ɵɵdefineDirective({type:d,selectors:[["","addToCart",""]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("click",(function(){return i.onClick()}))},inputs:{modifires:"modifires",dish:"dish",amountDish:"amountDish",comment:"comment"},outputs:{loading:"loading",success:"success",error:"error"}});var a=function(e,t,i){var r=this;this.cartService=e,this.renderer=t,this.el=i,this.amount="0",this.renderer.setProperty(this.el.nativeElement,"innerHTML",this.amount),this.cartService.userCart().subscribe((function(e){r.cart=e,r.amount=e.dishesCount||0,r.renderer.setProperty(r.el.nativeElement,"innerHTML",r.amount)}))};a.ɵfac=function(e){return new(e||a)(t.ɵɵdirectiveInject(s),t.ɵɵdirectiveInject(t.Renderer2),t.ɵɵdirectiveInject(t.ElementRef))},a.ɵdir=t.ɵɵdefineDirective({type:a,selectors:[["","amountCart",""]]});var c=function(){function e(e){var i=this;this.cartService=e,this.success=new t.EventEmitter,this.error=new t.EventEmitter,this.isChecking=new t.EventEmitter,this.cartService.userCart().subscribe((function(e){return i.cart=e})),this.cartService.OrderFormChange.pipe(r.filter((function(){if(i.locationId||(i.streetId||i.street)&&i.home||i.selfService)return!0})),r.debounceTime(1e3)).subscribe((function(){return i.checkStreet()}))}return e.prototype.onClick=function(){var e=this;if(this.locationId||(this.streetId||this.street)&&this.home||this.selfService){var t=this.comment||"Не указан",i={cartId:this.cart.cartId,comment:t,customer:{phone:this.preparePhone(this.phone),mail:this.email,name:this.name},personsCount:+this.personsCount};this.paymentMethodId&&(i.paymentMethodId=this.paymentMethodId),this.date&&(i.date=this.date),this.notifyMethodId&&(i.notifyMethodId=this.notifyMethodId),i.selfService=this.selfService,this.bonuses&&(i.bonuses=this.bonuses.map((function(e){return{name:e.name,amount:e.amount}}))),this.locationId?i.locationId=this.locationId:i.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""};var r=this.cart.id;this.cartService.orderCart(i).subscribe((function(t){t.action&&t.action.paymentRedirect?window.location.href=t.action.paymentRedirect:e.success.emit(r)}),(function(t){return e.error.emit(t)}))}else this.error.emit("Нужно указать адрес")},e.prototype.ngOnChanges=function(e){this.cartService.OrderFormChange.next(e)},e.prototype.checkStreet=function(){var e=this,t=this.comment||"Не указан",i={cartId:this.cart.cartId,comment:t,customer:{phone:this.phone?this.preparePhone(this.phone):null,mail:this.email,name:this.name||null},personsCount:+this.personsCount};i.selfService=this.selfService,this.paymentMethodId&&(i.paymentMethodId=this.paymentMethodId),this.date&&(i.date=this.date),this.notifyMethodId&&(i.notifyMethodId=this.notifyMethodId),this.locationId?i.locationId=this.locationId:i.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},this.isChecking.emit(!0),this.cartService.checkStreetV2(i).subscribe((function(){return e.isChecking.emit(!1)}),(function(){return e.isChecking.emit(!1)}))},e.prototype.preparePhone=function(e){return e?(e="+"+e.replace(/[^0-9]/gim,"")).replace("+8","+7"):""},e}();c.ɵfac=function(e){return new(e||c)(t.ɵɵdirectiveInject(s))},c.ɵdir=t.ɵɵdefineDirective({type:c,selectors:[["","checkout",""]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("click",(function(){return i.onClick()}))},inputs:{cartTotal:"cartTotal",bonuses:"bonuses",name:"name",email:"email",phone:"phone",delivery:"delivery",selfService:"selfService",locationId:"locationId",street:"street",streetId:"streetId",home:"home",housing:"housing",apartment:"apartment",entrance:"entrance",doorphone:"doorphone",floor:"floor",paymentMethod:"paymentMethod",paymentMethodId:"paymentMethodId",personsCount:"personsCount",comment:"comment",date:"date",notifyMethodId:"notifyMethodId"},outputs:{success:"success",error:"error",isChecking:"isChecking"},features:[t.ɵɵNgOnChangesFeature]});var h=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe((function(e){return t.cart=e}))}return e.prototype.onClick=function(){this.cartService.removeDishFromCart(this.dish.id,this.amountDish)},e}();h.ɵfac=function(e){return new(e||h)(t.ɵɵdirectiveInject(s))},h.ɵdir=t.ɵɵdefineDirective({type:h,selectors:[["","deleteFromCart",""]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("click",(function(){return i.onClick()}))},inputs:{dish:"dish",amountDish:"amountDish"}});var m=function(){function e(e,i,r){this.renderer=e,this.el=i,this.cartService=r,this.validate=new t.EventEmitter,this.amountDishToAdd=new t.EventEmitter,this.amountModifires={},this.stateModifiers={}}return e.prototype.ngOnInit=function(){var e=this;this.renderer.addClass(this.el.nativeElement,"dish-calculator"),this.amountDish=this.amount,this.amountDishToAdd.emit(this.amountDish),this.price=this.renderer.createElement("div"),this.renderer.addClass(this.price,"dish-price"),setTimeout((function(){e.renderDish(e.dish),e.render(e.dish.modifiers)}),100)},e.prototype.renderDish=function(e){var t=this,i=this.renderer.createElement("div");this.renderer.addClass(i,"dish-wraper"),this.renderer.appendChild(this.el.nativeElement,i);var r=this.renderer.createElement("div");this.renderer.addClass(r,"name"),this.renderer.appendChild(i,r);var n=this.renderer.createElement("div");this.renderer.addClass(n,"title"),this.renderer.setProperty(n,"innerHTML",this.dish.name),this.renderer.appendChild(r,n);var o=this.renderer.createElement("div");this.renderer.addClass(r,"weight"),this.renderer.addClass(r,"dish"),this.renderer.appendChild(i,o);var s=this.renderer.createElement("div");this.renderer.addClass(s,"value"),this.renderer.setProperty(s,"innerHTML",(1e3*this.dish.weight).toFixed(0)+" г."),0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(s,"zero"),this.renderer.appendChild(o,s),this.renderer.setProperty(this.price,"innerHTML",this.dish.price);var d=this.renderer.createElement("div");this.renderer.addClass(d,"price"),this.renderer.addClass(d,"total"),this.renderer.appendChild(d,this.price),this.renderer.appendChild(i,d);var a=this.renderer.createElement("div");this.renderer.addClass(a,"quantity"),this.renderer.appendChild(i,a);var c=this.renderer.createElement("a");this.renderer.addClass(c,"quantity__button"),this.renderer.addClass(c,"minus"),this.renderer.setProperty(c,"innerHTML","&#8722;"),this.renderer.listen(c,"click",(function(e){t.changeAmountdish(-1),t.renderer.setProperty(h,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(u)})),this.renderer.appendChild(a,c);var h=this.renderer.createElement("span");this.renderer.addClass(h,"quantity__counter"),this.renderer.setProperty(h,"innerHTML",this.amountDish),this.renderer.appendChild(a,h);var m=this.renderer.createElement("a");this.renderer.addClass(m,"quantity__button"),this.renderer.addClass(c,"plus"),this.renderer.setProperty(m,"innerHTML","&#x2b;"),this.renderer.listen(m,"click",(function(e){t.changeAmountdish(1),t.renderer.setProperty(h,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(u)})),this.renderer.appendChild(a,m);var l=this.renderer.createElement("div");this.renderer.addClass(r,"weight"),this.renderer.addClass(r,"total"),this.renderer.appendChild(i,l);var u=this.renderer.createElement("div");0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(u,"zero"),this.renderer.addClass(u,"value"),this.innerTotalWeight(u),this.renderer.appendChild(l,u),this.weightTotal=u,this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(e.price));var f=this.renderer.createElement("div");this.renderer.addClass(f,"price"),this.renderer.addClass(f,"total"),this.renderer.appendChild(f,this.price),this.renderer.appendChild(i,f)},e.prototype.generatePrice=function(e,t,i){var r=this,n=[];this.selectedModifiers&&this.selectedModifiers.forEach((function(e){r.dish.modifiers.forEach((function(t){var i=t.childModifiers.filter((function(t){return t.modifierId===e.id}));i.length>0&&(i[0].groupId=t.group.id,n.push(i[0]))}))}));var o=0;return n.forEach((function(e){o+=e.dish.price*r.amountModifires[e.groupId][e.modifierId]})),o*=this.amountDish,e*this.amountDish+o+'<div class="currency">&nbsp;&#x20bd;</div>'},e.prototype.generateTotalWeight=function(){var e=this,t=[];this.selectedModifiers&&this.selectedModifiers.forEach((function(i){e.dish.modifiers.forEach((function(e){var r=e.childModifiers.filter((function(e){return e.modifierId===i.id}));r.length>0&&(r[0].groupId=e.group.id,t.push(r[0]))}))}));var i=0;return t.forEach((function(t){i+=t.dish.weight*e.amountModifires[t.groupId][t.modifierId]*1e3})),i=parseFloat((i*this.amountDish).toFixed(2)),console.log(i,1e3*this.dish.weight*this.amountDish),console.log(this.dish.weight,this.amountDish),(1e3*this.dish.weight*this.amountDish+i).toFixed(0)+" г. <div class='separator'></div>"},e.prototype.innerTotalWeight=function(e){this.renderer.setProperty(e,"innerHTML",this.generateTotalWeight())},e.prototype.changeAmountdish=function(e){this.amountDish=this.amountDish+e,this.amountDish<=0&&(this.amountDish=1),this.amountDish>=199&&(this.amountDish=199),this.amountDishToAdd.emit(this.amountDish)},e.prototype.render=function(e){var t=this;if(this.setModifires(),e.length>0){var i=this.renderer.createElement("h5");this.renderer.setProperty(i,"innerHTML","К этому блюду можно добавить:")}if(e.forEach((function(e){if(t.stateModifiers[e.modifierId]={},t.amountModifires[e.modifierId]={},e.dish){var i=t.groupDiv("Одночные модификаторы не поддерживаются");t.renderer.appendChild(t.el.nativeElement,i),console.log("elementGroup",e)}else if(e.childModifiers){var r=t.groupDiv(e.group?e.group.name:"Ошибка");t.renderer.appendChild(t.el.nativeElement,r),e.childModifiers.forEach((function(i){var n=t.modifireDiv(i,e.modifierId);t.renderer.appendChild(r,n),i.defaultAmount<1?t.stateModifiers[e.modifierId][i.modifierId]=!1:t.stateModifiers[e.modifierId][i.modifierId]=!0}))}})),e.length>0){i=this.renderer.createElement("div");this.renderer.setProperty(i,"innerHTML","<p>* — Количество добавленых опций блюда применяется для каждой порции</p>"),this.renderer.appendChild(this.el.nativeElement,i)}},e.prototype.groupDiv=function(e){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"group-modifires-wraper"),this.renderer.appendChild(t,this.renderer.createText(""+e)),t},e.prototype.modifireDiv=function(e,t){var i=this.renderer.createElement("div");return this.renderer.addClass(i,"additional-item"),this.renderOneModifire(e,i,t),i},e.prototype.renderOneModifire=function(e,t,i){console.info("renderOneModifire",e),console.info("renderOneModifire selectedModifiers",this.selectedModifiers);var r=this.renderer.createElement("div");this.renderer.addClass(r,"item-name");var n=this.renderer.createElement("label");this.renderer.setAttribute(n,"for",e.modifierId),this.renderer.appendChild(r,n),this.renderer.setProperty(n,"innerHTML",e.dish.name),this.renderer.appendChild(t,r);var o=this.renderer.createElement("div");this.renderer.addClass(o,"left-weight-modifire-wraper");var s=this.renderer.createElement("div");this.renderer.addClass(s,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(s,"zero"),this.renderer.setProperty(s,"innerHTML",(1e3*e.dish.weight).toFixed(0)+" г."),this.renderer.appendChild(o,s),this.renderer.appendChild(t,o);var d=this.renderer.createElement("div"),a=e.minAmount,c=e.maxAmount,h=e.defaultAmount;switch(console.info("min max def",a,c,h),!0){case 0===a&&0===c&&0===h:case 0===a&&1===c&&0===h:this.renderCheckbox(e,!1,d,t,i);break;case 0===a&&1===c&&1===h:this.renderCheckbox(e,!0,d,t,i);break;case 1===a&&1===c&&1===h:console.error(e.dish.name,"Значение не поддается настройке:",a,c,h);break;case a<=c&&h>=a&&h<=c&&c>1:this.renderInputButton(e,i,d,t);break;default:console.error(e.dish.name,"Ошибка рендера модификатора, для значений:",a,c,h)}e.maxAmount>0&&e.minAmount;var m=this.renderer.createElement("div");this.renderer.addClass(m,"right-weight-modifire-wraper");var l=this.renderer.createElement("div");this.renderer.addClass(l,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(l,"zero"),this.renderer.setProperty(l,"innerHTML",(1e3*e.dish.weight).toFixed(0)+' г.<div class="separator"></div>'),this.renderer.appendChild(m,l),this.renderer.appendChild(t,m);var u,f=this.renderer.createElement("div");this.renderer.addClass(f,"item-price"),e.dish.price>0?(u=e.dish.price+"<div class = 'currency'>&nbsp;&#x20bd;</div>",this.renderer.setProperty(f,"innerHTML",u),this.renderer.appendChild(t,f)):this.renderer.addClass(f,"zero-price"),this.setModifires(),this.innerTotalWeight(this.weightTotal),this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(this.dish.price))},e.prototype.renderCheckbox=function(e,t,i,r,n){var o=this,s=this.renderer.createElement("input");this.renderer.setAttribute(s,"type","checkbox"),this.renderer.setAttribute(s,"id",e.modifierId),t?(this.renderer.setProperty(s,"checked",!0),e.checked=!0,this.stateModifiers[n][e.modifierId]=!0,this.amountModifires[n][e.modifierId]=1):(e.checked=!1,this.stateModifiers[n][e.modifierId]=!1,this.amountModifires[n][e.modifierId]=0),this.renderer.addClass(s,"modal-checkbox"),this.renderer.appendChild(i,s),this.renderer.listen(s,"change",(function(e){if(o.idRadioBox(n)){for(var t in o.stateModifiers[n])o.stateModifiers[n].hasOwnProperty(t)&&(o.stateModifiers[n][t]=!1);e.target.parentElement.parentElement.parentElement.querySelectorAll("input").forEach((function(t){t.id!=e.target.id&&(t.checked=!1)}))}o.stateModifiers[n][e.target.id]=e.target.checked,e.target.checked&&(o.amountModifires[n][e.target.id]=1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))})),this.renderer.appendChild(r,i)},e.prototype.renderInputButton=function(e,t,i,r){var n,o=this;(n=e.defaultAmount>0?e.defaultAmount:e.minAmount)>0&&(this.stateModifiers[t][e.modifierId]=!0);var s=this.renderer.createElement("a");this.renderer.addClass(s,"quantity__button"),this.renderer.setProperty(s,"innerHTML","&#8722;"),this.renderer.appendChild(i,s),this.renderer.listen(s,"click",(function(i){var r=+o.amountModifires[t][e.modifierId];o.amountModifires[t][e.modifierId]=r-1,o.amountModifires[t][e.modifierId]<e.minAmount&&(o.amountModifires[t][e.modifierId]=e.minAmount),o.renderer.setProperty(d,"innerHTML",o.amountModifires[t][e.modifierId]),0===o.amountModifires[t][e.modifierId]&&(o.stateModifiers[t][e.modifierId]=!1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))}));var d=this.renderer.createElement("span");this.renderer.addClass(d,"item-quantity__counter"),this.amountModifires[t][e.modifierId]=n,this.renderer.setProperty(d,"innerHTML",this.amountModifires[t][e.modifierId]),this.renderer.appendChild(i,d);var a=this.renderer.createElement("a");this.renderer.addClass(a,"quantity__button"),this.renderer.setProperty(a,"innerHTML","&#x2b;"),this.renderer.appendChild(i,a),this.renderer.appendChild(r,i),this.renderer.listen(a,"click",(function(i){var r=+o.amountModifires[t][e.modifierId];o.amountModifires[t][e.modifierId]=r+1,o.amountModifires[t][e.modifierId]>e.maxAmount&&0!=e.maxAmount&&(o.amountModifires[t][e.modifierId]=e.maxAmount),o.renderer.setProperty(d,"innerHTML",o.amountModifires[t][e.modifierId]),o.amountModifires[t][e.modifierId]>0&&(o.stateModifiers[t][e.modifierId]=!0),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))}))},e.prototype.setModifires=function(){var e=this,t=[],i=[];for(var r in console.info("setModifires modifiersToSelect",t),console.info("setModifires stateModifiers before",this.stateModifiers),console.info("setModifires selectedModifiers before",this.selectedModifiers),this.stateModifiers){var n=function(e){(o.stateModifiers[r][e]||t.find((function(t){return t.modifierId==e})))&&i.push({id:e,amount:o.amountModifires[r][e],groupId:r})},o=this;for(var s in this.stateModifiers[r])n(s)}if(this.selectedModifiers=i,this.dish.modifiers.length>0){var d=[];this.dish.modifiers.forEach((function(t){if(t.required)if(e.stateModifiers[t.modifierId]){var r=[],n=e.stateModifiers[t.modifierId];for(var o in n)n.hasOwnProperty(o)&&n[o]&&r.push(n[o]);r.length<t.minAmount?(d.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+t.group.name}),e.validate.emit(!1),e.cartService.setModifires(i,d)):(e.validate.emit(!0),e.cartService.setModifires(i,[]))}else d.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+t.group.name}),e.validate.emit(!1),e.cartService.setModifires(i,d);else e.validate.emit(!0),e.cartService.setModifires(i)}))}else this.validate.emit(!0),this.cartService.setModifires(i,[]);console.info("setModifires stateModifiers after",this.stateModifiers),console.info("setModifires selectedModifiers after",this.selectedModifiers)},e.prototype.idRadioBox=function(e){var t=this.dish.modifiers.find((function(t){return t.modifierId===e}));return 1===t.minAmount&&1===t.maxAmount},e.prototype.checkMinAmountModifires=function(e,t){},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e}();m.ɵfac=function(e){return new(e||m)(t.ɵɵdirectiveInject(t.Renderer2),t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(s))},m.ɵdir=t.ɵɵdefineDirective({type:m,selectors:[["","dishCalc",""]],inputs:{dish:"dish",amount:"amount",selectedModifiers:"selectedModifiers"},outputs:{validate:"validate",amountDishToAdd:"amountDishToAdd"}});var l=function(){function e(e,t,i){var r=this;this.renderer=e,this.el=t,this.cartService=i,this.amountModifires={},this.stateModifires={},setTimeout((function(){r.render(r.modifires)}),100)}return e.prototype.render=function(e){var t=this;if(e.length>0){var i=this.renderer.createElement("h5");this.renderer.setProperty(i,"innerHTML","К этому блюду можно добавить:"),this.renderer.appendChild(this.el.nativeElement,i)}e.forEach((function(e){t.stateModifires[e.modifierId]={},t.amountModifires[e.modifierId]={};var i=t.groupDiv(e.name);t.renderer.appendChild(t.el.nativeElement,i),(e.childModifiers.length>5?e.childModifiers.slice(0,5):e.childModifiers).forEach((function(r){var n=t.modifireDiv(r,e.modifierId);t.renderer.appendChild(i,n),t.stateModifires[e.modifierId][r.modifierId]=!1}))}))},e.prototype.groupDiv=function(e){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"group-modifires"),this.renderer.appendChild(t,this.renderer.createText("Название категории модификаторов: "+e)),t},e.prototype.modifireDiv=function(e,t){var i=this.renderer.createElement("div");return this.renderer.addClass(i,"additional-item"),this.renderOneModifire(e,i,t),i},e.prototype.renderOneModifire=function(e,t,i){var r=this,n=this.renderer.createElement("div");this.renderer.addClass(n,"item-name");var o=this.renderer.createElement("input");this.renderer.setAttribute(o,"type","checkbox"),this.renderer.setAttribute(o,"id",e.modifierId),this.renderer.appendChild(n,o),this.renderer.listen(o,"change",(function(e){r.stateModifires[i][e.target.id]=e.target.checked,r.setModifires()}));var s=this.renderer.createElement("label");this.renderer.setAttribute(s,"for",e.modifierId),this.renderer.appendChild(n,s),this.renderer.setProperty(s,"innerHTML",e.dish.name),this.renderer.appendChild(t,n);var d=this.renderer.createElement("div"),a=this.renderer.createElement("a");this.renderer.addClass(a,"item-quantity__button"),this.renderer.setProperty(a,"innerHTML","&#8722;"),this.renderer.appendChild(d,a),this.renderer.listen(a,"click",(function(t){var n=+r.amountModifires[i][e.modifierId];r.amountModifires[i][e.modifierId]=n-1,r.amountModifires[i][e.modifierId]<e.minAmount&&(r.amountModifires[i][e.modifierId]=e.minAmount),r.renderer.setProperty(c,"innerHTML",r.amountModifires[i][e.modifierId]),r.setModifires()}));var c=this.renderer.createElement("span");this.renderer.addClass(c,"item-quantity__counter"),this.amountModifires[i][e.modifierId]=e.minAmount,this.renderer.setProperty(c,"innerHTML",this.amountModifires[i][e.modifierId]),this.renderer.appendChild(d,c);var h=this.renderer.createElement("a");this.renderer.addClass(h,"item-quantity__button"),this.renderer.setProperty(h,"innerHTML","&#x2b;"),this.renderer.appendChild(d,h),this.renderer.appendChild(t,d),this.renderer.listen(h,"click",(function(t){var n=+r.amountModifires[i][e.modifierId];r.amountModifires[i][e.modifierId]=n+1,r.renderer.setProperty(c,"innerHTML",r.amountModifires[i][e.modifierId]),r.setModifires()}));var m=this.renderer.createElement("div");this.renderer.addClass(m,"weight-price");var l=e.dish.weight+" г / "+e.dish.price+"&nbsp;&#x20bd;";this.renderer.setProperty(m,"innerHTML",l),this.renderer.appendChild(t,m),this.setModifires()},e.prototype.setModifires=function(){var e=[];for(var t in this.stateModifires)for(var i in this.stateModifires[t])this.stateModifires[t][i]&&e.push({id:i,amount:this.amountModifires[t][i],groupId:t});console.log("модифікатори після циклу",e),this.cartService.setModifires(e)},e}();l.ɵfac=function(e){return new(e||l)(t.ɵɵdirectiveInject(t.Renderer2),t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(s))},l.ɵdir=t.ɵɵdefineDirective({type:l,selectors:[["","modifires",""]],inputs:{modifires:"modifires"}});var u=function(){function e(e){this.cartService=e,this.requiredFields=["name","phone","street","house"],this.checkerFields=new i.BehaviorSubject(void 0)}return e.prototype.onClick=function(){this.order(this.orderCart.value),console.log(this.orderCart.value)},e.prototype.ngAfterViewInit=function(){var e=this;setTimeout((function(){e.cartService.userCart().subscribe((function(t){e.cart&&e.orderCart.valid&&e.cart.cartTotal!=t.cartTotal&&t.cartTotal>0&&e.checkStreet(e.orderCart.value),e.cart=t}))}),100),setTimeout((function(){e.checkerFields.next(e.checkForFields(e.orderCart._directives,e.requiredFields))}),100),this.checkerFields.subscribe((function(t){t&&(e.orderCart.controls.street.valueChanges.subscribe((function(t){"object"==typeof t&&setTimeout((function(){e.orderCart.controls.house.valid&&(e.orderCart.value.name=e.orderCart.value.name||"Неуказано",e.orderCart.value.phone=e.orderCart.value.phone||"78888888888",e.checkStreet(e.orderCart.value))}),100)})),e.orderCart.controls.house.valueChanges.subscribe((function(t){setTimeout((function(){e.orderCart.controls.street.valid&&(e.orderCart.value.name=e.orderCart.value.name||"Неуказано",e.orderCart.value.phone=e.orderCart.value.phone||"78888888888",e.checkStreet(e.orderCart.value))}),100)})))}))},e.prototype.checkForFields=function(e,t){var i={},r=[];return e.forEach((function(e){i[e.name]=!0})),t.forEach((function(e){i.hasOwnProperty(e)||r.push(e)})),r.length<=0||(console.error("У формы отсутсвуют следующие обязательные для корректной работы модуля поля:",r),!1)},e.prototype.order=function(e){if(this.checkForFields(this.orderCart._directives,this.requiredFields)){var t=void 0,i=e.comment||"Не указан";t=e.cash?"Наличными курьеру":e.bankcard?"Банковской картой курьеру":"Не указан",console.log(e);var r={cartId:this.cart.cartId,comment:"\n Тип оплаты:"+t+"\nКоментарий:"+i,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.orderCart(r).subscribe()}},e.prototype.checkStreet=function(e){if(console.log(">>>>",e),this.checkForFields(this.orderCart._directives,this.requiredFields)){var t={cartId:this.cart.cartId,comment:e.comment,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.checkStreet(t)}},e.prototype.stringToNumber=function(e){return console.log(typeof e),"string"==typeof e?+e:"number"==typeof e?e:void console.error("Параметр home должен быть или string или number")},e}();u.ɵfac=function(e){return new(e||u)(t.ɵɵdirectiveInject(s))},u.ɵdir=t.ɵɵdefineDirective({type:u,selectors:[["","orderCart",""]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("click",(function(){return i.onClick()}))},inputs:{orderCart:"orderCart"}});var f=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe((function(e){return t.cart=e}))}return e.prototype.onClick=function(){this.changeAmount(this.action)},e.prototype.changeAmount=function(e){switch(e){case"+":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount+1);break;case"-":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount-1);break;default:console.log("Директива SetDishAmount получила ложное значение action")}},e}();f.ɵfac=function(e){return new(e||f)(t.ɵɵdirectiveInject(s))},f.ɵdir=t.ɵɵdefineDirective({type:f,selectors:[["","setDishAmount",""]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("click",(function(){return i.onClick()}))},inputs:{action:"action",dish:"dish"}});var p=function(){function e(e){this.cartService=e,this.success=new t.EventEmitter,this.error=new t.EventEmitter}return e.prototype.onClick=function(){this.setComment()},e.prototype.setComment=function(){var e=this;this.cartService.setDishComment(this.dish.id,this.comment).subscribe((function(t){return e.success.emit(!0)}),(function(t){return e.error.emit(t)}))},e}();p.ɵfac=function(e){return new(e||p)(t.ɵɵdirectiveInject(s))},p.ɵdir=t.ɵɵdefineDirective({type:p,selectors:[["","setDishComment",""]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("click",(function(){return i.onClick()}))},inputs:{comment:"comment",dish:"dish"},outputs:{success:"success",error:"error"}});Object.create;function g(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;function v(e,i){1&e&&t.ɵɵelementContainer(0)}var C=function(e){return{"zero-price":e}};function M(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",19),t.ɵɵelementStart(2,"span"),t.ɵɵtext(3),t.ɵɵelementEnd(),t.ɵɵtext(4," ₽ "),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext(2);t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(2,C,!r.dish.price)),t.ɵɵadvance(2),t.ɵɵtextInterpolate(r.dish.price)}}var I=function(e){return{selected:e}};function x(e,i){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",23),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=i.$implicit;return t.ɵɵnextContext(4).changeModifierAmount(e,1,"checkbox")})),t.ɵɵtext(2),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()}if(2&e){var n=i.$implicit,o=t.ɵɵnextContext().ngIf,s=t.ɵɵnextContext(3);t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(2,I,!!s.modifiersValueTree[o.modifierId][n.modifierId])),t.ɵɵadvance(1),t.ɵɵtextInterpolate1(" ",null==n.dish?null:n.dish.name," ")}}function y(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",19),t.ɵɵelementStart(2,"span"),t.ɵɵtext(3),t.ɵɵelementEnd(),t.ɵɵtext(4," ₽ "),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext().$implicit;t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(2,C,!(null!=r.dish&&r.dish.price))),t.ɵɵadvance(2),t.ɵɵtextInterpolate(null==r.dish?null:r.dish.price)}}function b(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,y,5,4,"ng-container",20),t.ɵɵelementContainerEnd()),2&e){var r=i.$implicit,n=t.ɵɵnextContext().ngIf,o=t.ɵɵnextContext(3);t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!!o.modifiersValueTree[n.modifierId][r.modifierId])}}function E(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",21),t.ɵɵtemplate(2,x,3,4,"ng-container",22),t.ɵɵelementEnd(),t.ɵɵtemplate(3,b,2,1,"ng-container",22),t.ɵɵelementContainerEnd()),2&e){var r=i.ngIf;t.ɵɵadvance(2),t.ɵɵproperty("ngForOf",r.childModifiers),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",r.childModifiers)}}function P(e,i){if(1&e&&t.ɵɵtemplate(0,E,4,2,"ng-container",20),2&e){var r=t.ɵɵnextContext(2);t.ɵɵproperty("ngIf",r.modifiers.custom.fixed)}}function O(e,i){if(1&e&&(t.ɵɵelementStart(0,"div",30),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var r=t.ɵɵnextContext().ngIf;t.ɵɵadvance(1),t.ɵɵtextInterpolate(r.name)}}function T(e,i){if(1&e&&(t.ɵɵelementStart(0,"div",31),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var r=t.ɵɵnextContext().ngIf;t.ɵɵadvance(1),t.ɵɵtextInterpolate(r.description)}}function w(e,i){if(1&e&&(t.ɵɵelementStart(0,"div",27),t.ɵɵtemplate(1,O,2,1,"div",28),t.ɵɵtemplate(2,T,2,1,"div",29),t.ɵɵelementEnd()),2&e){var r=i.ngIf;t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.name),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.description)}}function S(e,i){1&e&&t.ɵɵelementContainer(0)}var _=function(e){return{"without-images":e}},D=function(e,t,i,r,n){return{modifier:e,groupId:"single",amount:t,groupAmount:i,groupMinAmount:r,groupMaxAmount:n}};function k(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",32),t.ɵɵtemplate(2,S,1,0,"ng-container",8),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext().$implicit,n=t.ɵɵnextContext(3),o=t.ɵɵreference(4);t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(3,_,!r.childImagesIsset)),t.ɵɵadvance(1),t.ɵɵproperty("ngTemplateOutlet",o)("ngTemplateOutletContext",t.ɵɵpureFunction5(5,D,r,n.modifiersValueTree.single[r.modifierId],n.modifiersValueTree.single[r.modifierId],r.minAmount||0,r.maxAmount||100))}}function A(e,i){1&e&&t.ɵɵelementContainer(0)}var F=function(e,t,i,r,n,o){return{modifier:e,groupId:t,amount:i,groupAmount:r,groupMinAmount:n,groupMaxAmount:o}};function j(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,A,1,0,"ng-container",8),t.ɵɵelementContainerEnd()),2&e){var r=i.$implicit,n=t.ɵɵnextContext(2).$implicit,o=t.ɵɵnextContext(3),s=t.ɵɵreference(4);t.ɵɵadvance(1),t.ɵɵproperty("ngTemplateOutlet",s)("ngTemplateOutletContext",t.ɵɵpureFunction6(2,F,r,n.modifierId,o.modifiersValueTree[n.modifierId][r.modifierId],o.modifiers.indexById[n.modifierId].totalAmount,n.minAmount||0,n.maxAmount||100))}}function L(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",33),t.ɵɵtemplate(2,j,2,9,"ng-container",22),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext().$implicit;t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(2,_,!r.imagesIsset)),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",r.childModifiers)}}function H(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",25),t.ɵɵtemplate(2,w,3,2,"div",26),t.ɵɵtemplate(3,k,3,11,"ng-container",20),t.ɵɵtemplate(4,L,3,4,"ng-container",20),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var r=i.$implicit;t.ɵɵadvance(2),t.ɵɵproperty("ngIf",r.group),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.dish),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",null==r.childModifiers?null:r.childModifiers.length)}}function V(e,i){if(1&e&&(t.ɵɵelementStart(0,"div",24),t.ɵɵtemplate(1,H,5,3,"ng-container",22),t.ɵɵelementEnd()),2&e){var r=t.ɵɵnextContext(2);t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",r.modifiers.baseList)}}var B=function(e){return{dish:e}};function z(e,i){if(1&e&&(t.ɵɵelementStart(0,"div",5),t.ɵɵelementStart(1,"div",6),t.ɵɵelementStart(2,"div",7),t.ɵɵtemplate(3,v,1,0,"ng-container",8),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"div",9),t.ɵɵelementStart(5,"div",10),t.ɵɵtext(6),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"div",11),t.ɵɵtext(8),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"div",12),t.ɵɵtemplate(10,M,5,4,"ng-container",13),t.ɵɵtemplate(11,P,1,1,"ng-template",null,14,t.ɵɵtemplateRefExtractor),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(13,V,2,1,"div",15),t.ɵɵelementStart(14,"div",16),t.ɵɵelementStart(15,"span",17),t.ɵɵtext(16,"ИТОГО:"),t.ɵɵelementEnd(),t.ɵɵelementStart(17,"span",18),t.ɵɵelementStart(18,"span"),t.ɵɵtext(19),t.ɵɵelementEnd(),t.ɵɵtext(20," ₽ "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e){var r=t.ɵɵreference(12),n=t.ɵɵnextContext(),o=t.ɵɵreference(2);t.ɵɵadvance(3),t.ɵɵproperty("ngTemplateOutlet",o)("ngTemplateOutletContext",t.ɵɵpureFunction1(8,B,n.dish)),t.ɵɵadvance(3),t.ɵɵtextInterpolate(n.dish.name),t.ɵɵadvance(2),t.ɵɵtextInterpolate(n.dish.description),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",!n.modifiers.custom.fixed)("ngIfElse",r),t.ɵɵadvance(3),t.ɵɵproperty("ngIf",null==n.modifiers.baseList?null:n.modifiers.baseList.length),t.ɵɵadvance(6),t.ɵɵtextInterpolate(n.totalPrice)}}function R(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelement(1,"div",35),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext().dish,n=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵstyleProp("background-image","url("+n.imageUrl+r.images[0].images.small+")")}}function q(e,i){1&e&&t.ɵɵelement(0,"div",36)}function N(e,i){if(1&e&&(t.ɵɵtemplate(0,R,2,2,"ng-container",13),t.ɵɵtemplate(1,q,1,0,"ng-template",null,34,t.ɵɵtemplateRefExtractor)),2&e){var r=i.dish,n=t.ɵɵreference(2);t.ɵɵproperty("ngIf",(null==r?null:r.images)&&(null==r.images[0]||null==r.images[0].images?null:r.images[0].images.small))("ngIfElse",n)}}function W(e,i){1&e&&t.ɵɵelementContainer(0)}function $(e,i){1&e&&t.ɵɵelementContainer(0)}var G=function(e,t,i){return{modifier:e,groupId:t,amount:i}};function Z(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,$,1,0,"ng-container",8),t.ɵɵelementContainerEnd()),2&e){var r=t.ɵɵnextContext(2),n=r.modifier,o=r.groupId,s=r.amount;t.ɵɵnextContext();var d=t.ɵɵreference(8);t.ɵɵadvance(1),t.ɵɵproperty("ngTemplateOutlet",d)("ngTemplateOutletContext",t.ɵɵpureFunction3(2,G,n,o,s))}}function U(e,i){1&e&&t.ɵɵelementContainer(0)}function J(e,i){if(1&e&&t.ɵɵtemplate(0,U,1,0,"ng-container",8),2&e){var r=t.ɵɵnextContext(2),n=r.modifier,o=r.groupId,s=r.amount,d=r.groupAmount,a=r.groupMinAmount,c=r.groupMaxAmount;t.ɵɵnextContext();var h=t.ɵɵreference(6);t.ɵɵproperty("ngTemplateOutlet",h)("ngTemplateOutletContext",t.ɵɵpureFunction6(2,F,n,o,s,d,a,c))}}function K(e,i){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",37),t.ɵɵelementStart(2,"div",38),t.ɵɵtemplate(3,W,1,0,"ng-container",8),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"div",39),t.ɵɵelementStart(5,"div",40),t.ɵɵtext(6),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"div",41),t.ɵɵtext(8),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(9,"div",42),t.ɵɵelementStart(10,"div",43),t.ɵɵelementStart(11,"span"),t.ɵɵtext(12),t.ɵɵelementEnd(),t.ɵɵtext(13," ₽ "),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(14,"div",44),t.ɵɵtemplate(15,Z,2,6,"ng-container",13),t.ɵɵtemplate(16,J,1,9,"ng-template",null,45,t.ɵɵtemplateRefExtractor),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var r=i.ngIf,n=t.ɵɵreference(17),o=t.ɵɵnextContext(),s=o.groupMinAmount,d=o.groupMaxAmount;t.ɵɵnextContext();var a=t.ɵɵreference(2);t.ɵɵadvance(3),t.ɵɵproperty("ngTemplateOutlet",a)("ngTemplateOutletContext",t.ɵɵpureFunction1(8,B,r)),t.ɵɵadvance(3),t.ɵɵtextInterpolate(r.name),t.ɵɵadvance(2),t.ɵɵtextInterpolate1("",1e3*r.weight," гр"),t.ɵɵadvance(2),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(10,C,!r.price)),t.ɵɵadvance(2),t.ɵɵtextInterpolate(r.price),t.ɵɵadvance(3),t.ɵɵproperty("ngIf",s<=1&&1==d)("ngIfElse",n)}}function Q(e,i){if(1&e&&t.ɵɵtemplate(0,K,18,12,"ng-container",20),2&e){var r=i.modifier;t.ɵɵproperty("ngIf",r.dish)}}var Y=function(e){return{disabled:e}};function X(e,i){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",46),t.ɵɵelementStart(2,"div",47),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=i.modifier,n=i.amount;return t.ɵɵnextContext().changeModifierAmount(e,n-1,"minus")})),t.ɵɵtext(3,"-"),t.ɵɵelementEnd(),t.ɵɵelement(4,"input",48,49),t.ɵɵelementStart(6,"div",50),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=i.modifier,n=i.amount;return t.ɵɵnextContext().changeModifierAmount(e,n+1,"plus")})),t.ɵɵtext(7,"+"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()}if(2&e){var n=i.amount,o=i.groupAmount,s=i.groupMinAmount,d=i.groupMaxAmount;t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(4,Y,!n&&o>=d)),t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(6,Y,!n||o<=s)),t.ɵɵadvance(2),t.ɵɵproperty("value",n),t.ɵɵadvance(2),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(8,Y,o>=d))}}function ee(e,i){if(1&e){var r=t.ɵɵgetCurrentView();t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"div",51),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(r);var e=i.modifier,n=i.amount;return t.ɵɵnextContext().changeModifierAmount(e,n?0:1,"checkbox")})),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()}if(2&e){var n=i.amount;t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(1,I,n))}}var te=function(){function e(e,i,r){this.cartService=e,this.eventer=i,this.validate=new t.EventEmitter,this.amountDishToAdd=new t.EventEmitter,this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.imageUrl=r}return e.prototype.ngOnInit=function(){this.checkValid()},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e.prototype.ngOnChanges=function(){var e,t,i,r;if(this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.dish&&this.dish.modifiers){try{for(var n=g(this.dish.modifiers),o=n.next();!o.done;o=n.next()){var s=o.value,d=null;switch(this.modifiers.indexById[s.modifierId]=s,this.modifiers.custom.fixed||this.modifiers.baseList.length||!s.childModifiers||2!=s.childModifiers.length||s.maxAmount!=s.maxAmount||1!=s.maxAmount?s.group&&s.childModifiers&&s.childModifiers.length&&s.childModifiers.find((function(e){return e.dish}))?(d="group",this.modifiers.baseList.push(s),console.info("Group modifier:",s)):s.dish?(d="single",this.modifiers.baseList.push(s),console.info("Single modifier:",s)):(d="broken",console.warn("Broken modifier:",s)):(d="custom",this.modifiers.custom.fixed=s,console.info("Custom Fixed modifier:",s)),d){case"group":case"custom":this.modifiersValueTree[s.modifierId]={};try{for(var a=(i=void 0,g(s.childModifiers)),c=a.next();!c.done;c=a.next()){var h=c.value;this.modifiers.indexById[h.modifierId]=h,this.modifiersValueTree[s.modifierId][h.modifierId]=h.defaultAmount}}catch(e){i={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}this.calculateTotalAmountInGroup(s.modifierId);break;case"single":this.modifiersValueTree.single||(this.modifiersValueTree.single={}),this.modifiers.indexById[s.modifierId]=s,this.modifiersValueTree.single[s.modifierId]=s.defaultAmount}this.checkImagesInModifier(s.modifierId)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.calculateTotalPrice()}},e.prototype.calculateTotalAmountInGroup=function(e){if("single"!=e)return this.modifiers.indexById[e].totalAmount=Object.values(this.modifiersValueTree[e]).reduce((function(e,t){return e+t})),this.modifiers.indexById[e].totalAmount},e.prototype.checkImagesInModifier=function(e){var t=this.modifiers.indexById[e];this.modifiers.indexById[e].imagesIsset=t.dish&&t.dish.images&&t.dish.images.length,this.modifiers.indexById[e].childImagesIsset=!!Object.values(this.modifiersValueTree[e]).find((function(e){return e&&e.dish&&e.dish.images&&e.dish.images.length}))},e.prototype.calculateTotalPrice=function(){var e=this.dish.price||0;for(var t in this.modifiersValueTree)for(var i in this.modifiersValueTree[t]){var r=this.modifiersValueTree[t][i];if(r){var n=this.modifiers.indexById[i];n&&n.dish&&n.dish.price&&(e+=n.dish.price*r)}}this.totalPrice=e,this.setModifiers()},e.prototype.getModifiersIds=function(e){return{groupId:e.dish&&e.dish.groupId?e.dish.groupId:void 0,modifierId:e.modifierId}},e.prototype.changeModifierAmount=function(e,t,i){if(!(t<0)){var r=this.getModifiersIds(e),o=r.groupId,s=void 0===o?"single":o,d=r.modifierId,a=e.minAmount,c=e.maxAmount,h=this.modifiers.indexById[s]||{},m=h.minAmount,l=void 0===m?0:m,u=h.maxAmount,f=void 0===u?0:u,p=this.modifiersValueTree[s][d];if("checkbox"==i&&"single"!==s){if(l<=1&&1==f){if(t<l)return;for(var g in this.modifiersValueTree[s])this.modifiersValueTree[s][g]=0;this.calculateTotalAmountInGroup(s)}if(0==t)return void this.calculateTotalPrice()}if(l||f){var v=this.modifiers.indexById[s].totalAmount-p+t;if(v<l)return console.warn("Limit: min "+l+". Current "+v),void this.eventer.emitMessageEvent(new n.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[s].group.name+'" - не менее '+l));if(v>f)return console.warn("Limit: max "+f+". Current "+v),void this.eventer.emitMessageEvent(new n.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[s].group.name+'" - не более '+f))}if(a||c){if(t<a)switch(i){case"plus":t=a;break;case"minus":t=0}t>c&&(t=c)}this.modifiersValueTree[s][d]=t,this.calculateTotalAmountInGroup(s),this.calculateTotalPrice()}},e.prototype.setModifiers=function(){var e=[];for(var t in this.modifiersValueTree)for(var i in this.modifiersValueTree[t]){var r=this.modifiersValueTree[t][i];r&&e.push({id:i,amount:r,groupId:"single"!==t?t:void 0})}e.length&&(this.checkValid(),this.cartService.setModifires(e,[]))},e.prototype.checkValid=function(){var e=!0;for(var t in this.modifiersValueTree){var i=this.modifiers.indexById[t];if(i.required){var r=this.calculateTotalAmountInGroup(t);r<i.minAmount&&(e=!1,console.warn("Modifier "+t+" min amount: "+i.minAmount)),r>i.maxAmount&&(e=!1,console.warn("Modifier "+t+" max amount: "+i.maxAmount))}}this.validate.emit(e)},e}();te.ɵfac=function(e){return new(e||te)(t.ɵɵdirectiveInject(s),t.ɵɵdirectiveInject(n.EventerService),t.ɵɵdirectiveInject("ImageUrl"))},te.ɵcmp=t.ɵɵdefineComponent({type:te,selectors:[["dish-calc"]],inputs:{dish:"dish",amount:"amount",selectedModifiers:"selectedModifiers"},outputs:{validate:"validate",amountDishToAdd:"amountDishToAdd"},features:[t.ɵɵNgOnChangesFeature],decls:9,vars:1,consts:[["class","ng-cart-dish-calc",4,"ngIf"],["dishImageTemplate",""],["modifierTemplate",""],["modifierCounterTemplate",""],["modifierCheckboxTemplate",""],[1,"ng-cart-dish-calc"],[1,"dish"],[1,"dish-image-box"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"dish-description-box"],[1,"dish-name"],[1,"dish-ingredients"],[1,"dish-price-box"],[4,"ngIf","ngIfElse"],["modifierFixedTemplate",""],["class","modifiers",4,"ngIf"],[1,"result"],[1,"text"],[1,"price"],[1,"price",3,"ngClass"],[4,"ngIf"],[1,"modifier-fixed"],[4,"ngFor","ngForOf"],[1,"item",3,"ngClass","click"],[1,"modifiers"],[1,"modifier-group"],["class","modifier-header",4,"ngIf"],[1,"modifier-header"],["class","modifier-name",4,"ngIf"],["class","modifier-description",4,"ngIf"],[1,"modifier-name"],[1,"modifier-description"],[1,"modifier-box",3,"ngClass"],[1,"modifier-children",3,"ngClass"],["imgPlaceholder",""],[1,"dish-image"],[1,"dish-image-placeholder"],[1,"modifier-dish"],[1,"modifier-dish-image-box"],[1,"modifier-dish-description-box"],[1,"modifier-dish-name"],[1,"modifier-dish-weight"],[1,"modifier-dish-price-box"],[3,"ngClass"],[1,"modifier-dish-action-box"],["counterTemplate",""],[1,"modifier-counter",3,"ngClass"],["onselectstart","return false;",1,"minus",3,"ngClass","click"],["readonly","",3,"value"],["input",""],["onselectstart","return false;",1,"plus",3,"ngClass","click"],[1,"modifier-checkbox",3,"ngClass","click"]],template:function(e,i){1&e&&(t.ɵɵtemplate(0,z,21,10,"div",0),t.ɵɵtemplate(1,N,3,2,"ng-template",null,1,t.ɵɵtemplateRefExtractor),t.ɵɵtemplate(3,Q,1,1,"ng-template",null,2,t.ɵɵtemplateRefExtractor),t.ɵɵtemplate(5,X,8,10,"ng-template",null,3,t.ɵɵtemplateRefExtractor),t.ɵɵtemplate(7,ee,2,3,"ng-template",null,4,t.ɵɵtemplateRefExtractor)),2&e&&t.ɵɵproperty("ngIf",i.dish)},directives:[o.NgIf,o.NgTemplateOutlet,o.NgClass,o.NgForOf],styles:['.dish[_ngcontent-%COMP%]{align-items:flex-start;border-bottom:2px solid #969696;display:flex;padding-bottom:34px}.dish[_ngcontent-%COMP%]   .dish-image-box[_ngcontent-%COMP%]{background-color:#eee;background-size:50%;box-sizing:border-box;height:170px;position:relative;text-align:center;width:250px}.dish[_ngcontent-%COMP%]   .dish-description-box[_ngcontent-%COMP%]{align-items:stretch;box-sizing:border-box;display:flex;flex-direction:column;height:170px;margin-left:34px;padding:5px 0 0}.dish[_ngcontent-%COMP%]   .dish-description-box[_ngcontent-%COMP%]   .dish-name[_ngcontent-%COMP%]{color:#0a0909;font-size:28px;font-weight:700;letter-spacing:2.4px;line-height:32px}.dish[_ngcontent-%COMP%]   .dish-description-box[_ngcontent-%COMP%]   .dish-ingredients[_ngcontent-%COMP%]{color:#000;flex-grow:1;font-size:15px;line-height:17px;margin-top:15px;overflow:hidden}.dish[_ngcontent-%COMP%]   .dish-description-box[_ngcontent-%COMP%]   .dish-price-box[_ngcontent-%COMP%]{align-items:center;display:flex;font-size:20px;font-weight:700;height:45px;justify-content:space-between;line-height:23px;margin-right:49px}.dish-image[_ngcontent-%COMP%]{background-position:top;background-repeat:no-repeat;background-size:cover;border-radius:0;height:100%;width:250px}.result[_ngcontent-%COMP%]{color:#0a0909;font-size:24px;font-weight:700;line-height:28px;margin-top:49px;text-align:right}.result[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{margin-left:76px}.modifiers[_ngcontent-%COMP%]   .modifier-group[_ngcontent-%COMP%]{border-bottom:2px solid #969696;margin-top:25px;padding-bottom:25px}.modifiers[_ngcontent-%COMP%]   .modifier-header[_ngcontent-%COMP%]{margin-bottom:25px}.modifiers[_ngcontent-%COMP%]   .modifier-header[_ngcontent-%COMP%]   .modifier-name[_ngcontent-%COMP%]{color:#0a0909;font-size:20px;font-weight:500;line-height:23px}.modifiers[_ngcontent-%COMP%]   .modifier-header[_ngcontent-%COMP%]   .modifier-description[_ngcontent-%COMP%]{color:#0a0909;font-size:15px;line-height:17px}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]{align-items:center;box-sizing:border-box;display:flex;height:100px;justify-content:center;margin-bottom:2px}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-image-box[_ngcontent-%COMP%]{background-color:#eee;background-size:50%;box-sizing:border-box;height:100px;margin-right:28px;position:relative;text-align:center;width:100px}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-description-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;justify-content:center}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-description-box[_ngcontent-%COMP%]   .modifier-dish-name[_ngcontent-%COMP%]{color:#0a0909;font-size:20px;font-weight:500;line-height:23px}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-description-box[_ngcontent-%COMP%]   .modifier-dish-weight[_ngcontent-%COMP%]{color:#0a0909;font-size:20px;line-height:23px;margin-top:10px}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-price-box[_ngcontent-%COMP%]{color:#0a0909;font-size:20px;font-weight:700;line-height:23px;margin-right:105px}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-price-box[_ngcontent-%COMP%]   .zero-price[_ngcontent-%COMP%]{display:none}.modifiers[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]   .modifier-dish-action-box[_ngcontent-%COMP%]{display:flex;justify-content:center;width:151px}.modifier-fixed[_ngcontent-%COMP%]{align-items:stretch;border:2px solid #767676;border-radius:15px;box-sizing:border-box;display:flex;height:45px}.modifier-fixed[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{align-items:center;color:#767676;display:flex;font-size:20px;font-weight:500;height:45px;justify-content:center;line-height:23px;margin-top:-2px;width:142px}.modifier-fixed[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:first-child{margin-left:-2px}.modifier-fixed[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:last-child{margin-right:-2px}.modifier-fixed[_ngcontent-%COMP%]   .item.selected[_ngcontent-%COMP%]{background:#0a0909;border-radius:15px;color:#fff}.modifier-fixed[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:not(.selected){cursor:pointer}.modifier-checkbox[_ngcontent-%COMP%]{align-items:center;background:#e0e0e0;border-radius:15px;cursor:pointer;display:flex;height:50px;justify-content:center;width:50px}.modifier-checkbox.selected[_ngcontent-%COMP%]:after{content:url("data:image/svg+xml; base64, PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMTMuNUwxMS4zMjMxIDI2TDI2IDIiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMy41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cg==")}.modifier-counter[_ngcontent-%COMP%]{align-items:center;background:#e0e0e0;border:none;border-radius:15px;display:flex;height:50px;position:relative;width:151px}.modifier-counter.disabled[_ngcontent-%COMP%]{opacity:.3}.modifier-counter[_ngcontent-%COMP%]:not(.disabled)   .minus.disabled[_ngcontent-%COMP%], .modifier-counter[_ngcontent-%COMP%]:not(.disabled)   .plus.disabled[_ngcontent-%COMP%]{cursor:default;opacity:.15}.modifier-counter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:transparent;border:none;font-weight:500;padding:0;width:100%}.modifier-counter[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%], .modifier-counter[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%], .modifier-counter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#0a0909;font-size:18px;height:50px;line-height:50px;text-align:center}.modifier-counter[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%], .modifier-counter[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%]{cursor:pointer;display:block;font-style:normal;font-weight:700;padding:0 30px;position:absolute;top:0}.modifier-counter[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%]:hover, .modifier-counter[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%]:hover{color:#000}.modifier-counter[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%]:active, .modifier-counter[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%]:active{color:#cc0009}.modifier-counter[_ngcontent-%COMP%]   .minus.loading[_ngcontent-%COMP%], .modifier-counter[_ngcontent-%COMP%]   .plus.loading[_ngcontent-%COMP%]{opacity:.2}.modifier-counter[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%]{left:0}.modifier-counter[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%]{right:0}.without-images[_ngcontent-%COMP%]   .modifier-dish-image-box[_ngcontent-%COMP%]{height:70px!important}.without-images[_ngcontent-%COMP%]   .modifier-dish[_ngcontent-%COMP%]{height:70px}']});var ie=[o.CommonModule],re=function(){};re.ɵmod=t.ɵɵdefineNgModule({type:re}),re.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||re)},providers:[],imports:[[ie]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(re,{declarations:[d,a,h,u,m,p,f,c,te],imports:[o.CommonModule],exports:[d,a,h,u,m,p,f,c,te]}),e.AddDishToCartDirective=d,e.AmountCartDirective=a,e.CheckoutDirective=c,e.DeleteFromCartDirective=h,e.DishCalcComponent=te,e.DishCalcDirective=m,e.ModifiresDirective=l,e.NgRestoCartModule=re,e.NgRestoCartService=s,e.OrderCartUserDirective=u,e.SetAmountDirective=f,e.SetDishCommentDirective=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=webresto-ng-cart.umd.min.js.map