import { Directive, Input } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../services/ng-restocart.service";
export class ModifiresDirective {
    constructor(renderer, el, cartService) {
        this.renderer = renderer;
        this.el = el;
        this.cartService = cartService;
        this.amountModifires = {};
        this.stateModifires = {};
        setTimeout(() => {
            this.render(this.modifires);
        }, 100);
    }
    render(modifires) {
        if (modifires.length > 0) {
            let h = this.renderer.createElement('h5');
            this.renderer.setProperty(h, 'innerHTML', 'К этому блюду можно добавить:');
            this.renderer.appendChild(this.el.nativeElement, h);
        }
        modifires.forEach(elementGroup => {
            this.stateModifires[elementGroup.modifierId] = {};
            this.amountModifires[elementGroup.modifierId] = {};
            let groupDiv = this.groupDiv(elementGroup.name);
            this.renderer.appendChild(this.el.nativeElement, groupDiv);
            let modArr;
            if (elementGroup.childModifiers.length > 5) {
                modArr = elementGroup.childModifiers.slice(0, 5);
            }
            else {
                modArr = elementGroup.childModifiers;
            }
            modArr.forEach(element => {
                let modifireDiv = this.modifireDiv(element, elementGroup.modifierId);
                this.renderer.appendChild(groupDiv, modifireDiv);
                this.stateModifires[elementGroup.modifierId][element.modifierId] = false;
            });
        });
    }
    groupDiv(nameGorup) {
        let div = this.renderer.createElement('div');
        this.renderer.addClass(div, 'group-modifires');
        this.renderer.appendChild(div, this.renderer.createText('Название категории модификаторов: ' + nameGorup));
        return div;
    }
    modifireDiv(element, groupId) {
        let div = this.renderer.createElement('div');
        this.renderer.addClass(div, 'additional-item');
        this.renderOneModifire(element, div, groupId);
        return div;
    }
    renderOneModifire(element, modifireDiv, groupId) {
        // Рендер Названия модификатора
        let itemNameDiv = this.renderer.createElement('div');
        this.renderer.addClass(itemNameDiv, 'item-name');
        let input = this.renderer.createElement('input');
        this.renderer.setAttribute(input, 'type', 'checkbox');
        this.renderer.setAttribute(input, 'id', element.modifierId);
        this.renderer.appendChild(itemNameDiv, input);
        this.renderer.listen(input, 'change', e => {
            this.stateModifires[groupId][e.target.id] = e.target.checked;
            this.setModifires();
        });
        let label = this.renderer.createElement('label');
        this.renderer.setAttribute(label, 'for', element.modifierId);
        this.renderer.appendChild(itemNameDiv, label);
        this.renderer.setProperty(label, 'innerHTML', element.dish.name);
        this.renderer.appendChild(modifireDiv, itemNameDiv);
        // Рендер блока изминения количества модификатора
        let itemQuantity = this.renderer.createElement('div');
        let aMinusDiv = this.renderer.createElement('a');
        this.renderer.addClass(aMinusDiv, 'item-quantity__button');
        this.renderer.setProperty(aMinusDiv, 'innerHTML', '&#8722;');
        this.renderer.appendChild(itemQuantity, aMinusDiv);
        this.renderer.listen(aMinusDiv, 'click', e => {
            let value = +this.amountModifires[groupId][element.modifierId];
            this.amountModifires[groupId][element.modifierId] = value - 1;
            if (this.amountModifires[groupId][element.modifierId] < element.minAmount)
                this.amountModifires[groupId][element.modifierId] = element.minAmount;
            this.renderer.setProperty(span, 'innerHTML', this.amountModifires[groupId][element.modifierId]);
            this.setModifires();
        });
        let span = this.renderer.createElement('span');
        this.renderer.addClass(span, 'item-quantity__counter');
        this.amountModifires[groupId][element.modifierId] = element.minAmount;
        this.renderer.setProperty(span, 'innerHTML', this.amountModifires[groupId][element.modifierId]);
        this.renderer.appendChild(itemQuantity, span);
        let aPlusDiv = this.renderer.createElement('a');
        this.renderer.addClass(aPlusDiv, 'item-quantity__button');
        this.renderer.setProperty(aPlusDiv, 'innerHTML', '&#x2b;');
        this.renderer.appendChild(itemQuantity, aPlusDiv);
        this.renderer.appendChild(modifireDiv, itemQuantity);
        this.renderer.listen(aPlusDiv, 'click', e => {
            let value = +this.amountModifires[groupId][element.modifierId];
            this.amountModifires[groupId][element.modifierId] = value + 1;
            this.renderer.setProperty(span, 'innerHTML', this.amountModifires[groupId][element.modifierId]);
            this.setModifires();
        });
        // Рендер блока стоимости и веса модификатора
        let weightPriceDiv = this.renderer.createElement('div');
        this.renderer.addClass(weightPriceDiv, 'weight-price');
        let weightAndPriceHTML = element.dish.weight + " г / " + element.dish.price + "&nbsp;&#x20bd;";
        this.renderer.setProperty(weightPriceDiv, 'innerHTML', weightAndPriceHTML);
        this.renderer.appendChild(modifireDiv, weightPriceDiv);
        this.setModifires();
    }
    setModifires() {
        let modifires = [];
        for (let groupId in this.stateModifires) {
            for (let modifireId in this.stateModifires[groupId]) {
                if (this.stateModifires[groupId][modifireId]) {
                    modifires.push({
                        id: modifireId,
                        amount: this.amountModifires[groupId][modifireId],
                        groupId: groupId
                    });
                }
            }
        }
        console.log("модифікатори після циклу", modifires);
        this.cartService.setModifires(modifires);
    }
}
ModifiresDirective.ɵfac = function ModifiresDirective_Factory(t) { return new (t || ModifiresDirective)(i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.NgRestoCartService)); };
ModifiresDirective.ɵdir = i0.ɵɵdefineDirective({ type: ModifiresDirective, selectors: [["", "modifires", ""]], inputs: { modifires: "modifires" } });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(ModifiresDirective, [{
        type: Directive,
        args: [{
                selector: '[modifires]'
            }]
    }], function () { return [{ type: i0.Renderer2 }, { type: i0.ElementRef }, { type: i1.NgRestoCartService }]; }, { modifires: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kaWZpcmVzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi9zcmMvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9tb2RpZmlyZXMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQXlCLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBT3hFLE1BQU0sT0FBTyxrQkFBa0I7SUFLN0IsWUFDVSxRQUFtQixFQUNuQixFQUFjLEVBQ2QsV0FBOEI7UUFGOUIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsZ0JBQVcsR0FBWCxXQUFXLENBQW1CO1FBTnhDLG9CQUFlLEdBQUssRUFBRSxDQUFDO1FBQ3ZCLG1CQUFjLEdBQUssRUFBRSxDQUFDO1FBU3BCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFFZCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUU3QixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFHVixDQUFDO0lBRUQsTUFBTSxDQUFDLFNBQWM7UUFFckIsSUFBRyxTQUFTLENBQUMsTUFBTSxHQUFDLENBQUMsRUFBQztZQUFHLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pFLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRyxXQUFXLEVBQUUsK0JBQStCLENBQUMsQ0FBQztZQUM1RSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUFDO1FBR3JELFNBQVMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFFL0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUMsRUFBRSxDQUFDO1lB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bnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE5nUmVzdG9DYXJ0U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL25nLXJlc3RvY2FydC5zZXJ2aWNlJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW21vZGlmaXJlc10nXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgTW9kaWZpcmVzRGlyZWN0aXZlIHtcclxuICBASW5wdXQoKSBtb2RpZmlyZXM6IGFueTtcclxuICBhbW91bnRNb2RpZmlyZXM6YW55PXt9O1xyXG4gIHN0YXRlTW9kaWZpcmVzOmFueT17fTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxyXG4gICAgcHJpdmF0ZSBjYXJ0U2VydmljZTpOZ1Jlc3RvQ2FydFNlcnZpY2VcclxuICApIHtcclxuXHJcbiAgIFxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgXHJcbiAgICAgIHRoaXMucmVuZGVyKHRoaXMubW9kaWZpcmVzKVxyXG4gICAgXHJcbiAgICB9LCAxMDApO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuICByZW5kZXIobW9kaWZpcmVzOiBhbnkpIHtcclxuICAgXHJcbiAgaWYobW9kaWZpcmVzLmxlbmd0aD4wKXsgIGxldCBoID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdoNScpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eShoICwgJ2lubmVySFRNTCcsICfQmiDRjdGC0L7QvNGDINCx0LvRjtC00YMg0LzQvtC20L3QviDQtNC+0LHQsNCy0LjRgtGMOicpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIGgpO31cclxuXHJcbiAgIFxyXG4gICAgbW9kaWZpcmVzLmZvckVhY2goZWxlbWVudEdyb3VwID0+IHtcclxuXHJcbiAgICAgIHRoaXMuc3RhdGVNb2RpZmlyZXNbZWxlbWVudEdyb3VwLm1vZGlmaWVySWRdPXt9O1xyXG4gICAgICB0aGlzLmFtb3VudE1vZGlmaXJlc1tlbGVtZW50R3JvdXAubW9kaWZpZXJJZF09e307XHJcblxyXG5cclxuICAgICAgbGV0IGdyb3VwRGl2ID0gdGhpcy5ncm91cERpdihlbGVtZW50R3JvdXAubmFtZSk7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCBncm91cERpdik7XHJcblxyXG4gICAgICBsZXQgbW9kQXJyO1xyXG4gICAgICBpZihlbGVtZW50R3JvdXAuY2hpbGRNb2RpZmllcnMubGVuZ3RoPjUpe1xyXG4gICAgICAgbW9kQXJyID0gZWxlbWVudEdyb3VwLmNoaWxkTW9kaWZpZXJzLnNsaWNlKDAsIDUpXHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIG1vZEFyciA9IGVsZW1lbnRHcm91cC5jaGlsZE1vZGlmaWVycztcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgXHJcblxyXG4gICAgICBcclxuICAgICAgbW9kQXJyLmZvckVhY2goZWxlbWVudCA9PiB7XHJcblxyXG4gICAgICBsZXQgbW9kaWZpcmVEaXYgPSB0aGlzLm1vZGlmaXJlRGl2KGVsZW1lbnQsZWxlbWVudEdyb3VwLm1vZGlmaWVySWQpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoZ3JvdXBEaXYsbW9kaWZpcmVEaXYpO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5zdGF0ZU1vZGlmaXJlc1tlbGVtZW50R3JvdXAubW9kaWZpZXJJZF1bZWxlbWVudC5tb2RpZmllcklkXT1mYWxzZTtcclxuICAgICAgICBcclxuICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGdyb3VwRGl2KG5hbWVHb3J1cCl7XHJcbiAgICBsZXQgZGl2ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoZGl2LCAnZ3JvdXAtbW9kaWZpcmVzJyk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKGRpdiwgdGhpcy5yZW5kZXJlci5jcmVhdGVUZXh0KCfQndCw0LfQstCw0L3QuNC1INC60LDRgtC10LPQvtGA0LjQuCDQvNC+0LTQuNGE0LjQutCw0YLQvtGA0L7QsjogJytuYW1lR29ydXApKTtcclxuICAgIHJldHVybiBkaXY7XHJcbiAgfVxyXG5cclxuICBtb2RpZmlyZURpdihlbGVtZW50LCBncm91cElkKXtcclxuICAgIGxldCBkaXYgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhkaXYsICdhZGRpdGlvbmFsLWl0ZW0nKTtcclxuICAgIHRoaXMucmVuZGVyT25lTW9kaWZpcmUoZWxlbWVudCwgZGl2LGdyb3VwSWQpO1xyXG4gICByZXR1cm4gZGl2O1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyT25lTW9kaWZpcmUoZWxlbWVudCwgbW9kaWZpcmVEaXYsIGdyb3VwSWQpe1xyXG5cclxuICAgIC8vINCg0LXQvdC00LXRgCDQndCw0LfQstCw0L3QuNGPINC80L7QtNC40YTQuNC60LDRgtC+0YDQsFxyXG4gICAgbGV0IGl0ZW1OYW1lRGl2ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoaXRlbU5hbWVEaXYsICdpdGVtLW5hbWUnKTtcclxuXHJcbiAgICBsZXQgaW5wdXQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShpbnB1dCwgJ3R5cGUnLCAnY2hlY2tib3gnKTtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKGlucHV0LCAnaWQnLCBlbGVtZW50Lm1vZGlmaWVySWQpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChpdGVtTmFtZURpdiwgaW5wdXQpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oaW5wdXQsJ2NoYW5nZScsZT0+e1xyXG4gICAgICB0aGlzLnN0YXRlTW9kaWZpcmVzW2dyb3VwSWRdW2UudGFyZ2V0LmlkXT0gZS50YXJnZXQuY2hlY2tlZDtcclxuICAgICAgdGhpcy5zZXRNb2RpZmlyZXMoKTsgIFxyXG4gICAgfSlcclxuXHJcbiAgICBsZXQgbGFiZWwgID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUobGFiZWwsICdmb3InLCBlbGVtZW50Lm1vZGlmaWVySWQpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChpdGVtTmFtZURpdiwgbGFiZWwpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eShsYWJlbCwgJ2lubmVySFRNTCcsIGVsZW1lbnQuZGlzaC5uYW1lKTtcclxuXHJcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKG1vZGlmaXJlRGl2LCBpdGVtTmFtZURpdik7XHJcbi8vINCg0LXQvdC00LXRgCDQsdC70L7QutCwINC40LfQvNC40L3QtdC90LjRjyDQutC+0LvQuNGH0LXRgdGC0LLQsCDQvNC+0LTQuNGE0LjQutCw0YLQvtGA0LBcclxuICAgIGxldCBpdGVtUXVhbnRpdHkgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICBcclxuICAgIGxldCBhTWludXNEaXYgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoYU1pbnVzRGl2LCAnaXRlbS1xdWFudGl0eV9fYnV0dG9uJyk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KGFNaW51c0RpdiwgJ2lubmVySFRNTCcsICcmIzg3MjI7Jyk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKGl0ZW1RdWFudGl0eSwgYU1pbnVzRGl2KTtcclxuICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKGFNaW51c0RpdiwnY2xpY2snLGU9PntcclxuICAgICAgbGV0IHZhbHVlID0gICt0aGlzLmFtb3VudE1vZGlmaXJlc1tncm91cElkXVtlbGVtZW50Lm1vZGlmaWVySWRdO1xyXG4gICAgICB0aGlzLmFtb3VudE1vZGlmaXJlc1tncm91cElkXVtlbGVtZW50Lm1vZGlmaWVySWRdID0gdmFsdWUtMTtcclxuICAgICAgaWYodGhpcy5hbW91bnRNb2RpZmlyZXNbZ3JvdXBJZF1bZWxlbWVudC5tb2RpZmllcklkXSA8IGVsZW1lbnQubWluQW1vdW50KVxyXG4gICAgICB0aGlzLmFtb3VudE1vZGlmaXJlc1tncm91cElkXVtlbGVtZW50Lm1vZGlmaWVySWRdPWVsZW1lbnQubWluQW1vdW50O1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHNwYW4sICdpbm5lckhUTUwnLCB0aGlzLmFtb3VudE1vZGlmaXJlc1tncm91cElkXVtlbGVtZW50Lm1vZGlmaWVySWRdKTtcclxuICAgICAgdGhpcy5zZXRNb2RpZmlyZXMoKTtcclxuICBcclxuICAgIH0pXHJcblxyXG4gXHJcbiAgICBsZXQgc3BhbiA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhzcGFuLCAnaXRlbS1xdWFudGl0eV9fY291bnRlcicpO1xyXG4gICAgdGhpcy5hbW91bnRNb2RpZmlyZXNbZ3JvdXBJZF1bZWxlbWVudC5tb2RpZmllcklkXSA9IGVsZW1lbnQubWluQW1vdW50O1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eShzcGFuLCAnaW5uZXJIVE1MJywgdGhpcy5hbW91bnRNb2RpZmlyZXNbZ3JvdXBJZF1bZWxlbWVudC5tb2RpZmllcklkXSk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKGl0ZW1RdWFudGl0eSwgc3Bhbik7XHJcblxyXG5cclxuICAgIGxldCBhUGx1c0RpdiA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhUGx1c0RpdiwgJ2l0ZW0tcXVhbnRpdHlfX2J1dHRvbicpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eShhUGx1c0RpdiwgJ2lubmVySFRNTCcsICcmI3gyYjsnKTtcclxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoaXRlbVF1YW50aXR5LCBhUGx1c0Rpdik7XHJcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKG1vZGlmaXJlRGl2LCBpdGVtUXVhbnRpdHkpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oYVBsdXNEaXYsJ2NsaWNrJyxlPT57XHJcbiAgICAgIGxldCB2YWx1ZSA9ICArdGhpcy5hbW91bnRNb2RpZmlyZXNbZ3JvdXBJZF1bZWxlbWVudC5tb2RpZmllcklkXTtcclxuICAgICAgdGhpcy5hbW91bnRNb2RpZmlyZXNbZ3JvdXBJZF1bZWxlbWVudC5tb2RpZmllcklkXSA9IHZhbHVlKzE7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkoc3BhbiwgJ2lubmVySFRNTCcsIHRoaXMuYW1vdW50TW9kaWZpcmVzW2dyb3VwSWRdW2VsZW1lbnQubW9kaWZpZXJJZF0pO1xyXG4gICAgICB0aGlzLnNldE1vZGlmaXJlcygpO1xyXG5cclxuICAgIH0pXHJcblxyXG4vLyDQoNC10L3QtNC10YAg0LHQu9C+0LrQsCDRgdGC0L7QuNC80L7RgdGC0Lgg0Lgg0LLQtdGB0LAg0LzQvtC00LjRhNC40LrQsNGC0L7RgNCwXHJcbiAgICBsZXQgd2VpZ2h0UHJpY2VEaXYgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh3ZWlnaHRQcmljZURpdiwgJ3dlaWdodC1wcmljZScpO1xyXG4gICAgbGV0IHdlaWdodEFuZFByaWNlSFRNTCA9IGVsZW1lbnQuZGlzaC53ZWlnaHQgKyBcIiDQsyAvIFwiICsgZWxlbWVudC5kaXNoLnByaWNlICsgXCImbmJzcDsmI3gyMGJkO1wiXHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldFByb3BlcnR5KHdlaWdodFByaWNlRGl2LCAnaW5uZXJIVE1MJywgd2VpZ2h0QW5kUHJpY2VIVE1MKTtcclxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQobW9kaWZpcmVEaXYsIHdlaWdodFByaWNlRGl2KTtcclxuXHJcbiAgICB0aGlzLnNldE1vZGlmaXJlcygpO1xyXG5cclxuXHJcbiAgfVxyXG4gIHNldE1vZGlmaXJlcygpe1xyXG4gICAgXHJcbiAgICBsZXQgbW9kaWZpcmVzID0gW107XHJcbiAgXHJcbiAgICBmb3IgKGxldCBncm91cElkIGluIHRoaXMuc3RhdGVNb2RpZmlyZXMpe1xyXG4gICAgICBmb3IobGV0IG1vZGlmaXJlSWQgaW4gdGhpcy5zdGF0ZU1vZGlmaXJlc1tncm91cElkXSl7XHJcbiAgICAgICAgaWYodGhpcy5zdGF0ZU1vZGlmaXJlc1tncm91cElkXVttb2RpZmlyZUlkXSl7XHJcbiAgICAgICAgICBtb2RpZmlyZXMucHVzaChcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6IG1vZGlmaXJlSWQsXHJcbiAgICAgICAgICAgICAgICBhbW91bnQ6IHRoaXMuYW1vdW50TW9kaWZpcmVzW2dyb3VwSWRdW21vZGlmaXJlSWRdLFxyXG4gICAgICAgICAgICAgICAgZ3JvdXBJZDogZ3JvdXBJZFxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2coXCLQvNC+0LTQuNGE0ZbQutCw0YLQvtGA0Lgg0L/RltGB0LvRjyDRhtC40LrQu9GDXCIsbW9kaWZpcmVzKVxyXG5cclxuICAgIHRoaXMuY2FydFNlcnZpY2Uuc2V0TW9kaWZpcmVzKG1vZGlmaXJlcyk7XHJcbiAgICBcclxuICB9XHJcblxyXG5cclxufVxyXG4iXX0=