import { Injectable } from '@angular/core';
import { BehaviorSubject, throwError, from } from 'rxjs';
import { catchError, filter, map, switchMap, tap } from 'rxjs/operators';
import { NetService, EventerService } from '@webresto/ng-core';
import * as i0 from "@angular/core";
import * as i1 from "@webresto/ng-core";
export class NgRestoCartService {
    constructor(net, eventer) {
        this.net = net;
        this.eventer = eventer;
        this.cartID = this.getCartId();
        this.cart = new BehaviorSubject(null);
        this.modifires = new BehaviorSubject([]);
        this.OrderFormChange = new BehaviorSubject(null);
        this.modifiresMessage = new BehaviorSubject([]);
        this.restrictions$ = this.net.get(`/restrictions`);
    }
    getCartId() {
        return localStorage.getItem('cartID');
    }
    getCart() {
        return this.net.get(`/cart${this.cartID ? '?cartId=' + this.cartID : ''}`).pipe(switchMap(data => {
            if (!data) {
                this.removeCartId();
            }
            ;
            return data ? from([data]) : this.net.get(`/cart}`);
        }), switchMap(data => {
            var _a;
            if (data.cart.state == 'ORDER') {
                return throwError(new Error('Cart in order state'));
            }
            else {
                if (!this.cartID || this.cartID !== ((_a = data === null || data === void 0 ? void 0 : data.cart) === null || _a === void 0 ? void 0 : _a.cartId)) {
                    this.setCartId(data.cart.cartId);
                }
                ;
                this.cart.next(data.cart);
            }
            ;
            return this.cart;
        }), catchError(err => {
            this.removeCartId();
            return throwError(err);
        }));
    }
    addDishToCart(data) {
        if (this.modifiresMessage.value.length) {
            this.modifiresMessage.value.forEach(message => {
                this.eventer.emitMessageEvent(message);
            });
            return;
        }
        this.net.put('/cart/add', data).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Блюдо добавлено в корзину')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось добавить блюдо')
             )*/
        });
    }
    addDishToCart$(data) {
        if (this.modifiresMessage.value.length) {
            this.modifiresMessage.value.forEach(message => {
                this.eventer.emitMessageEvent(message);
            });
            return from([null]);
        }
        return this.net.put('/cart/add', data)
            .pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }));
    }
    setDishCountToCart(dishId, amount) {
        const sub = this.net.post('/cart/set', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        }).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Изменено количество')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось изменить количество')
             )*/
        }, () => sub.unsubscribe());
    }
    setDishComment(dishId, comment) {
        return this.net.post('/cart/setcomment', {
            dishId: dishId,
            cartId: this.cartID,
            comment: comment
        }).pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }, () => { }));
    }
    removeDishFromCart$(dishId, amount) {
        return this.net.put('/cart/remove', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        })
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
        }));
    }
    removeDishFromCart(dishId, amount) {
        const sub = this.net.put('/cart/remove', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        }).subscribe(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Блюдо успешно удалено')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось удалить блюдо')
             )*/
        }, () => sub.unsubscribe());
    }
    checkoutCart(data) {
        let order = {
            cartId: this.cartID,
            address: {
                streetId: data.street.id,
                home: data.house,
                housing: data.housing,
                // index: "1278",
                entrance: data.entrance,
                floor: data.floor,
                apartment: data.apartment
            },
            customer: {
                phone: data.phone,
                name: data.name,
                mail: data.email || undefined
            }
        };
        return this.orderCart(order);
    }
    orderCart(data) {
        return this.net.post('/order', data)
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
        }, error => {
            console.log("Ошибка оформления!", error);
            if (error.error && error.error.cart) {
                this.setCartId(error.error.cart.cartId);
                this.cart.next(error.error.cart);
                this.cartID = error.error.cart.cartId;
            }
            /*if (error.message) {
              this.eventer.emitMessageEvent(
                new EventMessage(error.message.type, error.message.title, error.message.body)
              );
            } else {
              this.eventer.emitMessageEvent(
                new EventMessage('error', 'Ошибка', 'Не удалось оформить заказ')
              );
            }*/
        }));
    }
    checkStreetV2(data) {
        return this.net.post('/check', data)
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
        }, () => { }));
    }
    checkStreet(data) {
        const sub = this.net.post('/check', data).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }, error => {
            if (error.error) {
                if (error.error.cart) {
                    this.setCartId(error.error.cart.cartId);
                    this.cart.next(error.error.cart);
                    this.cartID = error.error.cart.cartId;
                }
                /*this.eventer.emitMessageEvent(
                 new EventMessage(error.error.message.type, error.error.message.title, error.error.message.body)
                 );*/
            }
        }, () => sub.unsubscribe());
    }
    setCartId(cartID) {
        localStorage.setItem('cartID', cartID);
        this.cartID = cartID;
    }
    removeCartId() {
        localStorage.removeItem('cartID');
        this.cartID = null;
    }
    userCart() {
        return this.cart;
    }
    setModifires(modifires, messages) {
        this.modifires.next(modifires);
        if (messages) {
            this.modifiresMessage.next(messages);
        }
        ;
    }
    getModifires() {
        return this.modifires.pipe();
    }
    productInCart(product) {
        return this.cart.pipe(filter(cart => 'cartId' in cart), map(cart => {
            var _a;
            return !!(cart && ((_a = cart === null || cart === void 0 ? void 0 : cart.dishes) === null || _a === void 0 ? void 0 : _a.find(dishInCart => dishInCart.dish.id === product.id)));
        }));
    }
    getPickupPoints(cartId) {
        return this.net.get('/pickupaddreses', true, {
            params: {
                cartId
            }
        });
    }
    getPaymentMethods(cartId) {
        return this.net.get('/paymentmethods', true, {
            params: {
                cartId
            }
        });
    }
}
NgRestoCartService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgRestoCartService_Factory() { return new NgRestoCartService(i0.ɵɵinject(i1.NetService), i0.ɵɵinject(i1.EventerService)); }, token: NgRestoCartService, providedIn: "root" });
NgRestoCartService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
NgRestoCartService.ctorParameters = () => [
    { type: NetService },
    { type: EventerService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctcmVzdG9jYXJ0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vcHJvamVjdHMvd2VicmVzdG8vbmctY2FydC9zcmMvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbmctcmVzdG9jYXJ0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsZUFBZSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsVUFBVSxFQUFFLGNBQWMsRUFBZ0IsTUFBTSxtQkFBbUIsQ0FBQzs7O0FBSzdFLE1BQU0sT0FBTyxrQkFBa0I7SUFRN0IsWUFBb0IsR0FBZSxFQUFVLE9BQXVCO1FBQWhELFFBQUcsR0FBSCxHQUFHLENBQVk7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQVBwRSxXQUFNLEdBQVcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2xDLFNBQUksR0FBMEIsSUFBSSxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEQsY0FBUyxHQUF5QixJQUFJLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMxRCxvQkFBZSxHQUFHLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTVDLHFCQUFnQixHQUFvQyxJQUFJLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUk1RSxrQkFBYSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFvQixlQUFlLENBQUMsQ0FBQTtJQUZRLENBQUM7SUFJekUsU0FBUztRQUNQLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsT0FBTztRQUNM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RUFBRSxJQUFJLEVBQUU7WUFDMUQsTUFBTSxFQUFFO2dCQUNOLE1BQU07YUFDUDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxNQUFjO1FBQzlCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQWtCLGlCQUFpQixFQUFFLElBQUksRUFBRTtZQUM1RCxNQUFNLEVBQUU7Z0JBQ04sTUFBTTthQUNQO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7OztZQTNTRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7OztZQUpRLFVBQVU7WUFBRSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QsIHRocm93RXJyb3IsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY2F0Y2hFcnJvciwgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBOZXRTZXJ2aWNlLCBFdmVudGVyU2VydmljZSwgRXZlbnRNZXNzYWdlIH0gZnJvbSAnQHdlYnJlc3RvL25nLWNvcmUnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTmdSZXN0b0NhcnRTZXJ2aWNlIHtcclxuICBjYXJ0SUQ6IHN0cmluZyA9IHRoaXMuZ2V0Q2FydElkKCk7XHJcbiAgY2FydDogQmVoYXZpb3JTdWJqZWN0PENhcnQ+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcclxuICBtb2RpZmlyZXM6IEJlaGF2aW9yU3ViamVjdDxhbnk+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChbXSk7XHJcbiAgT3JkZXJGb3JtQ2hhbmdlID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcclxuXHJcbiAgbW9kaWZpcmVzTWVzc2FnZTogQmVoYXZpb3JTdWJqZWN0PEV2ZW50TWVzc2FnZVtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3QoW10pO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG5ldDogTmV0U2VydmljZSwgcHJpdmF0ZSBldmVudGVyOiBFdmVudGVyU2VydmljZSkgeyB9XHJcblxyXG4gIHJlc3RyaWN0aW9ucyQgPSB0aGlzLm5ldC5nZXQ8UmVzdHJpY3Rpb25zT3JkZXI+KGAvcmVzdHJpY3Rpb25zYClcclxuXHJcbiAgZ2V0Q2FydElkKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NhcnRJRCcpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2FydCgpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5nZXQ8eyBjYXJ0OiBDYXJ0IH0+KGAvY2FydCR7dGhpcy5jYXJ0SUQgPyAnP2NhcnRJZD0nICsgdGhpcy5jYXJ0SUQgOiAnJ31gKS5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoZGF0YSA9PiB7XHJcbiAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICB0aGlzLnJlbW92ZUNhcnRJZCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRhdGEgPyBmcm9tKFtkYXRhXSkgOiB0aGlzLm5ldC5nZXQ8eyBjYXJ0OiBDYXJ0IH0+KGAvY2FydH1gKVxyXG4gICAgICB9KSxcclxuICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgIGRhdGEgPT4ge1xyXG4gICAgICAgICAgaWYgKGRhdGEuY2FydC5zdGF0ZSA9PSAnT1JERVInKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKG5ldyBFcnJvcignQ2FydCBpbiBvcmRlciBzdGF0ZScpKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5jYXJ0SUQgfHwgdGhpcy5jYXJ0SUQgIT09IGRhdGE/LmNhcnQ/LmNhcnRJZCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKGRhdGEuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmNhcnQubmV4dChkYXRhLmNhcnQpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmNhcnQ7XHJcbiAgICAgICAgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoZXJyID0+IHtcclxuICAgICAgICB0aGlzLnJlbW92ZUNhcnRJZCgpO1xyXG4gICAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVycik7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYWRkRGlzaFRvQ2FydChkYXRhKSB7XHJcbiAgICBpZiAodGhpcy5tb2RpZmlyZXNNZXNzYWdlLnZhbHVlLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLm1vZGlmaXJlc01lc3NhZ2UudmFsdWUuZm9yRWFjaChtZXNzYWdlID0+IHtcclxuICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChtZXNzYWdlKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm5ldC5wdXQoJy9jYXJ0L2FkZCcsIGRhdGEpLnN1YnNjcmliZShcclxuICAgICAgcmVzID0+IHtcclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXMuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuXHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnc3VjY2VzcycsICfQo9GB0L/QtdGFJywgJ9CR0LvRjtC00L4g0LTQvtCx0LDQstC70LXQvdC+INCyINC60L7RgNC30LjQvdGDJylcclxuICAgICAgICAgKTsqL1xyXG5cclxuICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINC00L7QsdCw0LLQuNGC0Ywg0LHQu9GO0LTQvicpXHJcbiAgICAgICAgICkqL1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZERpc2hUb0NhcnQkKGRhdGEpIHtcclxuICAgIGlmICh0aGlzLm1vZGlmaXJlc01lc3NhZ2UudmFsdWUubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMubW9kaWZpcmVzTWVzc2FnZS52YWx1ZS5mb3JFYWNoKG1lc3NhZ2UgPT4ge1xyXG4gICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KG1lc3NhZ2UpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGZyb20oW251bGxdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5uZXQucHV0KCcvY2FydC9hZGQnLCBkYXRhKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YXAocmVzID0+IHtcclxuICAgICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzaENvdW50VG9DYXJ0KGRpc2hJZCwgYW1vdW50KSB7XHJcbiAgICBjb25zdCBzdWIgPSB0aGlzLm5ldC5wb3N0PGFueSx7Y2FydDpDYXJ0LG1lc3NhZ2U6YW55fT4oJy9jYXJ0L3NldCcsIHtcclxuICAgICAgZGlzaElkOiBkaXNoSWQsXHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGFtb3VudDogYW1vdW50XHJcbiAgICB9KS5zdWJzY3JpYmUoXHJcbiAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzLmNhcnQuY2FydElkKTtcclxuICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXMuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnc3VjY2VzcycsICfQo9GB0L/QtdGFJywgJ9CY0LfQvNC10L3QtdC90L4g0LrQvtC70LjRh9C10YHRgtCy0L4nKVxyXG4gICAgICAgICApOyovXHJcbiAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdlcnJvcicsICfQntGI0LjQsdC60LAnLCAn0J3QtSDRg9C00LDQu9C+0YHRjCDQuNC30LzQtdC90LjRgtGMINC60L7Qu9C40YfQtdGB0YLQstC+JylcclxuICAgICAgICAgKSovXHJcbiAgICAgIH0sICgpID0+IHN1Yi51bnN1YnNjcmliZSgpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzaENvbW1lbnQoZGlzaElkLCBjb21tZW50KSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQucG9zdCgnL2NhcnQvc2V0Y29tbWVudCcsIHtcclxuICAgICAgZGlzaElkOiBkaXNoSWQsXHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGNvbW1lbnQ6IGNvbW1lbnRcclxuICAgIH0pLnBpcGUodGFwKFxyXG4gICAgICByZXMgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzLmNhcnQpO1xyXG4gICAgICAgIHRoaXMuY2FydElEID0gcmVzLmNhcnQuY2FydElkO1xyXG5cclxuICAgICAgfSwgKCkgPT4geyB9XHJcbiAgICApKVxyXG5cclxuICB9XHJcblxyXG4gIHJlbW92ZURpc2hGcm9tQ2FydCQoZGlzaElkLCBhbW91bnQpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5wdXQoJy9jYXJ0L3JlbW92ZScsIHtcclxuICAgICAgZGlzaElkOiBkaXNoSWQsXHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGFtb3VudDogYW1vdW50XHJcbiAgICB9KVxyXG4gICAgICAucGlwZSh0YXAocmVzdWx0ID0+IHtcclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXN1bHQuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlc3VsdC5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlc3VsdC5jYXJ0LmNhcnRJZDtcclxuICAgICAgfSkpO1xyXG5cclxuICB9XHJcblxyXG4gIHJlbW92ZURpc2hGcm9tQ2FydChkaXNoSWQsIGFtb3VudCkge1xyXG4gICAgY29uc3Qgc3ViID0gdGhpcy5uZXQucHV0KCcvY2FydC9yZW1vdmUnLCB7XHJcbiAgICAgIGRpc2hJZDogZGlzaElkLFxyXG4gICAgICBjYXJ0SWQ6IHRoaXMuY2FydElELFxyXG4gICAgICBhbW91bnQ6IGFtb3VudFxyXG4gICAgfSkuc3Vic2NyaWJlKFxyXG4gICAgICByZXN1bHQgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0Q2FydElkKHJlc3VsdC5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzdWx0LmNhcnQpO1xyXG4gICAgICAgIHRoaXMuY2FydElEID0gcmVzdWx0LmNhcnQuY2FydElkO1xyXG4gICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAn0KPRgdC/0LXRhScsICfQkdC70Y7QtNC+INGD0YHQv9C10YjQvdC+INGD0LTQsNC70LXQvdC+JylcclxuICAgICAgICAgKTsqL1xyXG5cclxuICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINGD0LTQsNC70LjRgtGMINCx0LvRjtC00L4nKVxyXG4gICAgICAgICApKi9cclxuICAgICAgfSwgKCkgPT4gc3ViLnVuc3Vic2NyaWJlKClcclxuICAgICk7XHJcblxyXG4gIH1cclxuXHJcbiAgY2hlY2tvdXRDYXJ0KGRhdGEpIHtcclxuICAgIGxldCBvcmRlciA9IHtcclxuICAgICAgY2FydElkOiB0aGlzLmNhcnRJRCxcclxuICAgICAgYWRkcmVzczoge1xyXG4gICAgICAgIHN0cmVldElkOiBkYXRhLnN0cmVldC5pZCxcclxuICAgICAgICBob21lOiBkYXRhLmhvdXNlLFxyXG4gICAgICAgIGhvdXNpbmc6IGRhdGEuaG91c2luZyxcclxuICAgICAgICAvLyBpbmRleDogXCIxMjc4XCIsXHJcbiAgICAgICAgZW50cmFuY2U6IGRhdGEuZW50cmFuY2UsXHJcbiAgICAgICAgZmxvb3I6IGRhdGEuZmxvb3IsXHJcbiAgICAgICAgYXBhcnRtZW50OiBkYXRhLmFwYXJ0bWVudFxyXG4gICAgICB9LFxyXG5cclxuICAgICAgY3VzdG9tZXI6IHtcclxuICAgICAgICBwaG9uZTogZGF0YS5waG9uZSxcclxuICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXHJcbiAgICAgICAgbWFpbDogZGF0YS5lbWFpbCB8fCB1bmRlZmluZWRcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLm9yZGVyQ2FydChvcmRlcik7XHJcblxyXG4gIH1cclxuXHJcbiAgb3JkZXJDYXJ0KGRhdGEpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5wb3N0PGFueSx7Y2FydDpDYXJ0LG1lc3NhZ2U6YW55fT4oJy9vcmRlcicsIGRhdGEpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcChcclxuICAgICAgICAgIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKHJlc3VsdC5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydC5uZXh0KHJlc3VsdC5jYXJ0KTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXN1bHQuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcItCe0YjQuNCx0LrQsCDQvtGE0L7RgNC80LvQtdC90LjRjyFcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IuZXJyb3IgJiYgZXJyb3IuZXJyb3IuY2FydCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKGVycm9yLmVycm9yLmNhcnQuY2FydElkKTtcclxuICAgICAgICAgICAgICB0aGlzLmNhcnQubmV4dChlcnJvci5lcnJvci5jYXJ0KTtcclxuICAgICAgICAgICAgICB0aGlzLmNhcnRJRCA9IGVycm9yLmVycm9yLmNhcnQuY2FydElkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8qaWYgKGVycm9yLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoZXJyb3IubWVzc2FnZS50eXBlLCBlcnJvci5tZXNzYWdlLnRpdGxlLCBlcnJvci5tZXNzYWdlLmJvZHkpXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ2Vycm9yJywgJ9Ce0YjQuNCx0LrQsCcsICfQndC1INGD0LTQsNC70L7RgdGMINC+0YTQvtGA0LzQuNGC0Ywg0LfQsNC60LDQtycpXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tTdHJlZXRWMihkYXRhKTogT2JzZXJ2YWJsZTx7Y2FydDpDYXJ0LG1lc3NhZ2U6YW55fT4ge1xyXG4gICAgcmV0dXJuIHRoaXMubmV0LnBvc3Q8YW55LHtjYXJ0OkNhcnQsbWVzc2FnZTphbnl9PignL2NoZWNrJywgZGF0YSlcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKFxyXG4gICAgICAgICAgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzdWx0LmNhcnQuY2FydElkKTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzdWx0LmNhcnQpO1xyXG4gICAgICAgICAgICB0aGlzLmNhcnRJRCA9IHJlc3VsdC5jYXJ0LmNhcnRJZDtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAoKSA9PiB7IH1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBjaGVja1N0cmVldChkYXRhKTogdm9pZCB7XHJcbiAgICBjb25zdCBzdWIgPSB0aGlzLm5ldC5wb3N0PGFueSx7Y2FydDpDYXJ0LCBtZXNzYWdlOmFueX0+KCcvY2hlY2snLCBkYXRhKS5zdWJzY3JpYmUoXHJcbiAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzLmNhcnQuY2FydElkKTtcclxuICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXMuY2FydC5jYXJ0SWQ7XHJcbiAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IuZXJyb3IpIHtcclxuICAgICAgICAgIGlmIChlcnJvci5lcnJvci5jYXJ0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKGVycm9yLmVycm9yLmNhcnQuY2FydElkKTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0Lm5leHQoZXJyb3IuZXJyb3IuY2FydCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydElEID0gZXJyb3IuZXJyb3IuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoZXJyb3IuZXJyb3IubWVzc2FnZS50eXBlLCBlcnJvci5lcnJvci5tZXNzYWdlLnRpdGxlLCBlcnJvci5lcnJvci5tZXNzYWdlLmJvZHkpXHJcbiAgICAgICAgICAgKTsqL1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgKCkgPT4gc3ViLnVuc3Vic2NyaWJlKCkpO1xyXG5cclxuICB9XHJcblxyXG4gIHNldENhcnRJZChjYXJ0SUQpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjYXJ0SUQnLCBjYXJ0SUQpO1xyXG4gICAgdGhpcy5jYXJ0SUQgPSBjYXJ0SUQ7XHJcbiAgfVxyXG5cclxuICByZW1vdmVDYXJ0SWQoKSB7XHJcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY2FydElEJyk7XHJcbiAgICB0aGlzLmNhcnRJRCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICB1c2VyQ2FydCgpOiBPYnNlcnZhYmxlPENhcnQ+IHtcclxuICAgIHJldHVybiB0aGlzLmNhcnQ7XHJcbiAgfVxyXG5cclxuICBzZXRNb2RpZmlyZXMobW9kaWZpcmVzLCBtZXNzYWdlcz86IEV2ZW50TWVzc2FnZVtdKTogdm9pZCB7XHJcbiAgICB0aGlzLm1vZGlmaXJlcy5uZXh0KG1vZGlmaXJlcyk7XHJcbiAgICBpZiAobWVzc2FnZXMpIHtcclxuICAgICAgdGhpcy5tb2RpZmlyZXNNZXNzYWdlLm5leHQobWVzc2FnZXMpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldE1vZGlmaXJlcygpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMubW9kaWZpcmVzLnBpcGUoKTtcclxuICB9XHJcblxyXG4gIHByb2R1Y3RJbkNhcnQocHJvZHVjdDogRGlzaExpc3RJdGVtKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jYXJ0LnBpcGUoXHJcbiAgICAgIGZpbHRlcihjYXJ0ID0+ICdjYXJ0SWQnIGluIGNhcnQpLFxyXG4gICAgICBtYXAoY2FydCA9PiB7XHJcbiAgICAgICAgcmV0dXJuICEhKGNhcnQgJiYgY2FydD8uZGlzaGVzPy5maW5kKGRpc2hJbkNhcnQgPT4gZGlzaEluQ2FydC5kaXNoLmlkID09PSBwcm9kdWN0LmlkKSlcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRQaWNrdXBQb2ludHMoY2FydElkOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5nZXQ8UGlja3VwUG9pbnRbXT4oJy9waWNrdXBhZGRyZXNlcycsIHRydWUsIHtcclxuICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgY2FydElkXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0UGF5bWVudE1ldGhvZHMoY2FydElkOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5nZXQ8UGF5bWVudE1ldGhvZFtdPignL3BheW1lbnRtZXRob2RzJywgdHJ1ZSwge1xyXG4gICAgICBwYXJhbXM6IHtcclxuICAgICAgICBjYXJ0SWRcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIFBpY2t1cFBvaW50IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbiAgYWRkcmVzczogc3RyaW5nO1xyXG4gIG9yZGVyOiBudW1iZXI7XHJcbiAgZW5hYmxlOiBib29sZWFuO1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xyXG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgUGF5bWVudE1ldGhvZCB7XHJcbiAgaWlrb1BheW1lbnRNZXRob2Q6IGFueSxcclxuICBpZDogc3RyaW5nLFxyXG4gIHRpdGxlOiBzdHJpbmcsXHJcbiAgdHlwZTogc3RyaW5nLFxyXG4gIGFkYXB0ZXI6IHN0cmluZyxcclxuICBvcmRlcjogbnVtYmVyLFxyXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcsXHJcbiAgZW5hYmxlOiBib29sZWFuLFxyXG4gIGNyZWF0ZWRBdDogc3RyaW5nLFxyXG4gIHVwZGF0ZWRBdDogc3RyaW5nXHJcbn1cclxuXHJcbmV4cG9ydCBkZWNsYXJlIGludGVyZmFjZSBEaXNoSW5DYXJ0IHtcclxuICBhZGRlZEJ5OiBzdHJpbmc7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgY2FydDogc3RyaW5nO1xyXG4gIGNvbW1lbnQ6IHN0cmluZztcclxuICBjcmVhdGVkQXQ6IHN0cmluZztcclxuICBkaXNoOiBEaXNoTGlzdEl0ZW07XHJcbiAgaWQ6IG51bWJlcjtcclxuICBpdGVtVG90YWw6IG51bWJlcjtcclxuICBtb2RpZmllcnM6IGFueVtdO1xyXG4gIHBhcmVudDogYW55O1xyXG4gIHRvdGFsV2VpZ2h0OiBudW1iZXI7XHJcbiAgdW5pcXVlSXRlbXM6IG51bWJlcjtcclxuICB1cGRhdGVkQXQ6IHN0cmluZztcclxuICB3ZWlnaHQ6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIENhcnQge1xyXG4gIGFkZHJlc3M6IGFueVxyXG4gIGNhcnRJZDogc3RyaW5nXHJcbiAgY2FydFRvdGFsOiBudW1iZXJcclxuICBjb21tZW50OiBzdHJpbmdcclxuICBjcmVhdGVkQXQ6IHN0cmluZ1xyXG4gIGN1c3RvbWVyOiBzdHJpbmdcclxuICBkZWxpdmVyeTogYW55XHJcbiAgZGVsaXZlcnlEZXNjcmlwdGlvbjogc3RyaW5nXHJcbiAgZGVsaXZlcnlJdGVtOiBhbnlcclxuICBkZWxpdmVyeVN0YXR1czogYW55XHJcbiAgZGlzaGVzOiBEaXNoSW5DYXJ0W11cclxuICBkaXNoZXNDb3VudDogbnVtYmVyXHJcbiAgaGlzdG9yeTogYW55XHJcbiAgaWQ6IHN0cmluZ1xyXG4gIG1lc3NhZ2U6IGFueVxyXG4gIG1vZGlmaWVyczogYW55XHJcbiAgbmFtZU9mTW9kZWw6IGFueVxyXG4gIHBlcnNvbnNDb3VudDogbnVtYmVyXHJcbiAgcHJvYmxlbTogYm9vbGVhblxyXG4gIHJtc0lkOiBzdHJpbmdcclxuICBzZWxmRGVsaXZlcnk6IGJvb2xlYW5cclxuICBzZW5kVG9JaWtvOiBib29sZWFuXHJcbiAgc3RhdGU6IHN0cmluZ1xyXG4gIHRvdGFsV2VpZ2h0OiBzdHJpbmdcclxuICB1bmlxdWVEaXNoZXM6IHN0cmluZ1xyXG4gIHVwZGF0ZWRBdDogc3RyaW5nXHJcbiAgdXNlcjogYW55XHJcbiAgRnJlZURlbGl2ZXJ5RnJvbU1lc3NhZ2U6IHN0cmluZ1xyXG4gIGRhdGU6IG51bGxcclxuICBkZWxpdmVyeVRpbWVNZXNzYWdlOiBzdHJpbmdcclxuICBkZWxpdmVyeUNvc3Q6IG51bWJlclxyXG4gIGRpc2NvdW50VG90YWw6IG51bWJlclxyXG4gIGlzUGF5bWVudFByb21pc2U6IGJvb2xlYW5cclxuICBvcmRlckRhdGU6IHN0cmluZ1xyXG4gIG9yZGVyRGF0ZUxpbWl0OiBzdHJpbmdcclxuICBvcmRlclRvdGFsOiBudW1iZXJcclxuICBwYWlkOiBib29sZWFuXHJcbiAgcGF5bWVudE1ldGhvZDogc3RyaW5nXHJcbiAgcGF5bWVudE1ldGhvZFRpdGxlOiBzdHJpbmdcclxuICByZWNvbW1lbmRzOiBEaXNoTGlzdEl0ZW1bXTtcclxuICBybXNEZWxpdmVyZWQ6IGJvb2xlYW5cclxuICBybXNEZWxpdmVyeURhdGU6IG51bGxcclxuICBybXNFcnJvckNvZGU6IG51bGxcclxuICBybXNFcnJvck1lc3NhZ2U6IG51bGxcclxuICBybXNPcmRlckRhdGE6IG51bGxcclxuICBybXNPcmRlck51bWJlcjogbnVsbFxyXG4gIHJtc1N0YXR1c0NvZGU6IG51bGxcclxuICBzZWxmU2VydmljZTogYm9vbGVhblxyXG4gIHNob3J0SWQ6IHN0cmluZ1xyXG4gIHRvdGFsOiBudW1iZXJcclxuICB1bnRpbEZyZWVEZWxpdmVyeU1lc3NhZ2U6IHN0cmluZ1xyXG59XHJcblxyXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgRGlzaExpc3RJdGVtIHtcclxuICBhZGRpdGlvbmFsSW5mbzogYW55XHJcbiAgYmFsYW5jZTogbnVtYmVyXHJcbiAgY2FyYm9oeWRyYXRlQW1vdW50OiBudW1iZXJcclxuICBjYXJib2h5ZHJhdGVGdWxsQW1vdW50OiBudW1iZXJcclxuICBjb2RlOiBzdHJpbmdcclxuICBjcmVhdGVkQXQ6IHN0cmluZ1xyXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmdcclxuICBkaWZmZXJlbnRQcmljZXNPbjogYW55W11cclxuICBkb05vdFByaW50SW5DaGVxdWU6IGJvb2xlYW5cclxuICBlbmVyZ3lBbW91bnQ6IG51bWJlclxyXG4gIGVuZXJneUZ1bGxBbW91bnQ6IG51bWJlclxyXG4gIGZhdEFtb3VudDogbnVtYmVyXHJcbiAgZmF0RnVsbEFtb3VudDogbnVtYmVyXHJcbiAgZmliZXJBbW91bnQ6IG51bWJlclxyXG4gIGZpYmVyRnVsbEFtb3VudDogbnVtYmVyXHJcbiAgZ3JvdXBJZDogYW55XHJcbiAgZ3JvdXBNb2RpZmllcnM6IFtdXHJcbiAgaGFzaDogbnVtYmVyXHJcbiAgaWQ6IHN0cmluZ1xyXG4gIGltYWdlczogRGlzaEltYWdlSXRlbVtdXHJcbiAgaW1hZ2VzTGlzdDogRGlzaEltYWdlSXRlbVtdXHJcbiAgaXNEZWxldGVkOiBib29sZWFuXHJcbiAgaXNJbmNsdWRlZEluTWVudTogYm9vbGVhblxyXG4gIG1lYXN1cmVVbml0OiBzdHJpbmdcclxuICBtb2RpZmllcnM6IERpc2hNb2RpZmllcltdXHJcbiAgbmFtZTogc3RyaW5nXHJcbiAgb3JkZXI6IG51bWJlclxyXG4gIHBhcmVudEdyb3VwOiBzdHJpbmdcclxuICBwcmljZTogbnVtYmVyXHJcbiAgcHJvZHVjdENhdGVnb3J5SWQ6IHN0cmluZ1xyXG4gIHByb2hpYml0ZWRUb1NhbGVPbjogYW55W11cclxuICBybXNJZDogc3RyaW5nXHJcbiAgc2VvRGVzY3JpcHRpb246IGFueVxyXG4gIHNlb0tleXdvcmRzOiBhbnlcclxuICBzZW9UZXh0OiBhbnlcclxuICBzZW9UaXRsZTogYW55XHJcbiAgc2x1Zzogc3RyaW5nXHJcbiAgdGFnczogYW55W11cclxuICB0YWdzTGlzdDogYW55W11cclxuICB0eXBlOiBzdHJpbmdcclxuICB1cGRhdGVkQXQ6IHN0cmluZ1xyXG4gIHVzZUJhbGFuY2VGb3JTZWxsOiBib29sZWFuXHJcbiAgd2VpZ2h0OiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIERpc2hJbWFnZVVybHMge1xyXG4gIGxhcmdlOiBzdHJpbmdcclxuICBvcmlnaW46IHN0cmluZ1xyXG4gIHNtYWxsOiBzdHJpbmdcclxufVxyXG5cclxuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIERpc2hJbWFnZUl0ZW0ge1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgZ3JvdXA6IGFueVxyXG4gIGlkOiBzdHJpbmdcclxuICBpbWFnZXM6IERpc2hJbWFnZVVybHNcclxuICB1cGRhdGVkQXQ6IHN0cmluZ1xyXG4gIHVwbG9hZERhdGU6IHN0cmluZ1xyXG59XHJcblxyXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgRGlzaEJhc2VNb2RpZmllciB7XHJcbiAgbWF4QW1vdW50OiBudW1iZXJcclxuICBtaW5BbW91bnQ6IG51bWJlclxyXG4gIG1vZGlmaWVySWQ6IHN0cmluZ1xyXG4gIHJlcXVpcmVkOiBib29sZWFuXHJcbn1cclxuXHJcbmV4cG9ydCBkZWNsYXJlIGludGVyZmFjZSBEaXNoTW9kaWZpZXIgZXh0ZW5kcyBEaXNoQmFzZU1vZGlmaWVyIHtcclxuICBjaGlsZE1vZGlmaWVyczogRGlzaENoaWxkTW9kaWZpZXJbXVxyXG4gIGNoaWxkTW9kaWZpZXJzSGF2ZU1pbk1heFJlc3RyaWN0aW9uczogYm9vbGVhblxyXG4gIGdyb3VwOiBEaXNoTGlzdEl0ZW1cclxufVxyXG5cclxuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIERpc2hDaGlsZE1vZGlmaWVyIGV4dGVuZHMgRGlzaEJhc2VNb2RpZmllciB7XHJcbiAgZGVmYXVsdEFtb3VudDogbnVtYmVyXHJcbiAgaGlkZUlmRGVmYXVsdEFtb3VudDogYm9vbGVhblxyXG4gIGRpc2g6IERpc2hMaXN0SXRlbVxyXG59XHJcblxyXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgV29ya1RpbWVCYXNlIHtcclxuICBzdGFydDogc3RyaW5nO1xyXG4gIHN0b3A6IHN0cmluZztcclxuICBicmVhazogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgV29ya1RpbWUgZXh0ZW5kcyBXb3JrVGltZUJhc2Uge1xyXG4gIGRheU9mV2Vlazogc3RyaW5nXHJcbiAgc2VsZlNlcnZpY2U6IFdvcmtUaW1lQmFzZVxyXG59XHJcblxyXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgUmVzdHJpY3Rpb25zT3JkZXIge1xyXG4gIG1pbkRlbGl2ZXJ5VGltZTogc3RyaW5nXHJcbiAgZGVsaXZlcnlUb1RpbWVFbmFibGVkOiBib29sZWFuXHJcbiAgcGVyaW9kUG9zc2libGVGb3JPcmRlcjogbnVtYmVyXHJcbiAgdGltZXpvbmU6IHN0cmluZ1xyXG4gIHdvcmtUaW1lOiBXb3JrVGltZVtdXHJcbn1cclxuXHJcbiJdfQ==