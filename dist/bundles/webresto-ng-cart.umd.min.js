!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("\0commonjsHelpers.js"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@webresto/ng-core"),require("\0commonjs-proxy-@angular/core"),require("\0commonjs-proxy-rxjs"),require("\0commonjs-proxy-rxjs/operators"),require("\0commonjs-proxy-@webresto/ng-core"),require("\0commonjs-proxy-../services/ng-restocart.service"),require("\0commonjs-proxy-../../services/ng-restocart.service"),require("@angular/common"),require("\0commonjs-proxy-@angular/common"),require("\0commonjs-proxy-./directives/add-dish-to-cart.directive"),require("\0commonjs-proxy-./directives/amount-cart.directive"),require("\0commonjs-proxy-./directives/delete-from-cart.directive"),require("\0commonjs-proxy-./directives/order-cart-user.directive"),require("\0commonjs-proxy-./directives/set-amount.directive"),require("\0commonjs-proxy-./directives/dish-calc.directive"),require("\0commonjs-proxy-./directives/checkout.directive"),require("\0commonjs-proxy-./directives/set-dish-comment.directive"),require("\0commonjs-proxy-./components/dish-calc/dish-calc.component"),require("\0commonjs-proxy-./lib/services/ng-restocart.service"),require("\0commonjs-proxy-./lib/ng-cart.module"),require("\0commonjs-proxy-./public_api"),require("\0commonjs-proxy-./lib/components/dish-calc/dish-calc.component"),require("\0commonjs-proxy-./lib/directives/add-dish-to-cart.directive"),require("\0commonjs-proxy-./lib/directives/amount-cart.directive"),require("\0commonjs-proxy-./lib/directives/checkout.directive"),require("\0commonjs-proxy-./lib/directives/delete-from-cart.directive"),require("\0commonjs-proxy-./lib/directives/dish-calc.directive"),require("\0commonjs-proxy-./lib/directives/order-cart-user.directive"),require("\0commonjs-proxy-./lib/directives/set-amount.directive"),require("\0commonjs-proxy-./lib/directives/set-dish-comment.directive")):"function"==typeof define&&define.amd?define("@webresto/ng-cart",["\0commonjsHelpers.js","@angular/core","rxjs","rxjs/operators","@webresto/ng-core","\0commonjs-proxy-@angular/core","\0commonjs-proxy-rxjs","\0commonjs-proxy-rxjs/operators","\0commonjs-proxy-@webresto/ng-core","\0commonjs-proxy-../services/ng-restocart.service","\0commonjs-proxy-../../services/ng-restocart.service","@angular/common","\0commonjs-proxy-@angular/common","\0commonjs-proxy-./directives/add-dish-to-cart.directive","\0commonjs-proxy-./directives/amount-cart.directive","\0commonjs-proxy-./directives/delete-from-cart.directive","\0commonjs-proxy-./directives/order-cart-user.directive","\0commonjs-proxy-./directives/set-amount.directive","\0commonjs-proxy-./directives/dish-calc.directive","\0commonjs-proxy-./directives/checkout.directive","\0commonjs-proxy-./directives/set-dish-comment.directive","\0commonjs-proxy-./components/dish-calc/dish-calc.component","\0commonjs-proxy-./lib/services/ng-restocart.service","\0commonjs-proxy-./lib/ng-cart.module","\0commonjs-proxy-./public_api","\0commonjs-proxy-./lib/components/dish-calc/dish-calc.component","\0commonjs-proxy-./lib/directives/add-dish-to-cart.directive","\0commonjs-proxy-./lib/directives/amount-cart.directive","\0commonjs-proxy-./lib/directives/checkout.directive","\0commonjs-proxy-./lib/directives/delete-from-cart.directive","\0commonjs-proxy-./lib/directives/dish-calc.directive","\0commonjs-proxy-./lib/directives/order-cart-user.directive","\0commonjs-proxy-./lib/directives/set-amount.directive","\0commonjs-proxy-./lib/directives/set-dish-comment.directive"],t):(e.webresto=e.webresto||{},e.webresto["ng-cart"]=t(null,e.ng.core,e.rxjs,e.rxjs.operators,0,null,null,null,null,null,null,e.ng.common,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null))}(this,function(e,t,r,i,n,d,s,a,v,o,c,h,l,u,m,p,f,g,y,x,b,I,C,M,w,T,D,j,A,P,k,S,E,O){"use strict";d=d&&d.hasOwnProperty("default")?d["default"]:d,s=s&&s.hasOwnProperty("default")?s["default"]:s,a=a&&a.hasOwnProperty("default")?a["default"]:a,v=v&&v.hasOwnProperty("default")?v["default"]:v,o=o&&o.hasOwnProperty("default")?o["default"]:o,c=c&&c.hasOwnProperty("default")?c["default"]:c,l=l&&l.hasOwnProperty("default")?l["default"]:l,u=u&&u.hasOwnProperty("default")?u["default"]:u,m=m&&m.hasOwnProperty("default")?m["default"]:m,p=p&&p.hasOwnProperty("default")?p["default"]:p,f=f&&f.hasOwnProperty("default")?f["default"]:f,g=g&&g.hasOwnProperty("default")?g["default"]:g,y=y&&y.hasOwnProperty("default")?y["default"]:y,x=x&&x.hasOwnProperty("default")?x["default"]:x,b=b&&b.hasOwnProperty("default")?b["default"]:b,I=I&&I.hasOwnProperty("default")?I["default"]:I,C=C&&C.hasOwnProperty("default")?C["default"]:C,M=M&&M.hasOwnProperty("default")?M["default"]:M,w=w&&w.hasOwnProperty("default")?w["default"]:w,T=T&&T.hasOwnProperty("default")?T["default"]:T,D=D&&D.hasOwnProperty("default")?D["default"]:D,j=j&&j.hasOwnProperty("default")?j["default"]:j,A=A&&A.hasOwnProperty("default")?A["default"]:A,P=P&&P.hasOwnProperty("default")?P["default"]:P,k=k&&k.hasOwnProperty("default")?k["default"]:k,S=S&&S.hasOwnProperty("default")?S["default"]:S,E=E&&E.hasOwnProperty("default")?E["default"]:E,O=O&&O.hasOwnProperty("default")?O["default"]:O;var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var q=function(){return q=Object.assign||function q(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},q.apply(this,arguments)};function L(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function H(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=o.next()).done;)s.push(i.value)}catch(d){n={error:d}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(n)throw n.error}}return s}function F(e){return this instanceof F?(this.v=e,this):new F(e)}var z=Object.freeze({__extends:function(e,t){function r(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},get __assign(){return q},__rest:function(e,t){var r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r},__decorate:function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var d=e.length-1;0<=d;d--)(n=e[d])&&(s=(o<3?n(s):3<o?n(t,r,s):n(t,r))||s);return 3<o&&s&&Object.defineProperty(t,r,s),s},__param:function(r,i){return function(e,t){i(e,t,r)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(e,t,d,a){return new(d=d||Promise)(function(r,i){function n(e){try{s(a.next(e))}catch(t){i(t)}}function o(e){try{s(a["throw"](e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof d?t:new d(function(e){e(t)})).then(n,o)}s((a=a.apply(e,t||[])).next())})},__generator:function(r,i){var n,o,s,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),"throw":t(1),"return":t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;d;)try{if(n=1,o&&(s=2&e[0]?o["return"]:e[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return d.label++,{value:e[1],done:!1};case 5:d.label++,o=e[1],e=[0];continue;case 7:e=d.ops.pop(),d.trys.pop();continue;default:if(!(s=0<(s=d.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){d=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){d.label=e[1];break}if(6===e[0]&&d.label<s[1]){d.label=s[1],s=e;break}if(s&&d.label<s[2]){d.label=s[2],d.ops.push(e);break}s[2]&&d.ops.pop(),d.trys.pop();continue}e=i.call(r,d)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}},__createBinding:function(e,t,r,i){i===undefined&&(i=r),e[i]=t[r]},__exportStar:function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},__values:L,__read:H,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(H(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),n=0,t=0;t<r;t++)for(var o=arguments[t],s=0,d=o.length;s<d;s++,n++)i[n]=o[s];return i},__await:F,__asyncGenerator:function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o=[],s={};return i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(i){n[i]&&(s[i]=function(r){return new Promise(function(e,t){1<o.push([i,r,e,t])||d(i,r)})})}function d(e,t){try{(r=n[e](t)).value instanceof F?Promise.resolve(r.value.v).then(a,c):h(o[0][2],r)}catch(i){h(o[0][3],i)}var r}function a(e){d("next",e)}function c(e){d("throw",e)}function h(e,t){e(t),o.shift(),o.length&&d(o[0][0],o[0][1])}},__asyncDelegator:function(i){var n,e={};return t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,r){e[t]=i[t]?function(e){return(n=!n)?{value:F(i[t](e)),done:"return"===t}:r?r(e):e}:r}},__asyncValues:function(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=a[Symbol.asyncIterator];return t?t.call(a):(a=L(a),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(d){e[d]=a[d]&&function(s){return new Promise(function(e,t){var r,i,n,o;s=a[d](s),r=e,i=t,n=s.done,o=s.value,Promise.resolve(o).then(function(e){r({value:e,done:n})},i)})}}},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t},__importDefault:function(e){return e&&e.__esModule?e:{"default":e}},__classPrivateFieldGet:function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet:function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}}),B=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=d,i=v,n=(o.prototype.initialStorage=function(){var t=this;this.cartID=this.getCartId(),this.cartID&&this.net.get("/cart?cartId="+this.cartID).pipe(a.tap(function(e){"ORDER"==e.state&&s.throwError(new Error("Cart in order state"))})).subscribe(function(e){return t.cart.next(e.cart)},function(e){return t.removeCartId()})},o.prototype.getCartId=function(){return localStorage.getItem("cartID")},o.prototype.addDishToCart=function(e){var t=this;this.messages.length?this.messages.forEach(function(e){t.eventer.emitMessageEvent(e)}):this.net.put("/cart/add",e).subscribe(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId},function(e){})},o.prototype.addDishToCart$=function(e){var t=this;return this.messages.length?(this.messages.forEach(function(e){t.eventer.emitMessageEvent(e)}),s.of(null)):this.net.put("/cart/add",e).pipe(a.tap(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId}))},o.prototype.setDishCountToCart=function(e,t){var r=this;this.net.post("/cart/set",{dishId:e,cartId:this.cartID,amount:t}).subscribe(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){})},o.prototype.setDishComment=function(e,t){var r=this;return this.net.post("/cart/setcomment",{dishId:e,cartId:this.cartID,comment:t}).pipe(a.tap(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){r.eventer.emitMessageEvent(new v.EventMessage("error","Ошибка","Не удалось изменить коментарий"))}))},o.prototype.removeDishFromCart$=function(e,t){var r=this;return this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).pipe(a.tap(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId}))},o.prototype.removeDishFromCart=function(e,t){var r=this;this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).subscribe(function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){})},o.prototype.checkoutCart=function(e){var t={cartId:this.cartID,address:{streetId:e.street.id,home:e.house,housing:e.housing,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:e.phone,name:e.name,mail:e.email||undefined}};return this.orderCart(t)},o.prototype.orderCart=function(e){var t=this;return this.net.post("/order",e).pipe(a.tap(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId},function(e){console.log("Ошибка оформления!",e),e.error&&e.error.cart&&(t.setCartId(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId)}))},o.prototype.checkStreetV2=function(e){var t=this;return this.net.post("/check",e).pipe(a.tap(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId},function(e){console.error(e)}))},o.prototype.checkStreet=function(e){var t=this;this.net.post("/check",e).subscribe(function(e){t.setCartId(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,e.message&&t.eventer.emitMessageEvent(new v.EventMessage(e.message.type,e.message.title,e.message.body))},function(e){e.error&&e.error.cart&&(t.setCartId(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId)})},o.prototype.setCartId=function(e){localStorage.setItem("cartID",e)},o.prototype.removeCartId=function(){localStorage.removeItem("cartID")},o.prototype.userCart=function(){return this.cart},o.prototype.setModifires=function(e,t){this.modifires.next(e),t&&this.modifiresMessage.next(t)},o.prototype.getModifires=function(){return this.modifires},o.decorators=[{type:d.Injectable,args:[{providedIn:"root"}]}],o.ctorParameters=function(){return[{type:v.NetService},{type:v.EventerService}]},o.ngInjectableDef=r.defineInjectable({factory:function(){return new o(r.inject(i.NetService),r.inject(i.EventerService))},token:o,providedIn:"root"}),o);function o(e,t){var r=this;this.net=e,this.eventer=t,this.OrderFormChange=new s.BehaviorSubject(null),this.cart=new s.BehaviorSubject({}),this.modifires=new s.BehaviorSubject([]),this.modifiresMessage=new s.BehaviorSubject([]),this.initialStorage(),this.modifiresMessage.subscribe(function(e){return r.messages=e})}t.NgRestoCartService=n});e.unwrapExports(B);B.NgRestoCartService;var V=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.onClick=function(){this.addDishToCart(this.dish.id,this.amountDish)},i.prototype.addDishToCart=function(e,t){var r=this,i={dishId:e,amount:t,cartId:undefined,modifiers:this.modifires,comment:this.comment};this.cart.cartId&&(i.cartId=this.cart.cartId),this.loading.emit(!0),this.cartService.addDishToCart$(i).subscribe(function(e){return r.success.emit(!0)},function(e){return r.error.emit(e)},function(){r.loading.emit(!1)})},i.decorators=[{type:d.Directive,args:[{selector:"[addToCart]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService}]},i.propDecorators={dish:[{type:d.Input}],amountDish:[{type:d.Input}],comment:[{type:d.Input}],loading:[{type:d.Output}],success:[{type:d.Output}],error:[{type:d.Output}],onClick:[{type:d.HostListener,args:["click"]}]},i);function i(e){var t=this;this.cartService=e,this.loading=new d.EventEmitter,this.success=new d.EventEmitter,this.error=new d.EventEmitter,this.cartService.userCart().subscribe(function(e){return t.cart=e}),this.cartService.getModifires().subscribe(function(e){return t.modifires=e})}t.AddDishToCartDirective=r});e.unwrapExports(V);V.AddDishToCartDirective;var R=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.decorators=[{type:d.Directive,args:[{selector:"[amountCart]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService},{type:d.Renderer2},{type:d.ElementRef}]},i);function i(e,t,r){var i=this;this.cartService=e,this.renderer=t,this.el=r,this.amount="0",this.renderer.setProperty(this.el.nativeElement,"innerHTML",this.amount),this.cartService.userCart().subscribe(function(e){i.cart=e,i.amount=e.dishesCount||0,i.renderer.setProperty(i.el.nativeElement,"innerHTML",i.amount)})}t.AmountCartDirective=r});e.unwrapExports(R);R.AmountCartDirective;var N=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.onClick=function(){this.cartService.removeDishFromCart(this.dish.id,this.amountDish)},i.decorators=[{type:d.Directive,args:[{selector:"[deleteFromCart]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService}]},i.propDecorators={dish:[{type:d.Input}],amountDish:[{type:d.Input}],onClick:[{type:d.HostListener,args:["click"]}]},i);function i(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e})}t.DeleteFromCartDirective=r});e.unwrapExports(N);N.DeleteFromCartDirective;var G=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.onClick=function(){this.order(this.orderCart.value),console.log(this.orderCart.value)},i.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){t.cartService.userCart().subscribe(function(e){t.cart&&t.orderCart.valid&&t.cart.cartTotal!=e.cartTotal&&0<e.cartTotal&&t.checkStreet(t.orderCart.value),t.cart=e})},100),setTimeout(function(){t.checkerFields.next(t.checkForFields(t.orderCart._directives,t.requiredFields))},100),this.checkerFields.subscribe(function(e){e&&(t.orderCart.controls.street.valueChanges.subscribe(function(e){"object"==typeof e&&setTimeout(function(){t.orderCart.controls.house.valid&&(t.orderCart.value.name=t.orderCart.value.name||"Неуказано",t.orderCart.value.phone=t.orderCart.value.phone||"78888888888",t.checkStreet(t.orderCart.value))},100)}),t.orderCart.controls.house.valueChanges.subscribe(function(e){setTimeout(function(){t.orderCart.controls.street.valid&&(t.orderCart.value.name=t.orderCart.value.name||"Неуказано",t.orderCart.value.phone=t.orderCart.value.phone||"78888888888",t.checkStreet(t.orderCart.value))},100)}))})},i.prototype.checkForFields=function(e,t){var r={},i=[];return e.forEach(function(e){r[e.name]=!0}),t.forEach(function(e){r.hasOwnProperty(e)||i.push(e)}),i.length<=0||(console.error("У формы отсутсвуют следующие обязательные для корректной работы модуля поля:",i),!1)},i.prototype.order=function(e){var t,r,i;this.checkForFields(this.orderCart._directives,this.requiredFields)&&(r=void 0,t=e.comment||"Не указан",r=e.cash?"Наличными курьеру":e.bankcard?"Банковской картой курьеру":"Не указан",console.log(e),i={cartId:this.cart.cartId,comment:"\n Тип оплаты:"+r+"\nКоментарий:"+t,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount},this.cartService.orderCart(i).subscribe())},i.prototype.checkStreet=function(e){var t;console.log(">>>>",e),this.checkForFields(this.orderCart._directives,this.requiredFields)&&(t={cartId:this.cart.cartId,comment:e.comment,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount},this.cartService.checkStreet(t))},i.prototype.stringToNumber=function(e){return console.log(typeof e),"string"==typeof e?+e:"number"==typeof e?e:void console.error("Параметр home должен быть или string или number")},i.decorators=[{type:d.Directive,args:[{selector:"[orderCart]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService}]},i.propDecorators={orderCart:[{type:d.Input}],onClick:[{type:d.HostListener,args:["click"]}]},i);function i(e){this.cartService=e,this.requiredFields=["name","phone","street","house"],this.checkerFields=new s.BehaviorSubject(undefined)}t.OrderCartUserDirective=r});e.unwrapExports(G);G.OrderCartUserDirective;var W=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.onClick=function(){this.changeAmount(this.action)},i.prototype.changeAmount=function(e){switch(e){case"+":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount+1);break;case"-":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount-1);break;default:console.log("Директива SetDishAmount получила ложное значение action")}},i.decorators=[{type:d.Directive,args:[{selector:"[setDishAmount]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService}]},i.propDecorators={action:[{type:d.Input}],dish:[{type:d.Input}],onClick:[{type:d.HostListener,args:["click"]}]},i);function i(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e})}t.SetAmountDirective=r});e.unwrapExports(W);W.SetAmountDirective;var Z=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.ngOnInit=function(){var e=this;this.renderer.addClass(this.el.nativeElement,"dish-calculator"),this.amountDish=this.amount,this.amountDishToAdd.emit(this.amountDish),this.price=this.renderer.createElement("div"),this.renderer.addClass(this.price,"dish-price"),setTimeout(function(){e.renderDish(e.dish),e.render(e.dish.modifiers)},100)},i.prototype.renderDish=function(e){var t=this,r=this.renderer.createElement("div");this.renderer.addClass(r,"dish-wraper"),this.renderer.appendChild(this.el.nativeElement,r);var i=this.renderer.createElement("div");this.renderer.addClass(i,"name"),this.renderer.appendChild(r,i);var n=this.renderer.createElement("div");this.renderer.addClass(n,"title"),this.renderer.setProperty(n,"innerHTML",this.dish.name),this.renderer.appendChild(i,n);var o=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"dish"),this.renderer.appendChild(r,o);var s=this.renderer.createElement("div");this.renderer.addClass(s,"value"),this.renderer.setProperty(s,"innerHTML",(1e3*this.dish.weight).toFixed(0)+" г."),0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(s,"zero"),this.renderer.appendChild(o,s),this.renderer.setProperty(this.price,"innerHTML",this.dish.price);var d=this.renderer.createElement("div");this.renderer.addClass(d,"price"),this.renderer.addClass(d,"total"),this.renderer.appendChild(d,this.price),this.renderer.appendChild(r,d);var a=this.renderer.createElement("div");this.renderer.addClass(a,"quantity"),this.renderer.appendChild(r,a);var c=this.renderer.createElement("a");this.renderer.addClass(c,"quantity__button"),this.renderer.addClass(c,"minus"),this.renderer.setProperty(c,"innerHTML","&#8722;"),this.renderer.listen(c,"click",function(e){t.changeAmountdish(-1),t.renderer.setProperty(h,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(m)}),this.renderer.appendChild(a,c);var h=this.renderer.createElement("span");this.renderer.addClass(h,"quantity__counter"),this.renderer.setProperty(h,"innerHTML",this.amountDish),this.renderer.appendChild(a,h);var l=this.renderer.createElement("a");this.renderer.addClass(l,"quantity__button"),this.renderer.addClass(c,"plus"),this.renderer.setProperty(l,"innerHTML","&#x2b;"),this.renderer.listen(l,"click",function(e){t.changeAmountdish(1),t.renderer.setProperty(h,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(m)}),this.renderer.appendChild(a,l);var u=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"total"),this.renderer.appendChild(r,u);var m=this.renderer.createElement("div");0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(m,"zero"),this.renderer.addClass(m,"value"),this.innerTotalWeight(m),this.renderer.appendChild(u,m),this.weightTotal=m,this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(e.price));var p=this.renderer.createElement("div");this.renderer.addClass(p,"price"),this.renderer.addClass(p,"total"),this.renderer.appendChild(p,this.price),this.renderer.appendChild(r,p)},i.prototype.generatePrice=function(e,t,r){var i=this,n=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(r){i.dish.modifiers.forEach(function(e){var t=e.childModifiers.filter(function(e){return e.modifierId===r.id});0<t.length&&(t[0].groupId=e.group.id,n.push(t[0]))})});var o=0;return n.forEach(function(e){o+=e.dish.price*i.amountModifires[e.groupId][e.modifierId]}),o*=this.amountDish,e*this.amountDish+o+'<div class="currency">&nbsp;&#x20bd;</div>'},i.prototype.generateTotalWeight=function(){var t=this,i=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(r){t.dish.modifiers.forEach(function(e){var t=e.childModifiers.filter(function(e){return e.modifierId===r.id});0<t.length&&(t[0].groupId=e.group.id,i.push(t[0]))})});var r=0;return i.forEach(function(e){r+=e.dish.weight*t.amountModifires[e.groupId][e.modifierId]*1e3}),r=parseFloat((r*this.amountDish).toFixed(2)),console.log(r,1e3*this.dish.weight*this.amountDish),console.log(this.dish.weight,this.amountDish),(1e3*this.dish.weight*this.amountDish+r).toFixed(0)+" г. <div class='separator'></div>"},i.prototype.innerTotalWeight=function(e){this.renderer.setProperty(e,"innerHTML",this.generateTotalWeight())},i.prototype.changeAmountdish=function(e){this.amountDish=this.amountDish+e,this.amountDish<=0&&(this.amountDish=1),199<=this.amountDish&&(this.amountDish=199),this.amountDishToAdd.emit(this.amountDish)},i.prototype.render=function(e){var t,n=this;this.setModifires(),0<e.length&&(t=this.renderer.createElement("h5"),this.renderer.setProperty(t,"innerHTML","К этому блюду можно добавить:")),e.forEach(function(r){var e,i;n.stateModifiers[r.modifierId]={},n.amountModifires[r.modifierId]={},r.dish?(e=n.groupDiv("Одночные модификаторы не поддерживаются"),n.renderer.appendChild(n.el.nativeElement,e),console.log("elementGroup",r)):r.childModifiers&&(i=n.groupDiv(r.group?r.group.name:"Ошибка"),n.renderer.appendChild(n.el.nativeElement,i),r.childModifiers.forEach(function(e){var t=n.modifireDiv(e,r.modifierId);n.renderer.appendChild(i,t),e.defaultAmount<1?n.stateModifiers[r.modifierId][e.modifierId]=!1:n.stateModifiers[r.modifierId][e.modifierId]=!0}))}),0<e.length&&(t=this.renderer.createElement("div"),this.renderer.setProperty(t,"innerHTML","<p>* — Количество добавленых опций блюда применяется для каждой порции</p>"),this.renderer.appendChild(this.el.nativeElement,t))},i.prototype.groupDiv=function(e){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"group-modifires-wraper"),this.renderer.appendChild(t,this.renderer.createText(""+e)),t},i.prototype.modifireDiv=function(e,t){var r=this.renderer.createElement("div");return this.renderer.addClass(r,"additional-item"),this.renderOneModifire(e,r,t),r},i.prototype.renderOneModifire=function(e,t,r){console.info("renderOneModifire",e),console.info("renderOneModifire selectedModifiers",this.selectedModifiers);var i=this.renderer.createElement("div");this.renderer.addClass(i,"item-name");var n=this.renderer.createElement("label");this.renderer.setAttribute(n,"for",e.modifierId),this.renderer.appendChild(i,n),this.renderer.setProperty(n,"innerHTML",e.dish.name),this.renderer.appendChild(t,i);var o=this.renderer.createElement("div");this.renderer.addClass(o,"left-weight-modifire-wraper");var s=this.renderer.createElement("div");this.renderer.addClass(s,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(s,"zero"),this.renderer.setProperty(s,"innerHTML",(1e3*e.dish.weight).toFixed(0)+" г."),this.renderer.appendChild(o,s),this.renderer.appendChild(t,o);var d=this.renderer.createElement("div"),a=e.minAmount,c=e.maxAmount,h=e.defaultAmount;switch(console.info("min max def",a,c,h),!0){case 0===a&&0===c&&0===h:case 0===a&&1===c&&0===h:this.renderCheckbox(e,!1,d,t,r);break;case 0===a&&1===c&&1===h:this.renderCheckbox(e,!0,d,t,r);break;case 1===a&&1===c&&1===h:console.error(e.dish.name,"Значение не поддается настройке:",a,c,h);break;case a<=c&&a<=h&&h<=c&&1<c:this.renderInputButton(e,r,d,t);break;default:console.error(e.dish.name,"Ошибка рендера модификатора, для значений:",a,c,h)}0<e.maxAmount&&e.minAmount;var l=this.renderer.createElement("div");this.renderer.addClass(l,"right-weight-modifire-wraper");var u=this.renderer.createElement("div");this.renderer.addClass(u,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(u,"zero"),this.renderer.setProperty(u,"innerHTML",(1e3*e.dish.weight).toFixed(0)+' г.<div class="separator"></div>'),this.renderer.appendChild(l,u),this.renderer.appendChild(t,l);var m,p=this.renderer.createElement("div");this.renderer.addClass(p,"item-price"),0<e.dish.price?(m=e.dish.price+"<div class = 'currency'>&nbsp;&#x20bd;</div>",this.renderer.setProperty(p,"innerHTML",m),this.renderer.appendChild(t,p)):this.renderer.addClass(p,"zero-price"),this.setModifires(),this.innerTotalWeight(this.weightTotal),this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(this.dish.price))},i.prototype.renderCheckbox=function(e,t,r,i,n){var o=this,s=this.renderer.createElement("input");this.renderer.setAttribute(s,"type","checkbox"),this.renderer.setAttribute(s,"id",e.modifierId),t?(this.renderer.setProperty(s,"checked",!0),e.checked=!0,this.stateModifiers[n][e.modifierId]=!0,this.amountModifires[n][e.modifierId]=1):(e.checked=!1,this.stateModifiers[n][e.modifierId]=!1,this.amountModifires[n][e.modifierId]=0),this.renderer.addClass(s,"modal-checkbox"),this.renderer.appendChild(r,s),this.renderer.listen(s,"change",function(t){if(o.idRadioBox(n)){for(var e in o.stateModifiers[n])o.stateModifiers[n].hasOwnProperty(e)&&(o.stateModifiers[n][e]=!1);t.target.parentElement.parentElement.parentElement.querySelectorAll("input").forEach(function(e){e.id!=t.target.id&&(e.checked=!1)})}o.stateModifiers[n][t.target.id]=t.target.checked,t.target.checked&&(o.amountModifires[n][t.target.id]=1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))}),this.renderer.appendChild(i,r)},i.prototype.renderInputButton=function(r,i,e,t){var n=this,o=0<r.defaultAmount?r.defaultAmount:r.minAmount;0<o&&(this.stateModifiers[i][r.modifierId]=!0);var s=this.renderer.createElement("a");this.renderer.addClass(s,"quantity__button"),this.renderer.setProperty(s,"innerHTML","&#8722;"),this.renderer.appendChild(e,s),this.renderer.listen(s,"click",function(e){var t=+n.amountModifires[i][r.modifierId];n.amountModifires[i][r.modifierId]=t-1,n.amountModifires[i][r.modifierId]<r.minAmount&&(n.amountModifires[i][r.modifierId]=r.minAmount),n.renderer.setProperty(d,"innerHTML",n.amountModifires[i][r.modifierId]),0===n.amountModifires[i][r.modifierId]&&(n.stateModifiers[i][r.modifierId]=!1),n.setModifires(),n.innerTotalWeight(n.weightTotal),n.renderer.setProperty(n.price,"innerHTML",n.generatePrice(n.dish.price))});var d=this.renderer.createElement("span");this.renderer.addClass(d,"item-quantity__counter"),this.amountModifires[i][r.modifierId]=o,this.renderer.setProperty(d,"innerHTML",this.amountModifires[i][r.modifierId]),this.renderer.appendChild(e,d);var a=this.renderer.createElement("a");this.renderer.addClass(a,"quantity__button"),this.renderer.setProperty(a,"innerHTML","&#x2b;"),this.renderer.appendChild(e,a),this.renderer.appendChild(t,e),this.renderer.listen(a,"click",function(e){var t=+n.amountModifires[i][r.modifierId];n.amountModifires[i][r.modifierId]=1+t,n.amountModifires[i][r.modifierId]>r.maxAmount&&0!=r.maxAmount&&(n.amountModifires[i][r.modifierId]=r.maxAmount),n.renderer.setProperty(d,"innerHTML",n.amountModifires[i][r.modifierId]),0<n.amountModifires[i][r.modifierId]&&(n.stateModifiers[i][r.modifierId]=!0),n.setModifires(),n.innerTotalWeight(n.weightTotal),n.renderer.setProperty(n.price,"innerHTML",n.generatePrice(n.dish.price))})},i.prototype.setModifires=function(){var e,n,o=this,r=[],s=[];for(e in console.info("setModifires modifiersToSelect",r),console.info("setModifires stateModifiers before",this.stateModifiers),console.info("setModifires selectedModifiers before",this.selectedModifiers),this.stateModifiers){var t,i=this;for(t in this.stateModifiers[e])!function(t){(i.stateModifiers[e][t]||r.find(function(e){return e.modifierId==t}))&&s.push({id:t,amount:i.amountModifires[e][t],groupId:e})}(t)}this.selectedModifiers=s,0<this.dish.modifiers.length?(n=[],this.dish.modifiers.forEach(function(e){if(e.required)if(o.stateModifiers[e.modifierId]){var t,r=[],i=o.stateModifiers[e.modifierId];for(t in i)i.hasOwnProperty(t)&&i[t]&&r.push(i[t]);r.length<e.minAmount?(n.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),o.validate.emit(!1),o.cartService.setModifires(s,n)):(o.validate.emit(!0),o.cartService.setModifires(s,[]))}else n.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),o.validate.emit(!1),o.cartService.setModifires(s,n);else o.validate.emit(!0),o.cartService.setModifires(s)})):(this.validate.emit(!0),this.cartService.setModifires(s,[])),console.info("setModifires stateModifiers after",this.stateModifiers),console.info("setModifires selectedModifiers after",this.selectedModifiers)},i.prototype.idRadioBox=function(t){var e=this.dish.modifiers.find(function(e){return e.modifierId===t});return 1===e.minAmount&&1===e.maxAmount},i.prototype.checkMinAmountModifires=function(e,t){},i.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},i.decorators=[{type:d.Directive,args:[{selector:"[dishCalc]"}]}],i.ctorParameters=function(){return[{type:d.Renderer2},{type:d.ElementRef},{type:o.NgRestoCartService}]},i.propDecorators={dish:[{type:d.Input}],amount:[{type:d.Input}],selectedModifiers:[{type:d.Input}],validate:[{type:d.Output}],amountDishToAdd:[{type:d.Output}]},i);function i(e,t,r){this.renderer=e,this.el=t,this.cartService=r,this.validate=new d.EventEmitter,this.amountDishToAdd=new d.EventEmitter,this.amountModifires={},this.stateModifiers={}}t.DishCalcDirective=r});e.unwrapExports(Z);Z.DishCalcDirective;var U=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.onClick=function(){var e,t,r,i=this;this.locationId||(this.streetId||this.street)&&this.home||this.selfService?(e=this.comment||"Не указан",this.paymentMethod,t={cartId:this.cart.cartId,comment:e,customer:{phone:this.preparePhone(this.phone),mail:this.email,name:this.name},personsCount:+this.personsCount},this.paymentMethodId&&(t.paymentMethodId=this.paymentMethodId),this.date&&(t.date=this.date),this.notifyMethodId&&(t.notifyMethodId=this.notifyMethodId),t.selfService=this.selfService,this.bonuses&&(t.bonuses=this.bonuses.map(function(e){return{name:e.name,amount:e.amount}})),this.locationId?t.locationId=this.locationId:t.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},r=this.cart.id,this.cartService.orderCart(t).subscribe(function(e){e.action&&e.action.paymentRedirect?window.location.href=e.action.paymentRedirect:i.success.emit(r)},function(e){return i.error.emit(e)})):this.error.emit("Нужно указать адрес")},i.prototype.ngOnChanges=function(e){this.cartService.OrderFormChange.next(e)},i.prototype.checkStreet=function(){var t=this,e=this.comment||"Не указан",r=(this.paymentMethod,{cartId:this.cart.cartId,comment:e,customer:{phone:this.phone?this.preparePhone(this.phone):null,mail:this.email,name:this.name||null},personsCount:+this.personsCount});r.selfService=this.selfService,this.paymentMethodId&&(r.paymentMethodId=this.paymentMethodId),this.date&&(r.date=this.date),this.notifyMethodId&&(r.notifyMethodId=this.notifyMethodId),this.locationId?r.locationId=this.locationId:r.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},this.isChecking.emit(!0),this.cartService.checkStreetV2(r).subscribe(function(e){return t.isChecking.emit(!1)},function(e){return t.isChecking.emit(!1)})},i.prototype.preparePhone=function(e){return e?(e="+"+e.replace(/[^0-9]/gim,"")).replace("+8","+7"):""},i.decorators=[{type:d.Directive,args:[{selector:"[checkout]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService}]},i.propDecorators={cartTotal:[{type:d.Input}],bonuses:[{type:d.Input}],name:[{type:d.Input}],email:[{type:d.Input}],phone:[{type:d.Input}],delivery:[{type:d.Input}],selfService:[{type:d.Input}],locationId:[{type:d.Input}],street:[{type:d.Input}],streetId:[{type:d.Input}],home:[{type:d.Input}],housing:[{type:d.Input}],apartment:[{type:d.Input}],entrance:[{type:d.Input}],doorphone:[{type:d.Input}],floor:[{type:d.Input}],paymentMethod:[{type:d.Input}],paymentMethodId:[{type:d.Input}],personsCount:[{type:d.Input}],comment:[{type:d.Input}],date:[{type:d.Input}],notifyMethodId:[{type:d.Input}],success:[{type:d.Output}],error:[{type:d.Output}],isChecking:[{type:d.Output}],onClick:[{type:d.HostListener,args:["click"]}]},i);function i(e){var t=this;this.cartService=e,this.success=new d.EventEmitter,this.error=new d.EventEmitter,this.isChecking=new d.EventEmitter,this.cartService.userCart().subscribe(function(e){return t.cart=e}),this.cartService.OrderFormChange.pipe(a.filter(function(){if(t.locationId||(t.streetId||t.street)&&t.home||t.selfService)return!0}),a.debounceTime(1e3)).subscribe(function(){return t.checkStreet()})}t.CheckoutDirective=r});e.unwrapExports(U);U.CheckoutDirective;var $=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.onClick=function(){this.setComment()},i.prototype.setComment=function(){var t=this;this.cartService.setDishComment(this.dish.id,this.comment).subscribe(function(e){return t.success.emit(!0)},function(e){return t.error.emit(e)})},i.decorators=[{type:d.Directive,args:[{selector:"[setDishComment]"}]}],i.ctorParameters=function(){return[{type:o.NgRestoCartService}]},i.propDecorators={comment:[{type:d.Input}],dish:[{type:d.Input}],success:[{type:d.Output}],error:[{type:d.Output}],onClick:[{type:d.HostListener,args:["click"]}]},i);function i(e){this.cartService=e,this.success=new d.EventEmitter,this.error=new d.EventEmitter}t.SetDishCommentDirective=r});e.unwrapExports($);$.SetDishCommentDirective;var J=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.ngOnInit=function(){this.checkValid()},i.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},i.prototype.ngOnChanges=function(){var e,t,r,i;if(this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.dish&&this.dish.modifiers){try{for(var n=z.__values(this.dish.modifiers),o=n.next();!o.done;o=n.next()){var s=o.value,d=null;switch(this.modifiers.indexById[s.modifierId]=s,this.modifiers.custom.fixed||this.modifiers.baseList.length||!s.childModifiers||2!=s.childModifiers.length||s.maxAmount!=s.maxAmount||1!=s.maxAmount?s.group&&s.childModifiers&&s.childModifiers.length&&s.childModifiers.find(function(e){return e.dish})?(d="group",this.modifiers.baseList.push(s),console.info("Group modifier:",s)):s.dish?(d="single",this.modifiers.baseList.push(s),console.info("Single modifier:",s)):(d="broken",console.warn("Broken modifier:",s)):(d="custom",this.modifiers.custom.fixed=s,console.info("Custom Fixed modifier:",s)),d){case"group":case"custom":this.modifiersValueTree[s.modifierId]={};try{for(var a=z.__values(s.childModifiers),c=a.next();!c.done;c=a.next()){var h=c.value;this.modifiers.indexById[h.modifierId]=h,this.modifiersValueTree[s.modifierId][h.modifierId]=h.defaultAmount}}catch(l){r={error:l}}finally{try{c&&!c.done&&(i=a["return"])&&i.call(a)}finally{if(r)throw r.error}}this.calculateTotalAmountInGroup(s.modifierId);break;case"single":this.modifiersValueTree.single||(this.modifiersValueTree.single={}),this.modifiers.indexById[s.modifierId]=s,this.modifiersValueTree.single[s.modifierId]=s.defaultAmount}this.checkImagesInModifier(s.modifierId)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.calculateTotalPrice()}console.log("this.modifiers.indexById",this.modifiers.indexById)},i.prototype.calculateTotalAmountInGroup=function(e){if("single"!=e)return this.modifiers.indexById[e].totalAmount=Object.values(this.modifiersValueTree[e]).reduce(function(e,t){return e+t}),this.modifiers.indexById[e].totalAmount},i.prototype.checkImagesInModifier=function(e){var t=this.modifiers.indexById[e];this.modifiers.indexById[e].imagesIsset=!!(t.dish&&t.dish.images&&t.dish.images.length),this.modifiers.indexById[e].childImagesIsset=!!this.modifiers.indexById[e].childModifiers.find(function(e){return!!(e&&e.dish&&e.dish.images&&e.dish.images.length)})},i.prototype.calculateTotalPrice=function(){var e,t=this.dish.price||0;for(e in this.modifiersValueTree)for(var r in this.modifiersValueTree[e]){var i,n=this.modifiersValueTree[e][r];!n||(i=this.modifiers.indexById[r])&&i.dish&&i.dish.price&&(t+=i.dish.price*n)}this.totalPrice=t,this.setModifiers()},i.prototype.getModifiersIds=function(e){return{groupId:e.dish&&e.dish.groupId?e.dish.groupId:undefined,modifierId:e.modifierId}},i.prototype.selectTwoPartsAssembledModifier=function(e){var t=this.getModifiersIds(e),r=t.groupId,i=void 0===r?"single":r,n=t.modifierId,o=(e.minAmount,e.maxAmount,this.modifiers.indexById[i]||{}),s=o.maxAmount,d=void 0===s?0:s,a=this.modifiersValueTree[i][n],c=a?0:1,h=this.modifiers.indexById[i].totalAmount-a+c;if(d<h)return console.warn("Limit: max "+d+". Current "+h),void this.eventer.emitMessageEvent(new v.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[i].group.name+'" - не более '+d));this.modifiersValueTree[i][n]=c,this.calculateTotalAmountInGroup(i),this.calculateTotalPrice()},i.prototype.changeModifierAmount=function(e,t,r){if(!(t<0)){var i=this.getModifiersIds(e),n=i.groupId,o=void 0===n?"single":n,s=i.modifierId,d=e.minAmount,a=e.maxAmount,c=this.modifiers.indexById[o]||{},h=c.minAmount,l=void 0===h?0:h,u=c.maxAmount,m=void 0===u?0:u,p=this.modifiersValueTree[o][s];if("checkbox"==r&&"single"!==o){if(l<=1&&1==m){if(t<l)return;for(var f in this.modifiersValueTree[o])this.modifiersValueTree[o][f]=0;this.calculateTotalAmountInGroup(o)}if(0==t)return void this.calculateTotalPrice()}if(l||m){var g=this.modifiers.indexById[o].totalAmount-p+t;if(g<l)return console.warn("Limit: min "+l+". Current "+g),void this.eventer.emitMessageEvent(new v.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[o].group.name+'" - не менее '+l));if(m<g)return console.warn("Limit: max "+m+". Current "+g),void this.eventer.emitMessageEvent(new v.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[o].group.name+'" - не более '+m))}if(d||a){if(t<d)switch(r){case"plus":t=d;break;case"minus":t=0}a<t&&(t=a)}this.modifiersValueTree[o][s]=t,this.calculateTotalAmountInGroup(o),this.calculateTotalPrice()}},i.prototype.setModifiers=function(){var e,t=[];for(e in this.modifiersValueTree)for(var r in this.modifiersValueTree[e]){var i=this.modifiersValueTree[e][r];i&&t.push({id:r,amount:i,groupId:"single"!==e?e:undefined})}t.length&&(this.checkValid(),this.cartService.setModifires(t,[]))},i.prototype.checkValid=function(){var e,t=!0;for(e in this.modifiersValueTree){var r,i=this.modifiers.indexById[e];i.required&&((r=this.calculateTotalAmountInGroup(e))<i.minAmount&&(t=!1,console.warn("Modifier "+e+" min amount: "+i.minAmount)),r>i.maxAmount&&(t=!1,console.warn("Modifier "+e+" max amount: "+i.maxAmount)))}this.validate.emit(t)},i.decorators=[{type:d.Component,args:[{selector:"dish-calc",template:'<div class="ng-cart-dish-calc" *ngIf="dish">\n    <div class="dish">\n        <div class="dish-image-box">\n            <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\n        </div>\n        <div class="dish-description-box">\n            <div class="dish-name">{{ dish.name }}</div>\n            <div class="dish-ingredients">{{ dish.description }}</div>\n            <div class="dish-price-box">\n                <ng-container *ngIf="!modifiers.custom.fixed; else modifierFixedTemplate">\n                    <div class="price" [ngClass]="{\'zero-price\': !dish.price}">\n                        <span>{{ dish.price }}</span> ₽\n                    </div>\n                </ng-container>\n                <ng-template #modifierFixedTemplate>\n                    <ng-container *ngIf="modifiers.custom.fixed as modifier">\n                        <div class="modifier-fixed">\n                            <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                                <div class="item"\n                                     [ngClass]="{selected: !!modifiersValueTree[modifier.modifierId][childModifier.modifierId]}"\n                                     (click)="changeModifierAmount(childModifier, 1, \'checkbox\')">\n                                    {{ childModifier.dish?.name }}\n                                </div>\n                            </ng-container>\n                        </div>\n                        <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                            <ng-container *ngIf="!!modifiersValueTree[modifier.modifierId][childModifier.modifierId]">\n                                <div class="price" [ngClass]="{\'zero-price\': !childModifier.dish?.price}">\n                                    <span>{{ childModifier.dish?.price }}</span> ₽\n                                </div>\n                            </ng-container>\n                        </ng-container>\n                    </ng-container>\n                </ng-template>\n\n            </div>\n        </div>\n    </div>\n    <div class="modifiers" *ngIf="modifiers.baseList?.length">\n        <ng-container *ngFor="let modifier of modifiers.baseList">\n            <div class="modifier-group">\n                <ng-container *ngIf="modifier.dish">\n                    <div class="modifier-header" *ngIf="modifier.group as group">\n                        <div class="modifier-name" *ngIf="group.name">{{ group.name }}</div>\n                        <div class="modifier-description" *ngIf="group.description">{{ group.description }}</div>\n                    </div>\n\n                    <div class="modifier-box" [ngClass]="{\'without-images\': !modifier.childImagesIsset}">\n                        \x3c!-- Single modifier --\x3e\n                        <ng-container *ngTemplateOutlet="modifierTemplate; context: {\n                            modifier: modifier,\n                            groupId: \'single\',\n                            amount: modifiersValueTree[\'single\'][modifier.modifierId],\n                            groupAmount: modifiersValueTree[\'single\'][modifier.modifierId],\n                            groupMinAmount: modifier.minAmount || 0,\n                            groupMaxAmount: modifier.maxAmount || 100\n                        }"></ng-container>\n                    </div>\n                </ng-container>\n\n                <ng-container *ngIf="modifier.childModifiers?.length">\n                    <ng-container *ngIf="modifier.minAmount == 2 && modifier.maxAmount == 2; then twoPartsAssembledTemplate else groupTemplate">\n                    </ng-container>\n\n                    \x3c!-- Base group modifier view --\x3e\n                    <ng-template #groupTemplate>\n                        <div class="modifier-header" *ngIf="modifier.group as group">\n                            <div class="modifier-name" *ngIf="group.name">{{ group.name }}</div>\n                            <div class="modifier-description" *ngIf="group.description">{{ group.description }}</div>\n                        </div>\n                        <div class="modifier-children" [ngClass]="{\'without-images\': !modifier.imagesIsset}">\n                            <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                                \x3c!-- Group modifier --\x3e\n                                <ng-container *ngTemplateOutlet="modifierTemplate; context: {\n                            modifier: childModifier,\n                            groupId: modifier.modifierId,\n                            amount: modifiersValueTree[modifier.modifierId][childModifier.modifierId],\n                            groupAmount: modifiers.indexById[modifier.modifierId].totalAmount,\n                            groupMinAmount: modifier.minAmount || 0,\n                            groupMaxAmount: modifier.maxAmount || 100\n                        }"></ng-container>\n\n                            </ng-container>\n                        </div>\n                    </ng-template>\n\n                    \x3c!-- Two parts assembled group modifier view (like pizza from two halves) --\x3e\n                    <ng-template #twoPartsAssembledTemplate>\n                        <div class="two-parts-assembled">\n                            <div class="two-parts-assembled-header">\n                                <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                                    <ng-container *ngIf="modifiersValueTree[modifier.modifierId][childModifier.modifierId]">\n                                        <ng-container *ngIf="childModifier.dish as dish">\n                                            <div class="selected-dish">\n                                                <div class="title">{{ dish.name }}</div>\n                                                <div class="image-box">\n                                                    <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\n                                                </div>\n                                            </div>\n                                        </ng-container>\n                                        <ng-container *ngIf="modifiers.indexById[modifier.modifierId].totalAmount == 1">\n                                            <div class="selected-dish">\n                                                <div class="title">Выберите половину</div>\n                                                <div class="image-box">\n                                                    <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: {} }"></ng-container>\n                                                </div>\n                                            </div>\n                                        </ng-container>\n                                    </ng-container>\n                                </ng-container>\n                            </div>\n\n                            <div class="two-parts-assembled-body">\n                                <div class="two-parts-assembled-body-name">Выберите любые две половинки</div>\n                                <div class="two-parts-assembled-body-list">\n                                    <ng-container *ngFor="let childModifier of modifier.childModifiers">\n                                        <div class="two-parts-assembled-body-list-dish"\n                                             (click)="selectTwoPartsAssembledModifier(childModifier)"\n                                             [ngClass]="{selected: modifiersValueTree[modifier.modifierId][childModifier.modifierId]}"\n                                             *ngIf="childModifier.dish as dish">\n                                            <div class="image-box">\n                                                <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\n                                            </div>\n                                            <div class="dish-name">\n                                                {{ dish.name }}\n                                            </div>\n                                            <div class="dish-price">\n                                                <div [ngClass]="{\'zero-price\': !dish.price}">\n                                                    <span>{{ dish.price }}</span> ₽\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </ng-container>\n                                </div>\n                            </div>\n                        </div>\n                    </ng-template>\n\n\n                </ng-container>\n\n            </div>\n        </ng-container>\n    </div>\n    <div class="result">\n        <span class="text">ИТОГО:</span>\n        <span class="price">\n            <span>{{ totalPrice}}</span> ₽\n        </span>\n    </div>\n</div>\n\n\n\n\x3c!-- Template block #dishImageTemplate --\x3e\n\n<ng-template #dishImageTemplate let-dish="dish">\n    <ng-container *ngIf="dish?.images && dish.images[0]?.images?.small; else imgPlaceholder">\n        <div class="dish-image" [style.backgroundImage]="\'url(\' + imageUrl + dish.images[0].images.small + \')\'"></div>\n    </ng-container>\n    <ng-template #imgPlaceholder>\n        <div class="dish-image-placeholder"></div>\n    </ng-template>\n</ng-template>\n\n\x3c!-- Template block #modifierTemplate --\x3e\n\n<ng-template #modifierTemplate\n             let-modifier="modifier"\n             let-groupId="groupId"\n             let-amount="amount"\n             let-groupAmount="groupAmount"\n             let-groupMinAmount="groupMinAmount"\n             let-groupMaxAmount="groupMaxAmount">\n    <ng-container *ngIf="modifier.dish as dish">\n        <div class="modifier-dish">\n            <div class="modifier-dish-image-box">\n                <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\n            </div>\n            <div class="modifier-dish-description-box">\n                <div class="modifier-dish-name">{{ dish.name }}</div>\n                <div class="modifier-dish-weight" *ngIf="dish.weight">{{ dish.weight * 1000 }} гр</div>\n            </div>\n            <div class="modifier-dish-price-box">\n                <div [ngClass]="{\'zero-price\': !dish.price}">\n                    <span>{{ dish.price }}</span> ₽\n                </div>\n            </div>\n            <div class="modifier-dish-action-box">\n                <ng-container *ngIf="groupMinAmount <= 1 && groupMaxAmount == 1; else counterTemplate">\n                    <ng-container *ngTemplateOutlet="modifierCheckboxTemplate; context: {\n                        modifier: modifier,\n                        groupId: groupId,\n                        amount: amount\n                    }"></ng-container>\n                </ng-container>\n\n                <ng-template #counterTemplate>\n                    <ng-container *ngTemplateOutlet="modifierCounterTemplate; context: {\n                        modifier: modifier,\n                        groupId: groupId,\n                        amount: amount,\n                        groupAmount: groupAmount,\n                        groupMinAmount: groupMinAmount,\n                        groupMaxAmount: groupMaxAmount\n                    }"></ng-container>\n                </ng-template>\n\n            </div>\n        </div>\n    </ng-container>\n</ng-template>\n\n\x3c!-- Template block #modifierCounterTemplate --\x3e\n\n<ng-template #modifierCounterTemplate\n             let-modifier="modifier"\n             let-groupId="groupId"\n             let-amount="amount"\n             let-groupAmount="groupAmount"\n             let-groupMinAmount="groupMinAmount"\n             let-groupMaxAmount="groupMaxAmount">\n    <ng-container>\n        <div class="modifier-counter" [ngClass]="{disabled: !amount && groupAmount >= groupMaxAmount}">\n            <div\n                    class="minus"\n                    [ngClass]="{disabled: !amount || groupAmount <= groupMinAmount}"\n                    (click)="changeModifierAmount(modifier, amount - 1, \'minus\')"\n                    onselectstart="return false;">-</div>\n            <input [value]="amount" readonly #input>\n            <div\n                    class="plus"\n                    [ngClass]="{disabled: groupAmount >= groupMaxAmount}"\n                    (click)="changeModifierAmount(modifier, amount + 1, \'plus\')"\n                    onselectstart="return false;">+</div>\n        </div>\n    </ng-container>\n</ng-template>\n\n\x3c!-- Template block #modifierCheckboxTemplate --\x3e\n\n<ng-template #modifierCheckboxTemplate\n             let-modifier="modifier"\n             let-groupId="groupId"\n             let-amount="amount">\n    <ng-container>\n        <div\n                class="modifier-checkbox"\n                [ngClass]="{selected: amount}"\n                (click)="changeModifierAmount(modifier, amount ? 0 : 1, \'checkbox\')"></div>\n    </ng-container>\n</ng-template>\n',styles:['.dish{display:flex;align-items:flex-start;padding-bottom:34px;border-bottom:2px solid #969696}.dish .dish-image-box{position:relative;width:250px;height:170px;box-sizing:border-box;text-align:center;background-color:#eee;background-size:50%}.dish .dish-description-box{margin-left:34px;height:170px;display:flex;flex-direction:column;align-items:stretch;padding:5px 0 0;box-sizing:border-box}.dish .dish-description-box .dish-name{font-weight:700;font-size:28px;line-height:32px;letter-spacing:2.4px;color:#0a0909}.dish .dish-description-box .dish-ingredients{font-size:15px;line-height:17px;color:#000;margin-top:15px;overflow:hidden;flex-grow:1}.dish .dish-description-box .dish-price-box{font-weight:700;font-size:20px;line-height:23px;display:flex;align-items:center;justify-content:space-between;height:45px;margin-right:49px}.dish-image{width:250px;height:100%;border-radius:0;background-size:cover;background-position:top;background-repeat:no-repeat}.result{margin-top:49px;font-weight:700;font-size:24px;line-height:28px;color:#0a0909;text-align:right}.result .price{margin-left:76px}.modifiers .modifier-group{margin-top:25px;padding-bottom:25px;border-bottom:2px solid #969696}.modifiers .modifier-header{margin-bottom:25px}.modifiers .modifier-header .modifier-name{font-weight:500;font-size:20px;line-height:23px;color:#0a0909}.modifiers .modifier-header .modifier-description{font-size:15px;line-height:17px;color:#0a0909}.modifiers .modifier-dish{display:flex;justify-content:center;align-items:center;margin-bottom:2px;height:100px;box-sizing:border-box}.modifiers .modifier-dish .modifier-dish-image-box{position:relative;width:100px;height:100px;box-sizing:border-box;text-align:center;background-color:#fff;background-size:50%;margin-right:28px}.modifiers .modifier-dish .modifier-dish-image-box .dish-image{width:100%;height:100%;background-size:contain;background-position:center}.modifiers .modifier-dish .modifier-dish-description-box{flex-grow:1;display:flex;flex-direction:column;justify-content:center}.modifiers .modifier-dish .modifier-dish-description-box .modifier-dish-name{font-weight:500;font-size:20px;line-height:23px;color:#0a0909}.modifiers .modifier-dish .modifier-dish-description-box .modifier-dish-weight{font-size:20px;line-height:23px;color:#0a0909;margin-top:10px}.modifiers .modifier-dish .modifier-dish-price-box{font-weight:700;font-size:20px;line-height:23px;color:#0a0909;margin-right:105px}.modifiers .modifier-dish .modifier-dish-price-box .zero-price{display:none}.modifiers .modifier-dish .modifier-dish-action-box{width:151px;display:flex;justify-content:center}.two-parts-assembled .two-parts-assembled-header{display:flex;align-items:center;justify-content:center}.two-parts-assembled .two-parts-assembled-header .selected-dish{display:flex;align-items:center;justify-content:flex-end;width:50%}.two-parts-assembled .two-parts-assembled-header .selected-dish:nth-child(2){flex-direction:row-reverse}.two-parts-assembled .two-parts-assembled-header .selected-dish:nth-child(2) .image-box{direction:rtl}.two-parts-assembled .two-parts-assembled-header .selected-dish .image-box{width:100px;height:200px;overflow:hidden}.two-parts-assembled .two-parts-assembled-header .selected-dish .image-box .dish-image{width:200%;height:100%}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list{display:grid;grid-template-columns:1fr 1fr 1fr;margin-top:30px;grid-column-gap:30px;grid-row-gap:30px;border:1px solid rgba(255,255,255,0)}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish{display:flex;flex-direction:column;align-items:center;box-sizing:border-box;cursor:pointer}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish.selected{border:1px solid #000;border-radius:15px}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish .image-box{width:200px;height:200px}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish .image-box .dish-image{width:100%;height:100%}.modifier-fixed{border:2px solid #767676;box-sizing:border-box;border-radius:15px;display:flex;align-items:stretch;height:45px}.modifier-fixed .item{font-weight:500;font-size:20px;line-height:23px;width:142px;height:45px;color:#767676;display:flex;align-items:center;justify-content:center;margin-top:-2px}.modifier-fixed .item:first-child{margin-left:-2px}.modifier-fixed .item:last-child{margin-right:-2px}.modifier-fixed .item.selected{background:#0a0909;border-radius:15px;color:#fff}.modifier-fixed .item:not(.selected){cursor:pointer}.modifier-checkbox{width:50px;height:50px;background:#e0e0e0;border-radius:15px;cursor:pointer;display:flex;justify-content:center;align-items:center}.modifier-checkbox.selected:after{content:url("data:image/svg+xml; base64, PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMTMuNUwxMS4zMjMxIDI2TDI2IDIiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMy41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cg==")}.modifier-counter{display:flex;align-items:center;position:relative;border:none;width:151px;height:50px;border-radius:15px;background:#e0e0e0}.modifier-counter.disabled{opacity:.3}.modifier-counter:not(.disabled) .minus.disabled,.modifier-counter:not(.disabled) .plus.disabled{opacity:.15;cursor:default}.modifier-counter input{border:none;background:0 0;width:100%;padding:0;height:50px;line-height:50px;text-align:center;font-weight:500;font-size:18px;color:#0a0909}.modifier-counter .minus,.modifier-counter .plus{display:block;position:absolute;top:0;height:50px;line-height:50px;text-align:center;font-style:normal;font-weight:700;font-size:18px;color:#0a0909;padding:0 30px;cursor:pointer}.modifier-counter .minus:hover,.modifier-counter .plus:hover{color:#000}.modifier-counter .minus:active,.modifier-counter .plus:active{color:#cc0009}.modifier-counter .minus.loading,.modifier-counter .plus.loading{opacity:.2}.modifier-counter .minus{left:0}.modifier-counter .plus{right:0}.without-images .modifier-dish-image-box{height:70px!important}.without-images .modifier-dish{height:70px}']}]}],i.ctorParameters=function(){return[{type:c.NgRestoCartService},{type:v.EventerService},{type:String,decorators:[{type:d.Inject,args:["ImageUrl"]}]}]},i.propDecorators={dish:[{type:d.Input}],amount:[{type:d.Input}],selectedModifiers:[{type:d.Input}],validate:[{type:d.Output}],amountDishToAdd:[{type:d.Output}]},i);function i(e,t,r){this.cartService=e,this.eventer=t,this.validate=new d.EventEmitter,this.amountDishToAdd=new d.EventEmitter,this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.imageUrl=r}t.DishCalcComponent=r});e.unwrapExports(J);J.DishCalcComponent;var K=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=[u.AddDishToCartDirective,m.AmountCartDirective,p.DeleteFromCartDirective,f.OrderCartUserDirective,y.DishCalcDirective,b.SetDishCommentDirective,g.SetAmountDirective,x.CheckoutDirective],i=[I.DishCalcComponent],n=[l.CommonModule],o=(s.decorators=[{type:d.NgModule,args:[{imports:[n],providers:[],declarations:[r,i],exports:[r,i]}]}],s);function s(){}t.NgRestoCartModule=o});e.unwrapExports(K);K.NgRestoCartModule;var Q=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),z.__exportStar(C,t),z.__exportStar(M,t)});e.unwrapExports(Q);var Y=e.createCommonjsModule(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),z.__exportStar(w,t),t.ɵi=T.DishCalcComponent,t.ɵa=D.AddDishToCartDirective,t.ɵb=j.AmountCartDirective,t.ɵh=A.CheckoutDirective,t.ɵc=P.DeleteFromCartDirective,t.ɵe=k.DishCalcDirective,t.ɵd=S.OrderCartUserDirective,t.ɵg=E.SetAmountDirective,t.ɵf=O.SetDishCommentDirective});return e.unwrapExports(Y)});
//# sourceMappingURL=webresto-ng-cart.umd.min.js.map