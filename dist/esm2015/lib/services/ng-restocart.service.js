import { Injectable } from '@angular/core';
import { BehaviorSubject, throwError, from } from 'rxjs';
import { catchError, filter, map, switchMap, tap } from 'rxjs/operators';
import { EventMessage } from '@webresto/ng-core';
import { formatDate } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@webresto/ng-core";
export class NgRestoCartService {
    constructor(net, eventer) {
        this.net = net;
        this.eventer = eventer;
        this.cartID = this.getCartId();
        this.cart = new BehaviorSubject(null);
        this.modifires = new BehaviorSubject([]);
        this.OrderFormChange = new BehaviorSubject(null);
        this.modifiresMessage = new BehaviorSubject([]);
        this.restrictions$ = new BehaviorSubject(null);
        this.restrictionsLoader$ = this.net.get(`/restrictions`).pipe(map(restictions => formatDate(Date.now() + restictions.periodPossibleForOrder * 1000, 'yyyy-MM-dd', 'en'))).subscribe(this.restrictions$);
    }
    getCartId() {
        return localStorage.getItem('cartID');
    }
    getCart() {
        return this.net.get(`/cart${this.cartID ? '?cartId=' + this.cartID : ''}`).pipe(switchMap(data => {
            if (!this.cartID) {
                this.setCartId(data.cart.cartId);
            }
            ;
            if (data.cart.state == 'ORDER') {
                return throwError(new Error('Cart in order state'));
            }
            else {
                this.cart.next(data.cart);
            }
            ;
            return this.cart;
        }), catchError(err => {
            this.removeCartId();
            return throwError(err);
        }));
    }
    addDishToCart(data) {
        if (this.modifiresMessage.value.length) {
            this.modifiresMessage.value.forEach(message => {
                this.eventer.emitMessageEvent(message);
            });
            return;
        }
        this.net.put('/cart/add', data).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Блюдо добавлено в корзину')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось добавить блюдо')
             )*/
        });
    }
    addDishToCart$(data) {
        if (this.modifiresMessage.value.length) {
            this.modifiresMessage.value.forEach(message => {
                this.eventer.emitMessageEvent(message);
            });
            return from([null]);
        }
        return this.net.put('/cart/add', data)
            .pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }));
    }
    setDishCountToCart(dishId, amount) {
        this.net.post('/cart/set', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        }).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Изменено количество')
             );*/
        }, () => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось изменить количество')
             )*/
        });
    }
    setDishComment(dishId, comment) {
        return this.net.post('/cart/setcomment', {
            dishId: dishId,
            cartId: this.cartID,
            comment: comment
        }).pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }, () => {
            this.eventer.emitMessageEvent(new EventMessage('error', 'Ошибка', 'Не удалось изменить коментарий'));
        }));
    }
    removeDishFromCart$(dishId, amount) {
        return this.net.put('/cart/remove', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        })
            .pipe(tap(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
        }));
    }
    removeDishFromCart(dishId, amount) {
        this.net.put('/cart/remove', {
            dishId: dishId,
            cartId: this.cartID,
            amount: amount
        }).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Блюдо успешно удалено')
             );*/
        }, error => {
            /*this.eventer.emitMessageEvent(
             new EventMessage('error', 'Ошибка', 'Не удалось удалить блюдо')
             )*/
        });
    }
    checkoutCart(data) {
        let order = {
            cartId: this.cartID,
            address: {
                streetId: data.street.id,
                home: data.house,
                housing: data.housing,
                // index: "1278",
                entrance: data.entrance,
                floor: data.floor,
                apartment: data.apartment
            },
            customer: {
                phone: data.phone,
                name: data.name,
                mail: data.email || undefined
            }
        };
        return this.orderCart(order);
    }
    orderCart(data) {
        return this.net.post('/order', data)
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
            /*this.eventer.emitMessageEvent(
             new EventMessage('success', 'Успех', 'Заказ упешно оформлен')
             );*/
        }, error => {
            console.log("Ошибка оформления!", error);
            if (error.error && error.error.cart) {
                this.setCartId(error.error.cart.cartId);
                this.cart.next(error.error.cart);
                this.cartID = error.error.cart.cartId;
            }
            /*if (error.message) {
              this.eventer.emitMessageEvent(
                new EventMessage(error.message.type, error.message.title, error.message.body)
              );
            } else {
              this.eventer.emitMessageEvent(
                new EventMessage('error', 'Ошибка', 'Не удалось оформить заказ')
              );
            }*/
        }));
    }
    checkStreetV2(data) {
        return this.net.post('/check', data)
            .pipe(tap(result => {
            this.setCartId(result.cart.cartId);
            this.cart.next(result.cart);
            this.cartID = result.cart.cartId;
            /*if (result.message) {
             this.eventer.emitMessageEvent(
             new EventMessage(
             result.message.type,
             result.message.title,
             result.message.body
             )
             );
             }*/
        }, error => {
            console.error(error);
            //this.eventer.emitMessageEvent(
            //new EventMessage('error', 'Ошибка', 'Не удалось оформить заказ')
            //)
        }));
    }
    checkStreet(data) {
        this.net.post('/check', data).subscribe(res => {
            this.setCartId(res.cart.cartId);
            this.cart.next(res.cart);
            this.cartID = res.cart.cartId;
            if (res.message) {
                this.eventer.emitMessageEvent(new EventMessage(res.message.type, res.message.title, res.message.body));
            }
        }, error => {
            if (error.error) {
                if (error.error.cart) {
                    this.setCartId(error.error.cart.cartId);
                    this.cart.next(error.error.cart);
                    this.cartID = error.error.cart.cartId;
                }
                /*this.eventer.emitMessageEvent(
                 new EventMessage(error.error.message.type, error.error.message.title, error.error.message.body)
                 );*/
            }
        });
    }
    setCartId(cartID) {
        localStorage.setItem('cartID', cartID);
    }
    removeCartId() {
        localStorage.removeItem('cartID');
    }
    userCart() {
        return this.cart;
    }
    setModifires(modifires, messages) {
        this.modifires.next(modifires);
        if (messages) {
            this.modifiresMessage.next(messages);
        }
        ;
    }
    getModifires() {
        return this.modifires.pipe();
    }
    productInCart(product) {
        return this.cart.pipe(filter(cart => 'cartId' in cart), map(cart => {
            var _a;
            return !!(cart && ((_a = cart === null || cart === void 0 ? void 0 : cart.dishes) === null || _a === void 0 ? void 0 : _a.find(dishInCart => dishInCart.dish.id === product.id)));
        }));
    }
    getPickupPoints() {
        return this.net.get('/pickupaddreses?cartId=string');
    }
    getPaymentMethods() {
        return this.net.get('/paymentmethods');
    }
}
NgRestoCartService.ɵfac = function NgRestoCartService_Factory(t) { return new (t || NgRestoCartService)(i0.ɵɵinject(i1.NetService), i0.ɵɵinject(i1.EventerService)); };
NgRestoCartService.ɵprov = i0.ɵɵdefineInjectable({ token: NgRestoCartService, factory: NgRestoCartService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(NgRestoCartService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.NetService }, { type: i1.EventerService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctcmVzdG9jYXJ0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiQzovVXNlcnMvbGFyY2hlbmtvdi9mcm9udGVuZC9wcm9qZWN0cy93ZWJyZXN0by9uZy1jYXJ0L3NyYy8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9uZy1yZXN0b2NhcnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxlQUFlLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFHTCxZQUFZLEVBQ2IsTUFBTSxtQkFBbUIsQ0FBQztBQUMzQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0saUJBQWlCLENBQUM7OztBQU03QyxNQUFNLE9BQU8sa0JBQWtCO0lBUzdCLFlBQW9CLEdBQWUsRUFBVSxPQUF1QjtRQUFoRCxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUFScEUsV0FBTSxHQUFXLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNsQyxTQUFJLEdBQTBCLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXhELGNBQVMsR0FBeUIsSUFBSSxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUQsb0JBQWUsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QyxxQkFBZ0IsR0FBb0MsSUFBSSxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7UUFJNUUsa0JBQWEsR0FBRyxJQUFJLGVBQWUsQ0FBUyxJQUFJLENBQUMsQ0FBQztRQUVsRCx3QkFBbUIsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxlQUFl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QUFDLENBQUMsQ0FBQTtRQUN4RixDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVELGVBQWU7UUFDYixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFRCxpQkFBaUI7UUFDZixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFrQixpQkFBaUIsQ0FBQyxDQUFDO0lBQzFELENBQUM7O29GQTVUVSxrQkFBa0I7MERBQWxCLGtCQUFrQixXQUFsQixrQkFBa0IsbUJBRmpCLE1BQU07a0RBRVAsa0JBQWtCO2NBSDlCLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgQmVoYXZpb3JTdWJqZWN0LCB0aHJvd0Vycm9yLCBmcm9tIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGNhdGNoRXJyb3IsIGZpbHRlciwgbWFwLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHtcclxuICBOZXRTZXJ2aWNlLFxyXG4gIEV2ZW50ZXJTZXJ2aWNlLFxyXG4gIEV2ZW50TWVzc2FnZVxyXG59IGZyb20gJ0B3ZWJyZXN0by9uZy1jb3JlJztcclxuaW1wb3J0IHsgZm9ybWF0RGF0ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcblxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTmdSZXN0b0NhcnRTZXJ2aWNlIHtcclxuICBjYXJ0SUQ6IHN0cmluZyA9IHRoaXMuZ2V0Q2FydElkKCk7XHJcbiAgY2FydDogQmVoYXZpb3JTdWJqZWN0PENhcnQ+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcclxuXHJcbiAgbW9kaWZpcmVzOiBCZWhhdmlvclN1YmplY3Q8YW55PiA9IG5ldyBCZWhhdmlvclN1YmplY3QoW10pO1xyXG4gIE9yZGVyRm9ybUNoYW5nZSA9IG5ldyBCZWhhdmlvclN1YmplY3QobnVsbCk7XHJcblxyXG4gIG1vZGlmaXJlc01lc3NhZ2U6IEJlaGF2aW9yU3ViamVjdDxFdmVudE1lc3NhZ2VbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KFtdKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBuZXQ6IE5ldFNlcnZpY2UsIHByaXZhdGUgZXZlbnRlcjogRXZlbnRlclNlcnZpY2UpIHsgfVxyXG5cclxuICByZXN0cmljdGlvbnMkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KG51bGwpO1xyXG5cclxuICByZXN0cmljdGlvbnNMb2FkZXIkID0gdGhpcy5uZXQuZ2V0KGAvcmVzdHJpY3Rpb25zYCkucGlwZShcclxuICAgIG1hcChyZXN0aWN0aW9ucyA9PiBmb3JtYXREYXRlKERhdGUubm93KCkgKyByZXN0aWN0aW9ucy5wZXJpb2RQb3NzaWJsZUZvck9yZGVyICogMTAwMCwgJ3l5eXktTU0tZGQnLCAnZW4nKSlcclxuICApLnN1YnNjcmliZSh0aGlzLnJlc3RyaWN0aW9ucyQpXHJcblxyXG4gIGdldENhcnRJZCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYXJ0SUQnKTtcclxuICB9XHJcblxyXG4gIGdldENhcnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQuZ2V0PHtjYXJ0OkNhcnR9PihgL2NhcnQke3RoaXMuY2FydElEPyc/Y2FydElkPScrdGhpcy5jYXJ0SUQgOiAnJ31gKS5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgZGF0YSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXRoaXMuY2FydElEKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKGRhdGEuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGlmIChkYXRhLmNhcnQuc3RhdGUgPT0gJ09SREVSJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihuZXcgRXJyb3IoJ0NhcnQgaW4gb3JkZXIgc3RhdGUnKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNhcnQubmV4dChkYXRhLmNhcnQpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmNhcnQ7XHJcbiAgICAgICAgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoZXJyID0+IHtcclxuICAgICAgICB0aGlzLnJlbW92ZUNhcnRJZCgpO1xyXG4gICAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVycik7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYWRkRGlzaFRvQ2FydChkYXRhKSB7XHJcblxyXG4gICAgaWYgKHRoaXMubW9kaWZpcmVzTWVzc2FnZS52YWx1ZS5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5tb2RpZmlyZXNNZXNzYWdlLnZhbHVlLmZvckVhY2gobWVzc2FnZSA9PiB7XHJcbiAgICAgICAgdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQobWVzc2FnZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5uZXQucHV0KCcvY2FydC9hZGQnLCBkYXRhKS5zdWJzY3JpYmUoXHJcbiAgICAgIHJlcyA9PiB7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzLmNhcnQpO1xyXG4gICAgICAgIHRoaXMuY2FydElEID0gcmVzLmNhcnQuY2FydElkO1xyXG5cclxuICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdzdWNjZXNzJywgJ9Cj0YHQv9C10YUnLCAn0JHQu9GO0LTQviDQtNC+0LHQsNCy0LvQtdC90L4g0LIg0LrQvtGA0LfQuNC90YMnKVxyXG4gICAgICAgICApOyovXHJcblxyXG4gICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnZXJyb3InLCAn0J7RiNC40LHQutCwJywgJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0LTQvtCx0LDQstC40YLRjCDQsdC70Y7QtNC+JylcclxuICAgICAgICAgKSovXHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkRGlzaFRvQ2FydCQoZGF0YSkge1xyXG4gICAgaWYgKHRoaXMubW9kaWZpcmVzTWVzc2FnZS52YWx1ZS5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5tb2RpZmlyZXNNZXNzYWdlLnZhbHVlLmZvckVhY2gobWVzc2FnZSA9PiB7XHJcbiAgICAgICAgdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQobWVzc2FnZSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZnJvbShbbnVsbF0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLm5ldC5wdXQoJy9jYXJ0L2FkZCcsIGRhdGEpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcChyZXMgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzLmNhcnQuY2FydElkKTtcclxuICAgICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICAgIHRoaXMuY2FydElEID0gcmVzLmNhcnQuY2FydElkO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBzZXREaXNoQ291bnRUb0NhcnQoZGlzaElkLCBhbW91bnQpIHtcclxuICAgIHRoaXMubmV0LnBvc3QoJy9jYXJ0L3NldCcsIHtcclxuICAgICAgZGlzaElkOiBkaXNoSWQsXHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGFtb3VudDogYW1vdW50XHJcbiAgICB9KS5zdWJzY3JpYmUoXHJcbiAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzLmNhcnQuY2FydElkKTtcclxuICAgICAgICB0aGlzLmNhcnQubmV4dChyZXMuY2FydCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXMuY2FydC5jYXJ0SWQ7XHJcblxyXG4gICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAn0KPRgdC/0LXRhScsICfQmNC30LzQtdC90LXQvdC+INC60L7Qu9C40YfQtdGB0YLQstC+JylcclxuICAgICAgICAgKTsqL1xyXG5cclxuXHJcbiAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdlcnJvcicsICfQntGI0LjQsdC60LAnLCAn0J3QtSDRg9C00LDQu9C+0YHRjCDQuNC30LzQtdC90LjRgtGMINC60L7Qu9C40YfQtdGB0YLQstC+JylcclxuICAgICAgICAgKSovXHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzaENvbW1lbnQoZGlzaElkLCBjb21tZW50KSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQucG9zdCgnL2NhcnQvc2V0Y29tbWVudCcsIHtcclxuICAgICAgZGlzaElkOiBkaXNoSWQsXHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGNvbW1lbnQ6IGNvbW1lbnRcclxuICAgIH0pLnBpcGUodGFwKFxyXG4gICAgICByZXMgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzLmNhcnQpO1xyXG4gICAgICAgIHRoaXMuY2FydElEID0gcmVzLmNhcnQuY2FydElkO1xyXG5cclxuICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnZXJyb3InLCAn0J7RiNC40LHQutCwJywgJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0LjQt9C80LXQvdC40YLRjCDQutC+0LzQtdC90YLQsNGA0LjQuScpXHJcbiAgICAgICAgKVxyXG4gICAgICB9XHJcbiAgICApKVxyXG5cclxuICB9XHJcblxyXG4gIHJlbW92ZURpc2hGcm9tQ2FydCQoZGlzaElkLCBhbW91bnQpIHtcclxuICAgIHJldHVybiB0aGlzLm5ldC5wdXQoJy9jYXJ0L3JlbW92ZScsIHtcclxuICAgICAgZGlzaElkOiBkaXNoSWQsXHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGFtb3VudDogYW1vdW50XHJcbiAgICB9KVxyXG4gICAgICAucGlwZSh0YXAocmVzID0+IHtcclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXMuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuICAgICAgfSkpO1xyXG5cclxuICB9XHJcblxyXG4gIHJlbW92ZURpc2hGcm9tQ2FydChkaXNoSWQsIGFtb3VudCkge1xyXG4gICAgdGhpcy5uZXQucHV0KCcvY2FydC9yZW1vdmUnLCB7XHJcbiAgICAgIGRpc2hJZDogZGlzaElkLFxyXG4gICAgICBjYXJ0SWQ6IHRoaXMuY2FydElELFxyXG4gICAgICBhbW91bnQ6IGFtb3VudFxyXG4gICAgfSkuc3Vic2NyaWJlKFxyXG4gICAgICByZXMgPT4ge1xyXG5cclxuICAgICAgICB0aGlzLnNldENhcnRJZChyZXMuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgIHRoaXMuY2FydC5uZXh0KHJlcy5jYXJ0KTtcclxuICAgICAgICB0aGlzLmNhcnRJRCA9IHJlcy5jYXJ0LmNhcnRJZDtcclxuICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdzdWNjZXNzJywgJ9Cj0YHQv9C10YUnLCAn0JHQu9GO0LTQviDRg9GB0L/QtdGI0L3QviDRg9C00LDQu9C10L3QvicpXHJcbiAgICAgICAgICk7Ki9cclxuXHJcbiAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAvKnRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICBuZXcgRXZlbnRNZXNzYWdlKCdlcnJvcicsICfQntGI0LjQsdC60LAnLCAn0J3QtSDRg9C00LDQu9C+0YHRjCDRg9C00LDQu9C40YLRjCDQsdC70Y7QtNC+JylcclxuICAgICAgICAgKSovXHJcbiAgICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGNoZWNrb3V0Q2FydChkYXRhKSB7XHJcbiAgICBsZXQgb3JkZXIgPSB7XHJcbiAgICAgIGNhcnRJZDogdGhpcy5jYXJ0SUQsXHJcbiAgICAgIGFkZHJlc3M6IHtcclxuICAgICAgICBzdHJlZXRJZDogZGF0YS5zdHJlZXQuaWQsXHJcbiAgICAgICAgaG9tZTogZGF0YS5ob3VzZSxcclxuICAgICAgICBob3VzaW5nOiBkYXRhLmhvdXNpbmcsXHJcbiAgICAgICAgLy8gaW5kZXg6IFwiMTI3OFwiLFxyXG4gICAgICAgIGVudHJhbmNlOiBkYXRhLmVudHJhbmNlLFxyXG4gICAgICAgIGZsb29yOiBkYXRhLmZsb29yLFxyXG4gICAgICAgIGFwYXJ0bWVudDogZGF0YS5hcGFydG1lbnRcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGN1c3RvbWVyOiB7XHJcbiAgICAgICAgcGhvbmU6IGRhdGEucGhvbmUsXHJcbiAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgIG1haWw6IGRhdGEuZW1haWwgfHwgdW5kZWZpbmVkXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gdGhpcy5vcmRlckNhcnQob3JkZXIpO1xyXG5cclxuICB9XHJcblxyXG4gIG9yZGVyQ2FydChkYXRhKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQucG9zdCgnL29yZGVyJywgZGF0YSlcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFwKFxyXG4gICAgICAgICAgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDYXJ0SWQocmVzdWx0LmNhcnQuY2FydElkKTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzdWx0LmNhcnQpO1xyXG4gICAgICAgICAgICB0aGlzLmNhcnRJRCA9IHJlc3VsdC5jYXJ0LmNhcnRJZDtcclxuICAgICAgICAgICAgLyp0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAn0KPRgdC/0LXRhScsICfQl9Cw0LrQsNC3INGD0L/QtdGI0L3QviDQvtGE0L7RgNC80LvQtdC9JylcclxuICAgICAgICAgICAgICk7Ki9cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi0J7RiNC40LHQutCwINC+0YTQvtGA0LzQu9C10L3QuNGPIVwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgIGlmIChlcnJvci5lcnJvciAmJiBlcnJvci5lcnJvci5jYXJ0KSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZXRDYXJ0SWQoZXJyb3IuZXJyb3IuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgICAgICAgIHRoaXMuY2FydC5uZXh0KGVycm9yLmVycm9yLmNhcnQpO1xyXG4gICAgICAgICAgICAgIHRoaXMuY2FydElEID0gZXJyb3IuZXJyb3IuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLyppZiAoZXJyb3IubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZShlcnJvci5tZXNzYWdlLnR5cGUsIGVycm9yLm1lc3NhZ2UudGl0bGUsIGVycm9yLm1lc3NhZ2UuYm9keSlcclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHRoaXMuZXZlbnRlci5lbWl0TWVzc2FnZUV2ZW50KFxyXG4gICAgICAgICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZSgnZXJyb3InLCAn0J7RiNC40LHQutCwJywgJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0L7RhNC+0YDQvNC40YLRjCDQt9Cw0LrQsNC3JylcclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBjaGVja1N0cmVldFYyKGRhdGEpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMubmV0LnBvc3QoJy9jaGVjaycsIGRhdGEpXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcChcclxuICAgICAgICAgIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2FydElkKHJlc3VsdC5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydC5uZXh0KHJlc3VsdC5jYXJ0KTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0SUQgPSByZXN1bHQuY2FydC5jYXJ0SWQ7XHJcbiAgICAgICAgICAgIC8qaWYgKHJlc3VsdC5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICB0aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UoXHJcbiAgICAgICAgICAgICByZXN1bHQubWVzc2FnZS50eXBlLFxyXG4gICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2UudGl0bGUsXHJcbiAgICAgICAgICAgICByZXN1bHQubWVzc2FnZS5ib2R5XHJcbiAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgLy90aGlzLmV2ZW50ZXIuZW1pdE1lc3NhZ2VFdmVudChcclxuICAgICAgICAgICAgLy9uZXcgRXZlbnRNZXNzYWdlKCdlcnJvcicsICfQntGI0LjQsdC60LAnLCAn0J3QtSDRg9C00LDQu9C+0YHRjCDQvtGE0L7RgNC80LjRgtGMINC30LDQutCw0LcnKVxyXG4gICAgICAgICAgICAvLylcclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBjaGVja1N0cmVldChkYXRhKTogdm9pZCB7XHJcblxyXG4gICAgdGhpcy5uZXQucG9zdCgnL2NoZWNrJywgZGF0YSkuc3Vic2NyaWJlKFxyXG4gICAgICByZXMgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0Q2FydElkKHJlcy5jYXJ0LmNhcnRJZCk7XHJcbiAgICAgICAgdGhpcy5jYXJ0Lm5leHQocmVzLmNhcnQpO1xyXG4gICAgICAgIHRoaXMuY2FydElEID0gcmVzLmNhcnQuY2FydElkO1xyXG4gICAgICAgIGlmIChyZXMubWVzc2FnZSkge1xyXG4gICAgICAgICAgdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgICAgIG5ldyBFdmVudE1lc3NhZ2UocmVzLm1lc3NhZ2UudHlwZSwgcmVzLm1lc3NhZ2UudGl0bGUsIHJlcy5tZXNzYWdlLmJvZHkpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvci5lcnJvcikge1xyXG4gICAgICAgICAgaWYgKGVycm9yLmVycm9yLmNhcnQpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDYXJ0SWQoZXJyb3IuZXJyb3IuY2FydC5jYXJ0SWQpO1xyXG4gICAgICAgICAgICB0aGlzLmNhcnQubmV4dChlcnJvci5lcnJvci5jYXJ0KTtcclxuICAgICAgICAgICAgdGhpcy5jYXJ0SUQgPSBlcnJvci5lcnJvci5jYXJ0LmNhcnRJZDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8qdGhpcy5ldmVudGVyLmVtaXRNZXNzYWdlRXZlbnQoXHJcbiAgICAgICAgICAgbmV3IEV2ZW50TWVzc2FnZShlcnJvci5lcnJvci5tZXNzYWdlLnR5cGUsIGVycm9yLmVycm9yLm1lc3NhZ2UudGl0bGUsIGVycm9yLmVycm9yLm1lc3NhZ2UuYm9keSlcclxuICAgICAgICAgICApOyovXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBzZXRDYXJ0SWQoY2FydElEKSB7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FydElEJywgY2FydElEKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUNhcnRJZCgpIHtcclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdjYXJ0SUQnKTtcclxuICB9XHJcblxyXG4gIHVzZXJDYXJ0KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5jYXJ0O1xyXG4gIH1cclxuXHJcbiAgc2V0TW9kaWZpcmVzKG1vZGlmaXJlcywgbWVzc2FnZXM/OiBFdmVudE1lc3NhZ2VbXSk6IHZvaWQge1xyXG4gICAgdGhpcy5tb2RpZmlyZXMubmV4dChtb2RpZmlyZXMpO1xyXG4gICAgaWYgKG1lc3NhZ2VzKSB7XHJcbiAgICAgIHRoaXMubW9kaWZpcmVzTWVzc2FnZS5uZXh0KG1lc3NhZ2VzKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRNb2RpZmlyZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLm1vZGlmaXJlcy5waXBlKCk7XHJcbiAgfVxyXG5cclxuICBwcm9kdWN0SW5DYXJ0KHByb2R1Y3Q6RGlzaExpc3RJdGVtKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jYXJ0LnBpcGUoXHJcbiAgICAgIGZpbHRlcihjYXJ0ID0+ICdjYXJ0SWQnIGluIGNhcnQpLFxyXG4gICAgICBtYXAoY2FydCA9PiB7XHJcbiAgICAgICAgcmV0dXJuICEhKGNhcnQgJiYgY2FydD8uZGlzaGVzPy5maW5kKGRpc2hJbkNhcnQgPT4gZGlzaEluQ2FydC5kaXNoLmlkID09PSBwcm9kdWN0LmlkKSlcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRQaWNrdXBQb2ludHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQuZ2V0PFBpY2t1cFBvaW50W10+KCcvcGlja3VwYWRkcmVzZXM/Y2FydElkPXN0cmluZycpO1xyXG4gIH1cclxuXHJcbiAgZ2V0UGF5bWVudE1ldGhvZHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZXQuZ2V0PFBheW1lbnRNZXRob2RbXT4oJy9wYXltZW50bWV0aG9kcycpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIFBpY2t1cFBvaW50IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbiAgYWRkcmVzczogc3RyaW5nO1xyXG4gIG9yZGVyOiBudW1iZXI7XHJcbiAgZW5hYmxlOiBib29sZWFuO1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xyXG4gIHVwZGF0ZWRBdDogc3RyaW5nO1xyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBQYXltZW50TWV0aG9kIHtcclxuICBpaWtvUGF5bWVudE1ldGhvZDogYW55LFxyXG4gIGlkOiBzdHJpbmcsXHJcbiAgdGl0bGU6IHN0cmluZyxcclxuICB0eXBlOiBzdHJpbmcsXHJcbiAgYWRhcHRlcjogc3RyaW5nLFxyXG4gIG9yZGVyOiBudW1iZXIsXHJcbiAgZGVzY3JpcHRpb246IHN0cmluZyxcclxuICBlbmFibGU6IGJvb2xlYW4sXHJcbiAgY3JlYXRlZEF0OiBzdHJpbmcsXHJcbiAgdXBkYXRlZEF0OiBzdHJpbmdcclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgRGlzaEluQ2FydCB7XHJcbiAgYWRkZWRCeTogc3RyaW5nO1xyXG4gIGFtb3VudDogbnVtYmVyO1xyXG4gIGNhcnQ6IHN0cmluZztcclxuICBjb21tZW50OiBzdHJpbmc7XHJcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XHJcbiAgZGlzaDogRGlzaExpc3RJdGVtO1xyXG4gIGlkOiBudW1iZXI7XHJcbiAgaXRlbVRvdGFsOiBudW1iZXI7XHJcbiAgbW9kaWZpZXJzOiBhbnlbXTtcclxuICBwYXJlbnQ6IGFueTtcclxuICB0b3RhbFdlaWdodDogbnVtYmVyO1xyXG4gIHVuaXF1ZUl0ZW1zOiBudW1iZXI7XHJcbiAgdXBkYXRlZEF0OiBzdHJpbmc7XHJcbiAgd2VpZ2h0OiBudW1iZXI7XHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIENhcnQge1xyXG4gIGFkZHJlc3M6IGFueVxyXG4gIGNhcnRJZDogc3RyaW5nXHJcbiAgY2FydFRvdGFsOiBudW1iZXJcclxuICBjb21tZW50OiBzdHJpbmdcclxuICBjcmVhdGVkQXQ6IHN0cmluZ1xyXG4gIGN1c3RvbWVyOiBzdHJpbmdcclxuICBkZWxpdmVyeTogYW55XHJcbiAgZGVsaXZlcnlEZXNjcmlwdGlvbjogc3RyaW5nXHJcbiAgZGVsaXZlcnlJdGVtOiBhbnlcclxuICBkZWxpdmVyeVN0YXR1czogYW55XHJcbiAgZGlzaGVzOiBEaXNoSW5DYXJ0W11cclxuICBkaXNoZXNDb3VudDogbnVtYmVyXHJcbiAgaGlzdG9yeTogYW55XHJcbiAgaWQ6IHN0cmluZ1xyXG4gIG1lc3NhZ2U6IGFueVxyXG4gIG1vZGlmaWVyczogYW55XHJcbiAgbmFtZU9mTW9kZWw6IGFueVxyXG4gIHBlcnNvbnNDb3VudDogbnVtYmVyXHJcbiAgcHJvYmxlbTogYm9vbGVhblxyXG4gIHJtc0lkOiBzdHJpbmdcclxuICBzZWxmRGVsaXZlcnk6IGJvb2xlYW5cclxuICBzZW5kVG9JaWtvOiBib29sZWFuXHJcbiAgc3RhdGU6IHN0cmluZ1xyXG4gIHRvdGFsV2VpZ2h0OiBzdHJpbmdcclxuICB1bmlxdWVEaXNoZXM6IHN0cmluZ1xyXG4gIHVwZGF0ZWRBdDogc3RyaW5nXHJcbiAgdXNlcjogYW55XHJcbiAgRnJlZURlbGl2ZXJ5RnJvbU1lc3NhZ2U6IHN0cmluZ1xyXG4gIGRhdGU6IG51bGxcclxuICBkZWxpdmVyeVRpbWVNZXNzYWdlOiBzdHJpbmdcclxuICBkZWxpdmVyeVRvdGFsOiBudW1iZXJcclxuICBkaXNjb3VudFRvdGFsOiBudW1iZXJcclxuICBpc1BheW1lbnRQcm9taXNlOiBib29sZWFuXHJcbiAgb3JkZXJEYXRlOiBzdHJpbmdcclxuICBvcmRlckRhdGVMaW1pdDogc3RyaW5nXHJcbiAgb3JkZXJUb3RhbDogbnVtYmVyXHJcbiAgcGFpZDogYm9vbGVhblxyXG4gIHBheW1lbnRNZXRob2Q6IHN0cmluZ1xyXG4gIHBheW1lbnRNZXRob2RUaXRsZTogc3RyaW5nXHJcbiAgcmVjb21tZW5kczogRGlzaExpc3RJdGVtW107XHJcbiAgcm1zRGVsaXZlcmVkOiBib29sZWFuXHJcbiAgcm1zRGVsaXZlcnlEYXRlOiBudWxsXHJcbiAgcm1zRXJyb3JDb2RlOiBudWxsXHJcbiAgcm1zRXJyb3JNZXNzYWdlOiBudWxsXHJcbiAgcm1zT3JkZXJEYXRhOiBudWxsXHJcbiAgcm1zT3JkZXJOdW1iZXI6IG51bGxcclxuICBybXNTdGF0dXNDb2RlOiBudWxsXHJcbiAgc2VsZlNlcnZpY2U6IGJvb2xlYW5cclxuICBzaG9ydElkOiBzdHJpbmdcclxuICB0b3RhbDogbnVtYmVyXHJcbiAgdW50aWxGcmVlRGVsaXZlcnlNZXNzYWdlOiBzdHJpbmdcclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgRGlzaExpc3RJdGVtIHtcclxuICBhZGRpdGlvbmFsSW5mbzogYW55XHJcbiAgYmFsYW5jZTogbnVtYmVyXHJcbiAgY2FyYm9oeWRyYXRlQW1vdW50OiBudW1iZXJcclxuICBjYXJib2h5ZHJhdGVGdWxsQW1vdW50OiBudW1iZXJcclxuICBjb2RlOiBzdHJpbmdcclxuICBjcmVhdGVkQXQ6IHN0cmluZ1xyXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmdcclxuICBkaWZmZXJlbnRQcmljZXNPbjogYW55W11cclxuICBkb05vdFByaW50SW5DaGVxdWU6IGJvb2xlYW5cclxuICBlbmVyZ3lBbW91bnQ6IG51bWJlclxyXG4gIGVuZXJneUZ1bGxBbW91bnQ6IG51bWJlclxyXG4gIGZhdEFtb3VudDogbnVtYmVyXHJcbiAgZmF0RnVsbEFtb3VudDogbnVtYmVyXHJcbiAgZmliZXJBbW91bnQ6IG51bWJlclxyXG4gIGZpYmVyRnVsbEFtb3VudDogbnVtYmVyXHJcbiAgZ3JvdXBJZDogYW55XHJcbiAgZ3JvdXBNb2RpZmllcnM6IFtdXHJcbiAgaGFzaDogbnVtYmVyXHJcbiAgaWQ6IHN0cmluZ1xyXG4gIGltYWdlczogRGlzaEltYWdlSXRlbVtdXHJcbiAgaW1hZ2VzTGlzdDogRGlzaEltYWdlSXRlbVtdXHJcbiAgaXNEZWxldGVkOiBib29sZWFuXHJcbiAgaXNJbmNsdWRlZEluTWVudTogYm9vbGVhblxyXG4gIG1lYXN1cmVVbml0OiBzdHJpbmdcclxuICBtb2RpZmllcnM6IERpc2hNb2RpZmllcltdXHJcbiAgbmFtZTogc3RyaW5nXHJcbiAgb3JkZXI6IG51bWJlclxyXG4gIHBhcmVudEdyb3VwOiBzdHJpbmdcclxuICBwcmljZTogbnVtYmVyXHJcbiAgcHJvZHVjdENhdGVnb3J5SWQ6IHN0cmluZ1xyXG4gIHByb2hpYml0ZWRUb1NhbGVPbjogYW55W11cclxuICBybXNJZDogc3RyaW5nXHJcbiAgc2VvRGVzY3JpcHRpb246IGFueVxyXG4gIHNlb0tleXdvcmRzOiBhbnlcclxuICBzZW9UZXh0OiBhbnlcclxuICBzZW9UaXRsZTogYW55XHJcbiAgc2x1Zzogc3RyaW5nXHJcbiAgdGFnczogYW55W11cclxuICB0YWdzTGlzdDogYW55W11cclxuICB0eXBlOiBzdHJpbmdcclxuICB1cGRhdGVkQXQ6IHN0cmluZ1xyXG4gIHVzZUJhbGFuY2VGb3JTZWxsOiBib29sZWFuXHJcbiAgd2VpZ2h0OiBudW1iZXJcclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgRGlzaEltYWdlVXJscyB7XHJcbiAgbGFyZ2U6IHN0cmluZ1xyXG4gIG9yaWdpbjogc3RyaW5nXHJcbiAgc21hbGw6IHN0cmluZ1xyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBEaXNoSW1hZ2VJdGVtIHtcclxuICBjcmVhdGVkQXQ6IHN0cmluZ1xyXG4gIGdyb3VwOiBhbnlcclxuICBpZDogc3RyaW5nXHJcbiAgaW1hZ2VzOiBEaXNoSW1hZ2VVcmxzXHJcbiAgdXBkYXRlZEF0OiBzdHJpbmdcclxuICB1cGxvYWREYXRlOiBzdHJpbmdcclxufVxyXG5cclxuZGVjbGFyZSBpbnRlcmZhY2UgRGlzaEJhc2VNb2RpZmllciB7XHJcbiAgbWF4QW1vdW50OiBudW1iZXJcclxuICBtaW5BbW91bnQ6IG51bWJlclxyXG4gIG1vZGlmaWVySWQ6IHN0cmluZ1xyXG4gIHJlcXVpcmVkOiBib29sZWFuXHJcbn1cclxuXHJcbmRlY2xhcmUgaW50ZXJmYWNlIERpc2hNb2RpZmllciBleHRlbmRzIERpc2hCYXNlTW9kaWZpZXIge1xyXG4gIGNoaWxkTW9kaWZpZXJzOiBEaXNoQ2hpbGRNb2RpZmllcltdXHJcbiAgY2hpbGRNb2RpZmllcnNIYXZlTWluTWF4UmVzdHJpY3Rpb25zOiBib29sZWFuXHJcbiAgZ3JvdXA6IERpc2hMaXN0SXRlbVxyXG59XHJcblxyXG5kZWNsYXJlIGludGVyZmFjZSBEaXNoQ2hpbGRNb2RpZmllciBleHRlbmRzIERpc2hCYXNlTW9kaWZpZXIge1xyXG4gIGRlZmF1bHRBbW91bnQ6IG51bWJlclxyXG4gIGhpZGVJZkRlZmF1bHRBbW91bnQ6IGJvb2xlYW5cclxuICBkaXNoOiBEaXNoTGlzdEl0ZW1cclxufSJdfQ==