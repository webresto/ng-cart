!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@webresto/ng-core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@webresto/ng-cart",["exports","@angular/core","rxjs","rxjs/operators","@webresto/ng-core","@angular/common"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).webresto=e.webresto||{},e.webresto["ng-cart"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e["@webresto/ng-core"],e.ng.common)}(this,(function(e,r,i,t,n,o){"use strict";var s=function(){function e(e,r){this.net=e,this.eventer=r,this.cartID=this.getCartId(),this.cart=new i.BehaviorSubject(null),this.modifires=new i.BehaviorSubject([]),this.OrderFormChange=new i.BehaviorSubject(null),this.modifiresMessage=new i.BehaviorSubject([]),this.restrictions$=this.net.get("/restrictions")}return e.prototype.getCartId=function(){return localStorage.getItem("cartID")},e.prototype.getCart=function(){var e=this;return this.net.get("/cart"+(this.cartID?"?cartId="+this.cartID:"")).pipe(t.switchMap((function(r){return r||e.removeCartId(),r?i.from([r]):e.net.get("/cart}")})),t.switchMap((function(r){return"ORDER"==r.cart.state?i.throwError(new Error("Cart in order state")):(e.cartID||e.setCartId(r.cart.cartId),e.cart.next(r.cart),e.cart)})),t.catchError((function(r){return e.removeCartId(),i.throwError(r)})))},e.prototype.addDishToCart=function(e){var r=this;this.modifiresMessage.value.length?this.modifiresMessage.value.forEach((function(e){r.eventer.emitMessageEvent(e)})):this.net.put("/cart/add",e).subscribe((function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId}),(function(){}))},e.prototype.addDishToCart$=function(e){var r=this;return this.modifiresMessage.value.length?(this.modifiresMessage.value.forEach((function(e){r.eventer.emitMessageEvent(e)})),i.from([null])):this.net.put("/cart/add",e).pipe(t.tap((function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId})))},e.prototype.setDishCountToCart=function(e,r){var i=this;this.net.post("/cart/set",{dishId:e,cartId:this.cartID,amount:r}).subscribe((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId}),(function(){}))},e.prototype.setDishComment=function(e,r){var i=this;return this.net.post("/cart/setcomment",{dishId:e,cartId:this.cartID,comment:r}).pipe(t.tap((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId}),(function(){})))},e.prototype.removeDishFromCart$=function(e,r){var i=this;return this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:r}).pipe(t.tap((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId})))},e.prototype.removeDishFromCart=function(e,r){var i=this;this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:r}).subscribe((function(e){i.setCartId(e.cart.cartId),i.cart.next(e.cart),i.cartID=e.cart.cartId}),(function(){}))},e.prototype.checkoutCart=function(e){var r={cartId:this.cartID,address:{streetId:e.street.id,home:e.house,housing:e.housing,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:e.phone,name:e.name,mail:e.email||void 0}};return this.orderCart(r)},e.prototype.orderCart=function(e){var r=this;return this.net.post("/order",e).pipe(t.tap((function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId}),(function(e){console.log("Ошибка оформления!",e),e.error&&e.error.cart&&(r.setCartId(e.error.cart.cartId),r.cart.next(e.error.cart),r.cartID=e.error.cart.cartId)})))},e.prototype.checkStreetV2=function(e){var r=this;return this.net.post("/check",e).pipe(t.tap((function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId}),(function(){})))},e.prototype.checkStreet=function(e){var r=this;this.net.post("/check",e).subscribe((function(e){r.setCartId(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId}),(function(e){e.error&&e.error.cart&&(r.setCartId(e.error.cart.cartId),r.cart.next(e.error.cart),r.cartID=e.error.cart.cartId)}))},e.prototype.setCartId=function(e){localStorage.setItem("cartID",e),this.cartID=e},e.prototype.removeCartId=function(){localStorage.removeItem("cartID"),this.cartID=null},e.prototype.userCart=function(){return this.cart},e.prototype.setModifires=function(e,r){this.modifires.next(e),r&&this.modifiresMessage.next(r)},e.prototype.getModifires=function(){return this.modifires.pipe()},e.prototype.productInCart=function(e){return this.cart.pipe(t.filter((function(e){return"cartId"in e})),t.map((function(r){var i;return!(!r||!(null===(i=null==r?void 0:r.dishes)||void 0===i?void 0:i.find((function(r){return r.dish.id===e.id}))))})))},e.prototype.getPickupPoints=function(e){return this.net.get("/pickupaddreses",!0,{params:{cartId:e}})},e.prototype.getPaymentMethods=function(e){return this.net.get("/paymentmethods",!0,{params:{cartId:e}})},e}();s.ɵprov=r.ɵɵdefineInjectable({factory:function(){return new s(r.ɵɵinject(n.NetService),r.ɵɵinject(n.EventerService))},token:s,providedIn:"root"}),s.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[{type:n.NetService},{type:n.EventerService}]};var d=function(){function e(e){var i=this;this.cartService=e,this.loading=new r.EventEmitter,this.success=new r.EventEmitter,this.error=new r.EventEmitter,this.cartService.userCart().subscribe((function(e){return i.cart=e})),this.cartService.getModifires().subscribe((function(e){return i.modifires=e}))}return e.prototype.onClick=function(){this.addDishToCart(this.dish.id,this.amountDish)},e.prototype.addDishToCart=function(e,r){var i=this,t={dishId:e,amount:r,cartId:void 0,modifiers:this.modifires,comment:this.comment};this.cart.cartId&&(t.cartId=this.cart.cartId),this.loading.emit(!0),this.cartService.addDishToCart$(t).subscribe((function(){return i.success.emit(!0)}),(function(e){return i.error.emit(e)}),(function(){return i.loading.emit(!1)}))},e}();d.decorators=[{type:r.Directive,args:[{selector:"[rstAddToCart]"}]}],d.ctorParameters=function(){return[{type:s}]},d.propDecorators={modifires:[{type:r.Input}],dish:[{type:r.Input}],amountDish:[{type:r.Input}],comment:[{type:r.Input}],loading:[{type:r.Output}],success:[{type:r.Output}],error:[{type:r.Output}],onClick:[{type:r.HostListener,args:["click"]}]};var a=function(e,r,i){var t=this;this.cartService=e,this.renderer=r,this.el=i,this.amount="0",this.renderer.setProperty(this.el.nativeElement,"innerHTML",this.amount),this.cartService.userCart().subscribe((function(e){t.cart=e,t.amount=e.dishesCount||0,t.renderer.setProperty(t.el.nativeElement,"innerHTML",t.amount)}))};a.decorators=[{type:r.Directive,args:[{selector:"[rstAmountCart]"}]}],a.ctorParameters=function(){return[{type:s},{type:r.Renderer2},{type:r.ElementRef}]};var c=function(){function e(e){var i=this;this.cartService=e,this.success=new r.EventEmitter,this.error=new r.EventEmitter,this.isChecking=new r.EventEmitter,this.cartService.userCart().subscribe((function(e){return i.cart=e})),this.cartService.OrderFormChange.pipe(t.filter((function(){if(i.locationId||(i.streetId||i.street)&&i.home||i.selfService)return!0})),t.debounceTime(1e3)).subscribe((function(){return i.checkStreet()}))}return e.prototype.onClick=function(){var e=this;if(this.locationId||(this.streetId||this.street)&&this.home||this.selfService){var r=this.comment||"Не указан",i={cartId:this.cart.cartId,comment:r,customer:{phone:this.preparePhone(this.phone),mail:this.email,name:this.name},personsCount:+this.personsCount};this.paymentMethodId&&(i.paymentMethodId=this.paymentMethodId),this.date&&(i.date=this.date),this.notifyMethodId&&(i.notifyMethodId=this.notifyMethodId),i.selfService=this.selfService,this.bonuses&&(i.bonuses=this.bonuses.map((function(e){return{name:e.name,amount:e.amount}}))),this.locationId?i.locationId=this.locationId:i.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""};var t=this.cart.id;this.cartService.orderCart(i).subscribe((function(r){r.action&&r.action.paymentRedirect?window.location.href=r.action.paymentRedirect:e.success.emit(t)}),(function(r){return e.error.emit(r)}))}else this.error.emit("Нужно указать адрес")},e.prototype.ngOnChanges=function(e){this.cartService.OrderFormChange.next(e)},e.prototype.checkStreet=function(){var e=this,r=this.comment||"Не указан",i={cartId:this.cart.cartId,comment:r,customer:{phone:this.phone?this.preparePhone(this.phone):null,mail:this.email,name:this.name||null},personsCount:+this.personsCount};i.selfService=this.selfService,this.paymentMethodId&&(i.paymentMethodId=this.paymentMethodId),this.date&&(i.date=this.date),this.notifyMethodId&&(i.notifyMethodId=this.notifyMethodId),this.locationId?i.locationId=this.locationId:i.address={streetId:this.streetId,street:this.street,home:this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},this.isChecking.emit(!0),this.cartService.checkStreetV2(i).subscribe((function(){return e.isChecking.emit(!1)}),(function(){return e.isChecking.emit(!1)}))},e.prototype.preparePhone=function(e){return e?(e="+"+e.replace(/[^0-9]/gim,"")).replace("+8","+7"):""},e}();c.decorators=[{type:r.Directive,args:[{selector:"[rstCheckout]"}]}],c.ctorParameters=function(){return[{type:s}]},c.propDecorators={cartTotal:[{type:r.Input}],bonuses:[{type:r.Input}],name:[{type:r.Input}],email:[{type:r.Input}],phone:[{type:r.Input}],delivery:[{type:r.Input}],selfService:[{type:r.Input}],locationId:[{type:r.Input}],street:[{type:r.Input}],streetId:[{type:r.Input}],home:[{type:r.Input}],housing:[{type:r.Input}],apartment:[{type:r.Input}],entrance:[{type:r.Input}],doorphone:[{type:r.Input}],floor:[{type:r.Input}],paymentMethod:[{type:r.Input}],paymentMethodId:[{type:r.Input}],personsCount:[{type:r.Input}],comment:[{type:r.Input}],date:[{type:r.Input}],notifyMethodId:[{type:r.Input}],success:[{type:r.Output}],error:[{type:r.Output}],isChecking:[{type:r.Output}],onClick:[{type:r.HostListener,args:["click"]}]};var h=function(){function e(e){var r=this;this.cartService=e,this.cartService.userCart().subscribe((function(e){return r.cart=e}))}return e.prototype.onClick=function(){this.cartService.removeDishFromCart(this.dish.id,this.amountDish)},e}();h.decorators=[{type:r.Directive,args:[{selector:"[rstDeleteFromCart]"}]}],h.ctorParameters=function(){return[{type:s}]},h.propDecorators={dish:[{type:r.Input}],amountDish:[{type:r.Input}],onClick:[{type:r.HostListener,args:["click"]}]};var m=function(){function e(e,i,t){this.renderer=e,this.el=i,this.cartService=t,this.validate=new r.EventEmitter,this.amountDishToAdd=new r.EventEmitter,this.amountModifires={},this.stateModifiers={}}return e.prototype.ngOnInit=function(){var e=this;this.renderer.addClass(this.el.nativeElement,"dish-calculator"),this.amountDish=this.amount,this.amountDishToAdd.emit(this.amountDish),this.price=this.renderer.createElement("div"),this.renderer.addClass(this.price,"dish-price"),setTimeout((function(){e.renderDish(e.dish),e.render(e.dish.modifiers)}),100)},e.prototype.renderDish=function(e){var r=this,i=this.renderer.createElement("div");this.renderer.addClass(i,"dish-wraper"),this.renderer.appendChild(this.el.nativeElement,i);var t=this.renderer.createElement("div");this.renderer.addClass(t,"name"),this.renderer.appendChild(i,t);var n=this.renderer.createElement("div");this.renderer.addClass(n,"title"),this.renderer.setProperty(n,"innerHTML",this.dish.name),this.renderer.appendChild(t,n);var o=this.renderer.createElement("div");this.renderer.addClass(t,"weight"),this.renderer.addClass(t,"dish"),this.renderer.appendChild(i,o);var s=this.renderer.createElement("div");this.renderer.addClass(s,"value"),this.renderer.setProperty(s,"innerHTML",(1e3*this.dish.weight).toFixed(0)+" г."),0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(s,"zero"),this.renderer.appendChild(o,s),this.renderer.setProperty(this.price,"innerHTML",this.dish.price);var d=this.renderer.createElement("div");this.renderer.addClass(d,"price"),this.renderer.addClass(d,"total"),this.renderer.appendChild(d,this.price),this.renderer.appendChild(i,d);var a=this.renderer.createElement("div");this.renderer.addClass(a,"quantity"),this.renderer.appendChild(i,a);var c=this.renderer.createElement("a");this.renderer.addClass(c,"quantity__button"),this.renderer.addClass(c,"minus"),this.renderer.setProperty(c,"innerHTML","&#8722;"),this.renderer.listen(c,"click",(function(e){r.changeAmountdish(-1),r.renderer.setProperty(h,"innerHTML",r.amountDish),r.renderer.setProperty(r.price,"innerHTML",r.generatePrice(r.dish.price)),r.innerTotalWeight(l)})),this.renderer.appendChild(a,c);var h=this.renderer.createElement("span");this.renderer.addClass(h,"quantity__counter"),this.renderer.setProperty(h,"innerHTML",this.amountDish),this.renderer.appendChild(a,h);var m=this.renderer.createElement("a");this.renderer.addClass(m,"quantity__button"),this.renderer.addClass(c,"plus"),this.renderer.setProperty(m,"innerHTML","&#x2b;"),this.renderer.listen(m,"click",(function(e){r.changeAmountdish(1),r.renderer.setProperty(h,"innerHTML",r.amountDish),r.renderer.setProperty(r.price,"innerHTML",r.generatePrice(r.dish.price)),r.innerTotalWeight(l)})),this.renderer.appendChild(a,m);var p=this.renderer.createElement("div");this.renderer.addClass(t,"weight"),this.renderer.addClass(t,"total"),this.renderer.appendChild(i,p);var l=this.renderer.createElement("div");0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(l,"zero"),this.renderer.addClass(l,"value"),this.innerTotalWeight(l),this.renderer.appendChild(p,l),this.weightTotal=l,this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(e.price));var u=this.renderer.createElement("div");this.renderer.addClass(u,"price"),this.renderer.addClass(u,"total"),this.renderer.appendChild(u,this.price),this.renderer.appendChild(i,u)},e.prototype.generatePrice=function(e,r,i){var t=this,n=[];this.selectedModifiers&&this.selectedModifiers.forEach((function(e){t.dish.modifiers.forEach((function(r){var i=r.childModifiers.filter((function(r){return r.modifierId===e.id}));i.length>0&&(i[0].groupId=r.group.id,n.push(i[0]))}))}));var o=0;return n.forEach((function(e){o+=e.dish.price*t.amountModifires[e.groupId][e.modifierId]})),o*=this.amountDish,e*this.amountDish+o+'<div class="currency">&nbsp;&#x20bd;</div>'},e.prototype.generateTotalWeight=function(){var e=this,r=[];this.selectedModifiers&&this.selectedModifiers.forEach((function(i){e.dish.modifiers.forEach((function(e){var t=e.childModifiers.filter((function(e){return e.modifierId===i.id}));t.length>0&&(t[0].groupId=e.group.id,r.push(t[0]))}))}));var i=0;return r.forEach((function(r){i+=r.dish.weight*e.amountModifires[r.groupId][r.modifierId]*1e3})),i=parseFloat((i*this.amountDish).toFixed(2)),console.log(i,1e3*this.dish.weight*this.amountDish),console.log(this.dish.weight,this.amountDish),(1e3*this.dish.weight*this.amountDish+i).toFixed(0)+" г. <div class='separator'></div>"},e.prototype.innerTotalWeight=function(e){this.renderer.setProperty(e,"innerHTML",this.generateTotalWeight())},e.prototype.changeAmountdish=function(e){this.amountDish=this.amountDish+e,this.amountDish<=0&&(this.amountDish=1),this.amountDish>=199&&(this.amountDish=199),this.amountDishToAdd.emit(this.amountDish)},e.prototype.render=function(e){var r=this;if(this.setModifires(),e.length>0){var i=this.renderer.createElement("h5");this.renderer.setProperty(i,"innerHTML","К этому блюду можно добавить:")}if(e.forEach((function(e){if(r.stateModifiers[e.modifierId]={},r.amountModifires[e.modifierId]={},e.dish){var i=r.groupDiv("Одночные модификаторы не поддерживаются");r.renderer.appendChild(r.el.nativeElement,i),console.log("elementGroup",e)}else if(e.childModifiers){var t=r.groupDiv(e.group?e.group.name:"Ошибка");r.renderer.appendChild(r.el.nativeElement,t),e.childModifiers.forEach((function(i){var n=r.modifireDiv(i,e.modifierId);r.renderer.appendChild(t,n),i.defaultAmount<1?r.stateModifiers[e.modifierId][i.modifierId]=!1:r.stateModifiers[e.modifierId][i.modifierId]=!0}))}})),e.length>0){i=this.renderer.createElement("div");this.renderer.setProperty(i,"innerHTML","<p>* — Количество добавленых опций блюда применяется для каждой порции</p>"),this.renderer.appendChild(this.el.nativeElement,i)}},e.prototype.groupDiv=function(e){var r=this.renderer.createElement("div");return this.renderer.addClass(r,"group-modifires-wraper"),this.renderer.appendChild(r,this.renderer.createText(""+e)),r},e.prototype.modifireDiv=function(e,r){var i=this.renderer.createElement("div");return this.renderer.addClass(i,"additional-item"),this.renderOneModifire(e,i,r),i},e.prototype.renderOneModifire=function(e,r,i){console.info("renderOneModifire",e),console.info("renderOneModifire selectedModifiers",this.selectedModifiers);var t=this.renderer.createElement("div");this.renderer.addClass(t,"item-name");var n=this.renderer.createElement("label");this.renderer.setAttribute(n,"for",e.modifierId),this.renderer.appendChild(t,n),this.renderer.setProperty(n,"innerHTML",e.dish.name),this.renderer.appendChild(r,t);var o=this.renderer.createElement("div");this.renderer.addClass(o,"left-weight-modifire-wraper");var s=this.renderer.createElement("div");this.renderer.addClass(s,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(s,"zero"),this.renderer.setProperty(s,"innerHTML",(1e3*e.dish.weight).toFixed(0)+" г."),this.renderer.appendChild(o,s),this.renderer.appendChild(r,o);var d=this.renderer.createElement("div"),a=e.minAmount,c=e.maxAmount,h=e.defaultAmount;switch(console.info("min max def",a,c,h),!0){case 0===a&&0===c&&0===h:case 0===a&&1===c&&0===h:this.renderCheckbox(e,!1,d,r,i);break;case 0===a&&1===c&&1===h:this.renderCheckbox(e,!0,d,r,i);break;case 1===a&&1===c&&1===h:console.error(e.dish.name,"Значение не поддается настройке:",a,c,h);break;case a<=c&&h>=a&&h<=c&&c>1:this.renderInputButton(e,i,d,r);break;default:console.error(e.dish.name,"Ошибка рендера модификатора, для значений:",a,c,h)}e.maxAmount>0&&e.minAmount;var m=this.renderer.createElement("div");this.renderer.addClass(m,"right-weight-modifire-wraper");var p=this.renderer.createElement("div");this.renderer.addClass(p,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(p,"zero"),this.renderer.setProperty(p,"innerHTML",(1e3*e.dish.weight).toFixed(0)+' г.<div class="separator"></div>'),this.renderer.appendChild(m,p),this.renderer.appendChild(r,m);var l,u=this.renderer.createElement("div");this.renderer.addClass(u,"item-price"),e.dish.price>0?(l=e.dish.price+"<div class = 'currency'>&nbsp;&#x20bd;</div>",this.renderer.setProperty(u,"innerHTML",l),this.renderer.appendChild(r,u)):this.renderer.addClass(u,"zero-price"),this.setModifires(),this.innerTotalWeight(this.weightTotal),this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(this.dish.price))},e.prototype.renderCheckbox=function(e,r,i,t,n){var o=this,s=this.renderer.createElement("input");this.renderer.setAttribute(s,"type","checkbox"),this.renderer.setAttribute(s,"id",e.modifierId),r?(this.renderer.setProperty(s,"checked",!0),e.checked=!0,this.stateModifiers[n][e.modifierId]=!0,this.amountModifires[n][e.modifierId]=1):(e.checked=!1,this.stateModifiers[n][e.modifierId]=!1,this.amountModifires[n][e.modifierId]=0),this.renderer.addClass(s,"modal-checkbox"),this.renderer.appendChild(i,s),this.renderer.listen(s,"change",(function(e){if(o.idRadioBox(n)){for(var r in o.stateModifiers[n])o.stateModifiers[n].hasOwnProperty(r)&&(o.stateModifiers[n][r]=!1);e.target.parentElement.parentElement.parentElement.querySelectorAll("input").forEach((function(r){r.id!=e.target.id&&(r.checked=!1)}))}o.stateModifiers[n][e.target.id]=e.target.checked,e.target.checked&&(o.amountModifires[n][e.target.id]=1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))})),this.renderer.appendChild(t,i)},e.prototype.renderInputButton=function(e,r,i,t){var n,o=this;(n=e.defaultAmount>0?e.defaultAmount:e.minAmount)>0&&(this.stateModifiers[r][e.modifierId]=!0);var s=this.renderer.createElement("a");this.renderer.addClass(s,"quantity__button"),this.renderer.setProperty(s,"innerHTML","&#8722;"),this.renderer.appendChild(i,s),this.renderer.listen(s,"click",(function(i){var t=+o.amountModifires[r][e.modifierId];o.amountModifires[r][e.modifierId]=t-1,o.amountModifires[r][e.modifierId]<e.minAmount&&(o.amountModifires[r][e.modifierId]=e.minAmount),o.renderer.setProperty(d,"innerHTML",o.amountModifires[r][e.modifierId]),0===o.amountModifires[r][e.modifierId]&&(o.stateModifiers[r][e.modifierId]=!1),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))}));var d=this.renderer.createElement("span");this.renderer.addClass(d,"item-quantity__counter"),this.amountModifires[r][e.modifierId]=n,this.renderer.setProperty(d,"innerHTML",this.amountModifires[r][e.modifierId]),this.renderer.appendChild(i,d);var a=this.renderer.createElement("a");this.renderer.addClass(a,"quantity__button"),this.renderer.setProperty(a,"innerHTML","&#x2b;"),this.renderer.appendChild(i,a),this.renderer.appendChild(t,i),this.renderer.listen(a,"click",(function(i){var t=+o.amountModifires[r][e.modifierId];o.amountModifires[r][e.modifierId]=t+1,o.amountModifires[r][e.modifierId]>e.maxAmount&&0!=e.maxAmount&&(o.amountModifires[r][e.modifierId]=e.maxAmount),o.renderer.setProperty(d,"innerHTML",o.amountModifires[r][e.modifierId]),o.amountModifires[r][e.modifierId]>0&&(o.stateModifiers[r][e.modifierId]=!0),o.setModifires(),o.innerTotalWeight(o.weightTotal),o.renderer.setProperty(o.price,"innerHTML",o.generatePrice(o.dish.price))}))},e.prototype.setModifires=function(){var e=this,r=[],i=[];for(var t in console.info("setModifires modifiersToSelect",r),console.info("setModifires stateModifiers before",this.stateModifiers),console.info("setModifires selectedModifiers before",this.selectedModifiers),this.stateModifiers){var n=function(e){(o.stateModifiers[t][e]||r.find((function(r){return r.modifierId==e})))&&i.push({id:e,amount:o.amountModifires[t][e],groupId:t})},o=this;for(var s in this.stateModifiers[t])n(s)}if(this.selectedModifiers=i,this.dish.modifiers.length>0){var d=[];this.dish.modifiers.forEach((function(r){if(r.required)if(e.stateModifiers[r.modifierId]){var t=[],n=e.stateModifiers[r.modifierId];for(var o in n)n.hasOwnProperty(o)&&n[o]&&t.push(n[o]);t.length<r.minAmount?(d.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+r.group.name}),e.validate.emit(!1),e.cartService.setModifires(i,d)):(e.validate.emit(!0),e.cartService.setModifires(i,[]))}else d.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+r.group.name}),e.validate.emit(!1),e.cartService.setModifires(i,d);else e.validate.emit(!0),e.cartService.setModifires(i)}))}else this.validate.emit(!0),this.cartService.setModifires(i,[]);console.info("setModifires stateModifiers after",this.stateModifiers),console.info("setModifires selectedModifiers after",this.selectedModifiers)},e.prototype.idRadioBox=function(e){var r=this.dish.modifiers.find((function(r){return r.modifierId===e}));return 1===r.minAmount&&1===r.maxAmount},e.prototype.checkMinAmountModifires=function(e,r){},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e}();m.decorators=[{type:r.Directive,args:[{selector:"[rstDishCalc]"}]}],m.ctorParameters=function(){return[{type:r.Renderer2},{type:r.ElementRef},{type:s}]},m.propDecorators={dish:[{type:r.Input}],amount:[{type:r.Input}],selectedModifiers:[{type:r.Input}],validate:[{type:r.Output}],amountDishToAdd:[{type:r.Output}]};var p=function(){function e(e,r,i){var t=this;this.renderer=e,this.el=r,this.cartService=i,this.amountModifires={},this.stateModifires={},setTimeout((function(){t.render(t.modifires)}),100)}return e.prototype.render=function(e){var r=this;if(e.length>0){var i=this.renderer.createElement("h5");this.renderer.setProperty(i,"innerHTML","К этому блюду можно добавить:"),this.renderer.appendChild(this.el.nativeElement,i)}e.forEach((function(e){r.stateModifires[e.modifierId]={},r.amountModifires[e.modifierId]={};var i=r.groupDiv(e.name);r.renderer.appendChild(r.el.nativeElement,i),(e.childModifiers.length>5?e.childModifiers.slice(0,5):e.childModifiers).forEach((function(t){var n=r.modifireDiv(t,e.modifierId);r.renderer.appendChild(i,n),r.stateModifires[e.modifierId][t.modifierId]=!1}))}))},e.prototype.groupDiv=function(e){var r=this.renderer.createElement("div");return this.renderer.addClass(r,"group-modifires"),this.renderer.appendChild(r,this.renderer.createText("Название категории модификаторов: "+e)),r},e.prototype.modifireDiv=function(e,r){var i=this.renderer.createElement("div");return this.renderer.addClass(i,"additional-item"),this.renderOneModifire(e,i,r),i},e.prototype.renderOneModifire=function(e,r,i){var t=this,n=this.renderer.createElement("div");this.renderer.addClass(n,"item-name");var o=this.renderer.createElement("input");this.renderer.setAttribute(o,"type","checkbox"),this.renderer.setAttribute(o,"id",e.modifierId),this.renderer.appendChild(n,o),this.renderer.listen(o,"change",(function(e){t.stateModifires[i][e.target.id]=e.target.checked,t.setModifires()}));var s=this.renderer.createElement("label");this.renderer.setAttribute(s,"for",e.modifierId),this.renderer.appendChild(n,s),this.renderer.setProperty(s,"innerHTML",e.dish.name),this.renderer.appendChild(r,n);var d=this.renderer.createElement("div"),a=this.renderer.createElement("a");this.renderer.addClass(a,"item-quantity__button"),this.renderer.setProperty(a,"innerHTML","&#8722;"),this.renderer.appendChild(d,a),this.renderer.listen(a,"click",(function(r){var n=+t.amountModifires[i][e.modifierId];t.amountModifires[i][e.modifierId]=n-1,t.amountModifires[i][e.modifierId]<e.minAmount&&(t.amountModifires[i][e.modifierId]=e.minAmount),t.renderer.setProperty(c,"innerHTML",t.amountModifires[i][e.modifierId]),t.setModifires()}));var c=this.renderer.createElement("span");this.renderer.addClass(c,"item-quantity__counter"),this.amountModifires[i][e.modifierId]=e.minAmount,this.renderer.setProperty(c,"innerHTML",this.amountModifires[i][e.modifierId]),this.renderer.appendChild(d,c);var h=this.renderer.createElement("a");this.renderer.addClass(h,"item-quantity__button"),this.renderer.setProperty(h,"innerHTML","&#x2b;"),this.renderer.appendChild(d,h),this.renderer.appendChild(r,d),this.renderer.listen(h,"click",(function(r){var n=+t.amountModifires[i][e.modifierId];t.amountModifires[i][e.modifierId]=n+1,t.renderer.setProperty(c,"innerHTML",t.amountModifires[i][e.modifierId]),t.setModifires()}));var m=this.renderer.createElement("div");this.renderer.addClass(m,"weight-price");var p=e.dish.weight+" г / "+e.dish.price+"&nbsp;&#x20bd;";this.renderer.setProperty(m,"innerHTML",p),this.renderer.appendChild(r,m),this.setModifires()},e.prototype.setModifires=function(){var e=[];for(var r in this.stateModifires)for(var i in this.stateModifires[r])this.stateModifires[r][i]&&e.push({id:i,amount:this.amountModifires[r][i],groupId:r});console.log("модифікатори після циклу",e),this.cartService.setModifires(e)},e}();p.decorators=[{type:r.Directive,args:[{selector:"[rstModifires]"}]}],p.ctorParameters=function(){return[{type:r.Renderer2},{type:r.ElementRef},{type:s}]},p.propDecorators={modifires:[{type:r.Input}]};var l=function(){function e(e){this.cartService=e,this.requiredFields=["name","phone","street","house"],this.checkerFields=new i.BehaviorSubject(void 0)}return e.prototype.onClick=function(){this.order(this.orderCart.value),console.log(this.orderCart.value)},e.prototype.ngAfterViewInit=function(){var e=this;setTimeout((function(){e.cartService.userCart().subscribe((function(r){e.cart&&e.orderCart.valid&&e.cart.cartTotal!=r.cartTotal&&r.cartTotal>0&&e.checkStreet(e.orderCart.value),e.cart=r}))}),100),setTimeout((function(){e.checkerFields.next(e.checkForFields(e.orderCart._directives,e.requiredFields))}),100),this.checkerFields.subscribe((function(r){r&&(e.orderCart.controls.street.valueChanges.subscribe((function(r){"object"==typeof r&&setTimeout((function(){e.orderCart.controls.house.valid&&(e.orderCart.value.name=e.orderCart.value.name||"Неуказано",e.orderCart.value.phone=e.orderCart.value.phone||"78888888888",e.checkStreet(e.orderCart.value))}),100)})),e.orderCart.controls.house.valueChanges.subscribe((function(r){setTimeout((function(){e.orderCart.controls.street.valid&&(e.orderCart.value.name=e.orderCart.value.name||"Неуказано",e.orderCart.value.phone=e.orderCart.value.phone||"78888888888",e.checkStreet(e.orderCart.value))}),100)})))}))},e.prototype.checkForFields=function(e,r){var i={},t=[];return e.forEach((function(e){i[e.name]=!0})),r.forEach((function(e){i.hasOwnProperty(e)||t.push(e)})),t.length<=0||(console.error("У формы отсутсвуют следующие обязательные для корректной работы модуля поля:",t),!1)},e.prototype.order=function(e){if(this.checkForFields(this.orderCart._directives,this.requiredFields)){var r=void 0,i=e.comment||"Не указан";r=e.cash?"Наличными курьеру":e.bankcard?"Банковской картой курьеру":"Не указан",console.log(e);var t={cartId:this.cart.cartId,comment:"\n Тип оплаты:"+r+"\nКоментарий:"+i,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.orderCart(t).subscribe()}},e.prototype.checkStreet=function(e){if(console.log(">>>>",e),this.checkForFields(this.orderCart._directives,this.requiredFields)){var r={cartId:this.cart.cartId,comment:e.comment,address:{streetId:e.street.id,home:e.house,housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.checkStreet(r)}},e.prototype.stringToNumber=function(e){return console.log(typeof e),"string"==typeof e?+e:"number"==typeof e?e:void console.error("Параметр home должен быть или string или number")},e}();l.decorators=[{type:r.Directive,args:[{selector:"[rstOrderCart]"}]}],l.ctorParameters=function(){return[{type:s}]},l.propDecorators={orderCart:[{type:r.Input}],onClick:[{type:r.HostListener,args:["click"]}]};var u=function(){function e(e){var r=this;this.cartService=e,this.cartService.userCart().subscribe((function(e){return r.cart=e}))}return e.prototype.onClick=function(){this.changeAmount(this.action)},e.prototype.changeAmount=function(e){switch(e){case"+":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount+1);break;case"-":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount-1);break;default:console.log("Директива SetDishAmount получила ложное значение action")}},e}();u.decorators=[{type:r.Directive,args:[{selector:"[rstSetDishAmount]"}]}],u.ctorParameters=function(){return[{type:s}]},u.propDecorators={action:[{type:r.Input}],dish:[{type:r.Input}],onClick:[{type:r.HostListener,args:["click"]}]};var f=function(){function e(e){this.cartService=e,this.success=new r.EventEmitter,this.error=new r.EventEmitter}return e.prototype.onClick=function(){this.setComment()},e.prototype.setComment=function(){var e=this;this.cartService.setDishComment(this.dish.id,this.comment).subscribe((function(r){return e.success.emit(!0)}),(function(r){return e.error.emit(r)}))},e}();f.decorators=[{type:r.Directive,args:[{selector:"[rstSetDishComment]"}]}],f.ctorParameters=function(){return[{type:s}]},f.propDecorators={comment:[{type:r.Input}],dish:[{type:r.Input}],success:[{type:r.Output}],error:[{type:r.Output}],onClick:[{type:r.HostListener,args:["click"]}]};Object.create;function g(e){var r="function"==typeof Symbol&&Symbol.iterator,i=r&&e[r],t=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;var v=function(){function e(e,i,t){this.cartService=e,this.eventer=i,this.validate=new r.EventEmitter,this.amountDishToAdd=new r.EventEmitter,this.comment=new r.EventEmitter,this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.twoPartsAssembledModifiersIdsByGroupId={},this.imageUrl=t}return e.prototype.ngOnInit=function(){this.checkValid()},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e.prototype.ngOnChanges=function(){var e,r,i,t;if(this.modifiers={indexById:{},custom:{fixed:null},baseList:[]},this.modifiersValueTree={},this.dish&&this.dish.modifiers){try{for(var n=g(this.dish.modifiers),o=n.next();!o.done;o=n.next()){var s=o.value,d=null;switch(this.modifiers.indexById[s.modifierId]=s,this.modifiers.custom.fixed||this.modifiers.baseList.length||!s.childModifiers||2!=s.childModifiers.length||s.maxAmount!=s.maxAmount||1!=s.maxAmount?s.group&&s.childModifiers&&s.childModifiers.length&&s.childModifiers.find((function(e){return e.dish}))?(d="group",this.modifiers.baseList.push(s),2==s.minAmount&&2==s.maxAmount&&(this.isTwoPartsAssembledTemplate=!0),console.info("Group modifier:",s)):s.dish?(d="single",this.modifiers.baseList.push(s),console.info("Single modifier:",s)):(d="broken",console.warn("Broken modifier:",s)):(d="custom",this.modifiers.custom.fixed=s,console.info("Custom Fixed modifier:",s)),d){case"group":case"custom":this.modifiersValueTree[s.modifierId]={};try{for(var a=(i=void 0,g(s.childModifiers)),c=a.next();!c.done;c=a.next()){var h=c.value;this.modifiers.indexById[h.modifierId]=h,this.modifiersValueTree[s.modifierId][h.modifierId]=h.defaultAmount}}catch(e){i={error:e}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(i)throw i.error}}this.calculateTotalAmountInGroup(s.modifierId);break;case"single":this.modifiersValueTree.single||(this.modifiersValueTree.single={}),this.modifiers.indexById[s.modifierId]=s,this.modifiersValueTree.single[s.modifierId]=s.defaultAmount}this.checkImagesInModifier(s.modifierId)}}catch(r){e={error:r}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}this.calculateTotalPrice()}console.log("this.modifiers.indexById",this.modifiers.indexById)},e.prototype.calculateTotalAmountInGroup=function(e){if("single"!=e)return this.modifiers.indexById[e].totalAmount=Object.values(this.modifiersValueTree[e]).reduce((function(e,r){return e+r})),this.modifiers.indexById[e].totalAmount},e.prototype.checkImagesInModifier=function(e){var r=this.modifiers.indexById[e];this.modifiers.indexById[e].imagesIsset=!!(r.dish&&r.dish.images&&r.dish.images.length),this.modifiers.indexById[e].childImagesIsset=!!this.modifiers.indexById[e].childModifiers.find((function(e){return!!(e&&e.dish&&e.dish.images&&e.dish.images.length)}))},e.prototype.calculateTotalPrice=function(){var e=this.dish.price||0;for(var r in this.modifiersValueTree)for(var i in this.modifiersValueTree[r]){var t=this.modifiersValueTree[r][i];if(t){var n=this.modifiers.indexById[i];n&&n.dish&&n.dish.price&&(e+=n.dish.price*t)}}this.totalPrice=e,this.setModifiers()},e.prototype.getModifiersIds=function(e){return{groupId:e.dish&&e.dish.groupId?e.dish.groupId:void 0,modifierId:e.modifierId}},e.prototype.selectTwoPartsAssembledModifier=function(e){var r=this.getModifiersIds(e),i=r.groupId,t=void 0===i?"single":i,o=r.modifierId,s=(e.minAmount,e.maxAmount,this.modifiers.indexById[t]||{}),d=(s.minAmount,s.maxAmount),a=void 0===d?0:d,c=this.modifiersValueTree[t][o],h=c?0:1;this.twoPartsAssembledModifiersIdsByGroupId[t]||(this.twoPartsAssembledModifiersIdsByGroupId[t]=[]);var m=this.modifiers.indexById[t].totalAmount-c+h;if(m>a){if(!this.twoPartsAssembledModifiersIdsByGroupId[t].length)return console.warn("Limit: max "+a+". Current "+m),void this.eventer.emitMessageEvent(new n.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[t].group.name+'" - не более '+a));for(var p in this.modifiersValueTree[t])this.modifiersValueTree[t][p]=0;this.twoPartsAssembledModifiersIdsByGroupId[t]=this.twoPartsAssembledModifiersIdsByGroupId[t].slice(1,2),this.modifiersValueTree[t][this.twoPartsAssembledModifiersIdsByGroupId[t][0]]=1}else 0===m&&(this.twoPartsAssembledModifiersIdsByGroupId[t]=[]);h&&!this.twoPartsAssembledModifiersIdsByGroupId[t].find((function(e){return e==o}))&&this.twoPartsAssembledModifiersIdsByGroupId[t].push(o),this.modifiersValueTree[t][o]=h,this.calculateTotalAmountInGroup(t),this.calculateTotalPrice()},e.prototype.changeModifierAmount=function(e,r,i){if(!(r<0)){var t=this.getModifiersIds(e),o=t.groupId,s=void 0===o?"single":o,d=t.modifierId,a=e.minAmount,c=e.maxAmount,h=this.modifiers.indexById[s]||{},m=h.minAmount,p=void 0===m?0:m,l=h.maxAmount,u=void 0===l?0:l,f=this.modifiersValueTree[s][d];if("checkbox"==i&&"single"!==s){if(p<=1&&1==u){if(r<p)return;for(var g in this.modifiersValueTree[s])this.modifiersValueTree[s][g]=0;this.calculateTotalAmountInGroup(s)}if(0==r)return void this.calculateTotalPrice()}if(p||u){var v=this.modifiers.indexById[s].totalAmount-f+r;if(v<p)return console.warn("Limit: min "+p+". Current "+v),void this.eventer.emitMessageEvent(new n.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[s].group.name+'" - не менее '+p));if(v>u)return console.warn("Limit: max "+u+". Current "+v),void this.eventer.emitMessageEvent(new n.EventMessage("warning","Ограничение",'Максимальное количество опций для группы\n            модификаторов "'+this.modifiers.indexById[s].group.name+'" - не более '+u))}if(a||c){if(r<a)switch(i){case"plus":r=a;break;case"minus":r=0}r>c&&(r=c)}this.modifiersValueTree[s][d]=r,this.calculateTotalAmountInGroup(s),this.calculateTotalPrice()}},e.prototype.setModifiers=function(){var e=[];for(var r in this.modifiersValueTree)for(var i in this.modifiersValueTree[r]){var t=this.modifiersValueTree[r][i];t&&e.push({id:i,amount:t,groupId:"single"!==r?r:void 0})}e.length&&(this.checkValid(),this.cartService.setModifires(e,[]))},e.prototype.checkValid=function(){var e=!0;for(var r in this.modifiersValueTree){var i=this.modifiers.indexById[r];if(i.required){var t=this.calculateTotalAmountInGroup(r);t<i.minAmount&&(e=!1,console.warn("Modifier "+r+" min amount: "+i.minAmount)),t>i.maxAmount&&(e=!1,console.warn("Modifier "+r+" max amount: "+i.maxAmount))}}this.validate.emit(e)},e}();v.decorators=[{type:r.Component,args:[{selector:"rst-dish-calc",template:'<div *ngIf="dish" class="ng-cart-dish-calc" [ngClass]="{\'ng-cart-dish-calc-two-parts-assembled\': isTwoPartsAssembledTemplate}">\r\n    <div class="dish">\r\n        <div class="dish-image-box">\r\n            <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\r\n        </div>\r\n        <div class="dish-description-box">\r\n            <div class="dish-name">{{ dish.name }}</div>\r\n            <div class="dish-ingredients">{{ dish.description }}</div>\r\n            <div class="dish-price-box">\r\n                <ng-container *ngIf="!modifiers.custom.fixed; else modifierFixedTemplate">\r\n                    <div class="price" [ngClass]="{\'zero-price\': !dish.price}">\r\n                        <span>{{ dish.price }}</span> ₽\r\n                    </div>\r\n                </ng-container>\r\n                <ng-template #modifierFixedTemplate>\r\n                    <ng-container *ngIf="modifiers.custom.fixed as modifier">\r\n                        <div class="modifier-fixed">\r\n                            <ng-container *ngFor="let childModifier of modifier.childModifiers">\r\n                                <div class="item"\r\n                                     [ngClass]="{selected: !!modifiersValueTree[modifier.modifierId][childModifier.modifierId]}"\r\n                                     (click)="changeModifierAmount(childModifier, 1, \'checkbox\')">\r\n                                    {{ childModifier.dish?.name }}\r\n                                </div>\r\n                            </ng-container>\r\n                        </div>\r\n                        <ng-container *ngFor="let childModifier of modifier.childModifiers">\r\n                            <ng-container *ngIf="!!modifiersValueTree[modifier.modifierId][childModifier.modifierId]">\r\n                                <div class="price" [ngClass]="{\'zero-price\': !childModifier.dish?.price}">\r\n                                    <span>{{ childModifier.dish?.price }}</span> ₽\r\n                                </div>\r\n                            </ng-container>\r\n                        </ng-container>\r\n                    </ng-container>\r\n                </ng-template>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modifiers" *ngIf="modifiers.baseList?.length">\r\n        <ng-container *ngFor="let modifier of modifiers.baseList">\r\n            <div class="modifier-group">\r\n                <ng-container *ngIf="modifier.dish">\r\n                    <div class="modifier-header" *ngIf="modifier.group as group">\r\n                        <div class="modifier-name" *ngIf="group.name">{{ group.name }}</div>\r\n                        <div class="modifier-description" *ngIf="group.description">{{ group.description }}</div>\r\n                    </div>\r\n\r\n                    <div class="modifier-box" [ngClass]="{\'without-images\': !modifier.childImagesIsset}">\r\n                        \x3c!-- Single modifier --\x3e\r\n                        <ng-container *ngTemplateOutlet="modifierTemplate; context: {\r\n                            modifier: modifier,\r\n                            groupId: \'single\',\r\n                            amount: modifiersValueTree[\'single\'][modifier.modifierId],\r\n                            groupAmount: modifiersValueTree[\'single\'][modifier.modifierId],\r\n                            groupMinAmount: modifier.minAmount || 0,\r\n                            groupMaxAmount: modifier.maxAmount || 100\r\n                        }"></ng-container>\r\n                    </div>\r\n                </ng-container>\r\n\r\n                <ng-container *ngIf="modifier.childModifiers?.length">\r\n                    <ng-container *ngIf="modifier.minAmount == 2 && modifier.maxAmount == 2; then twoPartsAssembledTemplate else groupTemplate">\r\n                    </ng-container>\r\n\r\n                    \x3c!-- Base group modifier view --\x3e\r\n                    <ng-template #groupTemplate>\r\n                        <div class="modifier-header" *ngIf="modifier.group as group">\r\n                            <div class="modifier-name" *ngIf="group.name">{{ group.name }}</div>\r\n                            <div class="modifier-description" *ngIf="group.description">{{ group.description }}</div>\r\n                        </div>\r\n                        <div class="modifier-children" [ngClass]="{\'without-images\': !modifier.imagesIsset}">\r\n                            <ng-container *ngFor="let childModifier of modifier.childModifiers">\r\n                                \x3c!-- Group modifier --\x3e\r\n                                <ng-container *ngTemplateOutlet="modifierTemplate; context: {\r\n                            modifier: childModifier,\r\n                            groupId: modifier.modifierId,\r\n                            amount: modifiersValueTree[modifier.modifierId][childModifier.modifierId],\r\n                            groupAmount: modifiers.indexById[modifier.modifierId].totalAmount,\r\n                            groupMinAmount: modifier.minAmount || 0,\r\n                            groupMaxAmount: modifier.maxAmount || 100\r\n                        }"></ng-container>\r\n\r\n                            </ng-container>\r\n                        </div>\r\n                    </ng-template>\r\n\r\n                    \x3c!-- Two parts assembled group modifier view (like pizza from two halves) --\x3e\r\n                    <ng-template #twoPartsAssembledTemplate>\r\n                        <div class="two-parts-assembled">\r\n                            <div class="two-parts-assembled-header" [ngClass]="{empty: !twoPartsAssembledModifiersIdsByGroupId[modifier.modifierId]?.length}">\r\n                                <ng-container *ngFor="let childModifier of modifier.childModifiers">\r\n                                    <ng-container *ngIf="modifiersValueTree[modifier.modifierId][childModifier.modifierId]">\r\n                                        <ng-container *ngIf="childModifier.dish as dish">\r\n                                            <div class="selected-dish">\r\n                                                <div class="title">{{ dish.name }}</div>\r\n                                                <div class="image-box">\r\n                                                    <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\r\n                                                </div>\r\n                                            </div>\r\n                                        </ng-container>\r\n                                        <ng-container *ngIf="modifiers.indexById[modifier.modifierId].totalAmount == 1">\r\n                                            <div class="selected-dish">\r\n                                                <div class="title">Выберите половину</div>\r\n                                                <div class="image-box">\r\n                                                    <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: {} }"></ng-container>\r\n                                                </div>\r\n                                            </div>\r\n                                        </ng-container>\r\n                                    </ng-container>\r\n                                </ng-container>\r\n                            </div>\r\n\r\n                            <div class="two-parts-assembled-body">\r\n                                <div class="two-parts-assembled-body-name">Выберите любые две половинки</div>\r\n                                <div class="two-parts-assembled-body-list">\r\n                                    <ng-container *ngFor="let childModifier of modifier.childModifiers">\r\n                                        <div class="two-parts-assembled-body-list-dish"\r\n                                             (click)="selectTwoPartsAssembledModifier(childModifier)"\r\n                                             [ngClass]="{selected: modifiersValueTree[modifier.modifierId][childModifier.modifierId]}"\r\n                                             *ngIf="childModifier.dish as dish">\r\n                                            <div class="image-box">\r\n                                                <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\r\n                                            </div>\r\n                                            <div class="dish-name">\r\n                                                {{ dish.name }}\r\n                                            </div>\r\n                                            <div class="dish-price">\r\n                                                <div [ngClass]="{\'zero-price\': !dish.price}">\r\n                                                    <span>{{ dish.price }}</span> ₽\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </ng-container>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </ng-template>\r\n\r\n\r\n                </ng-container>\r\n\r\n            </div>\r\n        </ng-container>\r\n    </div>\r\n    <div class="result">\r\n        <span class="text">ИТОГО:</span>\r\n        <span class="price">\r\n            <span>{{ totalPrice}}</span> ₽\r\n        </span>\r\n    </div>\r\n    <div class="comment" *ngIf="isTwoPartsAssembledTemplate">\r\n        <div class="title">Комментарий</div>\r\n        <div class="input-box">\r\n            <input #commentInput type="text" placeholder="" (keyup)="comment.emit(commentInput.value)">\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n\x3c!-- Template block #dishImageTemplate --\x3e\r\n\r\n<ng-template #dishImageTemplate let-dish="dish">\r\n    <ng-container *ngIf="dish?.images && dish.images[0]?.images?.small; else imgPlaceholder">\r\n        <div class="dish-image" [style.backgroundImage]="\'url(\' + imageUrl + dish.images[0].images.small + \')\'"></div>\r\n    </ng-container>\r\n    <ng-template #imgPlaceholder>\r\n        <div class="dish-image-placeholder"></div>\r\n    </ng-template>\r\n</ng-template>\r\n\r\n\x3c!-- Template block #modifierTemplate --\x3e\r\n\r\n<ng-template #modifierTemplate\r\n             let-modifier="modifier"\r\n             let-groupId="groupId"\r\n             let-amount="amount"\r\n             let-groupAmount="groupAmount"\r\n             let-groupMinAmount="groupMinAmount"\r\n             let-groupMaxAmount="groupMaxAmount">\r\n    <ng-container *ngIf="modifier.dish as dish">\r\n        <div class="modifier-dish">\r\n            <div class="modifier-dish-image-box">\r\n                <ng-container *ngTemplateOutlet="dishImageTemplate; context: { dish: dish }"></ng-container>\r\n            </div>\r\n            <div class="modifier-dish-description-box">\r\n                <div class="modifier-dish-name">{{ dish.name }}</div>\r\n                <div class="modifier-dish-weight" *ngIf="dish.weight">{{ dish.weight * 1000 }} гр</div>\r\n            </div>\r\n            <div class="modifier-dish-price-box">\r\n                <div [ngClass]="{\'zero-price\': !dish.price}">\r\n                    <span>{{ dish.price }}</span> ₽\r\n                </div>\r\n            </div>\r\n            <div class="modifier-dish-action-box">\r\n                <ng-container *ngIf="groupMinAmount <= 1 && groupMaxAmount == 1; else counterTemplate">\r\n                    <ng-container *ngTemplateOutlet="modifierCheckboxTemplate; context: {\r\n                        modifier: modifier,\r\n                        groupId: groupId,\r\n                        amount: amount\r\n                    }"></ng-container>\r\n                </ng-container>\r\n\r\n                <ng-template #counterTemplate>\r\n                    <ng-container *ngTemplateOutlet="modifierCounterTemplate; context: {\r\n                        modifier: modifier,\r\n                        groupId: groupId,\r\n                        amount: amount,\r\n                        groupAmount: groupAmount,\r\n                        groupMinAmount: groupMinAmount,\r\n                        groupMaxAmount: groupMaxAmount\r\n                    }"></ng-container>\r\n                </ng-template>\r\n\r\n            </div>\r\n        </div>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\x3c!-- Template block #modifierCounterTemplate --\x3e\r\n\r\n<ng-template #modifierCounterTemplate\r\n             let-modifier="modifier"\r\n             let-groupId="groupId"\r\n             let-amount="amount"\r\n             let-groupAmount="groupAmount"\r\n             let-groupMinAmount="groupMinAmount"\r\n             let-groupMaxAmount="groupMaxAmount">\r\n    <ng-container>\r\n        <div class="modifier-counter" [ngClass]="{disabled: !amount && groupAmount >= groupMaxAmount}">\r\n            <div\r\n                    class="minus"\r\n                    [ngClass]="{disabled: !amount || groupAmount <= groupMinAmount}"\r\n                    (click)="changeModifierAmount(modifier, amount - 1, \'minus\')"\r\n                    onselectstart="return false;">-</div>\r\n            <input [value]="amount" readonly #input>\r\n            <div\r\n                    class="plus"\r\n                    [ngClass]="{disabled: groupAmount >= groupMaxAmount}"\r\n                    (click)="changeModifierAmount(modifier, amount + 1, \'plus\')"\r\n                    onselectstart="return false;">+</div>\r\n        </div>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\x3c!-- Template block #modifierCheckboxTemplate --\x3e\r\n\r\n<ng-template #modifierCheckboxTemplate\r\n             let-modifier="modifier"\r\n             let-groupId="groupId"\r\n             let-amount="amount">\r\n    <ng-container>\r\n        <div\r\n                class="modifier-checkbox"\r\n                [ngClass]="{selected: amount}"\r\n                (click)="changeModifierAmount(modifier, amount ? 0 : 1, \'checkbox\')"></div>\r\n    </ng-container>\r\n</ng-template>\r\n',styles:['.dish{align-items:flex-start;border-bottom:2px solid #969696;display:flex;padding-bottom:34px}.dish .dish-image-box{background-color:#eee;background-size:50%;box-sizing:border-box;height:170px;position:relative;text-align:center;width:250px}.dish .dish-description-box{align-items:stretch;box-sizing:border-box;display:flex;flex-direction:column;height:170px;margin-left:34px;padding:5px 0 0}.dish .dish-description-box .dish-name{color:#0a0909;font-size:28px;font-weight:700;letter-spacing:2.4px;line-height:32px}.dish .dish-description-box .dish-ingredients{color:#000;flex-grow:1;font-size:15px;line-height:17px;margin-top:15px;overflow:hidden}.dish .dish-description-box .dish-price-box{align-items:center;display:flex;font-size:20px;font-weight:700;height:45px;justify-content:space-between;line-height:23px;margin-right:49px}.ng-cart-dish-calc-two-parts-assembled .dish{border:none;margin-left:0;padding-bottom:0}.ng-cart-dish-calc-two-parts-assembled .dish .dish-image-box{display:none}.ng-cart-dish-calc-two-parts-assembled .dish .dish-description-box{height:auto;width:100%}.ng-cart-dish-calc-two-parts-assembled .dish .dish-description-box .dish-name{color:#0a0909;font-size:28px;font-weight:700;letter-spacing:2.4px;line-height:32px;text-align:center;text-transform:uppercase}.ng-cart-dish-calc-two-parts-assembled .dish .dish-description-box .dish-ingredients,.ng-cart-dish-calc-two-parts-assembled .dish .dish-description-box .dish-price-box{display:none}.dish-image{background-position:top;background-repeat:no-repeat;background-size:cover;border-radius:0;height:100%;width:250px}.result{color:#0a0909;font-size:24px;font-weight:700;line-height:28px;margin-top:49px;text-align:right}.result .price{margin-left:76px}.comment{padding-bottom:15px}.comment .title{color:#0a0909;font-size:20px;font-weight:500;line-height:23px;margin:30px 0 20px}.comment .input-box{margin-top:10px}.comment .input-box input{border:2px solid #969696;border-radius:15px;box-sizing:border-box;color:#969696;font-size:20px;font-style:italic;font-weight:400;height:45px;line-height:45px;padding:0 20px}.modifiers .modifier-group{border-bottom:2px solid #969696;margin-top:25px;padding-bottom:25px}.modifiers .modifier-header{margin-bottom:25px}.modifiers .modifier-header .modifier-name{color:#0a0909;font-size:20px;font-weight:500;line-height:23px}.modifiers .modifier-header .modifier-description{color:#0a0909;font-size:15px;line-height:17px}.modifiers .modifier-dish{align-items:center;box-sizing:border-box;display:flex;height:100px;justify-content:center;margin-bottom:2px}.modifiers .modifier-dish .modifier-dish-image-box{background-color:#fff;background-size:50%;box-sizing:border-box;height:100px;margin-right:28px;position:relative;text-align:center;width:100px}.modifiers .modifier-dish .modifier-dish-image-box .dish-image{background-position:50%;background-size:contain;height:100%;width:100%}.modifiers .modifier-dish .modifier-dish-description-box{display:flex;flex-direction:column;flex-grow:1;justify-content:center}.modifiers .modifier-dish .modifier-dish-description-box .modifier-dish-name{color:#0a0909;font-size:20px;font-weight:500;line-height:23px}.modifiers .modifier-dish .modifier-dish-description-box .modifier-dish-weight{color:#0a0909;font-size:20px;line-height:23px;margin-top:10px}.modifiers .modifier-dish .modifier-dish-price-box{color:#0a0909;font-size:20px;font-weight:700;line-height:23px;margin-right:105px}.modifiers .modifier-dish .modifier-dish-price-box .zero-price{display:none}.modifiers .modifier-dish .modifier-dish-action-box{display:flex;justify-content:center;width:151px}.two-parts-assembled .two-parts-assembled-header{align-items:center;border-bottom:2px solid #969696;display:flex;height:230px;justify-content:center;opacity:1;overflow:hidden;padding-bottom:28px;transition:all .5s ease 0s}.two-parts-assembled .two-parts-assembled-header.empty{border-bottom:none;height:0;opacity:0}.two-parts-assembled .two-parts-assembled-header .selected-dish{align-items:center;display:flex;justify-content:flex-end;width:50%}.two-parts-assembled .two-parts-assembled-header .selected-dish .title{color:#0a0909;font-size:21px;line-height:25px;margin-right:24px}.two-parts-assembled .two-parts-assembled-header .selected-dish .image-box{height:200px;overflow:hidden;width:100px}.two-parts-assembled .two-parts-assembled-header .selected-dish .image-box .dish-image{height:100%;width:200%}.two-parts-assembled .two-parts-assembled-header .selected-dish:nth-child(2){flex-direction:row-reverse}.two-parts-assembled .two-parts-assembled-header .selected-dish:nth-child(2) .title{margin-left:24px}.two-parts-assembled .two-parts-assembled-header .selected-dish:nth-child(2) .image-box{direction:rtl}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-name{color:#0a0909;font-size:20px;font-weight:500;line-height:23px;padding:20px 0}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list{display:grid;grid-column-gap:30px;grid-row-gap:24px;grid-template-columns:1fr 1fr 1fr;margin-top:30px}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish{align-items:center;border:1.5px solid hsla(0,0%,100%,0);box-sizing:border-box;color:#0a0909;cursor:pointer;display:flex;flex-direction:column}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish.selected{border:1.5px solid #0a0909;border-radius:15px}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish .dish-name{font-size:17px;font-weight:500;letter-spacing:2.4px;line-height:20px;padding:0 5px;text-align:center;text-transform:uppercase}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish .dish-price{font-size:20px;font-weight:700;line-height:23px;padding:5px 0 10px}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish .image-box{border-radius:15px 15px 0 0;height:228px;width:228px}.two-parts-assembled .two-parts-assembled-body .two-parts-assembled-body-list .two-parts-assembled-body-list-dish .image-box .dish-image{border-radius:15px 15px 0 0;height:100%;width:100%}.modifier-fixed{align-items:stretch;border:2px solid #767676;border-radius:15px;box-sizing:border-box;display:flex;height:45px}.modifier-fixed .item{align-items:center;color:#767676;display:flex;font-size:20px;font-weight:500;height:45px;justify-content:center;line-height:23px;margin-top:-2px;width:142px}.modifier-fixed .item:first-child{margin-left:-2px}.modifier-fixed .item:last-child{margin-right:-2px}.modifier-fixed .item.selected{background:#0a0909;border-radius:15px;color:#fff}.modifier-fixed .item:not(.selected){cursor:pointer}.modifier-checkbox{align-items:center;background:#e0e0e0;border-radius:15px;cursor:pointer;display:flex;height:50px;justify-content:center;width:50px}.modifier-checkbox.selected:after{content:url("data:image/svg+xml; base64, PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMTMuNUwxMS4zMjMxIDI2TDI2IDIiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMy41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cg==")}.modifier-counter{align-items:center;background:#e0e0e0;border:none;border-radius:15px;display:flex;height:50px;position:relative;width:151px}.modifier-counter.disabled{opacity:.3}.modifier-counter:not(.disabled) .minus.disabled,.modifier-counter:not(.disabled) .plus.disabled{cursor:default;opacity:.15}.modifier-counter input{background:transparent;border:none;font-weight:500;padding:0;width:100%}.modifier-counter .minus,.modifier-counter .plus,.modifier-counter input{color:#0a0909;font-size:18px;height:50px;line-height:50px;text-align:center}.modifier-counter .minus,.modifier-counter .plus{cursor:pointer;display:block;font-style:normal;font-weight:700;padding:0 30px;position:absolute;top:0}.modifier-counter .minus:hover,.modifier-counter .plus:hover{color:#000}.modifier-counter .minus:active,.modifier-counter .plus:active{color:#cc0009}.modifier-counter .minus.loading,.modifier-counter .plus.loading{opacity:.2}.modifier-counter .minus{left:0}.modifier-counter .plus{right:0}.without-images .modifier-dish-image-box{height:70px!important}.without-images .modifier-dish{height:70px}']}]}],v.ctorParameters=function(){return[{type:s},{type:n.EventerService},{type:String,decorators:[{type:r.Inject,args:["ImageUrl"]}]}]},v.propDecorators={dish:[{type:r.Input}],amount:[{type:r.Input}],selectedModifiers:[{type:r.Input}],validate:[{type:r.Output}],amountDishToAdd:[{type:r.Output}],comment:[{type:r.Output}]};var I=function(){};I.decorators=[{type:r.NgModule,args:[{imports:[o.CommonModule],providers:[],declarations:[d,a,h,l,p,m,f,u,c,v],exports:[d,a,h,l,p,m,f,u,c,v]}]}],e.AddDishToCartDirective=d,e.AmountCartDirective=a,e.CheckoutDirective=c,e.DeleteFromCartDirective=h,e.DishCalcComponent=v,e.DishCalcDirective=m,e.ModifiresDirective=p,e.NgRestoCartModule=I,e.NgRestoCartService=s,e.OrderCartUserDirective=l,e.SetAmountDirective=u,e.SetDishCommentDirective=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=webresto-ng-cart.umd.min.js.map