{"version":3,"file":"webresto-ng-cart.js","sources":["../esm2015/projects/webresto/ng-cart/src/lib/services/ng-restocart.service.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/add-dish-to-cart.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/amount-cart.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/checkout.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/delete-from-cart.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/dish-calc.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/modifires.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/order-cart-user.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/set-amount.directive.ts","../esm2015/projects/webresto/ng-cart/src/lib/directives/set-dish-comment.directive.ts","../esm2015/lib/projects/webresto/ng-cart/src/lib/components/dish-calc/dish-calc.component.ts","../projects/webresto/ng-cart/src/lib/ng-cart.module.ts","../../projects/webresto/ng-cart/src/public_api.ts","../../projects/webresto/ng-cart/src/webresto-ng-cart.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Observable, BehaviorSubject, throwError, from } from 'rxjs';\r\nimport { catchError, filter, map, switchMap, tap } from 'rxjs/operators';\r\nimport { NetService, EventerService, EventMessage } from '@webresto/ng-core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgRestoCartService {\r\n  cartID: string = this.getCartId();\r\n  cart: BehaviorSubject<Cart> = new BehaviorSubject(null);\r\n  modifires: BehaviorSubject<any> = new BehaviorSubject([]);\r\n  OrderFormChange = new BehaviorSubject(null);\r\n\r\n  modifiresMessage: BehaviorSubject<EventMessage[]> = new BehaviorSubject([]);\r\n\r\n  constructor(private net: NetService, private eventer: EventerService) { }\r\n\r\n  restrictions$ = this.net.get<RestrictionsOrder>(`/restrictions`)\r\n\r\n  getCartId(): string {\r\n    return localStorage.getItem('cartID');\r\n  }\r\n\r\n  getCart() {\r\n    return this.net.get<{ cart: Cart }>(`/cart${this.cartID ? '?cartId=' + this.cartID : ''}`).pipe(\r\n      switchMap(data => {\r\n        if (!data) {\r\n          this.removeCartId();\r\n        };\r\n        return data ? from([data]) : this.net.get<{ cart: Cart }>(`/cart}`)\r\n      }),\r\n      switchMap(\r\n        data => {\r\n          if (data.cart.state == 'ORDER') {\r\n            return throwError(new Error('Cart in order state'));\r\n          } else {\r\n            if (!this.cartID || this.cartID !== data?.cart?.cartId) {\r\n              this.setCartId(data.cart.cartId);\r\n            };\r\n            this.cart.next(data.cart);\r\n          };\r\n          return this.cart;\r\n        }),\r\n      catchError(err => {\r\n        this.removeCartId();\r\n        return throwError(err);\r\n      })\r\n    );\r\n  }\r\n\r\n  addDishToCart(data) {\r\n    if (this.modifiresMessage.value.length) {\r\n      this.modifiresMessage.value.forEach(message => {\r\n        this.eventer.emitMessageEvent(message);\r\n      });\r\n      return;\r\n    }\r\n\r\n    this.net.put('/cart/add', data).subscribe(\r\n      res => {\r\n        this.setCartId(res.cart.cartId);\r\n        this.cart.next(res.cart);\r\n        this.cartID = res.cart.cartId;\r\n\r\n        /*this.eventer.emitMessageEvent(\r\n         new EventMessage('success', 'Успех', 'Блюдо добавлено в корзину')\r\n         );*/\r\n\r\n      }, () => {\r\n        /*this.eventer.emitMessageEvent(\r\n         new EventMessage('error', 'Ошибка', 'Не удалось добавить блюдо')\r\n         )*/\r\n      });\r\n  }\r\n\r\n  addDishToCart$(data) {\r\n    if (this.modifiresMessage.value.length) {\r\n      this.modifiresMessage.value.forEach(message => {\r\n        this.eventer.emitMessageEvent(message);\r\n      });\r\n      return from([null]);\r\n    }\r\n\r\n    return this.net.put('/cart/add', data)\r\n      .pipe(\r\n        tap(res => {\r\n          this.setCartId(res.cart.cartId);\r\n          this.cart.next(res.cart);\r\n          this.cartID = res.cart.cartId;\r\n        })\r\n      );\r\n  }\r\n\r\n  setDishCountToCart(dishId, amount) {\r\n    const sub = this.net.post<any,{cart:Cart,message:any}>('/cart/set', {\r\n      dishId: dishId,\r\n      cartId: this.cartID,\r\n      amount: amount\r\n    }).subscribe(\r\n      res => {\r\n        this.setCartId(res.cart.cartId);\r\n        this.cart.next(res.cart);\r\n        this.cartID = res.cart.cartId;\r\n        /*this.eventer.emitMessageEvent(\r\n         new EventMessage('success', 'Успех', 'Изменено количество')\r\n         );*/\r\n      }, () => {\r\n        /*this.eventer.emitMessageEvent(\r\n         new EventMessage('error', 'Ошибка', 'Не удалось изменить количество')\r\n         )*/\r\n      }, () => sub.unsubscribe()\r\n    );\r\n  }\r\n\r\n  setDishComment(dishId, comment) {\r\n    return this.net.post('/cart/setcomment', {\r\n      dishId: dishId,\r\n      cartId: this.cartID,\r\n      comment: comment\r\n    }).pipe(tap(\r\n      res => {\r\n        this.setCartId(res.cart.cartId);\r\n        this.cart.next(res.cart);\r\n        this.cartID = res.cart.cartId;\r\n\r\n      }, () => { }\r\n    ))\r\n\r\n  }\r\n\r\n  removeDishFromCart$(dishId, amount) {\r\n    return this.net.put('/cart/remove', {\r\n      dishId: dishId,\r\n      cartId: this.cartID,\r\n      amount: amount\r\n    })\r\n      .pipe(tap(result => {\r\n        this.setCartId(result.cart.cartId);\r\n        this.cart.next(result.cart);\r\n        this.cartID = result.cart.cartId;\r\n      }));\r\n\r\n  }\r\n\r\n  removeDishFromCart(dishId, amount) {\r\n    const sub = this.net.put('/cart/remove', {\r\n      dishId: dishId,\r\n      cartId: this.cartID,\r\n      amount: amount\r\n    }).subscribe(\r\n      result => {\r\n        this.setCartId(result.cart.cartId);\r\n        this.cart.next(result.cart);\r\n        this.cartID = result.cart.cartId;\r\n        /*this.eventer.emitMessageEvent(\r\n         new EventMessage('success', 'Успех', 'Блюдо успешно удалено')\r\n         );*/\r\n\r\n      }, () => {\r\n        /*this.eventer.emitMessageEvent(\r\n         new EventMessage('error', 'Ошибка', 'Не удалось удалить блюдо')\r\n         )*/\r\n      }, () => sub.unsubscribe()\r\n    );\r\n\r\n  }\r\n\r\n  checkoutCart(data) {\r\n    let order = {\r\n      cartId: this.cartID,\r\n      address: {\r\n        streetId: data.street.id,\r\n        home: data.house,\r\n        housing: data.housing,\r\n        // index: \"1278\",\r\n        entrance: data.entrance,\r\n        floor: data.floor,\r\n        apartment: data.apartment\r\n      },\r\n\r\n      customer: {\r\n        phone: data.phone,\r\n        name: data.name,\r\n        mail: data.email || undefined\r\n      }\r\n    };\r\n    return this.orderCart(order);\r\n\r\n  }\r\n\r\n  orderCart(data) {\r\n    return this.net.post<any,{cart:Cart,message:any}>('/order', data)\r\n      .pipe(\r\n        tap(\r\n          result => {\r\n            this.setCartId(result.cart.cartId);\r\n            this.cart.next(result.cart);\r\n            this.cartID = result.cart.cartId;\r\n          },\r\n          error => {\r\n            console.log(\"Ошибка оформления!\", error);\r\n            if (error.error && error.error.cart) {\r\n              this.setCartId(error.error.cart.cartId);\r\n              this.cart.next(error.error.cart);\r\n              this.cartID = error.error.cart.cartId;\r\n            }\r\n            /*if (error.message) {\r\n              this.eventer.emitMessageEvent(\r\n                new EventMessage(error.message.type, error.message.title, error.message.body)\r\n              );\r\n            } else {\r\n              this.eventer.emitMessageEvent(\r\n                new EventMessage('error', 'Ошибка', 'Не удалось оформить заказ')\r\n              );\r\n            }*/\r\n          }\r\n        )\r\n      );\r\n  }\r\n\r\n  checkStreetV2(data): Observable<{cart:Cart,message:any}> {\r\n    return this.net.post<any,{cart:Cart,message:any}>('/check', data)\r\n      .pipe(\r\n        tap(\r\n          result => {\r\n            this.setCartId(result.cart.cartId);\r\n            this.cart.next(result.cart);\r\n            this.cartID = result.cart.cartId;\r\n          },\r\n          () => { }\r\n        )\r\n      );\r\n  }\r\n\r\n  checkStreet(data): void {\r\n    const sub = this.net.post<any,{cart:Cart, message:any}>('/check', data).subscribe(\r\n      res => {\r\n        this.setCartId(res.cart.cartId);\r\n        this.cart.next(res.cart);\r\n        this.cartID = res.cart.cartId;\r\n      }, error => {\r\n        if (error.error) {\r\n          if (error.error.cart) {\r\n            this.setCartId(error.error.cart.cartId);\r\n            this.cart.next(error.error.cart);\r\n            this.cartID = error.error.cart.cartId;\r\n          }\r\n          /*this.eventer.emitMessageEvent(\r\n           new EventMessage(error.error.message.type, error.error.message.title, error.error.message.body)\r\n           );*/\r\n        }\r\n      }, () => sub.unsubscribe());\r\n\r\n  }\r\n\r\n  setCartId(cartID) {\r\n    localStorage.setItem('cartID', cartID);\r\n    this.cartID = cartID;\r\n  }\r\n\r\n  removeCartId() {\r\n    localStorage.removeItem('cartID');\r\n    this.cartID = null;\r\n  }\r\n\r\n  userCart(): Observable<Cart> {\r\n    return this.cart;\r\n  }\r\n\r\n  setModifires(modifires, messages?: EventMessage[]): void {\r\n    this.modifires.next(modifires);\r\n    if (messages) {\r\n      this.modifiresMessage.next(messages);\r\n    };\r\n  }\r\n\r\n  getModifires(): Observable<any> {\r\n    return this.modifires.pipe();\r\n  }\r\n\r\n  productInCart(product: DishListItem) {\r\n    return this.cart.pipe(\r\n      filter(cart => 'cartId' in cart),\r\n      map(cart => {\r\n        return !!(cart && cart?.dishes?.find(dishInCart => dishInCart.dish.id === product.id))\r\n      })\r\n    );\r\n  }\r\n\r\n  getPickupPoints(cartId: string) {\r\n    return this.net.get<PickupPoint[]>('/pickupaddreses', true, {\r\n      params: {\r\n        cartId\r\n      }\r\n    });\r\n  }\r\n\r\n  getPaymentMethods(cartId: string) {\r\n    return this.net.get<PaymentMethod[]>('/paymentmethods', true, {\r\n      params: {\r\n        cartId\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\nexport declare interface PickupPoint {\r\n  id: string;\r\n  title: string;\r\n  address: string;\r\n  order: number;\r\n  enable: boolean;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport declare interface PaymentMethod {\r\n  iikoPaymentMethod: any,\r\n  id: string,\r\n  title: string,\r\n  type: string,\r\n  adapter: string,\r\n  order: number,\r\n  description: string,\r\n  enable: boolean,\r\n  createdAt: string,\r\n  updatedAt: string\r\n}\r\n\r\nexport declare interface DishInCart {\r\n  addedBy: string;\r\n  amount: number;\r\n  cart: string;\r\n  comment: string;\r\n  createdAt: string;\r\n  dish: DishListItem;\r\n  id: number;\r\n  itemTotal: number;\r\n  modifiers: any[];\r\n  parent: any;\r\n  totalWeight: number;\r\n  uniqueItems: number;\r\n  updatedAt: string;\r\n  weight: number;\r\n}\r\n\r\nexport declare interface Cart {\r\n  address: any\r\n  cartId: string\r\n  cartTotal: number\r\n  comment: string\r\n  createdAt: string\r\n  customer: string\r\n  delivery: any\r\n  deliveryDescription: string\r\n  deliveryItem: any\r\n  deliveryStatus: any\r\n  dishes: DishInCart[]\r\n  dishesCount: number\r\n  history: any\r\n  id: string\r\n  message: any\r\n  modifiers: any\r\n  nameOfModel: any\r\n  personsCount: number\r\n  problem: boolean\r\n  rmsId: string\r\n  selfDelivery: boolean\r\n  sendToIiko: boolean\r\n  state: string\r\n  totalWeight: string\r\n  uniqueDishes: string\r\n  updatedAt: string\r\n  user: any\r\n  FreeDeliveryFromMessage: string\r\n  date: null\r\n  deliveryTimeMessage: string\r\n  deliveryCost: number\r\n  discountTotal: number\r\n  isPaymentPromise: boolean\r\n  orderDate: string\r\n  orderDateLimit: string\r\n  orderTotal: number\r\n  paid: boolean\r\n  paymentMethod: string\r\n  paymentMethodTitle: string\r\n  recommends: DishListItem[];\r\n  rmsDelivered: boolean\r\n  rmsDeliveryDate: null\r\n  rmsErrorCode: null\r\n  rmsErrorMessage: null\r\n  rmsOrderData: null\r\n  rmsOrderNumber: null\r\n  rmsStatusCode: null\r\n  selfService: boolean\r\n  shortId: string\r\n  total: number\r\n  untilFreeDeliveryMessage: string\r\n}\r\n\r\nexport declare interface DishListItem {\r\n  additionalInfo: any\r\n  balance: number\r\n  carbohydrateAmount: number\r\n  carbohydrateFullAmount: number\r\n  code: string\r\n  createdAt: string\r\n  description: string\r\n  differentPricesOn: any[]\r\n  doNotPrintInCheque: boolean\r\n  energyAmount: number\r\n  energyFullAmount: number\r\n  fatAmount: number\r\n  fatFullAmount: number\r\n  fiberAmount: number\r\n  fiberFullAmount: number\r\n  groupId: any\r\n  groupModifiers: []\r\n  hash: number\r\n  id: string\r\n  images: DishImageItem[]\r\n  imagesList: DishImageItem[]\r\n  isDeleted: boolean\r\n  isIncludedInMenu: boolean\r\n  measureUnit: string\r\n  modifiers: DishModifier[]\r\n  name: string\r\n  order: number\r\n  parentGroup: string\r\n  price: number\r\n  productCategoryId: string\r\n  prohibitedToSaleOn: any[]\r\n  rmsId: string\r\n  seoDescription: any\r\n  seoKeywords: any\r\n  seoText: any\r\n  seoTitle: any\r\n  slug: string\r\n  tags: any[]\r\n  tagsList: any[]\r\n  type: string\r\n  updatedAt: string\r\n  useBalanceForSell: boolean\r\n  weight: number\r\n}\r\n\r\nexport declare interface DishImageUrls {\r\n  large: string\r\n  origin: string\r\n  small: string\r\n}\r\n\r\nexport declare interface DishImageItem {\r\n  createdAt: string\r\n  group: any\r\n  id: string\r\n  images: DishImageUrls\r\n  updatedAt: string\r\n  uploadDate: string\r\n}\r\n\r\nexport declare interface DishBaseModifier {\r\n  maxAmount: number\r\n  minAmount: number\r\n  modifierId: string\r\n  required: boolean\r\n}\r\n\r\nexport declare interface DishModifier extends DishBaseModifier {\r\n  childModifiers: DishChildModifier[]\r\n  childModifiersHaveMinMaxRestrictions: boolean\r\n  group: DishListItem\r\n}\r\n\r\nexport declare interface DishChildModifier extends DishBaseModifier {\r\n  defaultAmount: number\r\n  hideIfDefaultAmount: boolean\r\n  dish: DishListItem\r\n}\r\n\r\nexport declare interface WorkTimeBase {\r\n  start: string;\r\n  stop: string;\r\n  break: string;\r\n}\r\n\r\nexport declare interface WorkTime extends WorkTimeBase {\r\n  dayOfWeek: string\r\n  selfService: WorkTimeBase\r\n}\r\n\r\nexport declare interface RestrictionsOrder {\r\n  minDeliveryTime: string\r\n  deliveryToTimeEnabled: boolean\r\n  periodPossibleForOrder: number\r\n  timezone: string\r\n  workTime: WorkTime[]\r\n}\r\n\r\n","import { Directive, HostListener, Input, Output, EventEmitter } from '@angular/core';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { Cart, NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstAddToCart]'\r\n})\r\nexport class AddDishToCartDirective {\r\n\r\n  cart:Cart;\r\n  @Input() modifires: any;\r\n\r\n  constructor(private cartService: NgRestoCartService) {\r\n\r\n    const sub = this.cartService.userCart().pipe(\r\n      switchMap(\r\n        res => {\r\n          this.cart = res;\r\n          return this.cartService.getModifires();\r\n        })\r\n    ).subscribe(\r\n      res => this.modifires = res, () => { }, () => sub.unsubscribe()\r\n    );\r\n  }\r\n\r\n\r\n  @Input() dish: any;\r\n  @Input() amountDish: any;\r\n  @Input() comment: string;\r\n\r\n  @Output() loading = new EventEmitter<boolean>();\r\n  @Output() success = new EventEmitter<boolean>();\r\n  @Output() error = new EventEmitter<any>();\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    this.addDishToCart(this.dish.id, this.amountDish)\r\n  }\r\n\r\n  private addDishToCart(dishID, amount) {\r\n\r\n    let data = {\r\n      dishId: dishID,\r\n      amount: amount,\r\n      cartId: undefined,\r\n      modifiers: this.modifires,\r\n      comment: this.comment\r\n    };\r\n\r\n    if (this.cart.cartId) data.cartId = this.cart.cartId;\r\n\r\n    this.loading.emit(true);\r\n\r\n    const sub = this.cartService\r\n      .addDishToCart$(data)\r\n      .subscribe(\r\n        () => this.success.emit(true),\r\n        e => this.error.emit(e),\r\n        () => {\r\n          this.loading.emit(false);\r\n          sub.unsubscribe();\r\n        }\r\n      );\r\n  }\r\n\r\n}\r\n","import { Directive, Renderer2, ElementRef } from '@angular/core';\r\nimport { Cart, NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstAmountCart]'\r\n})\r\nexport class AmountCartDirective {\r\n  cart: Cart;\r\n  amount: string;\r\n\r\n  constructor(\r\n    private cartService: NgRestoCartService,\r\n    private renderer: Renderer2,\r\n    private el: ElementRef\r\n  ) {\r\n\r\n    this.amount = '0';\r\n    this.renderer.setProperty(this.el.nativeElement, 'innerHTML', this.amount);\r\n    const sub = this.cartService.userCart().subscribe(\r\n      res => {\r\n        this.cart = res;\r\n        this.amount = String(res.dishesCount || 0);\r\n        this.renderer.setProperty(this.el.nativeElement, 'innerHTML', this.amount);\r\n      },\r\n      () => { }, () => sub.unsubscribe()\r\n    );\r\n  }\r\n\r\n\r\n}\r\n","import { Directive, Input, Output, HostListener, EventEmitter, SimpleChanges } from '@angular/core';\r\nimport { filter, debounceTime, } from 'rxjs/operators'\r\nimport { NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstCheckout]'\r\n})\r\nexport class CheckoutDirective {\r\n\r\n  @Input() cartTotal: any;\r\n\r\n  @Input() bonuses: any;\r\n\r\n  @Input() name: string;\r\n  @Input() email: string;\r\n  @Input() phone: string;\r\n  @Input() delivery: any;\r\n  @Input() selfService: any;\r\n  @Input() locationId: string;\r\n\r\n  @Input() street: string;\r\n  @Input() streetId: string;\r\n  @Input() home: string;\r\n  @Input() housing: string;\r\n  @Input() apartment: string;\r\n  @Input() entrance: string;\r\n  @Input() doorphone: string;\r\n  @Input() floor: string;\r\n\r\n  @Input() paymentMethod: string;\r\n  @Input() paymentMethodId: string;\r\n  @Input() personsCount: number;\r\n  @Input() comment: string;\r\n\r\n  @Input() date: string;\r\n  @Input() notifyMethodId: string;\r\n\r\n  @Output() success = new EventEmitter<boolean>();\r\n  @Output() error = new EventEmitter<string>();\r\n  @Output() isChecking = new EventEmitter<boolean>();\r\n\r\n\r\n  cart: any;\r\n  lastFormChangeKey: string;\r\n\r\n  constructor(private cartService: NgRestoCartService) {\r\n\r\n    this.cartService\r\n      .userCart()\r\n      .subscribe(cart => this.cart = cart);\r\n\r\n    this.cartService.OrderFormChange\r\n      .pipe(\r\n        filter(() => {\r\n          //if((this.locationId || this.streetId) && this.home && this.phone && this.preparePhone(this.phone).length > 11) {\r\n          if (this.locationId || (this.streetId || this.street) && this.home || this.selfService) {\r\n            return true;\r\n          }\r\n        }),\r\n        /*filter(() => {\r\n          const formChangeKey = JSON.stringify({\r\n            1: this.locationId,\r\n            2: this.streetId,\r\n            3: this.street,\r\n            4: this.home,\r\n            5: this.cartTotal,\r\n            6: this.bonuses,\r\n            7: this.delivery,\r\n            8: this.paymentMethodId\r\n          });\r\n\r\n          if(formChangeKey !== this.lastFormChangeKey) {\r\n            this.lastFormChangeKey = formChangeKey;\r\n            return true;\r\n          }\r\n        }),*/\r\n        debounceTime(1000)\r\n      )\r\n      .subscribe(() => this.checkStreet());\r\n  }\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    if (!this.locationId && !((this.streetId || this.street) && this.home) && !this.selfService) {\r\n      this.error.emit('Нужно указать адрес');\r\n      return;\r\n    }\r\n\r\n    let comment = this.comment || \"Не указан\";\r\n\r\n    let data = {\r\n      cartId: this.cart.cartId,\r\n      comment: comment,\r\n      customer: {\r\n        phone: this.preparePhone(this.phone),\r\n        mail: this.email,\r\n        name: this.name\r\n      },\r\n      personsCount: +this.personsCount\r\n    };\r\n\r\n    if (this.paymentMethodId) {\r\n      data[\"paymentMethodId\"] = this.paymentMethodId;\r\n    }\r\n\r\n    if (this.date) {\r\n      data[\"date\"] = this.date;\r\n    }\r\n\r\n    if (this.notifyMethodId) {\r\n      data[\"notifyMethodId\"] = this.notifyMethodId;\r\n    }\r\n\r\n    data[\"selfService\"] = this.selfService;\r\n\r\n\r\n    if (this.bonuses) {\r\n      data['bonuses'] = this.bonuses.map(b => {\r\n        return {\r\n          name: b.name,\r\n          amount: b.amount\r\n        }\r\n      });\r\n    }\r\n\r\n\r\n    if (this.locationId) {\r\n      data[\"locationId\"] = this.locationId;\r\n    } else {\r\n      data[\"address\"] = {\r\n        streetId: this.streetId,\r\n        street: this.street,\r\n        home: this.home,\r\n        housing: this.housing,\r\n        doorphone: this.doorphone || '',\r\n        entrance: this.entrance || '',\r\n        floor: this.floor || '',\r\n        apartment: this.apartment || ''\r\n      }\r\n    }\r\n\r\n    const cartId = this.cart.id;\r\n    this.cartService\r\n      .orderCart(data)\r\n      .subscribe(\r\n        result => {\r\n          if (result.action && result.action.paymentRedirect) {\r\n            window.location.href = result.action.paymentRedirect;\r\n          } else {\r\n            this.success.emit(cartId)\r\n          }\r\n        },\r\n        error => this.error.emit(error)\r\n      );\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    this.cartService.OrderFormChange.next(changes);\r\n  }\r\n\r\n  checkStreet() {\r\n\r\n    //if(this.streetId == '0') return;\r\n\r\n    let comment = this.comment || \"Не указан\";\r\n\r\n    let data = {\r\n      cartId: this.cart.cartId,\r\n      comment: comment,\r\n      customer: {\r\n        phone: this.phone ? this.preparePhone(this.phone) : null,\r\n        mail: this.email,\r\n        name: this.name || null\r\n      },\r\n      personsCount: +this.personsCount\r\n    };\r\n\r\n    data[\"selfService\"] = this.selfService;\r\n\r\n    if (this.paymentMethodId) {\r\n      data[\"paymentMethodId\"] = this.paymentMethodId;\r\n    }\r\n\r\n    if (this.date) {\r\n      data[\"date\"] = this.date;\r\n    }\r\n\r\n    if (this.notifyMethodId) {\r\n      data[\"notifyMethodId\"] = this.notifyMethodId;\r\n    }\r\n\r\n    if (this.locationId) {\r\n      data[\"locationId\"] = this.locationId;\r\n    } else {\r\n      data[\"address\"] = {\r\n        streetId: this.streetId,\r\n        street: this.street,\r\n        home: this.home,\r\n        housing: this.housing,\r\n        doorphone: this.doorphone || '',\r\n        entrance: this.entrance || '',\r\n        floor: this.floor || '',\r\n        apartment: this.apartment || ''\r\n      }\r\n    }\r\n\r\n    this.isChecking.emit(true);\r\n    this.cartService\r\n      .checkStreetV2(data)\r\n      .subscribe(\r\n        //() => this.success.emit(true),\r\n        //error => this.error.emit(error)\r\n        () => this.isChecking.emit(false),\r\n        () => this.isChecking.emit(false)\r\n      );\r\n  }\r\n\r\n\r\n  preparePhone(phone) {\r\n    if (!phone) return '';\r\n    phone = '+' + phone.replace(/[^0-9]/gim, '');\r\n    return phone.replace('+8', '+7');\r\n  }\r\n}\r\n","import { Directive, HostListener, Input } from '@angular/core';\r\nimport { Cart, NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstDeleteFromCart]'\r\n})\r\nexport class DeleteFromCartDirective {\r\n\r\n  cart:Cart;\r\n\r\n  constructor(private cartService: NgRestoCartService) {\r\n    const sub = this.cartService.userCart().subscribe(\r\n      res => this.cart = res, () => { }, () => sub.unsubscribe()\r\n    );\r\n  }\r\n\r\n\r\n  @Input() dish: any;\r\n  @Input() amountDish: any;\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    this.cartService.removeDishFromCart(this.dish.id, this.amountDish)\r\n  }\r\n\r\n}\r\n","import {\r\n  Directive, Renderer2, ElementRef,\r\n  HostListener, Input, Output, OnDestroy,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstDishCalc]'\r\n})\r\nexport class DishCalcDirective implements OnDestroy {\r\n\r\n  @Input()  dish:any;\r\n  @Input()  amount:any;\r\n  @Input()  selectedModifiers:any;\r\n  @Output()  validate:EventEmitter<any> = new EventEmitter();\r\n  @Output()  amountDishToAdd:EventEmitter<any> = new EventEmitter();\r\n\r\n  weightTotal;\r\n  amountDish;\r\n  price;\r\n  amountModifires:any = {};\r\n  stateModifiers:any = {};\r\n  testcountCall;\r\n\r\n  constructor(private renderer:Renderer2,\r\n              private el:ElementRef,\r\n              private cartService:NgRestoCartService) {\r\n\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.renderer.addClass(this.el.nativeElement, \"dish-calculator\");\r\n\r\n\r\n    this.amountDish = this.amount;\r\n\r\n    this.amountDishToAdd.emit(this.amountDish);\r\n    this.price = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(this.price, \"dish-price\");\r\n\r\n    setTimeout(() => {\r\n      this.renderDish(this.dish);\r\n      this.render(this.dish.modifiers);\r\n    }, 100);\r\n  }\r\n\r\n  renderDish(dish:any) {\r\n    /*\r\n     <div class=\"main-item\">\r\n     <div class=\"item-name\">\r\n     <div class=\"title\">{{dish.name}}</div>\r\n     </div>\r\n     <div class=\"item-quantity\">\r\n     <!-- increase button-->\r\n     <a class=\"item-quantity__button\" (click)=\"changeAmountdish(-1)\">&#8722;</a>\r\n     <span class=\"item-quantity__counter\" >{{amountDish}}</span>\r\n     <!-- decrease button-->\r\n     <a class=\"item-quantity__button\" (click)=\"changeAmountdish(1)\">&#x2b;</a>\r\n     </div>\r\n     <div class=\"weight-price\">\r\n     {{dish.price*amountDish}}&nbsp;&#x20bd;\r\n     </div>\r\n     </div>\r\n\r\n\r\n     */\r\n    let mainItem = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(mainItem, \"dish-wraper\");\r\n    this.renderer.appendChild(this.el.nativeElement, mainItem);\r\n\r\n    let itemName = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(itemName, \"name\");\r\n    this.renderer.appendChild(mainItem, itemName);\r\n\r\n    let title = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(title, \"title\");\r\n    this.renderer.setProperty(title, \"innerHTML\", this.dish.name);\r\n    this.renderer.appendChild(itemName, title);\r\n\r\n    let weightDishWrapper = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(itemName, \"weight\");\r\n    this.renderer.addClass(itemName, \"dish\");\r\n    this.renderer.appendChild(mainItem, weightDishWrapper);\r\n\r\n    let weightDishValue = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(weightDishValue, \"value\");\r\n    this.renderer.setProperty(\r\n      weightDishValue,\r\n      \"innerHTML\",\r\n      (this.dish.weight * 1000).toFixed(0) + \" г.\"\r\n    );\r\n    if (this.dish.weight === 0 || !this.dish.weight) {\r\n      this.renderer.addClass(weightDishValue, \"zero\");\r\n    }\r\n    this.renderer.appendChild(weightDishWrapper, weightDishValue);\r\n\r\n    this.renderer.setProperty(this.price, \"innerHTML\", this.dish.price);\r\n    let priceDishWrapper = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(priceDishWrapper, \"price\");\r\n    this.renderer.addClass(priceDishWrapper, \"total\");\r\n    this.renderer.appendChild(priceDishWrapper, this.price);\r\n    this.renderer.appendChild(mainItem, priceDishWrapper);\r\n\r\n    let itemQuant = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(itemQuant, \"quantity\");\r\n    this.renderer.appendChild(mainItem, itemQuant);\r\n\r\n    let addButton = this.renderer.createElement(\"a\");\r\n    this.renderer.addClass(addButton, \"quantity__button\");\r\n    this.renderer.addClass(addButton, \"minus\");\r\n    this.renderer.setProperty(addButton, \"innerHTML\", \"&#8722;\");\r\n    this.renderer.listen(addButton, \"click\", e => {\r\n      this.changeAmountdish(-1);\r\n      this.renderer.setProperty(counter, \"innerHTML\", this.amountDish);\r\n      this.renderer.setProperty(this.price, \"innerHTML\", this.generatePrice(this.dish.price));\r\n      this.innerTotalWeight(weightTotal)\r\n    });\r\n    this.renderer.appendChild(itemQuant, addButton);\r\n\r\n    let counter = this.renderer.createElement(\"span\");\r\n    this.renderer.addClass(counter, \"quantity__counter\");\r\n    this.renderer.setProperty(counter, \"innerHTML\", this.amountDish);\r\n    this.renderer.appendChild(itemQuant, counter);\r\n\r\n    let minusButton = this.renderer.createElement(\"a\");\r\n    this.renderer.addClass(minusButton, \"quantity__button\");\r\n    this.renderer.addClass(addButton, \"plus\");\r\n    this.renderer.setProperty(minusButton, \"innerHTML\", \"&#x2b;\");\r\n    this.renderer.listen(minusButton, \"click\", e => {\r\n      this.changeAmountdish(1);\r\n      this.renderer.setProperty(counter, \"innerHTML\", this.amountDish);\r\n      this.renderer.setProperty(\r\n        this.price,\r\n        \"innerHTML\",\r\n        this.generatePrice(this.dish.price)\r\n      );\r\n      this.innerTotalWeight(weightTotal)\r\n    });\r\n    this.renderer.appendChild(itemQuant, minusButton);\r\n\r\n    let weightTotalWrapper = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(itemName, \"weight\");\r\n    this.renderer.addClass(itemName, \"total\");\r\n    this.renderer.appendChild(mainItem, weightTotalWrapper);\r\n\r\n    let weightTotal = this.renderer.createElement(\"div\");\r\n    if (this.dish.weight === 0 || !this.dish.weight) {\r\n      this.renderer.addClass(weightTotal, \"zero\");\r\n    }\r\n    this.renderer.addClass(weightTotal, \"value\");\r\n    this.innerTotalWeight(weightTotal) // TODO: total Weight\r\n    this.renderer.appendChild(weightTotalWrapper, weightTotal);\r\n    this.weightTotal = weightTotal;\r\n\r\n\r\n    this.renderer.setProperty(\r\n      this.price,\r\n      \"innerHTML\",\r\n      this.generatePrice(dish.price)\r\n    ); // TODO: правильно считать цену\r\n    let priceTotalWrapper = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(priceTotalWrapper, \"price\");\r\n    this.renderer.addClass(priceTotalWrapper, \"total\");\r\n    this.renderer.appendChild(priceTotalWrapper, this.price);\r\n    this.renderer.appendChild(mainItem, priceTotalWrapper);\r\n  }\r\n\r\n  generatePrice(priceDish, amount?, modifiresPrice?) {\r\n    let selected = [];\r\n    if (this.selectedModifiers)\r\n      this.selectedModifiers.forEach(element => {\r\n\r\n        this.dish.modifiers.forEach(groups => {\r\n          let mod = groups.childModifiers.filter(x=>x.modifierId === element.id);\r\n          if (mod.length > 0) {\r\n            mod[0].groupId = groups.group.id;\r\n            selected.push(mod[0]);\r\n          }\r\n        });\r\n\r\n      });\r\n    let modSum:number = 0;\r\n    selected.forEach(element => {\r\n\r\n      modSum = modSum + element.dish.price * this.amountModifires[element.groupId][element.modifierId]\r\n    });\r\n    modSum = modSum * this.amountDish;\r\n    return (\r\n      priceDish * this.amountDish + modSum + '<div class=\"currency\">&nbsp;&#x20bd;</div>'\r\n    );\r\n  }\r\n\r\n  generateTotalWeight() {\r\n    let selected = [];\r\n    if (this.selectedModifiers)\r\n      this.selectedModifiers.forEach(element => {\r\n\r\n        this.dish.modifiers.forEach(groups => {\r\n          let mod = groups.childModifiers.filter(x=>x.modifierId === element.id);\r\n          if (mod.length > 0) {\r\n            mod[0].groupId = groups.group.id;\r\n            selected.push(mod[0]);\r\n          }\r\n        });\r\n\r\n      });\r\n    let modSum:number = 0;\r\n    selected.forEach(element => {\r\n\r\n      modSum = modSum + element.dish.weight * this.amountModifires[element.groupId][element.modifierId] * 1000\r\n    });\r\n    modSum = parseFloat((modSum * this.amountDish).toFixed(2));\r\n    console.log(modSum, this.dish.weight * 1000 * this.amountDish)\r\n    console.log(this.dish.weight, this.amountDish)\r\n    let weight = (this.dish.weight * 1000 * this.amountDish) + modSum;\r\n\r\n    return (weight).toFixed(0) + \" г. <div class='separator'></div>\";\r\n  }\r\n\r\n  innerTotalWeight(totalWeigthDiv) {\r\n\r\n    this.renderer.setProperty(totalWeigthDiv, \"innerHTML\", this.generateTotalWeight());\r\n  }\r\n\r\n  changeAmountdish(value) {\r\n    this.amountDish = this.amountDish + value;\r\n    if (this.amountDish <= 0) {\r\n      this.amountDish = 1;\r\n\r\n    }\r\n    if (this.amountDish >= 199) {\r\n      this.amountDish = 199;\r\n\r\n    }\r\n    this.amountDishToAdd.emit(this.amountDish)\r\n  }\r\n\r\n  render(modifires:any) {\r\n    this.setModifires();\r\n\r\n    if (modifires.length > 0) {\r\n      let h = this.renderer.createElement(\"h5\");\r\n      this.renderer.setProperty(\r\n        h,\r\n        \"innerHTML\",\r\n        \"К этому блюду можно добавить:\"\r\n      );\r\n      // this.renderer.appendChild(this.el.nativeElement, h);\r\n    }\r\n\r\n\r\n\r\n    modifires.forEach(elementGroup => {\r\n      this.stateModifiers[elementGroup.modifierId] = {};\r\n      this.amountModifires[elementGroup.modifierId] = {};\r\n\r\n      if (elementGroup.dish) {\r\n        let groupDiv = this.groupDiv(\"Одночные модификаторы не поддерживаются\");\r\n        this.renderer.appendChild(this.el.nativeElement, groupDiv);\r\n        console.log(\"elementGroup\",elementGroup);\r\n        //TODO: add single modificator logic\r\n      } else if (elementGroup.childModifiers) {\r\n        let groupDiv = this.groupDiv(\r\n          elementGroup.group ? elementGroup.group.name : \"Ошибка\"\r\n        );\r\n        this.renderer.appendChild(this.el.nativeElement, groupDiv);\r\n        let modArr = elementGroup.childModifiers;\r\n        modArr.forEach(element => {\r\n          let modifireDiv = this.modifireDiv(element, elementGroup.modifierId);\r\n          this.renderer.appendChild(groupDiv, modifireDiv);\r\n          if (element.defaultAmount < 1) {\r\n            this.stateModifiers[elementGroup.modifierId][element.modifierId] = false;\r\n          } else {\r\n            this.stateModifiers[elementGroup.modifierId][element.modifierId] = true;\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    if (modifires.length > 0) {\r\n      let h = this.renderer.createElement(\"div\");\r\n\r\n      this.renderer.setProperty(\r\n        h,\r\n        \"innerHTML\",\r\n        \"<p>* — Количество добавленых опций блюда применяется для каждой порции</p>\"\r\n      );\r\n      this.renderer.appendChild(this.el.nativeElement, h);\r\n    }\r\n\r\n\r\n  }\r\n\r\n  groupDiv(nameGorup) {\r\n    let div = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(div, \"group-modifires-wraper\");\r\n    this.renderer.appendChild(div, this.renderer.createText(\"\" + nameGorup));\r\n    return div;\r\n  }\r\n\r\n  modifireDiv(element, groupId) {\r\n    let div = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(div, \"additional-item\");\r\n    this.renderOneModifire(element, div, groupId);\r\n    return div;\r\n  }\r\n\r\n  renderOneModifire(element, modifireDiv, groupId) {\r\n\r\n    console.info('renderOneModifire', element);\r\n    console.info('renderOneModifire selectedModifiers', this.selectedModifiers);\r\n    // Рендер Названия модификатора\r\n    let itemNameDiv = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(itemNameDiv, \"item-name\");\r\n\r\n    let label = this.renderer.createElement(\"label\");\r\n\r\n    this.renderer.setAttribute(label, \"for\", element.modifierId);\r\n    this.renderer.appendChild(itemNameDiv, label);\r\n    this.renderer.setProperty(label, \"innerHTML\", element.dish.name);\r\n\r\n    this.renderer.appendChild(modifireDiv, itemNameDiv);\r\n\r\n    let weigthModifireWraper = this.renderer.createElement('div');\r\n    this.renderer.addClass(weigthModifireWraper, \"left-weight-modifire-wraper\");\r\n    let weightModifireLeft = this.renderer.createElement('div');\r\n    this.renderer.addClass(weightModifireLeft, 'weight');\r\n    if (element.dish.weight === 0 || element.dish.weight < 0) {\r\n      this.renderer.addClass(weightModifireLeft, 'zero');\r\n    }\r\n    this.renderer.setProperty(weightModifireLeft, 'innerHTML', (element.dish.weight * 1000).toFixed(0) + \" г.\" + '');\r\n\r\n    this.renderer.appendChild(weigthModifireWraper, weightModifireLeft);\r\n    this.renderer.appendChild(modifireDiv, weigthModifireWraper);\r\n\r\n    // Рендер блока изминения количества модификатора\r\n    let itemQuantity = this.renderer.createElement(\"div\");\r\n    /* TODO: нужно проверить:\r\n     да 0,0,[0] - только выключеный чекбокс\r\n     да 0,1 [0]- только чекбокс\r\n     да 0,1 [d===1]- только чекбокс, включеный\r\n\r\n     да 0,n[d=0] - по умолчанию 0 кнопки +-\r\n     да 0,n[d>0<n] - по умолчанию d, кнопки +-\r\n\r\n\r\n\r\n     k,n [k<n,d=0] - k по умолчанию!!! нужно чтобвы стояла цыфра k в амаунт, макс n(больше n не подниамалось) кнопки +- (частный случай когда d=0)\r\n     k,n [k<n,0<d=<n]- d по умолчанию!!! нужно чтобвы стояла цыфра 1 в амаунт, макс n(больше n не подниамалось) кнопки +-\r\n\r\n\r\n\r\n     defaultAmount:0\r\n     hideIfDefaultAmount:false //Признак того, что не нужно отображать список модификаторов, если их количество равно количеству\r\n     maxAmount:0\r\n     minAmount:0\r\n\r\n     */\r\n\r\n    let min = element.minAmount;\r\n    let max = element.maxAmount;\r\n    let def = element.defaultAmount;\r\n\r\n    console.info('min max def', min, max, def);\r\n\r\n    switch (true) {\r\n      case min === 0 && max === 0 && def === 0: // 0,0,[0] - только выключеный чекбокс\r\n        this.renderCheckbox(element, false, itemQuantity, modifireDiv, groupId)\r\n        break;\r\n\r\n      case min === 0 && max === 1 && def === 0: // 0,1 [0]- только чекбокс\r\n        this.renderCheckbox(element, false, itemQuantity, modifireDiv, groupId)\r\n        break;\r\n\r\n      case min === 0 && max === 1 && def === 1: // 0,1 [d!=0]- только чекбокс, включеный\r\n        this.renderCheckbox(element, true, itemQuantity, modifireDiv, groupId)\r\n        break;\r\n      case min === 1 && max === 1 && def === 1: // 0,1 [d!=0]- только чекбокс, включеный\r\n        console.error(\r\n          element.dish.name,\r\n          \"Значение не поддается настройке:\",\r\n          min,\r\n          max,\r\n          def\r\n        );\r\n        break;\r\n\r\n      case min <= max && def >= min && def <= max && max > 1: //d по умолчанию!!! нужно чтобвы стояла цыфра 1 в амаунт, макс n(больше n не подниамалось) кнопки +-\r\n        this.renderInputButton(element, groupId, itemQuantity, modifireDiv)\r\n        break;\r\n\r\n      default:\r\n        console.error(\r\n          element.dish.name,\r\n          \"Ошибка рендера модификатора, для значений:\",\r\n          min,\r\n          max,\r\n          def\r\n        );\r\n        break;\r\n    }\r\n\r\n    if (element.maxAmount > 0 && element.minAmount > 0) {\r\n\r\n    } else {\r\n\r\n    }\r\n    // Рендер блока стоимости и веса модификатора\r\n    // let weightPriceDiv = this.renderer.createElement('div');\r\n    // this.renderer.addClass(weightPriceDiv, 'modal-price');\r\n    // let weight;\r\n    // if(element.dish.weight>0){\r\n    //   weight =  element.dish.weight + \" г \";\r\n    // }\r\n    // let slash = \"/ \";\r\n    // let price;\r\n    // if(element.dish.price>0){\r\n    //   price = element.dish.price + \"&nbsp;&#x20bd;\";\r\n    // }\r\n    // let weightAndPriceHTML = (weight||'')+(weight&&price? slash : '')+( price || '');\r\n    // this.renderer.setProperty(weightPriceDiv, 'innerHTML', weightAndPriceHTML);\r\n    // this.renderer.appendChild(modifireDiv, weightPriceDiv);\r\n\r\n    let rightweigthModifireWraper = this.renderer.createElement('div');\r\n    this.renderer.addClass(rightweigthModifireWraper, \"right-weight-modifire-wraper\");\r\n    let weightModifireRight = this.renderer.createElement('div');\r\n    this.renderer.addClass(weightModifireRight, 'weight');\r\n    if (element.dish.weight === 0 || element.dish.weight < 0) {\r\n      this.renderer.addClass(weightModifireRight, 'zero');\r\n    }\r\n    this.renderer.setProperty(weightModifireRight, 'innerHTML', (element.dish.weight * 1000).toFixed(0) + \" г.\" + '<div class=\"separator\"></div>');\r\n\r\n    this.renderer.appendChild(rightweigthModifireWraper, weightModifireRight);\r\n    this.renderer.appendChild(modifireDiv, rightweigthModifireWraper);\r\n\r\n\r\n    let price = this.renderer.createElement(\"div\");\r\n    this.renderer.addClass(price, \"item-price\");\r\n\r\n    let priceValue;\r\n    if (element.dish.price > 0) {\r\n      priceValue = element.dish.price + \"<div class = 'currency'>&nbsp;&#x20bd;</div>\";\r\n      this.renderer.setProperty(price, \"innerHTML\", priceValue);\r\n      this.renderer.appendChild(modifireDiv, price);\r\n    } else {\r\n      this.renderer.addClass(price, \"zero-price\");\r\n    }\r\n\r\n\r\n    this.setModifires();\r\n    this.innerTotalWeight(this.weightTotal);\r\n    this.renderer.setProperty(this.price, \"innerHTML\", this.generatePrice(this.dish.price));\r\n\r\n  }\r\n\r\n  renderCheckbox(element, isActive, itemQuantity, modifireDiv, groupId) {\r\n\r\n    let input = this.renderer.createElement(\"input\");\r\n    this.renderer.setAttribute(input, \"type\", \"checkbox\");\r\n    this.renderer.setAttribute(input, \"id\", element.modifierId);\r\n    if (isActive) {\r\n      this.renderer.setProperty(input, 'checked', true);\r\n      element.checked = true;\r\n      this.stateModifiers[groupId][element.modifierId] = true;\r\n      this.amountModifires[groupId][element.modifierId] = 1;\r\n\r\n    } else {\r\n      element.checked = false;\r\n      this.stateModifiers[groupId][element.modifierId] = false;\r\n      this.amountModifires[groupId][element.modifierId] = 0;\r\n\r\n    }\r\n    this.renderer.addClass(input, \"modal-checkbox\");\r\n    this.renderer.appendChild(itemQuantity, input);\r\n\r\n    this.renderer.listen(input, \"change\", e => {\r\n      if (this.idRadioBox(groupId)) {\r\n        for (const key in this.stateModifiers[groupId]) {\r\n          if (this.stateModifiers[groupId].hasOwnProperty(key)) {\r\n            this.stateModifiers[groupId][key] = false;\r\n\r\n            // this.renderer.setProperty(input, 'checked',   true);\r\n          }\r\n        }\r\n\r\n        let groupDivBlock = e.target.parentElement.parentElement.parentElement.querySelectorAll(\r\n          \"input\"\r\n        );\r\n\r\n        groupDivBlock.forEach(element => {\r\n          if (element.id != e.target.id) element.checked = false;\r\n        });\r\n      }\r\n      this.stateModifiers[groupId][e.target.id] = e.target.checked;\r\n      if (e.target.checked) {\r\n        this.amountModifires[groupId][e.target.id] = 1;\r\n\r\n      }\r\n\r\n\r\n      this.setModifires();\r\n      this.innerTotalWeight(this.weightTotal);\r\n      this.renderer.setProperty(this.price, \"innerHTML\", this.generatePrice(this.dish.price));\r\n    });\r\n\r\n\r\n    this.renderer.appendChild(modifireDiv, itemQuantity);\r\n\r\n  }\r\n\r\n  renderInputButton(element, groupId, itemQuantity, modifireDiv) {\r\n\r\n    let startAmount;\r\n    if (element.defaultAmount > 0) {\r\n      startAmount = element.defaultAmount;\r\n    } else {\r\n      startAmount = element.minAmount;\r\n\r\n    }\r\n    if (startAmount > 0) {\r\n\r\n      this.stateModifiers[groupId][element.modifierId] = true;\r\n    }\r\n\r\n\r\n    let aMinusDiv = this.renderer.createElement(\"a\");\r\n    this.renderer.addClass(aMinusDiv, \"quantity__button\");\r\n    this.renderer.setProperty(aMinusDiv, \"innerHTML\", \"&#8722;\");\r\n    this.renderer.appendChild(itemQuantity, aMinusDiv);\r\n    this.renderer.listen(aMinusDiv, \"click\", e => {\r\n      let value = +this.amountModifires[groupId][element.modifierId];\r\n\r\n      this.amountModifires[groupId][element.modifierId] = value - 1;\r\n      if (\r\n        this.amountModifires[groupId][element.modifierId] < element.minAmount\r\n      )\r\n        this.amountModifires[groupId][element.modifierId] = element.minAmount;\r\n      this.renderer.setProperty(\r\n        span,\r\n        \"innerHTML\",\r\n        this.amountModifires[groupId][element.modifierId]\r\n      );\r\n\r\n      if (this.amountModifires[groupId][element.modifierId] === 0) {\r\n        this.stateModifiers[groupId][element.modifierId] = false;\r\n      }\r\n      this.setModifires();\r\n      this.innerTotalWeight(this.weightTotal);\r\n      this.renderer.setProperty(this.price, \"innerHTML\", this.generatePrice(this.dish.price));\r\n    });\r\n\r\n    let span = this.renderer.createElement(\"span\");\r\n    this.renderer.addClass(span, \"item-quantity__counter\");\r\n    this.amountModifires[groupId][element.modifierId] = startAmount;\r\n    this.renderer.setProperty(\r\n      span,\r\n      \"innerHTML\",\r\n      this.amountModifires[groupId][element.modifierId]\r\n    );\r\n    this.renderer.appendChild(itemQuantity, span);\r\n\r\n    let aPlusDiv = this.renderer.createElement(\"a\");\r\n    this.renderer.addClass(aPlusDiv, \"quantity__button\");\r\n    this.renderer.setProperty(aPlusDiv, \"innerHTML\", \"&#x2b;\");\r\n    this.renderer.appendChild(itemQuantity, aPlusDiv);\r\n    this.renderer.appendChild(modifireDiv, itemQuantity);\r\n    this.renderer.listen(aPlusDiv, \"click\", e => {\r\n      let value = +this.amountModifires[groupId][element.modifierId];\r\n      this.amountModifires[groupId][element.modifierId] = value + 1;\r\n      if (\r\n        this.amountModifires[groupId][element.modifierId] >\r\n        element.maxAmount &&\r\n        element.maxAmount != 0\r\n      )\r\n        this.amountModifires[groupId][element.modifierId] = element.maxAmount;\r\n      this.renderer.setProperty(\r\n        span,\r\n        \"innerHTML\",\r\n        this.amountModifires[groupId][element.modifierId]\r\n      );\r\n      if (this.amountModifires[groupId][element.modifierId] > 0) {\r\n        this.stateModifiers[groupId][element.modifierId] = true;\r\n      }\r\n      this.setModifires();\r\n      this.innerTotalWeight(this.weightTotal);\r\n      this.renderer.setProperty(this.price, \"innerHTML\", this.generatePrice(this.dish.price));\r\n    });\r\n\r\n  }\r\n\r\n  setModifires() {\r\n    let modifiersToSelect = [];\r\n\r\n    /*if(this.selectedModifiers.length && !(Object.values(this.stateModifiers)).length) {\r\n      modifiersToSelect = this.selectedModifiers;\r\n    }*/\r\n\r\n    let modifires = [];\r\n\r\n    console.info('setModifires modifiersToSelect', modifiersToSelect);\r\n    console.info('setModifires stateModifiers before', this.stateModifiers);\r\n    console.info('setModifires selectedModifiers before', this.selectedModifiers);\r\n\r\n    for (let groupId in this.stateModifiers) {\r\n      for (let modifireId in this.stateModifiers[groupId]) {\r\n        if (this.stateModifiers[groupId][modifireId] || modifiersToSelect.find(item => item.modifierId == modifireId)) {\r\n          modifires.push({\r\n            id: modifireId,\r\n            amount: this.amountModifires[groupId][modifireId],\r\n            groupId: groupId\r\n          });\r\n        }\r\n      }\r\n    }\r\n    this.selectedModifiers = modifires;\r\n\r\n    if (this.dish.modifiers.length > 0) {\r\n      let message = [];\r\n\r\n      this.dish.modifiers.forEach(group => {\r\n        if (group.required) {\r\n          if (this.stateModifiers[group.modifierId]) {\r\n            let selectedModif = [];\r\n            let localModif = this.stateModifiers[group.modifierId]; //.filter(element=>element);\r\n            for (const mod in localModif) {\r\n              if (localModif.hasOwnProperty(mod)) {\r\n                if (localModif[mod]) {\r\n                  selectedModif.push(localModif[mod]);\r\n                }\r\n              }\r\n            }\r\n            if (selectedModif.length < group.minAmount) {\r\n              message.push({\r\n                type: \"warning\",\r\n                title: \"Внимание\",\r\n                body: \" Обязательно выберите модификаторы из категории: \" +\r\n                group.group.name\r\n              });\r\n              this.validate.emit(false);\r\n              this.cartService.setModifires(modifires, message);\r\n            } else {\r\n              this.validate.emit(true);\r\n              this.cartService.setModifires(modifires, []);\r\n            }\r\n          } else {\r\n            message.push({\r\n              type: \"warning\",\r\n              title: \"Внимание\",\r\n              body: \" Обязательно выберите модификаторы из категории: \" +\r\n              group.group.name\r\n            });\r\n            this.validate.emit(false);\r\n            this.cartService.setModifires(modifires, message);\r\n          }\r\n        } else {\r\n          this.validate.emit(true);\r\n          this.cartService.setModifires(modifires);\r\n        }\r\n      });\r\n    } else {\r\n      this.validate.emit(true);\r\n      this.cartService.setModifires(modifires, []);\r\n    }\r\n\r\n    console.info('setModifires stateModifiers after', this.stateModifiers);\r\n    console.info('setModifires selectedModifiers after', this.selectedModifiers);\r\n  }\r\n\r\n  /* проверяет соотвествет ли максимальное количество модификаторовб если 1 то реализует поведение радиокнопки,\r\n   если максимальное количество больше 1 то генерирует делает выбор всех остальных модификаторов не возможным, генерирует предупреждение*/\r\n\r\n  idRadioBox(groupId):boolean {\r\n    let currentGroup = this.dish.modifiers.find(x => x.modifierId === groupId);\r\n    return currentGroup.minAmount === 1 && currentGroup.maxAmount === 1;\r\n  }\r\n\r\n  // Проверяет минимальное количество модификаторовкоторые были выбраны\r\n  checkMinAmountModifires(groupId, modifire) {\r\n  }\r\n\r\n\r\n  ngOnDestroy() {\r\n    //this.dish.modifiers =[];\r\n    this.validate.emit(true);\r\n    this.cartService.setModifires([], []);\r\n  }\r\n\r\n}\r\n","import { Directive, Renderer2, ElementRef, Input } from '@angular/core';\r\nimport { NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstModifires]'\r\n})\r\n\r\nexport class ModifiresDirective {\r\n  @Input() modifires: any;\r\n  amountModifires:any={};\r\n  stateModifires:any={};\r\n\r\n  constructor(\r\n    private renderer: Renderer2,\r\n    private el: ElementRef,\r\n    private cartService:NgRestoCartService\r\n  ) {\r\n\r\n\r\n    setTimeout(() => {\r\n\r\n      this.render(this.modifires)\r\n\r\n    }, 100);\r\n\r\n\r\n  }\r\n\r\n  render(modifires: any) {\r\n\r\n  if(modifires.length>0){  let h = this.renderer.createElement('h5');\r\n    this.renderer.setProperty(h , 'innerHTML', 'К этому блюду можно добавить:');\r\n    this.renderer.appendChild(this.el.nativeElement, h);}\r\n\r\n\r\n    modifires.forEach(elementGroup => {\r\n\r\n      this.stateModifires[elementGroup.modifierId]={};\r\n      this.amountModifires[elementGroup.modifierId]={};\r\n\r\n\r\n      let groupDiv = this.groupDiv(elementGroup.name);\r\n      this.renderer.appendChild(this.el.nativeElement, groupDiv);\r\n\r\n      let modArr;\r\n      if(elementGroup.childModifiers.length>5){\r\n       modArr = elementGroup.childModifiers.slice(0, 5)\r\n      }else{\r\n        modArr = elementGroup.childModifiers;\r\n      }\r\n\r\n\r\n\r\n\r\n      modArr.forEach(element => {\r\n\r\n      let modifireDiv = this.modifireDiv(element,elementGroup.modifierId);\r\n        this.renderer.appendChild(groupDiv,modifireDiv);\r\n\r\n\r\n        this.stateModifires[elementGroup.modifierId][element.modifierId]=false;\r\n\r\n      });\r\n\r\n\r\n    });\r\n\r\n  }\r\n\r\n  groupDiv(nameGorup){\r\n    let div = this.renderer.createElement('div');\r\n    this.renderer.addClass(div, 'group-modifires');\r\n    this.renderer.appendChild(div, this.renderer.createText('Название категории модификаторов: '+nameGorup));\r\n    return div;\r\n  }\r\n\r\n  modifireDiv(element, groupId){\r\n    let div = this.renderer.createElement('div');\r\n    this.renderer.addClass(div, 'additional-item');\r\n    this.renderOneModifire(element, div,groupId);\r\n   return div;\r\n  }\r\n\r\n  renderOneModifire(element, modifireDiv, groupId){\r\n\r\n    // Рендер Названия модификатора\r\n    let itemNameDiv = this.renderer.createElement('div');\r\n    this.renderer.addClass(itemNameDiv, 'item-name');\r\n\r\n    let input = this.renderer.createElement('input');\r\n    this.renderer.setAttribute(input, 'type', 'checkbox');\r\n    this.renderer.setAttribute(input, 'id', element.modifierId);\r\n    this.renderer.appendChild(itemNameDiv, input);\r\n    this.renderer.listen(input,'change',e=>{\r\n      this.stateModifires[groupId][e.target.id]= e.target.checked;\r\n      this.setModifires();\r\n    })\r\n\r\n    let label  = this.renderer.createElement('label');\r\n    this.renderer.setAttribute(label, 'for', element.modifierId);\r\n    this.renderer.appendChild(itemNameDiv, label);\r\n    this.renderer.setProperty(label, 'innerHTML', element.dish.name);\r\n\r\n    this.renderer.appendChild(modifireDiv, itemNameDiv);\r\n// Рендер блока изминения количества модификатора\r\n    let itemQuantity = this.renderer.createElement('div');\r\n\r\n    let aMinusDiv = this.renderer.createElement('a');\r\n    this.renderer.addClass(aMinusDiv, 'item-quantity__button');\r\n    this.renderer.setProperty(aMinusDiv, 'innerHTML', '&#8722;');\r\n    this.renderer.appendChild(itemQuantity, aMinusDiv);\r\n    this.renderer.listen(aMinusDiv,'click',e=>{\r\n      let value =  +this.amountModifires[groupId][element.modifierId];\r\n      this.amountModifires[groupId][element.modifierId] = value-1;\r\n      if(this.amountModifires[groupId][element.modifierId] < element.minAmount)\r\n      this.amountModifires[groupId][element.modifierId]=element.minAmount;\r\n      this.renderer.setProperty(span, 'innerHTML', this.amountModifires[groupId][element.modifierId]);\r\n      this.setModifires();\r\n\r\n    })\r\n\r\n\r\n    let span = this.renderer.createElement('span');\r\n    this.renderer.addClass(span, 'item-quantity__counter');\r\n    this.amountModifires[groupId][element.modifierId] = element.minAmount;\r\n    this.renderer.setProperty(span, 'innerHTML', this.amountModifires[groupId][element.modifierId]);\r\n    this.renderer.appendChild(itemQuantity, span);\r\n\r\n\r\n    let aPlusDiv = this.renderer.createElement('a');\r\n    this.renderer.addClass(aPlusDiv, 'item-quantity__button');\r\n    this.renderer.setProperty(aPlusDiv, 'innerHTML', '&#x2b;');\r\n    this.renderer.appendChild(itemQuantity, aPlusDiv);\r\n    this.renderer.appendChild(modifireDiv, itemQuantity);\r\n    this.renderer.listen(aPlusDiv,'click',e=>{\r\n      let value =  +this.amountModifires[groupId][element.modifierId];\r\n      this.amountModifires[groupId][element.modifierId] = value+1;\r\n      this.renderer.setProperty(span, 'innerHTML', this.amountModifires[groupId][element.modifierId]);\r\n      this.setModifires();\r\n\r\n    })\r\n\r\n// Рендер блока стоимости и веса модификатора\r\n    let weightPriceDiv = this.renderer.createElement('div');\r\n    this.renderer.addClass(weightPriceDiv, 'weight-price');\r\n    let weightAndPriceHTML = element.dish.weight + \" г / \" + element.dish.price + \"&nbsp;&#x20bd;\"\r\n    this.renderer.setProperty(weightPriceDiv, 'innerHTML', weightAndPriceHTML);\r\n    this.renderer.appendChild(modifireDiv, weightPriceDiv);\r\n\r\n    this.setModifires();\r\n\r\n\r\n  }\r\n  setModifires(){\r\n\r\n    let modifires = [];\r\n\r\n    for (let groupId in this.stateModifires){\r\n      for(let modifireId in this.stateModifires[groupId]){\r\n        if(this.stateModifires[groupId][modifireId]){\r\n          modifires.push(\r\n            {\r\n                id: modifireId,\r\n                amount: this.amountModifires[groupId][modifireId],\r\n                groupId: groupId\r\n            }\r\n\r\n          )\r\n        }\r\n\r\n      }\r\n\r\n\r\n    }\r\n    console.log(\"модифікатори після циклу\",modifires)\r\n\r\n    this.cartService.setModifires(modifires);\r\n\r\n  }\r\n\r\n\r\n}\r\n","import { Directive, Input, HostListener } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstOrderCart]'\r\n})\r\nexport class OrderCartUserDirective {\r\n\r\n  @Input() orderCart: any;\r\n  cart: any;\r\n\r\n  @HostListener('click')\r\n  onClick() {\r\n    this.order(this.orderCart.value);\r\n    console.log(this.orderCart.value)\r\n  }\r\n\r\n  private requiredFields: Array<string> = [\"name\", \"phone\", \"street\", \"house\"];\r\n  private checkerFields: BehaviorSubject<boolean>;\r\n\r\n  constructor(private cartService: NgRestoCartService) {\r\n    this.checkerFields = new BehaviorSubject(undefined);\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n\r\n    setTimeout(() => {\r\n      const sub = this.cartService.userCart().subscribe(\r\n        cart => {\r\n          if (this.cart && this.orderCart.valid && this.cart.cartTotal != cart.cartTotal && cart.cartTotal > 0) {\r\n            this.checkStreet(this.orderCart.value)\r\n          }\r\n          this.cart = cart;\r\n        }, () => { }, () => sub.unsubscribe()\r\n        );\r\n    }, 100);\r\n\r\n    setTimeout(() => {\r\n      this.checkerFields.next(this.checkForFields(this.orderCart._directives, this.requiredFields));\r\n    }, 100);\r\n\r\n    this.checkerFields.subscribe(state => {\r\n      if (state) {\r\n        this.orderCart.controls['street'].valueChanges.subscribe(val => {\r\n          if (typeof val === 'object') {\r\n            setTimeout(() => {\r\n              if (this.orderCart.controls['house'].valid) {\r\n                this.orderCart.value.name = this.orderCart.value.name || \"Неуказано\";\r\n                this.orderCart.value.phone = this.orderCart.value.phone || \"78888888888\";\r\n                this.checkStreet(this.orderCart.value);\r\n              }\r\n            }, 100);\r\n          }\r\n        });\r\n        this.orderCart.controls['house'].valueChanges.subscribe(val => {\r\n          setTimeout(() => {\r\n            if (this.orderCart.controls['street'].valid) {\r\n              this.orderCart.value.name = this.orderCart.value.name || \"Неуказано\";\r\n              this.orderCart.value.phone = this.orderCart.value.phone || \"78888888888\";\r\n              this.checkStreet(this.orderCart.value);\r\n            }\r\n          }, 100);\r\n        });\r\n\r\n      }\r\n    })\r\n\r\n\r\n  }\r\n\r\n\r\n  checkForFields(formDirectives: Array<any>, requiredFields: Array<string>): boolean {\r\n\r\n    let fieldsAreAvailable: object = {};\r\n    let noFields: Array<string> = [];\r\n\r\n\r\n    formDirectives.forEach(element => {\r\n      fieldsAreAvailable[element.name] = true;\r\n    });\r\n\r\n    requiredFields.forEach(element => {\r\n      if (!fieldsAreAvailable.hasOwnProperty(element)) {\r\n        noFields.push(element);\r\n      }\r\n    });\r\n\r\n    if (noFields.length <= 0) {\r\n      return true;\r\n    } else {\r\n      console.error(\"У формы отсутсвуют следующие обязательные для корректной работы модуля поля:\", noFields)\r\n      return false;\r\n    }\r\n  }\r\n\r\n  order(dataToSend) {\r\n    if (this.checkForFields(this.orderCart._directives, this.requiredFields)) {\r\n      let payment;\r\n      let comment = dataToSend.comment || \"Не указан\"\r\n\r\n      if (dataToSend.cash) {\r\n        payment = \"Наличными курьеру\";\r\n      } else if (dataToSend.bankcard) {\r\n        payment = \"Банковской картой курьеру\";\r\n      } else {\r\n        payment = \"Не указан\";\r\n      }\r\n      console.log(dataToSend);\r\n      let data = {\r\n        \"cartId\": this.cart.cartId,\r\n        // TODO: тип оплаты надо вынести в отдельный модуль.\r\n        \"comment\": \"\\n Тип оплаты:\" + payment + \"\\nКоментарий:\" + comment,\r\n        // \"delivery\": {\r\n        //   \"type\": \"string (self or nothing)\"\r\n        // },\r\n        \"address\": {\r\n          // \"city\": \"string\",\r\n          \"streetId\": dataToSend.street.id,\r\n          \"home\": dataToSend.house,\r\n          \"housing\": dataToSend.housing,\r\n          // \"index\": \"string\",\r\n          \"doorphone\": dataToSend.doorphone,\r\n          \"entrance\": dataToSend.entrance,\r\n          \"floor\": dataToSend.floor,\r\n          \"apartment\": dataToSend.apartment\r\n        },\r\n        \"customer\": {\r\n          \"phone\": '+' + dataToSend.phone,\r\n          \"mail\": dataToSend.email,\r\n          \"name\": dataToSend.name\r\n        },\r\n        \"personsCount\": dataToSend.personsCount\r\n      };\r\n      this.cartService.orderCart(data).subscribe();\r\n    } else {\r\n\r\n    }\r\n\r\n\r\n  }\r\n\r\n  checkStreet(dataToSend) {\r\n    console.log(\">>>>\", dataToSend);\r\n    if (this.checkForFields(this.orderCart._directives, this.requiredFields)) {\r\n      let data = {\r\n        \"cartId\": this.cart.cartId,\r\n        \"comment\": dataToSend.comment,\r\n        // \"delivery\": {\r\n        //   \"type\": \"string (self or nothing)\"\r\n        // },\r\n        \"address\": {\r\n          // \"city\": \"string\",\r\n          \"streetId\": dataToSend.street.id,\r\n          \"home\": dataToSend.house,\r\n          \"housing\": dataToSend.housing,\r\n          // \"index\": \"string\",\r\n          \"doorphone\": dataToSend.doorphone,\r\n          \"entrance\": dataToSend.entrance,\r\n          \"floor\": dataToSend.floor,\r\n          \"apartment\": dataToSend.apartment\r\n        },\r\n        \"customer\": {\r\n          \"phone\": '+' + dataToSend.phone,\r\n          \"mail\": dataToSend.email,\r\n          \"name\": dataToSend.name\r\n        },\r\n        \"personsCount\": dataToSend.personsCount\r\n      };\r\n      this.cartService.checkStreet(data);\r\n\r\n    } else {\r\n\r\n    }\r\n  }\r\n\r\n  stringToNumber(str: number | any): number {\r\n    console.log(typeof str);\r\n    if (typeof str === 'string') {\r\n      return +str;\r\n    } else if (typeof str === \"number\") {\r\n      return str;\r\n    } else {\r\n      console.error(\"Параметр home должен быть или string или number\");\r\n    }\r\n  }\r\n\r\n}\r\n","import { Directive, Input, HostListener } from '@angular/core';\r\nimport { Cart, NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstSetDishAmount]'\r\n})\r\nexport class SetAmountDirective {\r\n  @Input() action: any;\r\n  @Input() dish: any;\r\n\r\n  @HostListener('click') onClick() {\r\n    this.changeAmount(this.action);\r\n  }\r\n\r\n  cart:Cart;\r\n\r\n  constructor(private cartService: NgRestoCartService) {\r\n    const sub = this.cartService.userCart().subscribe(\r\n      res => this.cart = res, () => { }, () => sub.unsubscribe()\r\n    );\r\n  }\r\n\r\n  changeAmount(action) {\r\n\r\n    switch (action) {\r\n      case '+':\r\n        this.cartService.setDishCountToCart(\r\n          this.dish.id,\r\n          this.dish.amount + 1\r\n        );\r\n        break;\r\n      case '-':\r\n        this.cartService.setDishCountToCart(\r\n          this.dish.id,\r\n          this.dish.amount - 1\r\n        );\r\n        break;\r\n      default:\r\n        console.log(\"Директива SetDishAmount получила ложное значение action\");\r\n        break;\r\n    }\r\n\r\n  }\r\n\r\n}\r\n","import { Directive, Input, Output, EventEmitter, HostListener } from '@angular/core';\r\nimport { NgRestoCartService } from '../services/ng-restocart.service';\r\n\r\n@Directive({\r\n  selector: '[rstSetDishComment]'\r\n})\r\nexport class SetDishCommentDirective {\r\n  @Input() comment:any;\r\n  @Input() dish:any;\r\n\r\n  @Output() success = new EventEmitter<boolean>();\r\n  @Output() error = new EventEmitter<string>();\r\n\r\n  @HostListener('click') onClick() {\r\n    this.setComment();\r\n  }\r\n\r\n  constructor(private cartService:NgRestoCartService) { }\r\n\r\n  setComment(){\r\n    this.cartService.setDishComment(this.dish.id,this.comment).subscribe(\r\n      res=>this.success.emit(true),\r\n      err=>this.error.emit(err)\r\n    )\r\n\r\n\r\n  }\r\n\r\n}\r\n","import { Component, OnInit, OnChanges, OnDestroy, Input, Output, EventEmitter, Inject } from '@angular/core';\r\nimport { NgRestoCartService } from \"../../services/ng-restocart.service\";\r\n\r\nimport {\r\n  EventerService,\r\n  EventMessage\r\n} from '@webresto/ng-core';\r\n\r\n@Component({\r\n  selector: 'rst-dish-calc',\r\n  templateUrl: './dish-calc.component.html',\r\n  styleUrls: ['./dish-calc.component.scss']\r\n})\r\nexport class DishCalcComponent implements OnInit, OnChanges, OnDestroy {\r\n\r\n  @Input() dish:any;\r\n  @Input() amount:any;\r\n  @Input() selectedModifiers:any;\r\n  @Output() validate:EventEmitter<any> = new EventEmitter();\r\n  @Output() amountDishToAdd:EventEmitter<any> = new EventEmitter();\r\n  @Output() comment:EventEmitter<string> = new EventEmitter();\r\n\r\n  modifiers = {\r\n    indexById: {},\r\n    custom: {\r\n      fixed: null\r\n    },\r\n    baseList: [],\r\n  };\r\n\r\n  isTwoPartsAssembledTemplate: boolean;\r\n\r\n  totalPrice: number;\r\n  modifiersValueTree: any = {};\r\n  twoPartsAssembledModifiersIdsByGroupId: any = {};\r\n  imageUrl: string;\r\n\r\n  constructor(\r\n    private cartService: NgRestoCartService,\r\n    private eventer:EventerService,\r\n    @Inject('ImageUrl') imageUrl:string\r\n  ) {\r\n    this.imageUrl = imageUrl;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.checkValid();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.validate.emit(true);\r\n    this.cartService.setModifires([], []);\r\n  }\r\n\r\n  ngOnChanges() {\r\n    this.modifiers = {\r\n      indexById: {},\r\n      custom: {\r\n        fixed: null\r\n      },\r\n      baseList: [],\r\n    };\r\n\r\n    this.modifiersValueTree = {};\r\n    if(this.dish && this.dish.modifiers) {\r\n      for(let modifier of this.dish.modifiers) {\r\n        let modifierType = null;\r\n        // Indexing\r\n        this.modifiers.indexById[modifier.modifierId] = modifier;\r\n        // Check Custom modifiers (like Pizza Size)\r\n        if(!this.modifiers.custom.fixed\r\n          && !this.modifiers.baseList.length\r\n          && modifier.childModifiers\r\n          && modifier.childModifiers.length == 2\r\n          && modifier.maxAmount == modifier.maxAmount\r\n          && modifier.maxAmount == 1) {\r\n          // This is Pizza Size modifier\r\n          modifierType = 'custom';\r\n          this.modifiers.custom.fixed = modifier;\r\n          console.info('Custom Fixed modifier:', modifier);\r\n        } else if(modifier.group\r\n          && modifier.childModifiers\r\n          && modifier.childModifiers.length\r\n          && modifier.childModifiers.find(m => m.dish)) {\r\n          // This is Base modifier\r\n          modifierType = 'group';\r\n          this.modifiers.baseList.push(modifier);\r\n\r\n          if(modifier.minAmount == 2 && modifier.maxAmount == 2) {\r\n            this.isTwoPartsAssembledTemplate = true;\r\n          }\r\n          console.info('Group modifier:', modifier);\r\n        } else if(modifier.dish) {\r\n          modifierType = 'single';\r\n          this.modifiers.baseList.push(modifier);\r\n          console.info('Single modifier:', modifier);\r\n        } else {\r\n          // This is broken modifier\r\n          modifierType = 'broken';\r\n          console.warn('Broken modifier:', modifier);\r\n        }\r\n\r\n\r\n        // Init default values\r\n        switch (modifierType) {\r\n          case 'group':\r\n          case 'custom':\r\n            this.modifiersValueTree[modifier.modifierId] = {};\r\n            for(let childModifier of modifier.childModifiers) {\r\n              // Indexing\r\n              this.modifiers.indexById[childModifier.modifierId] = childModifier;\r\n              // Init default value\r\n              this.modifiersValueTree[modifier.modifierId][childModifier.modifierId] = childModifier.defaultAmount;\r\n            }\r\n            // Calculate total amount in group\r\n            this.calculateTotalAmountInGroup(modifier.modifierId);\r\n            break;\r\n          case 'single':\r\n            if(!this.modifiersValueTree['single']){\r\n              this.modifiersValueTree['single'] = {}\r\n            }\r\n            // Indexing\r\n            this.modifiers.indexById[modifier.modifierId] = modifier;\r\n            // Init default value\r\n            this.modifiersValueTree['single'][modifier.modifierId] = modifier.defaultAmount;\r\n        }\r\n\r\n        // Find images and set flags (imagesIsset, childImagesIsset)\r\n        this.checkImagesInModifier(modifier.modifierId);\r\n\r\n      }\r\n      this.calculateTotalPrice();\r\n    }\r\n    console.log(`this.modifiers.indexById`, this.modifiers.indexById);\r\n  }\r\n\r\n  calculateTotalAmountInGroup(groupId) {\r\n    if(groupId == 'single') return;\r\n    this.modifiers.indexById[groupId].totalAmount = Object\r\n      .values(this.modifiersValueTree[groupId])\r\n      .reduce((a: any, b: any) => a + b);\r\n    return this.modifiers.indexById[groupId].totalAmount;\r\n  }\r\n\r\n  checkImagesInModifier(modifierId) {\r\n    const m: any = this.modifiers.indexById[modifierId];\r\n    this.modifiers.indexById[modifierId].imagesIsset = m.dish && m.dish.images && m.dish.images.length ? true : false;\r\n    this.modifiers.indexById[modifierId].childImagesIsset = !!this.modifiers.indexById[modifierId]\r\n      .childModifiers\r\n      .find((m: any) => m && m.dish && m.dish.images && m.dish.images.length ? true : false);\r\n  }\r\n\r\n  calculateTotalPrice() {\r\n    let totalPrice = this.dish.price || 0;\r\n    for(let groupId in this.modifiersValueTree) {\r\n      for(let modifierId in this.modifiersValueTree[groupId]) {\r\n        const amount = this.modifiersValueTree[groupId][modifierId];\r\n        if(amount) {\r\n          const modifier = this.modifiers.indexById[modifierId];\r\n          if(modifier && modifier.dish && modifier.dish.price) {\r\n            totalPrice += modifier.dish.price * amount;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.totalPrice = totalPrice;\r\n    this.setModifiers();\r\n  }\r\n\r\n  getModifiersIds(modifier) {\r\n    return {\r\n      groupId: (modifier.dish && modifier.dish.groupId) ? modifier.dish.groupId : undefined,\r\n      modifierId: modifier.modifierId\r\n    }\r\n  }\r\n\r\n  selectTwoPartsAssembledModifier(modifier: any) {\r\n    const { groupId = 'single', modifierId } = this.getModifiersIds(modifier);\r\n    const { minAmount, maxAmount } = modifier;\r\n    const { minAmount: groupMinAmount = 0,\r\n      maxAmount: groupMaxAmount = 0 } = this.modifiers.indexById[groupId] || {};\r\n    const previousAmount: number = this.modifiersValueTree[groupId][modifierId];\r\n    const amount: number = previousAmount ? 0 : 1;\r\n\r\n    // Init tmp value storage if not exists\r\n    if(!this.twoPartsAssembledModifiersIdsByGroupId[groupId]) {\r\n      this.twoPartsAssembledModifiersIdsByGroupId[groupId] = [];\r\n    }\r\n\r\n    // Total amount in group\r\n    const groupAmount: number = this.modifiers.indexById[groupId].totalAmount - previousAmount + amount;\r\n    if(groupAmount > groupMaxAmount) {\r\n      if(this.twoPartsAssembledModifiersIdsByGroupId[groupId].length) {\r\n        for(let mId in this.modifiersValueTree[groupId]) {\r\n          this.modifiersValueTree[groupId][mId] = 0;\r\n        }\r\n        this.twoPartsAssembledModifiersIdsByGroupId[groupId] = this.twoPartsAssembledModifiersIdsByGroupId[groupId].slice(1,2);\r\n        this.modifiersValueTree[groupId][this.twoPartsAssembledModifiersIdsByGroupId[groupId][0]] = 1;\r\n      }else {\r\n        console.warn(`Limit: max ${groupMaxAmount}. Current ${groupAmount}`);\r\n        this.eventer.emitMessageEvent(\r\n          new EventMessage(\r\n            'warning',\r\n            'Ограничение',\r\n            `Максимальное количество опций для группы\r\n            модификаторов \"${this.modifiers.indexById[groupId].group.name}\" - не более ${groupMaxAmount}`\r\n          )\r\n        );\r\n        return;\r\n      }\r\n    }else if(groupAmount === 0) {\r\n      this.twoPartsAssembledModifiersIdsByGroupId[groupId] = [];\r\n    }\r\n\r\n    if(amount && !this.twoPartsAssembledModifiersIdsByGroupId[groupId].find(v => v == modifierId)) {\r\n      this.twoPartsAssembledModifiersIdsByGroupId[groupId].push(modifierId);\r\n    }\r\n    this.modifiersValueTree[groupId][modifierId] = amount;\r\n    this.calculateTotalAmountInGroup(groupId);\r\n    this.calculateTotalPrice();\r\n  }\r\n\r\n  changeModifierAmount(modifier: any, amount: number, operation: string) {\r\n    if(amount < 0) return;\r\n    const { groupId = 'single', modifierId } = this.getModifiersIds(modifier);\r\n    const { minAmount, maxAmount } = modifier;\r\n    const { minAmount: groupMinAmount = 0,\r\n            maxAmount: groupMaxAmount = 0 } = this.modifiers.indexById[groupId] || {};\r\n    const previousAmount: number = this.modifiersValueTree[groupId][modifierId];\r\n\r\n    // For checkbox\r\n    if(operation == 'checkbox' && groupId !== 'single') {\r\n      // If it work like radio button\r\n      if(groupMinAmount <= 1 && groupMaxAmount == 1) {\r\n        if(amount < groupMinAmount) {\r\n          return;\r\n        }\r\n        // Set zero amount for all options\r\n        for(let itemModifierId in this.modifiersValueTree[groupId]) {\r\n          this.modifiersValueTree[groupId][itemModifierId] = 0\r\n        }\r\n        this.calculateTotalAmountInGroup(groupId);\r\n      }\r\n      // Not action needed after\r\n      if(amount == 0) {\r\n        this.calculateTotalPrice();\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Check Group amount limits\r\n    if(groupMinAmount || groupMaxAmount) {\r\n      // Total amount in group\r\n      const groupAmount: number = this.modifiers.indexById[groupId].totalAmount - previousAmount + amount;\r\n\r\n      if(groupAmount < groupMinAmount) {\r\n        console.warn(`Limit: min ${groupMinAmount}. Current ${groupAmount}`);\r\n        this.eventer.emitMessageEvent(\r\n          new EventMessage(\r\n            'warning',\r\n            'Ограничение',\r\n            `Максимальное количество опций для группы\r\n            модификаторов \"${this.modifiers.indexById[groupId].group.name}\" - не менее ${groupMinAmount}`\r\n          )\r\n        );\r\n        return;\r\n      }\r\n      if(groupAmount > groupMaxAmount) {\r\n        console.warn(`Limit: max ${groupMaxAmount}. Current ${groupAmount}`);\r\n        this.eventer.emitMessageEvent(\r\n          new EventMessage(\r\n            'warning',\r\n            'Ограничение',\r\n            `Максимальное количество опций для группы\r\n            модификаторов \"${this.modifiers.indexById[groupId].group.name}\" - не более ${groupMaxAmount}`\r\n          )\r\n        );\r\n        return;\r\n      }\r\n    }\r\n\r\n    // CHeck Modifier amount limits\r\n    if(minAmount || maxAmount) {\r\n      if(amount < minAmount) {\r\n        switch (operation) {\r\n          case 'plus': amount = minAmount; break;\r\n          case 'minus': amount = 0; break;\r\n        }\r\n      }\r\n      if(amount > maxAmount) {\r\n        amount = maxAmount;\r\n      }\r\n    }\r\n\r\n    this.modifiersValueTree[groupId][modifierId] = amount;\r\n    this.calculateTotalAmountInGroup(groupId);\r\n    this.calculateTotalPrice();\r\n  }\r\n\r\n  setModifiers() {\r\n    const modifiersToSet = [];\r\n\r\n    for(let groupId in this.modifiersValueTree) {\r\n      for(let modifierId in this.modifiersValueTree[groupId]) {\r\n        const amount = this.modifiersValueTree[groupId][modifierId];\r\n        if(amount) {\r\n\r\n          modifiersToSet.push({\r\n            id: modifierId,\r\n            amount: amount,\r\n            groupId: groupId !== 'single' ? groupId : undefined\r\n          });\r\n\r\n        }\r\n      }\r\n    }\r\n\r\n    if(modifiersToSet.length) {\r\n      this.checkValid();\r\n      this.cartService.setModifires(modifiersToSet, []);\r\n    }\r\n  }\r\n\r\n  checkValid() {\r\n\r\n    let isValid = true;\r\n\r\n    for(let groupId in this.modifiersValueTree) {\r\n\r\n      const groupModifier = this.modifiers.indexById[groupId];\r\n      if(groupModifier.required) {\r\n        const totalAmountInGroup = this.calculateTotalAmountInGroup(groupId);\r\n        if(totalAmountInGroup < groupModifier.minAmount) {\r\n          isValid = false;\r\n          console.warn(`Modifier ${groupId} min amount: ${groupModifier.minAmount}`);\r\n        }\r\n        if(totalAmountInGroup > groupModifier.maxAmount) {\r\n          isValid = false;\r\n          console.warn(`Modifier ${groupId} max amount: ${groupModifier.maxAmount}`);\r\n        }\r\n      }\r\n\r\n      //for(let modifierId in this.modifiersValueTree[groupId]) {\r\n      //\r\n      //}\r\n    }\r\n\r\n    this.validate.emit(isValid);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { AddDishToCartDirective } from './directives/add-dish-to-cart.directive';\r\nimport { AmountCartDirective } from './directives/amount-cart.directive';\r\nimport { DeleteFromCartDirective } from './directives/delete-from-cart.directive';\r\nimport { OrderCartUserDirective } from './directives/order-cart-user.directive';\r\nimport { ModifiresDirective } from './directives/modifires.directive';\r\nimport { SetAmountDirective } from './directives/set-amount.directive';\r\nimport { DishCalcDirective } from './directives/dish-calc.directive';\r\nimport { CheckoutDirective } from \"./directives/checkout.directive\";\r\nimport { SetDishCommentDirective } from './directives/set-dish-comment.directive';\r\nimport { DishCalcComponent } from './components/dish-calc/dish-calc.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  providers: [],\r\n  declarations: [\r\n    AddDishToCartDirective,\r\n    AmountCartDirective,\r\n    DeleteFromCartDirective,\r\n    OrderCartUserDirective,\r\n    ModifiresDirective,\r\n    DishCalcDirective,\r\n    SetDishCommentDirective,\r\n    SetAmountDirective,\r\n    CheckoutDirective,\r\n    DishCalcComponent\r\n  ],\r\n  exports: [\r\n    AddDishToCartDirective,\r\n    AmountCartDirective,\r\n    DeleteFromCartDirective,\r\n    OrderCartUserDirective,\r\n    ModifiresDirective,\r\n    DishCalcDirective,\r\n    SetDishCommentDirective,\r\n    SetAmountDirective,\r\n    CheckoutDirective,\r\n    DishCalcComponent\r\n  ]\r\n})\r\nexport class NgRestoCartModule { }\r\n","/*\r\n * Public API Surface of ng-cart\r\n */\r\n\r\nexport * from './lib/services/ng-restocart.service';\r\nexport * from './lib/directives/add-dish-to-cart.directive';\r\nexport * from './lib/directives/amount-cart.directive';\r\nexport * from './lib/directives/checkout.directive';\r\nexport * from './lib/directives/delete-from-cart.directive';\r\nexport * from './lib/directives/dish-calc.directive';\r\nexport * from './lib/directives/modifires.directive';\r\nexport * from './lib/directives/order-cart-user.directive';\r\nexport * from './lib/directives/set-amount.directive';\r\nexport * from './lib/directives/set-dish-comment.directive';\r\nexport * from './lib/components/dish-calc/dish-calc.component';\r\nexport * from './lib/ng-cart.module';","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}